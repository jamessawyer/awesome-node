<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Rollupæ’ä»¶æœºåˆ¶ | Awesome Node</title>
    <meta name="description" content="Node + Vite + Webpack + Babel">
    <link rel="preload stylesheet" href="/awesome-node/assets/style.7fb35bd6.css" as="style">
    <script type="module" src="/awesome-node/assets/app.a4f21f64.js"></script>
    <link rel="preload" href="/awesome-node/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/awesome-node/assets/chunks/framework.7812daa2.js">
  <link rel="modulepreload" href="/awesome-node/assets/chunks/theme.1af457ef.js">
  <link rel="modulepreload" href="/awesome-node/assets/book_vite_11.md.2a52347f.lean.js">
  <link rel="icon" href="/awesome-node/favicon.ico">
  <link rel="apple-touch-icon" href="/awesome-node/pwa-192x192.png" sizes="192x192">
  <meta name="keywords" content="Node, Vite, Webpack, Babel">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  <link rel="manifest" href="/awesome-node/manifest.webmanifest">
  <script id="vite-plugin-pwa:register-sw" src="/awesome-node/registerSW.js"></script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-3e0ca8a2><!--[--><!--]--><!--[--><span tabindex="-1" data-v-33a8c34a></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-33a8c34a> Skip to content </a><!--]--><!----><header class="VPNav" data-v-3e0ca8a2 data-v-b3ff4af3><div class="VPNavBar has-sidebar" data-v-b3ff4af3 data-v-a62ffe7c><div class="container" data-v-a62ffe7c><div class="title" data-v-a62ffe7c><div class="VPNavBarTitle has-sidebar" data-v-a62ffe7c data-v-020ee0c9><a class="title" href="/awesome-node/" data-v-020ee0c9><!--[--><!--]--><!--[--><img class="VPImage logo" src="/awesome-node/logo.svg" alt data-v-e14de6bc><!--]--><!--[-->Awesome Node<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-a62ffe7c><div class="curtain" data-v-a62ffe7c></div><div class="content-body" data-v-a62ffe7c><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a62ffe7c data-v-be64992f><span id="main-nav-aria-label" class="visually-hidden" data-v-be64992f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/awesome-node/v18doc/File-System.html" tabindex="0" data-v-be64992f data-v-2efc767b data-v-c57314a4><!--[-->ğŸ“„Nodeæ–‡æ¡£<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/awesome-node/manager/basic.html" tabindex="0" data-v-be64992f data-v-2efc767b data-v-c57314a4><!--[-->ğŸ“¦å·¥ç¨‹åŒ–<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/awesome-node/core/stream/index.html" tabindex="0" data-v-be64992f data-v-2efc767b data-v-c57314a4><!--[-->ğŸ’«æ ¸å¿ƒæ¦‚å¿µ<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/awesome-node/blog/first.html" tabindex="0" data-v-be64992f data-v-2efc767b data-v-c57314a4><!--[-->ğŸ¤”blog<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-be64992f data-v-ac3e18f4><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-ac3e18f4><span class="text" data-v-ac3e18f4><!----> ğŸ“šä¹¦ç± <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-ac3e18f4><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-ac3e18f4><div class="VPMenu" data-v-ac3e18f4 data-v-52293316><div class="items" data-v-52293316><!--[--><!--[--><div class="VPMenuLink" data-v-52293316 data-v-b997cc47><a class="VPLink link" href="/awesome-node/book/patterns/the-node-platform.html" data-v-b997cc47 data-v-c57314a4><!--[-->Node Design Patterns<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-52293316 data-v-b997cc47><a class="VPLink link" href="/awesome-node/book/vite/2.html" data-v-b997cc47 data-v-c57314a4><!--[-->æ·±å…¥ç†è§£Vite<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-52293316 data-v-b997cc47><a class="VPLink link" href="/awesome-node/book/babel/2.html" data-v-b997cc47 data-v-c57314a4><!--[-->Babelæ’ä»¶ç§˜ç±<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-be64992f data-v-ac3e18f4><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-ac3e18f4><span class="text" data-v-ac3e18f4><!----> ğŸ§‘â€ğŸš€æ¡†æ¶ <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-ac3e18f4><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-ac3e18f4><div class="VPMenu" data-v-ac3e18f4 data-v-52293316><div class="items" data-v-52293316><!--[--><!--[--><div class="VPMenuLink" data-v-52293316 data-v-b997cc47><a class="VPLink link" href="/awesome-node/framework/nestjs/index.html" data-v-b997cc47 data-v-c57314a4><!--[-->NestJS<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-52293316 data-v-b997cc47><a class="VPLink link" href="/awesome-node/framework/express/index.html" data-v-b997cc47 data-v-c57314a4><!--[-->Express<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-be64992f data-v-ac3e18f4><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-ac3e18f4><span class="text" data-v-ac3e18f4><!----> ğŸ”¥å¸¸ç”¨åº“ <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-ac3e18f4><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-ac3e18f4><div class="VPMenu" data-v-ac3e18f4 data-v-52293316><div class="items" data-v-52293316><!--[--><!--[--><div class="VPMenuLink" data-v-52293316 data-v-b997cc47><a class="VPLink link" href="/awesome-node/lib/fs-extra/index.html" data-v-b997cc47 data-v-c57314a4><!--[-->fs-extra<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a62ffe7c data-v-9fd1e4ce><label title="toggle dark mode" data-v-9fd1e4ce data-v-7bce4d0b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-7bce4d0b data-v-bd9ad1cb><span class="check" data-v-bd9ad1cb><span class="icon" data-v-bd9ad1cb><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-7bce4d0b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-7bce4d0b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-a62ffe7c data-v-0b45c657 data-v-ac3e18f4><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-ac3e18f4><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-ac3e18f4><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-ac3e18f4><div class="VPMenu" data-v-ac3e18f4 data-v-52293316><!----><!--[--><!--[--><!----><div class="group" data-v-0b45c657><div class="item appearance" data-v-0b45c657><p class="label" data-v-0b45c657>Appearance</p><div class="appearance-action" data-v-0b45c657><label title="toggle dark mode" data-v-0b45c657 data-v-7bce4d0b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-7bce4d0b data-v-bd9ad1cb><span class="check" data-v-bd9ad1cb><span class="icon" data-v-bd9ad1cb><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-7bce4d0b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-7bce4d0b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a62ffe7c data-v-5b16ccf2><span class="container" data-v-5b16ccf2><span class="top" data-v-5b16ccf2></span><span class="middle" data-v-5b16ccf2></span><span class="bottom" data-v-5b16ccf2></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-3e0ca8a2 data-v-e1d0b1c9><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-e1d0b1c9><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-e1d0b1c9><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-e1d0b1c9>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-e1d0b1c9 data-v-f889330c><button data-v-f889330c>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-3e0ca8a2 data-v-681ed879><div class="curtain" data-v-681ed879></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-681ed879><span class="visually-hidden" id="sidebar-aria-label" data-v-681ed879> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-681ed879><section class="VPSidebarItem level-0 has-active" data-v-681ed879 data-v-f538e8c9><div class="item" role="button" tabindex="0" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><h2 class="text" data-v-f538e8c9>ğŸ”§æ·±å…¥ç†è§£Vite</h2><!----></div><div class="items" data-v-f538e8c9><!--[--><div class="VPSidebarItem level-1 is-link" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/1.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>1.Viteå¼€ç¯‡</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/2.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>2.æ¨¡å—æ ‡å‡†</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/3.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>3.å¿«é€Ÿä¸Šæ‰‹Vite</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/4.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>4.æ ·å¼æ–¹æ¡ˆ</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/7.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>7.é¢„æ„å»º</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/8.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>8.åŒå¼•æ“æ¶æ„</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/9.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>9.æ€§èƒ½æ¨æ‰‹: Esbuild</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/10.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>10.RollupåŸºæœ¬ç”¨æ³•</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/11.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>11.æ·±å…¥ç†è§£Rollupæ’ä»¶æœºåˆ¶</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/12.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>12.Viteæ’ä»¶å¼€å‘</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/14.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>14.ä»£ç åˆ†å‰²</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/15.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>15.Polyfillå’Œè¯­æ³•é™çº§</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/16.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>16.Viteæ­å»ºSSRå·¥ç¨‹</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/17.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>17.è”é‚¦æ¨¡å—ä»¥åŠåŸç†</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/18.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>18.Pure ESMæ—¶ä»£</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f538e8c9 data-v-f538e8c9><div class="item" data-v-f538e8c9><div class="indicator" data-v-f538e8c9></div><a class="VPLink link link" href="/awesome-node/book/vite/19.html" data-v-f538e8c9 data-v-c57314a4><!--[--><p class="text" data-v-f538e8c9>19.ç³»ç»Ÿå¯¹Viteé¡¹ç›®æ€§èƒ½ä¼˜åŒ–</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-3e0ca8a2 data-v-5394fe7f><div class="VPDoc has-sidebar has-aside" data-v-5394fe7f data-v-8682743f><!--[--><!--]--><div class="container" data-v-8682743f><div class="aside" data-v-8682743f><div class="aside-curtain" data-v-8682743f></div><div class="aside-container" data-v-8682743f><div class="aside-content" data-v-8682743f><div class="VPDocAside" data-v-8682743f data-v-1ec6a5e2><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-1ec6a5e2 data-v-52cdc596><div class="content" data-v-52cdc596><div class="outline-marker" data-v-52cdc596></div><div class="outline-title" data-v-52cdc596>ç›®å½•</div><nav aria-labelledby="doc-outline-aria-label" data-v-52cdc596><span class="visually-hidden" id="doc-outline-aria-label" data-v-52cdc596> Table of Contents for current page </span><ul class="root" data-v-52cdc596 data-v-61fad279><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-1ec6a5e2></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-8682743f><div class="content-container" data-v-8682743f><!--[--><!--]--><!----><main class="main" data-v-8682743f><div style="position:relative;" class="vp-doc _awesome-node_book_vite_11" data-v-8682743f><div><p>ä¸Šä¸€èŠ‚æˆ‘ä»¬å­¦ä¼šäº† Rollup æ„å»ºå·¥å…·çš„ä½¿ç”¨ï¼Œç›¸ä¿¡ä½ å·²ç»å¯¹ Rollup çš„åŸºç¡€æ¦‚å¿µå’Œä½¿ç”¨æœ‰äº†åŸºæœ¬çš„æŒæ¡ã€‚åŒæ—¶æˆ‘ä»¬ä¹ŸçŸ¥é“ï¼Œä»…ä»…ä½¿ç”¨ Rollup å†…ç½®çš„æ‰“åŒ…èƒ½åŠ›å¾ˆéš¾æ»¡è¶³é¡¹ç›®æ—¥ç›Šå¤æ‚çš„æ„å»ºéœ€æ±‚ã€‚å¯¹äºä¸€ä¸ªçœŸå®çš„é¡¹ç›®æ„å»ºåœºæ™¯æ¥è¯´ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘åˆ°<code>æ¨¡å—æ‰“åŒ…</code>ä¹‹å¤–çš„é—®é¢˜ï¼Œæ¯”å¦‚<strong>è·¯å¾„åˆ«å(alias)</strong> ã€<strong>å…¨å±€å˜é‡æ³¨å…¥</strong>å’Œ<strong>ä»£ç å‹ç¼©</strong>ç­‰ç­‰ã€‚</p><p>å¯è¦æ˜¯æŠŠè¿™äº›åœºæ™¯çš„å¤„ç†é€»è¾‘ä¸æ ¸å¿ƒçš„æ‰“åŒ…é€»è¾‘éƒ½å†™åˆ°ä¸€èµ·ï¼Œä¸€æ¥æ‰“åŒ…å™¨æœ¬èº«çš„ä»£ç ä¼šå˜å¾—ååˆ†è‡ƒè‚¿ï¼ŒäºŒæ¥ä¹Ÿä¼šå¯¹åŸæœ‰çš„æ ¸å¿ƒä»£ç äº§ç”Ÿä¸€å®šçš„ä¾µå…¥æ€§ï¼Œæ··å…¥å¾ˆå¤šä¸æ ¸å¿ƒæµç¨‹æ— å…³çš„ä»£ç ï¼Œä¸æ˜“äºåæœŸçš„ç»´æŠ¤ã€‚å› æ­¤ ï¼ŒRollup è®¾è®¡å‡ºäº†ä¸€å¥—å®Œæ•´çš„<strong>æ’ä»¶æœºåˆ¶</strong>ï¼Œå°†è‡ªèº«çš„æ ¸å¿ƒé€»è¾‘ä¸æ’ä»¶é€»è¾‘åˆ†ç¦»ï¼Œè®©ä½ èƒ½æŒ‰éœ€å¼•å…¥æ’ä»¶åŠŸèƒ½ï¼Œæé«˜äº† Rollup è‡ªèº«çš„å¯æ‰©å±•æ€§ã€‚</p><p>æˆ‘ä¸ªäººä¹Ÿéå¸¸å–œæ¬¢ Rollup çš„æ’ä»¶æœºåˆ¶ï¼ŒåŠŸèƒ½å®Œå¤‡åˆç®€å•æ˜“ä¸Šæ‰‹ï¼Œä½“ç°äº† Rollup æœ¬èº«å°è€Œç¾çš„é£æ ¼ã€‚é‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šå¸¦ä½ åˆ†æ Rollup çš„æ’ä»¶æœºåˆ¶ï¼Œç†Ÿæ‚‰ Rollup æ’ä»¶çš„å®Œæ•´æ„å»ºé˜¶æ®µå’Œå·¥ä½œæµç¨‹ï¼Œå¹¶ä¸”ç»“åˆæ¡ˆä¾‹æ·±å…¥æ’ä»¶å¼€å‘ç»†èŠ‚ã€‚</p><p>Rollup çš„æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œä¼šå®šä¹‰ä¸€å¥—å®Œæ•´çš„æ„å»ºç”Ÿå‘½å‘¨æœŸï¼Œä»å¼€å§‹æ‰“åŒ…åˆ°äº§ç‰©è¾“å‡ºï¼Œä¸­é€”ä¼šç»å†ä¸€äº›<strong>æ ‡å¿—æ€§çš„é˜¶æ®µ</strong>ï¼Œå¹¶ä¸”åœ¨ä¸åŒé˜¶æ®µä¼šè‡ªåŠ¨æ‰§è¡Œå¯¹åº”çš„æ’ä»¶é’©å­å‡½æ•°(Hook)ã€‚å¯¹ Rollup æ’ä»¶æ¥è®²ï¼Œæœ€é‡è¦çš„éƒ¨åˆ†æ˜¯é’©å­å‡½æ•°ï¼Œä¸€æ–¹é¢å®ƒå®šä¹‰äº†æ’ä»¶çš„æ‰§è¡Œé€»è¾‘ï¼Œä¹Ÿå°±æ˜¯&quot;åšä»€ä¹ˆ&quot;ï¼›å¦ä¸€æ–¹é¢ä¹Ÿå£°æ˜äº†æ’ä»¶çš„ä½œç”¨é˜¶æ®µï¼Œå³&quot;ä»€ä¹ˆæ—¶å€™åš&quot;ï¼Œè¿™ä¸ Rollup æœ¬èº«çš„æ„å»ºç”Ÿå‘½å‘¨æœŸæ¯æ¯ç›¸å…³ã€‚</p><p>å› æ­¤ï¼Œè¦çœŸæ­£ç†è§£æ’ä»¶çš„ä½œç”¨èŒƒå›´å’Œé˜¶æ®µï¼Œé¦–å…ˆéœ€è¦äº†è§£ Rollup æ•´ä½“çš„æ„å»ºè¿‡ç¨‹ä¸­åˆ°åº•åšäº†äº›ä»€ä¹ˆã€‚</p><h2 id="rollup-æ•´ä½“æ„å»ºé˜¶æ®µ" tabindex="-1">Rollup æ•´ä½“æ„å»ºé˜¶æ®µ <a class="header-anchor" href="#rollup-æ•´ä½“æ„å»ºé˜¶æ®µ" aria-label="Permalink to &quot;Rollup æ•´ä½“æ„å»ºé˜¶æ®µ&quot;">â€‹</a></h2><p>åœ¨æ‰§è¡Œ <code>rollup</code> å‘½ä»¤ä¹‹åï¼Œåœ¨ cli å†…éƒ¨çš„ä¸»è¦é€»è¾‘ç®€åŒ–å¦‚ä¸‹:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line highlighted"><span style="color:#676E95;font-style:italic;">// 1ï¸âƒ£ Build é˜¶æ®µ</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> bundle </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> rollup</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">rollup</span><span style="color:#A6ACCD;">(inputOptions)</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// 2ï¸âƒ£ Output é˜¶æ®µ</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">(outputOptions</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#A6ACCD;">(bundle</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">write))</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// 3ï¸âƒ£ æ„å»ºç»“æŸ</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> bundle</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">close</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span></code></pre></div><p>Rollupå†…éƒ¨ä¸»è¦ç»å†äº† <code>Build</code> å’Œ <code>Output</code> ä¸¤å¤§é˜¶æ®µï¼š</p><p><img src="/awesome-node/assets/11-1.381e7c72.webp" alt="Rollupæ„å»ºé˜¶æ®µ"></p><p>é¦–å…ˆï¼ŒBuild é˜¶æ®µä¸»è¦è´Ÿè´£åˆ›å»ºæ¨¡å—ä¾èµ–å›¾ï¼Œåˆå§‹åŒ–å„ä¸ªæ¨¡å—çš„ AST ä»¥åŠæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥æ„Ÿå—ä¸€ä¸‹:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// src/index.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./module-a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(a)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// src/module-a.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>ç„¶åæ‰§è¡Œå¦‚ä¸‹çš„æ„å»ºè„šæœ¬:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rollup</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rollup</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">inspect</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node:util</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">build</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bundle</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">rollup</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    input</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./src/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">inspect</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">bundle</span><span style="color:#F07178;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">build</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°è¿™æ ·çš„ <code>bundle</code> å¯¹è±¡ä¿¡æ¯:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">cache</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">     </span><span style="color:#FFCB6B;">modules</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        ast</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">AST èŠ‚ç‚¹ä¿¡æ¯ï¼Œå…·ä½“å†…å®¹çœç•¥</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">export const a = 1;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        dependencies</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/code/rollup-demo/src/module-a.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        resolveIds</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// å…¶å®ƒå±æ€§çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        ast</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">AST èŠ‚ç‚¹ä¿¡æ¯ï¼Œå…·ä½“å†…å®¹çœç•¥</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">import { a } from &#39;./module-a.js&#39;;</span><span style="color:#A6ACCD;">\n\n</span><span style="color:#C3E88D;">console.log(a);</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        dependencies</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/code/rollup-demo/src/module-a.js</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">        ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/code/rollup-demo/src/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        resolveIds</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">./module-a.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            assertions</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#F07178;">            external</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/code/rollup-demo/src/module-a.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            meta</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#F07178;">            moduleSideEffects</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            resolvedBy</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rollup</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            syntheticNamedExports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// å…¶å®ƒå±æ€§çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">Object</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">prototype</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">closed</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æŒ‚è½½åç»­é˜¶æ®µä¼šæ‰§è¡Œçš„æ–¹æ³•</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">close</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">AsyncFunction</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">close</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">generate</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">AsyncFunction</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">generate</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">write</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">AsyncFunction</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">write</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">watchFiles</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/code/rollup-demo/src/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/code/rollup-demo/src/module-a.js</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ä»ä¸Šé¢çš„ä¿¡æ¯ä¸­å¯ä»¥çœ‹å‡ºï¼Œç›®å‰ç»è¿‡ Build é˜¶æ®µçš„ <code>bundle</code> å¯¹è±¡å…¶å®å¹¶æ²¡æœ‰è¿›è¡Œæ¨¡å—çš„æ‰“åŒ…ï¼Œè¿™ä¸ªå¯¹è±¡çš„ä½œç”¨åœ¨äºå­˜å‚¨å„ä¸ªæ¨¡å—çš„å†…å®¹åŠä¾èµ–å…³ç³»ï¼ŒåŒæ—¶æš´éœ²<code>generate</code>å’Œ<code>write</code>æ–¹æ³•ï¼Œä»¥è¿›å…¥åˆ°åç»­çš„ <code>Output</code> é˜¶æ®µï¼ˆ<code>write</code>å’Œ<code>generate</code>æ–¹æ³•å”¯ä¸€çš„åŒºåˆ«åœ¨äºå‰è€…æ‰“åŒ…å®Œäº§ç‰©ä¼šå†™å…¥ç£ç›˜ï¼Œè€Œåè€…ä¸ä¼šï¼‰ã€‚</p><p>æ‰€ä»¥ï¼ŒçœŸæ­£è¿›è¡Œæ‰“åŒ…çš„è¿‡ç¨‹ä¼šåœ¨ <code>Output</code> é˜¶æ®µè¿›è¡Œï¼Œå³åœ¨<code>bundle</code>å¯¹è±¡çš„ <code>generate</code>æˆ–è€…<code>write</code>æ–¹æ³•ä¸­è¿›è¡Œã€‚è¿˜æ˜¯ä»¥ä¸Šé¢çš„ demo ä¸ºä¾‹ï¼Œæˆ‘ä»¬ç¨ç¨æ”¹åŠ¨ä¸€ä¸‹æ„å»ºé€»è¾‘:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rollup</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rollup</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">build</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bundle</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">rollup</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    input</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./src/module-b.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bundle</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">generate</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">    format</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">es</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">build</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span></code></pre></div><p>æ‰§è¡Œåå¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„è¾“å‡º:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">output</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      exports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      facadeModuleId</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/Users/code/rollup-demo/src/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      isDynamicEntry</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      isEntry</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      isImplicitEntry</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      moduleIds</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">Array</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      type</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">chunk</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      dynamicImports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      fileName</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      implicitlyLoadedBefore</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      importedBindings</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#F07178;">      imports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      modules</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">Object</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">prototype</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      referencedFiles</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">const a = 1;</span><span style="color:#A6ACCD;">\n\n</span><span style="color:#C3E88D;">console.log(a);</span><span style="color:#A6ACCD;">\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      map</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  ]</span></span>
<span class="line"></span></code></pre></div><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„è¾“å‡ºä¿¡æ¯ï¼Œç”Ÿæˆçš„<code>output</code>æ•°ç»„å³ä¸ºæ‰“åŒ…å®Œæˆçš„ç»“æœã€‚å½“ç„¶ï¼Œå¦‚æœä½¿ç”¨ <code>bundle.write</code> ä¼šæ ¹æ®é…ç½®å°†æœ€åçš„äº§ç‰©å†™å…¥åˆ°æŒ‡å®šçš„ç£ç›˜ç›®å½•ä¸­ã€‚</p><p>å› æ­¤ï¼Œ<strong>å¯¹äºä¸€æ¬¡å®Œæ•´çš„æ„å»ºè¿‡ç¨‹è€Œè¨€ï¼Œ</strong> <strong>Rollup</strong> <strong>ä¼šå…ˆè¿›å…¥åˆ° <code>Build</code> é˜¶æ®µï¼Œè§£æå„æ¨¡å—çš„å†…å®¹åŠä¾èµ–å…³ç³»ï¼Œç„¶åè¿›å…¥</strong><code>Output</code><strong>é˜¶æ®µï¼Œå®Œæˆæ‰“åŒ…åŠè¾“å‡ºçš„è¿‡ç¨‹</strong>ã€‚å¯¹äºä¸åŒçš„é˜¶æ®µï¼ŒRollup æ’ä»¶ä¼šæœ‰ä¸åŒçš„æ’ä»¶å·¥ä½œæµç¨‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥æ‹†è§£ä¸€ä¸‹ Rollup æ’ä»¶åœ¨ <code>Build</code> å’Œ <code>Output</code> ä¸¤ä¸ªé˜¶æ®µçš„è¯¦ç»†å·¥ä½œæµç¨‹ã€‚</p><h2 id="æ‹†è§£æ’ä»¶å·¥ä½œæµ" tabindex="-1">æ‹†è§£æ’ä»¶å·¥ä½œæµ <a class="header-anchor" href="#æ‹†è§£æ’ä»¶å·¥ä½œæµ" aria-label="Permalink to &quot;æ‹†è§£æ’ä»¶å·¥ä½œæµ&quot;">â€‹</a></h2><h3 id="è°ˆè°ˆæ’ä»¶-hook-ç±»å‹" tabindex="-1">è°ˆè°ˆæ’ä»¶ Hook ç±»å‹ <a class="header-anchor" href="#è°ˆè°ˆæ’ä»¶-hook-ç±»å‹" aria-label="Permalink to &quot;è°ˆè°ˆæ’ä»¶ Hook ç±»å‹&quot;">â€‹</a></h3><p>åœ¨å…·ä½“è®²è¿° Rollup æ’ä»¶å·¥ä½œæµä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹ä¸åŒæ’ä»¶ Hook çš„ç±»å‹ï¼Œè¿™äº›ç±»å‹ä»£è¡¨äº†ä¸åŒæ’ä»¶çš„æ‰§è¡Œç‰¹ç‚¹ï¼Œæ˜¯æˆ‘ä»¬ç†è§£ Rollup æ’ä»¶å·¥ä½œæµçš„åŸºç¡€ï¼Œå› æ­¤æœ‰å¿…è¦è·Ÿå¤§å®¶å¥½å¥½æ‹†è§£ä¸€ä¸‹ã€‚</p><p>é€šè¿‡ä¸Šæ–‡çš„ä¾‹å­ï¼Œç›¸ä¿¡ä½ å¯ä»¥ç›´è§‚åœ°ç†è§£ Rollup ä¸¤å¤§æ„å»ºé˜¶æ®µï¼ˆ<code>Build</code>å’Œ<code>Output</code>ï¼‰å„è‡ªçš„åŸç†ã€‚å¯èƒ½ä½ ä¼šæœ‰ç–‘é—®ï¼Œè¿™ä¸¤ä¸ªé˜¶æ®µåˆ°åº•è·Ÿæ’ä»¶æœºåˆ¶æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿå®é™…ä¸Šï¼Œæ’ä»¶çš„å„ç§ Hook å¯ä»¥æ ¹æ®è¿™ä¸¤ä¸ªæ„å»ºé˜¶æ®µåˆ†ä¸ºä¸¤ç±»: <code>Build Hook</code> ä¸ <code>Output Hook</code>:</p><ul><li><code>Build Hook</code>å³åœ¨<code>Build</code>é˜¶æ®µæ‰§è¡Œçš„é’©å­å‡½æ•°ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µä¸»è¦è¿›è¡Œæ¨¡å—ä»£ç çš„è½¬æ¢ã€AST è§£æä»¥åŠæ¨¡å—ä¾èµ–çš„è§£æï¼Œé‚£ä¹ˆè¿™ä¸ªé˜¶æ®µçš„ Hook å¯¹äºä»£ç çš„æ“ä½œç²’åº¦ä¸€èˆ¬ä¸º<code>æ¨¡å—</code>çº§åˆ«ï¼Œä¹Ÿå°±æ˜¯å•æ–‡ä»¶çº§åˆ«</li><li><code>Ouput Hook</code>(å®˜æ–¹ç§°ä¸º<code>Output Generation Hook</code>)ï¼Œåˆ™ä¸»è¦è¿›è¡Œä»£ç çš„æ‰“åŒ…ï¼Œå¯¹äºä»£ç è€Œè¨€ï¼Œæ“ä½œç²’åº¦ä¸€èˆ¬ä¸º <code>chunk</code>çº§åˆ«(ä¸€ä¸ª chunk é€šå¸¸æŒ‡å¾ˆå¤šæ–‡ä»¶æ‰“åŒ…åˆ°ä¸€èµ·çš„äº§ç‰©)</li></ul><p>é™¤äº†æ ¹æ®æ„å»ºé˜¶æ®µå¯ä»¥å°† Rollup æ’ä»¶è¿›è¡Œåˆ†ç±»ï¼Œæ ¹æ®ä¸åŒçš„ Hook æ‰§è¡Œæ–¹å¼ä¹Ÿä¼šæœ‰ä¸åŒçš„åˆ†ç±»ï¼Œä¸»è¦åŒ…æ‹¬<code>Async</code>ã€<code>Sync</code>ã€<code>Parallel</code>ã€<code>Squential</code>ã€<code>First</code>è¿™äº”ç§ã€‚åœ¨åæ–‡ä¸­æˆ‘ä»¬å°†æ¥è§¦å„ç§å„æ ·çš„æ’ä»¶ Hookï¼Œä½†æ— è®ºå“ªä¸ª Hook éƒ½ç¦»ä¸å¼€è¿™äº”ç§æ‰§è¡Œæ–¹å¼ã€‚</p><h4 id="_1-async-sync" tabindex="-1"><strong>1. Async &amp; Sync</strong> <a class="header-anchor" href="#_1-async-sync" aria-label="Permalink to &quot;**1. Async &amp; Sync**&quot;">â€‹</a></h4><p>é¦–å…ˆæ˜¯<code>Async</code>å’Œ<code>Sync</code>é’©å­å‡½æ•°ï¼Œä¸¤è€…å…¶å®æ˜¯ç›¸å¯¹çš„ï¼Œåˆ†åˆ«ä»£è¡¨<code>å¼‚æ­¥</code>å’Œ<code>åŒæ­¥</code>çš„é’©å­å‡½æ•°ï¼Œä¸¤è€…æœ€å¤§çš„åŒºåˆ«åœ¨äºåŒæ­¥é’©å­é‡Œé¢ä¸èƒ½æœ‰å¼‚æ­¥é€»è¾‘ï¼Œè€Œå¼‚æ­¥é’©å­å¯ä»¥æœ‰ã€‚</p><h4 id="_2-parallel" tabindex="-1"><strong>2. Parallel</strong> <a class="header-anchor" href="#_2-parallel" aria-label="Permalink to &quot;**2. Parallel**&quot;">â€‹</a></h4><p>è¿™é‡ŒæŒ‡å¹¶è¡Œçš„é’©å­å‡½æ•°ã€‚å¦‚æœæœ‰å¤šä¸ªæ’ä»¶å®ç°äº†è¿™ä¸ªé’©å­çš„é€»è¾‘ï¼Œä¸€æ—¦æœ‰é’©å­å‡½æ•°æ˜¯å¼‚æ­¥é€»è¾‘ï¼Œåˆ™å¹¶å‘æ‰§è¡Œé’©å­å‡½æ•°ï¼Œä¸ä¼šç­‰å¾…å½“å‰é’©å­å®Œæˆ(åº•å±‚ä½¿ç”¨ <code>Promise.all</code>)ã€‚</p><p>æ¯”å¦‚å¯¹äº<code>Build</code>é˜¶æ®µçš„<code>buildStart</code>é’©å­ï¼Œå®ƒçš„æ‰§è¡Œæ—¶æœºå…¶å®æ˜¯åœ¨æ„å»ºåˆšå¼€å§‹çš„æ—¶å€™ï¼Œå„ä¸ªæ’ä»¶å¯ä»¥åœ¨è¿™ä¸ªé’©å­å½“ä¸­åšä¸€äº›çŠ¶æ€çš„åˆå§‹åŒ–æ“ä½œï¼Œä½†å…¶å®æ’ä»¶ä¹‹é—´çš„æ“ä½œå¹¶ä¸æ˜¯ç›¸äº’ä¾èµ–çš„ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œä»è€Œæå‡æ„å»ºæ€§èƒ½ã€‚åä¹‹ï¼Œå¯¹äºéœ€è¦<strong>ä¾èµ–å…¶ä»–æ’ä»¶å¤„ç†ç»“æœ</strong>çš„æƒ…å†µå°±ä¸é€‚åˆç”¨ <code>Parallel</code> é’©å­äº†ï¼Œæ¯”å¦‚ <code>transform</code>ã€‚</p><h4 id="_3-sequential" tabindex="-1"><strong>3. Sequential</strong> <a class="header-anchor" href="#_3-sequential" aria-label="Permalink to &quot;**3. Sequential**&quot;">â€‹</a></h4><p><strong>Sequential</strong> æŒ‡ä¸²è¡Œçš„é’©å­å‡½æ•°ã€‚è¿™ç§ Hook å¾€å¾€é€‚ç”¨äºæ’ä»¶é—´å¤„ç†ç»“æœç›¸äº’ä¾èµ–çš„æƒ…å†µï¼Œå‰ä¸€ä¸ªæ’ä»¶ Hook çš„è¿”å›å€¼ä½œä¸ºåç»­æ’ä»¶çš„å…¥å‚ï¼Œè¿™ç§æƒ…å†µå°±éœ€è¦ç­‰å¾…å‰ä¸€ä¸ªæ’ä»¶æ‰§è¡Œå®Œ Hookï¼Œè·å¾—å…¶æ‰§è¡Œç»“æœï¼Œç„¶åæ‰èƒ½è¿›è¡Œä¸‹ä¸€ä¸ªæ’ä»¶ç›¸åº” Hook çš„è°ƒç”¨ï¼Œå¦‚<code>transform</code>ã€‚</p><h4 id="_4-first" tabindex="-1"><strong>4. First</strong> <a class="header-anchor" href="#_4-first" aria-label="Permalink to &quot;**4. First**&quot;">â€‹</a></h4><p>å¦‚æœæœ‰å¤šä¸ªæ’ä»¶å®ç°äº†è¿™ä¸ª Hookï¼Œé‚£ä¹ˆ Hook å°†ä¾æ¬¡è¿è¡Œï¼Œç›´åˆ°è¿”å›ä¸€ä¸ªé <code>null</code> æˆ–é <code>undefined</code> çš„å€¼ä¸ºæ­¢ã€‚æ¯”è¾ƒå…¸å‹çš„ Hook æ˜¯ <code>resolveId</code>ï¼Œä¸€æ—¦æœ‰æ’ä»¶çš„ resolveId è¿”å›äº†ä¸€ä¸ªè·¯å¾„ï¼Œå°†åœæ­¢æ‰§è¡Œåç»­æ’ä»¶çš„ resolveId é€»è¾‘ã€‚</p><p>åˆšåˆšæˆ‘ä»¬ä»‹ç»äº† Rollup å½“ä¸­ä¸åŒæ’ä»¶ Hook çš„ç±»å‹ï¼Œå®é™…ä¸Šä¸åŒçš„ç±»å‹æ˜¯å¯ä»¥å åŠ çš„ï¼Œ<code>Async</code>/<code>Sync</code> å¯ä»¥æ­é…åé¢ä¸‰ç§ç±»å‹ä¸­çš„ä»»æ„ä¸€ç§ï¼Œæ¯”å¦‚ä¸€ä¸ª Hookæ—¢å¯ä»¥æ˜¯ <code>Async</code> ä¹Ÿå¯ä»¥æ˜¯ <code>First</code> ç±»å‹ï¼Œæ¥ç€æˆ‘ä»¬å°†æ¥å…·ä½“åˆ†æ Rollup å½“ä¸­çš„æ’ä»¶å·¥ä½œæµç¨‹ï¼Œé‡Œé¢ä¼šæ¶‰åŠåˆ°å…·ä½“çš„ä¸€äº› Hookï¼Œå¤§å®¶å¯ä»¥å…·ä½“åœ°æ„Ÿå—ä¸€ä¸‹ã€‚</p><h3 id="build-é˜¶æ®µå·¥ä½œæµ" tabindex="-1">Build é˜¶æ®µå·¥ä½œæµ <a class="header-anchor" href="#build-é˜¶æ®µå·¥ä½œæµ" aria-label="Permalink to &quot;Build é˜¶æ®µå·¥ä½œæµ&quot;">â€‹</a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥åˆ†æ Build é˜¶æ®µçš„æ’ä»¶å·¥ä½œæµç¨‹ã€‚å¯¹äº Build é˜¶æ®µï¼Œæ’ä»¶ Hook çš„è°ƒç”¨æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æµç¨‹å›¾çš„æœ€ä¸Šé¢å£°æ˜äº†ä¸åŒ Hook çš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢æ€»ç»“çš„ 5 ç§ Hook åˆ†ç±»ï¼Œæ¯ä¸ªæ–¹å—ä»£è¡¨äº†ä¸€ä¸ª Hookï¼Œè¾¹æ¡†çš„é¢œè‰²å¯ä»¥è¡¨ç¤º<code>Async</code>å’Œ<code>Sync</code> ç±»å‹ï¼Œæ–¹å—çš„å¡«å……é¢œè‰²å¯ä»¥è¡¨ç¤º<code>Parallel</code>ã€<code>Sequential</code> å’Œ<code>First</code> ç±»å‹ã€‚</p><p><img src="/awesome-node/assets/11-2.ee890fb0.webp" alt="Rollup Build Phase"></p><p>ä¹ä¸€çœ‹æ˜¯ä¸æ˜¯æ„Ÿè§‰è¿™å¼ å›¾éå¸¸å¤æ‚ï¼Ÿæ²¡å…³ç³»ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šå’Œä½ ä¸€æ­¥æ­¥åˆ†æ <code>Build Hooks</code> çš„å·¥ä½œæµç¨‹ï¼Œä½ å¯ä»¥å¯¹ç…§ç€å›¾ä¸€èµ·çœ‹:</p><ol><li>é¦–å…ˆç»å† <code>options</code> é’©å­è¿›è¡Œé…ç½®çš„è½¬æ¢ï¼Œå¾—åˆ°å¤„ç†åçš„é…ç½®å¯¹è±¡ã€‚</li><li>éšä¹‹ Rollup ä¼šè°ƒç”¨<code>buildStart</code>é’©å­ï¼Œæ­£å¼å¼€å§‹æ„å»ºæµç¨‹ã€‚</li><li>Rollup å…ˆè¿›å…¥åˆ° <code>resolveId</code> é’©å­ä¸­è§£ææ–‡ä»¶è·¯å¾„ã€‚(ä» <code>input</code> é…ç½®æŒ‡å®šçš„å…¥å£æ–‡ä»¶å¼€å§‹)ã€‚</li><li>Rollup é€šè¿‡è°ƒç”¨<code>load</code>é’©å­åŠ è½½æ¨¡å—å†…å®¹ã€‚</li><li>ç´§æ¥ç€ Rollup æ‰§è¡Œæ‰€æœ‰çš„ <code>transform</code> é’©å­æ¥å¯¹æ¨¡å—å†…å®¹è¿›è¡Œè¿›è¡Œè‡ªå®šä¹‰çš„è½¬æ¢ï¼Œæ¯”å¦‚ babel è½¬è¯‘ã€‚</li><li>ç°åœ¨ Rollup æ‹¿åˆ°æœ€åçš„æ¨¡å—å†…å®¹ï¼Œè¿›è¡Œ AST åˆ†æï¼Œå¾—åˆ°æ‰€æœ‰çš„ import å†…å®¹ï¼Œè°ƒç”¨ <code>moduleParsed</code> é’©å­: <ol><li>å¦‚æœæ˜¯æ™®é€šçš„ importï¼Œåˆ™æ‰§è¡Œ <code>resolveId</code> é’©å­ï¼Œç»§ç»­å›åˆ°æ­¥éª¤<code>3</code>ã€‚</li><li>å¦‚æœæ˜¯åŠ¨æ€ importï¼Œåˆ™æ‰§è¡Œ <code>resolveDynamicImport</code> é’©å­è§£æè·¯å¾„ï¼Œå¦‚æœè§£ææˆåŠŸï¼Œåˆ™å›åˆ°æ­¥éª¤<code>4</code>åŠ è½½æ¨¡å—ï¼Œå¦åˆ™å›åˆ°æ­¥éª¤<code>3</code>é€šè¿‡ <code>resolveId</code> è§£æè·¯å¾„ã€‚</li></ol></li><li>ç›´åˆ°æ‰€æœ‰çš„ import éƒ½è§£æå®Œæ¯•ï¼ŒRollup æ‰§è¡Œ<code>buildEnd</code>é’©å­ï¼ŒBuild é˜¶æ®µç»“æŸã€‚</li></ol><p>å½“ç„¶ï¼Œåœ¨ Rollup è§£æè·¯å¾„çš„æ—¶å€™ï¼Œå³æ‰§è¡Œ<code>resolveId</code>æˆ–è€…<code>resolveDynamicImport</code>çš„æ—¶å€™ï¼Œæœ‰äº›è·¯å¾„å¯èƒ½ä¼šè¢«æ ‡è®°ä¸º<code>external</code>(ç¿»è¯‘ä¸º<code>æ’é™¤</code>)ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å‚åŠ  Rollup æ‰“åŒ…è¿‡ç¨‹ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¸ä¼šè¿›è¡Œ<code>load</code>ã€<code>transform</code>ç­‰ç­‰åç»­çš„å¤„ç†äº†ã€‚</p><p>åœ¨æµç¨‹å›¾æœ€ä¸Šé¢ï¼Œä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰æ³¨æ„åˆ°<code>watchChange</code>å’Œ<code>closeWatcher</code>è¿™ä¸¤ä¸ª Hookï¼Œè¿™é‡Œå…¶å®æ˜¯å¯¹åº”äº† rollup çš„<code>watch</code>æ¨¡å¼ã€‚å½“ä½ ä½¿ç”¨ <code>rollup --watch</code> æŒ‡ä»¤æˆ–è€…åœ¨é…ç½®æ–‡ä»¶é…æœ‰<code>watch: true</code>çš„å±æ€§æ—¶ï¼Œä»£è¡¨å¼€å¯äº† Rollup çš„<code>watch</code>æ‰“åŒ…æ¨¡å¼ï¼Œè¿™ä¸ªæ—¶å€™ Rollup å†…éƒ¨ä¼šåˆå§‹åŒ–ä¸€ä¸ª <code>watcher</code> å¯¹è±¡ï¼Œå½“æ–‡ä»¶å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œwatcher å¯¹è±¡ä¼šè‡ªåŠ¨è§¦å‘<code>watchChange</code>é’©å­æ‰§è¡Œå¹¶å¯¹é¡¹ç›®è¿›è¡Œé‡æ–°æ„å»ºã€‚åœ¨å½“å‰<strong>æ‰“åŒ…è¿‡ç¨‹ç»“æŸ</strong>æ—¶ï¼ŒRollup ä¼šè‡ªåŠ¨æ¸…é™¤ watcher å¯¹è±¡è°ƒç”¨<code>closeWacher</code>é’©å­ã€‚</p><h3 id="output-é˜¶æ®µå·¥ä½œæµ" tabindex="-1">Output é˜¶æ®µå·¥ä½œæµ <a class="header-anchor" href="#output-é˜¶æ®µå·¥ä½œæµ" aria-label="Permalink to &quot;Output é˜¶æ®µå·¥ä½œæµ&quot;">â€‹</a></h3><p>å¥½ï¼Œæ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹ Output é˜¶æ®µçš„æ’ä»¶åˆ°åº•æ˜¯å¦‚ä½•æ¥è¿›è¡Œå·¥ä½œçš„ã€‚è¿™ä¸ªé˜¶æ®µçš„ Hook ç›¸æ¯”äº Build é˜¶æ®µç¨å¾®å¤šä¸€äº›ï¼Œæµç¨‹ä¸Šä¹Ÿæ›´åŠ å¤æ‚ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…¶ä¸­ä¼šæ¶‰åŠçš„ Hook å‡½æ•°æ¯”è¾ƒå¤šï¼Œå¯èƒ½ä¼šç»™ä½ ç†è§£æ•´ä¸ªæµç¨‹å¸¦æ¥ä¸€äº›å›°æ‰°ï¼Œå› æ­¤æˆ‘ä¼šåœ¨ Hook æ‰§è¡Œçš„é˜¶æ®µè§£é‡Šå…¶å¤§è‡´çš„ä½œç”¨å’Œæ„ä¹‰ï¼Œå…³äºå…·ä½“çš„ä½¿ç”¨å¤§å®¶å¯ä»¥å» Rollup çš„å®˜ç½‘è‡ªè¡ŒæŸ¥é˜…ï¼Œæ¯•ç«Ÿè¿™é‡Œçš„ä¸»çº¿è¿˜æ˜¯åˆ†ææ’ä»¶çš„æ‰§è¡Œæµç¨‹ï¼Œæºæ‚å¤ªå¤šçš„ä½¿ç”¨ç»†èŠ‚åè€Œä¸æ˜“äºç†è§£ã€‚ä¸‹é¢æˆ‘ç»“åˆä¸€å¼ å®Œæ•´çš„æ’ä»¶æµç¨‹å›¾å’Œä½ å…·ä½“åˆ†æä¸€ä¸‹ã€‚</p><p><img src="/awesome-node/assets/11-3.0bb060c4.webp" alt="Rollup Output Phase"></p><ol><li><p>æ‰§è¡Œæ‰€æœ‰æ’ä»¶çš„ <code>outputOptions</code> é’©å­å‡½æ•°ï¼Œå¯¹ <code>output</code> é…ç½®è¿›è¡Œè½¬æ¢ã€‚</p></li><li><p>æ‰§è¡Œ <code>renderStart</code>ï¼Œå¹¶å‘æ‰§è¡Œ renderStart é’©å­ï¼Œæ­£å¼å¼€å§‹æ‰“åŒ…ã€‚</p></li><li><p>å¹¶å‘æ‰§è¡Œæ‰€æœ‰æ’ä»¶çš„<code>banner</code>ã€<code>footer</code>ã€<code>intro</code>ã€<code>outro</code> é’©å­(åº•å±‚ç”¨ Promise.all åŒ…è£¹æ‰€æœ‰çš„è¿™å››ç§é’©å­å‡½æ•°)ï¼Œè¿™å››ä¸ªé’©å­åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯å¾€æ‰“åŒ…äº§ç‰©çš„å›ºå®šä½ç½®(æ¯”å¦‚å¤´éƒ¨å’Œå°¾éƒ¨)æ’å…¥ä¸€äº›è‡ªå®šä¹‰çš„å†…å®¹ï¼Œæ¯”å¦‚åè®®å£°æ˜å†…å®¹ã€é¡¹ç›®ä»‹ç»ç­‰ç­‰ã€‚</p></li><li><p>ä»å…¥å£æ¨¡å—å¼€å§‹æ‰«æï¼Œé’ˆå¯¹åŠ¨æ€ import è¯­å¥æ‰§è¡Œ <code>renderDynamicImport</code>é’©å­ï¼Œæ¥è‡ªå®šä¹‰åŠ¨æ€ import çš„å†…å®¹ã€‚</p></li><li><p>å¯¹æ¯ä¸ªå³å°†ç”Ÿæˆçš„ <code>chunk</code>ï¼Œæ‰§è¡Œ <code>augmentChunkHash</code>é’©å­ï¼Œæ¥å†³å®šæ˜¯å¦æ›´æ”¹ chunk çš„å“ˆå¸Œå€¼ï¼Œåœ¨ <code>watch</code> æ¨¡å¼ä¸‹å³å¯èƒ½ä¼šå¤šæ¬¡æ‰“åŒ…çš„åœºæ™¯ä¸‹ï¼Œè¿™ä¸ªé’©å­ä¼šæ¯”è¾ƒé€‚ç”¨ã€‚</p></li><li><p>å¦‚æœæ²¡æœ‰é‡åˆ° <code>i<wbr>mport.meta</code> è¯­å¥ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œå¦åˆ™:</p><ol><li>å¯¹äº <code>i<wbr>mport.meta.url</code> è¯­å¥è°ƒç”¨ <code>resolveFileUrl</code> æ¥è‡ªå®šä¹‰ url è§£æé€»è¾‘</li><li>å¯¹äºå…¶ä»–<code>i<wbr>mport.meta</code> å±æ€§ï¼Œåˆ™è°ƒç”¨ <code>resolveImportMeta</code> æ¥è¿›è¡Œè‡ªå®šä¹‰çš„è§£æã€‚</li></ol></li><li><p>æ¥ç€ Rollup ä¼šç”Ÿæˆæ‰€æœ‰ chunk çš„å†…å®¹ï¼Œé’ˆå¯¹æ¯ä¸ª chunk ä¼šä¾æ¬¡è°ƒç”¨æ’ä»¶çš„<code>renderChunk</code>æ–¹æ³•è¿›è¡Œè‡ªå®šä¹‰æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™é‡Œæ—¶å€™ä½ å¯ä»¥ç›´æ¥æ“ä½œæ‰“åŒ…äº§ç‰©äº†</p></li><li><p>éšåä¼šè°ƒç”¨ <code>generateBundle</code> é’©å­ï¼Œè¿™ä¸ªé’©å­çš„å…¥å‚é‡Œé¢ä¼šåŒ…å«æ‰€æœ‰çš„æ‰“åŒ…äº§ç‰©ä¿¡æ¯ï¼ŒåŒ…æ‹¬ <code>chunk</code> (æ‰“åŒ…åçš„ä»£ç )ã€<code>asset</code>(æœ€ç»ˆçš„é™æ€èµ„æºæ–‡ä»¶)ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œåˆ é™¤ä¸€äº› chunk æˆ–è€… assetï¼Œæœ€ç»ˆè¿™äº›å†…å®¹å°†ä¸ä¼šä½œä¸ºäº§ç‰©è¾“å‡ºã€‚</p></li><li><p>å‰é¢æåˆ°äº†<code>rollup.rollup</code>æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª<code>bundle</code>å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯åŒ…å«<code>generate</code>å’Œ<code>write</code>ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸¤ä¸ªæ–¹æ³•å”¯ä¸€çš„åŒºåˆ«åœ¨äºåè€…ä¼šå°†ä»£ç å†™å…¥åˆ°ç£ç›˜ä¸­ï¼ŒåŒæ—¶ä¼šè§¦å‘<code>writeBundle</code>é’©å­ï¼Œä¼ å…¥æ‰€æœ‰çš„æ‰“åŒ…äº§ç‰©ä¿¡æ¯ï¼ŒåŒ…æ‹¬ chunk å’Œ assetï¼Œå’Œ <code>generateBundle</code>é’©å­éå¸¸ç›¸ä¼¼ã€‚ä¸è¿‡å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªé’©å­æ‰§è¡Œçš„æ—¶å€™ï¼Œäº§ç‰©å·²ç»è¾“å‡ºäº†ï¼Œè€Œ generateBundle æ‰§è¡Œçš„æ—¶å€™äº§ç‰©è¿˜å¹¶æ²¡æœ‰è¾“å‡ºã€‚é¡ºåºå¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="/awesome-node/assets/11-4.d765a341.webp" alt="generateBundle vs writeBundle"></p></li><li><p>å½“ä¸Šè¿°çš„<code>bundle</code>çš„<code>close</code>æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šè§¦å‘<code>closeBundle</code>é’©å­ï¼Œåˆ°è¿™é‡Œ Output é˜¶æ®µæ­£å¼ç»“æŸã€‚</p></li></ol><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>æ³¨æ„: å½“æ‰“åŒ…è¿‡ç¨‹ä¸­ä»»ä½•é˜¶æ®µå‡ºç°é”™è¯¯ï¼Œä¼šè§¦å‘ renderError é’©å­ï¼Œç„¶åæ‰§è¡ŒcloseBundleé’©å­ç»“æŸæ‰“åŒ…ã€‚</p></div><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬ç»ˆäºæ¢³ç†å®Œäº† Rollup å½“ä¸­å®Œæ•´çš„æ’ä»¶å·¥ä½œæµç¨‹ï¼Œä»ä¸€å¼€å§‹åœ¨<strong>æ„å»ºç”Ÿå‘½å‘¨æœŸ</strong>ä¸­å¯¹ä¸¤å¤§æ„å»ºé˜¶æ®µçš„æ„Ÿæ€§è®¤è¯†ï¼Œåˆ°ç°åœ¨<strong>æ’ä»¶å·¥ä½œæµ</strong>çš„å…·ä½“åˆ†æï¼Œä¸ç¦æ„Ÿå¹ Rollup çœ‹ä¼¼ç®€å•ï¼Œå®åˆ™å†…éƒ¨ç»†èŠ‚ç¹æ‚ã€‚å¸Œæœ›ä½ èƒ½å¯¹ç…§æµç¨‹å›¾å¥½å¥½å¤ä¹ å‡ éï¼Œå½»åº•æ¶ˆåŒ–è¿™éƒ¨åˆ†çš„çŸ¥è¯†ç‚¹ï¼Œä¸ä»…ä»…èƒ½åŠ æ·±ä½ å¯¹ Rollup æ’ä»¶æœºåˆ¶çš„ç†è§£ï¼Œå¹¶ä¸”å¯¹ Rollup æœ¬èº«æ‰“åŒ…åŸç†çš„æŒæ¡ä¹Ÿä¼šæ›´ä¸Šä¸€å±‚æ¥¼ã€‚</p><h2 id="å¸¸ç”¨-hook-å®æˆ˜" tabindex="-1">å¸¸ç”¨ Hook å®æˆ˜ <a class="header-anchor" href="#å¸¸ç”¨-hook-å®æˆ˜" aria-label="Permalink to &quot;å¸¸ç”¨ Hook å®æˆ˜&quot;">â€‹</a></h2><p>è¯»åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šè¯´äº†ï¼šä¸Šé¢è®²äº†é‚£ä¹ˆå¤š Rollup æ’ä»¶æœºåˆ¶çš„å†…å®¹ï¼Œä½†çœŸæ­£è¦å»å†™ä¸€ä¸ªæ’ä»¶ï¼Œæ„Ÿè§‰è¿˜æ˜¯å¾ˆå›°éš¾å•Šã€‚</p><p>è¿™é‡Œæˆ‘æƒ³è¦åˆ†äº«ä¸¤ä¸ªè§‚ç‚¹ï¼šé¦–å…ˆæ˜¯<strong>äºŒå…«å®šå¾‹</strong>ï¼Œä¹Ÿå°±æ˜¯ 20% çš„ API åº”å¯¹ 80% çš„åœºæ™¯ï¼Œè¿™æ”¾åœ¨ Rollup å½“ä¸­ä»ç„¶æ˜¯é€‚ç”¨çš„ã€‚ç»å¸¸ä½¿ç”¨åˆ°çš„ Hook ä¹Ÿå¹¶ä¸å¤šï¼Œå†µä¸” Rollup æ’ä»¶çš„å†™æ³•ä¹Ÿéå¸¸ç®€å•ï¼Œè‡³å°‘æ¯” Webpack æ’ä»¶è¦å®¹æ˜“çš„å¤šï¼Œå› æ­¤æŒæ¡ Rollup çš„æ’ä»¶å¼€å‘éš¾åº¦å¹¶ä¸å¤§ï¼Œè¿™ä¸ªå¤§å®¶æ”¾å¿ƒã€‚</p><p>å…¶æ¬¡ï¼Œ<strong>å­¦ä¼šæ¨¡ä»¿</strong>ä¹Ÿç‰¹åˆ«é‡è¦ã€‚å°¤å…¶æ˜¯åˆšå¼€å§‹ä»€ä¹ˆç»éªŒéƒ½æ²¡æœ‰çš„æ—¶å€™ï¼Œè§‚å¯Ÿå’Œæ¨¡ä»¿åˆ«äººä¼˜ç§€çš„å®ç°ä¸å¤±ä¸ºä¸€ç§é«˜æ•ˆçš„å­¦ä¹ æ–¹æ³•ï¼Œæ…¢æ…¢åœ°è‡ªå·±ä¹Ÿä¼šè½»è½¦ç†Ÿè·¯ï¼Œæˆä¸ºä¸€ä¸ªç»éªŒä¸°å¯Œçš„è€å¸æœºã€‚</p><p>å®é™…ä¸Šå¼€å‘ Rollup æ’ä»¶å°±æ˜¯åœ¨ç¼–å†™ä¸€ä¸ªä¸ª Hook å‡½æ•°ï¼Œä½ å¯ä»¥ç†è§£ä¸ºä¸€ä¸ª Rollup æ’ä»¶åŸºæœ¬å°±æ˜¯å„ç§ Hook å‡½æ•°çš„ç»„åˆã€‚å› æ­¤ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šè¯¦ç»†ä»‹ç»ä¸€äº›å¸¸ç”¨çš„ Hookï¼Œå¹¶ä»¥ä¸€äº›å®˜æ–¹çš„æ’ä»¶å®ç°ä¸ºä¾‹ï¼Œä» Hook çš„ç‰¹æ€§ã€åº”ç”¨åœºæ™¯ã€å…¥å‚å’Œè¿”å›å€¼çš„æ„ä¹‰åŠå®ç°ä»£ç ç¤ºä¾‹è¿™å‡ ä¸ªè§’åº¦å¸¦ä½ æŒæ¡å„ç§ Hook å®é™…çš„ä½¿ç”¨ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œå¼€å‘ä¸€ä¸ªå®Œæ•´çš„æ’ä»¶å¯¹ä½ æ¥è¯´æƒ³å¿…ä¹Ÿä¸åœ¨è¯ä¸‹äº†ã€‚</p><h3 id="è·¯å¾„è§£æ-resolveid" tabindex="-1"><strong>è·¯å¾„è§£æ: resolveId</strong> <a class="header-anchor" href="#è·¯å¾„è§£æ-resolveid" aria-label="Permalink to &quot;**è·¯å¾„è§£æ: resolveId**&quot;">â€‹</a></h3><p>resolveId é’©å­ä¸€èˆ¬ç”¨æ¥è§£ææ¨¡å—è·¯å¾„ï¼Œä¸º<code>Async + First</code>ç±»å‹å³<code>å¼‚æ­¥ä¼˜å…ˆ</code>çš„é’©å­ã€‚è¿™é‡Œæˆ‘ä»¬æ‹¿å®˜æ–¹çš„ <a href="https://github.com/rollup/plugins/blob/master/packages/alias/src/index.ts" target="_blank" rel="noreferrer">alias æ’ä»¶</a> æ¥è¯´æ˜ï¼Œè¿™ä¸ªæ’ä»¶ç”¨æ³•æ¼”ç¤ºå¦‚ä¸‹:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// rollup.config.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> alias </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@rollup/plugin-alias</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">output</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cjs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">alias</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">entries</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// å°†æŠŠ import xxx from &#39;module-a&#39; </span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// è½¬æ¢ä¸º import xxx from &#39;./module-a&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">find</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">module-a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">replacement</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./module-a.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">      ]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>æ’ä»¶çš„ä»£ç ç®€åŒ–åå¦‚ä¸‹:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">alias</span><span style="color:#A6ACCD;">(options) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è·å–entriesé…ç½®</span></span>
<span class="line"><span style="color:#A6ACCD;">  const entries </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getEntries</span><span style="color:#A6ACCD;">(options)</span></span>
<span class="line"><span style="color:#A6ACCD;">  return {</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œå½“å‰æ¨¡å—è·¯å¾„ã€å¼•ç”¨å½“å‰æ¨¡å—çš„æ¨¡å—è·¯å¾„ã€å…¶ä½™å‚æ•°</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">resolveId</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">importee</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">importer</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">resolveOptions</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å…ˆæ£€æŸ¥èƒ½ä¸èƒ½åŒ¹é…åˆ«åè§„åˆ™</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">matchedEntry</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entries</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">entry</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">matches</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">entry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">find</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">importee</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å¦‚æœä¸èƒ½åŒ¹é…æ›¿æ¢è§„åˆ™ï¼Œæˆ–è€…å½“å‰æ¨¡å—æ˜¯å…¥å£æ¨¡å—ï¼Œåˆ™ä¸ä¼šç»§ç»­åé¢çš„åˆ«åæ›¿æ¢æµç¨‹</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">matchedEntry</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">importerId</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// ğŸ“š return null åï¼Œå½“å‰çš„æ¨¡å—è·¯å¾„ä¼šäº¤ç»™ä¸‹ä¸€ä¸ªæ’ä»¶å¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æ­£å¼æ›¿æ¢è·¯å¾„</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">updatedId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">normalizeId</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">importee</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">matchedEntry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">find</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">matchedEntry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">replacement</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      )</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ğŸ“š æ¯ä¸ªæ’ä»¶æ‰§è¡Œæ—¶éƒ½ä¼šç»‘å®šä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸º this</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// è¿™é‡Œçš„ this.resolve ä¼šæ‰§è¡Œæ‰€æœ‰æ’ä»¶(é™¤å½“å‰æ’ä»¶å¤–)çš„ resolveId é’©å­</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">updateId</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">importer</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">assign</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> skipSelf</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolveOptions</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      )</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolved</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// æ›¿æ¢åçš„è·¯å¾„å³ updateId ä¼šç»è¿‡åˆ«çš„æ’ä»¶è¿›è¡Œå¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">finalResult</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">PartialResolvedId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolved</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">finalResult</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;">// å¦‚æœå…¶å®ƒæ’ä»¶æ²¡æœ‰å¤„ç†è¿™ä¸ªè·¯å¾„ï¼Œåˆ™ç›´æ¥è¿”å› updateId</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">finalResult</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">updatedId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">finalResult</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span></code></pre></div><p>ä»è¿™é‡Œä½ å¯ä»¥çœ‹åˆ° resolveId é’©å­å‡½æ•°çš„ä¸€äº›å¸¸ç”¨ä½¿ç”¨æ–¹å¼ï¼Œå®ƒçš„å…¥å‚åˆ†åˆ«æ˜¯<code>å½“å‰æ¨¡å—è·¯å¾„</code>ã€<code>å¼•ç”¨å½“å‰æ¨¡å—çš„æ¨¡å—è·¯å¾„</code>ã€<code>è§£æå‚æ•°</code>ï¼Œè¿”å›å€¼å¯ä»¥æ˜¯ nullã€string æˆ–è€…ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬åˆ†æƒ…å†µè®¨è®º:</p><ul><li>è¿”å›å€¼ä¸º null æ—¶ï¼Œä¼šé»˜è®¤äº¤ç»™ä¸‹ä¸€ä¸ªæ’ä»¶çš„ resolveId é’©å­å¤„ç†</li><li>è¿”å›å€¼ä¸º string æ—¶ï¼Œåˆ™åœæ­¢åç»­æ’ä»¶çš„å¤„ç†ã€‚è¿™é‡Œä¸ºäº†è®©æ›¿æ¢åçš„è·¯å¾„èƒ½è¢«å…¶ä»–æ’ä»¶å¤„ç†ï¼Œç‰¹æ„è°ƒç”¨äº† this.resolve æ¥äº¤ç»™å…¶å®ƒæ’ä»¶å¤„ç†ï¼Œå¦åˆ™å°†ä¸ä¼šè¿›å…¥åˆ°å…¶å®ƒæ’ä»¶çš„å¤„ç†</li><li>è¿”å›å€¼ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿä¼šåœæ­¢åç»­æ’ä»¶çš„å¤„ç†ï¼Œä¸è¿‡è¿™ä¸ªå¯¹è±¡å°±å¯ä»¥åŒ…å«<a href="https://rollupjs.org/plugin-development/#resolveid" target="_blank" rel="noreferrer">æ›´å¤šçš„ä¿¡æ¯</a>äº†ï¼ŒåŒ…æ‹¬è§£æåçš„è·¯å¾„ã€æ˜¯å¦è¢« enternalã€æ˜¯å¦éœ€è¦ tree-shaking ç­‰ç­‰ï¼Œä¸è¿‡å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿”å›ä¸€ä¸ª string å°±å¤Ÿç”¨äº†</li></ul><h3 id="load" tabindex="-1"><strong>load</strong> <a class="header-anchor" href="#load" aria-label="Permalink to &quot;**load**&quot;">â€‹</a></h3><p>load ä¸º<code>Async + First</code>ç±»å‹ï¼Œå³<strong>å¼‚æ­¥ä¼˜å…ˆ</strong>çš„é’©å­ï¼Œå’Œ<code>resolveId</code>ç±»ä¼¼ã€‚å®ƒçš„ä½œç”¨æ˜¯é€šè¿‡ resolveId è§£æåçš„è·¯å¾„æ¥åŠ è½½æ¨¡å—å†…å®¹ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä»¥å®˜æ–¹çš„ <a href="https://github.com/rollup/plugins/blob/master/packages/image/src/index.js" target="_blank" rel="noreferrer">image æ’ä»¶</a> ä¸ºä¾‹æ¥ä»‹ç»ä¸€ä¸‹ load é’©å­çš„ä½¿ç”¨ã€‚æºç ç®€åŒ–åå¦‚ä¸‹æ‰€ç¤º:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> mimeTypes </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">.jpg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">image/jpeg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åé¢å›¾ç‰‡ç±»å‹çœç•¥</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">image</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">opts</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{})</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">assign</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{},</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defaults</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">opts</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">image</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    load</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mime</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mimeTypes</span><span style="color:#F07178;">[</span><span style="color:#82AAFF;">extname</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">mime</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// å¦‚æœä¸æ˜¯å›¾ç‰‡ç±»å‹ï¼Œè¿”å› nullï¼Œäº¤ç»™ä¸‹ä¸€ä¸ªæ’ä»¶å¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// åŠ è½½å›¾ç‰‡å…·ä½“å†…å®¹</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isSvg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mime</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mimeTypes</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">format</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isSvg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">base64</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">source</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">format</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/[</span><span style="color:#C3E88D;">\r\n</span><span style="color:#89DDFF;">]+/</span><span style="color:#F78C6C;">gm</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dataUri</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getDataUri</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">format</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isSvg</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mime</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">source</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">dom</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">domTemplate</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dataUri</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">constTemplate</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dataUri</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">trim</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ä»ä¸­å¯ä»¥çœ‹åˆ°ï¼Œload é’©å­çš„å…¥å‚æ˜¯æ¨¡å— idï¼Œè¿”å›å€¼ä¸€èˆ¬æ˜¯ nullã€string æˆ–è€…ä¸€ä¸ªå¯¹è±¡ï¼š</p><ul><li>å¦‚æœè¿”å›å€¼ä¸º nullï¼Œåˆ™äº¤ç»™ä¸‹ä¸€ä¸ªæ’ä»¶å¤„ç†ï¼›</li><li>å¦‚æœè¿”å›å€¼ä¸º string æˆ–è€…å¯¹è±¡ï¼Œåˆ™ç»ˆæ­¢åç»­æ’ä»¶çš„å¤„ç†ï¼Œå¦‚æœæ˜¯å¯¹è±¡å¯ä»¥åŒ…å« SourceMapã€AST ç­‰<a href="https://rollupjs.org/plugin-development/#load" target="_blank" rel="noreferrer">æ›´è¯¦ç»†çš„ä¿¡æ¯</a>ã€‚</li></ul><h3 id="ä»£ç è½¬æ¢-transform" tabindex="-1"><strong>ä»£ç è½¬æ¢: transform</strong> <a class="header-anchor" href="#ä»£ç è½¬æ¢-transform" aria-label="Permalink to &quot;**ä»£ç è½¬æ¢: transform**&quot;">â€‹</a></h3><p><code>transform</code> é’©å­ä¹Ÿæ˜¯éå¸¸å¸¸è§çš„ä¸€ä¸ªé’©å­å‡½æ•°ï¼Œä¸º<code>Async + Sequential</code>ç±»å‹ï¼Œä¹Ÿå°±æ˜¯<code>å¼‚æ­¥ä¸²è¡Œ</code>é’©å­ï¼Œä½œç”¨æ˜¯å¯¹åŠ è½½åçš„æ¨¡å—å†…å®¹è¿›è¡Œè‡ªå®šä¹‰çš„è½¬æ¢ã€‚æˆ‘ä»¬ä»¥å®˜æ–¹çš„ <code>replace</code> æ’ä»¶ä¸ºä¾‹ï¼Œè¿™ä¸ªæ’ä»¶çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// rollup.config.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> replace </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@rollup/plugin-replace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">output</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cjs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å°†ä¼šæŠŠä»£ç ä¸­æ‰€æœ‰çš„ __TEST__ æ›¿æ¢ä¸º 1</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">replace</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">__TEST__</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div><p>å†…éƒ¨å®ç°ä¹Ÿå¹¶ä¸å¤æ‚ï¼Œä¸»è¦é€šè¿‡å­—ç¬¦ä¸²æ›¿æ¢æ¥å®ç°ï¼Œæ ¸å¿ƒé€»è¾‘ç®€åŒ–å¦‚ä¸‹:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> MagicString </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">magic-string</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">replace</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">options</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{})</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">replace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    transform</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// çœç•¥ä¸€äº›è¾¹ç•Œæƒ…å†µçš„å¤„ç†</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æ‰§è¡Œä»£ç æ›¿æ¢çš„é€»è¾‘ï¼Œå¹¶ç”Ÿæˆæœ€åçš„ä»£ç å’Œ SourceMap</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">executeReplacement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">executeReplacement</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">code</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">magicString</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">MagicString</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// é€šè¿‡ magicString.overwrite æ–¹æ³•å®ç°å­—ç¬¦ä¸²æ›¿æ¢</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#82AAFF;">codeHasReplacements</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">magicString</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">magicString</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isSourceMapEnabled</span><span style="color:#F07178;">()) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">map</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">magicString</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">generateMap</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> hires</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è¿”å›ä¸€ä¸ªå¸¦æœ‰ code å’Œ map å±æ€§çš„å¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><a href="https://rollupjs.org/plugin-development/#transform" target="_blank" rel="noreferrer">transform é’©å­</a>çš„å…¥å‚åˆ†åˆ«ä¸º<code>æ¨¡å—ä»£ç </code>ã€<code>æ¨¡å— ID</code>ï¼Œè¿”å›ä¸€ä¸ªåŒ…å« <code>code</code>(ä»£ç å†…å®¹) å’Œ <code>map</code>(SourceMap å†…å®¹) å±æ€§çš„å¯¹è±¡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è¿”å› null æ¥è·³è¿‡å½“å‰æ’ä»¶çš„ transform å¤„ç†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>å½“å‰æ’ä»¶è¿”å›çš„ä»£ç ä¼šä½œä¸ºä¸‹ä¸€ä¸ªæ’ä»¶ transform é’©å­çš„ç¬¬ä¸€ä¸ªå…¥å‚</strong>ï¼Œå®ç°ç±»ä¼¼äºç€‘å¸ƒæµçš„å¤„ç†ã€‚</p><h3 id="chunk-çº§ä»£ç ä¿®æ”¹-renderchunk" tabindex="-1"><strong>Chunk çº§ä»£ç ä¿®æ”¹: renderChunk</strong> <a class="header-anchor" href="#chunk-çº§ä»£ç ä¿®æ”¹-renderchunk" aria-label="Permalink to &quot;**Chunk çº§ä»£ç ä¿®æ”¹: renderChunk**&quot;">â€‹</a></h3><p>è¿™é‡Œæˆ‘ä»¬ç»§ç»­ä»¥<code>replace</code>æ’ä»¶ä¸¾ä¾‹ï¼Œåœ¨è¿™ä¸ªæ’ä»¶ä¸­ï¼Œä¹ŸåŒæ ·å®ç°äº† renderChunk é’©å­å‡½æ•°:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">replace</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">options</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{})</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">replace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    transform</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// transform ä»£ç çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line highlighted"><span style="color:#F07178;">    renderChunk</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">chunk</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">chunk</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">fileName</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// çœç•¥ä¸€äº›è¾¹ç•Œæƒ…å†µçš„å¤„ç†</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æ‹¿åˆ° chunk çš„ä»£ç åŠæ–‡ä»¶åï¼Œæ‰§è¡Œæ›¿æ¢é€»è¾‘</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">executeReplacement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œ replace æ’ä»¶ä¸ºäº†æ›¿æ¢ç»“æœæ›´åŠ å‡†ç¡®ï¼Œåœ¨ <a href="https://rollupjs.org/plugin-development/#renderchunk" target="_blank" rel="noreferrer">renderChunké’©å­</a> ä¸­åˆè¿›è¡Œäº†ä¸€æ¬¡æ›¿æ¢ï¼Œå› ä¸ºåç»­çš„æ’ä»¶ä»ç„¶å¯èƒ½åœ¨ transform ä¸­è¿›è¡Œæ¨¡å—å†…å®¹è½¬æ¢ï¼Œè¿›è€Œå¯èƒ½å‡ºç°ç¬¦åˆæ›¿æ¢è§„åˆ™çš„å­—ç¬¦ä¸²ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬æŠŠå…³æ³¨ç‚¹æ”¾åˆ° renderChunk å‡½æ•°æœ¬èº«ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªå…¥å‚ï¼Œåˆ†åˆ«ä¸º <code>chunk ä»£ç å†…å®¹</code>ã€<a href="https://rollupjs.org/plugin-development/#generatebundle" target="_blank" rel="noreferrer">chunk å…ƒä¿¡æ¯</a>ï¼Œè¿”å›å€¼è·Ÿ <code>transform</code> é’©å­ç±»ä¼¼ï¼Œæ—¢å¯ä»¥è¿”å›åŒ…å« code å’Œ map å±æ€§çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿”å› null æ¥è·³è¿‡å½“å‰é’©å­çš„å¤„ç†ã€‚</p><h3 id="äº§ç‰©ç”Ÿæˆæœ€åä¸€æ­¥-generatebundle" tabindex="-1"><strong>äº§ç‰©ç”Ÿæˆæœ€åä¸€æ­¥: generateBundle</strong> <a class="header-anchor" href="#äº§ç‰©ç”Ÿæˆæœ€åä¸€æ­¥-generatebundle" aria-label="Permalink to &quot;**äº§ç‰©ç”Ÿæˆæœ€åä¸€æ­¥: generateBundle**&quot;">â€‹</a></h3><p>generateBundle ä¹Ÿæ˜¯<code>å¼‚æ­¥ä¸²è¡Œ</code>çš„é’©å­ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ªé’©å­é‡Œé¢è‡ªå®šä¹‰åˆ é™¤ä¸€äº›æ— ç”¨çš„ chunk æˆ–è€…é™æ€èµ„æºï¼Œæˆ–è€…è‡ªå·±æ·»åŠ ä¸€äº›æ–‡ä»¶ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥ Rollup å®˜æ–¹çš„<code>html</code>æ’ä»¶æ¥å…·ä½“è¯´æ˜ï¼Œè¿™ä¸ªæ’ä»¶çš„ä½œç”¨æ˜¯é€šè¿‡æ‹¿åˆ° Rollup æ‰“åŒ…åçš„èµ„æºæ¥ç”ŸæˆåŒ…å«è¿™äº›èµ„æºçš„ HTML æ–‡ä»¶ï¼Œæºç ç®€åŒ–åå¦‚ä¸‹æ‰€ç¤º:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">html</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">opts</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">RollupHtmlOptions</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Plugin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åˆå§‹åŒ–é…ç½®</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> generateBundle</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">output</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">NormalizedOutputOptions</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">bundle</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">OutputBundle</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// çœç•¥ä¸€äº›è¾¹ç•Œæƒ…å†µçš„å¤„ç†</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 1. è·å–æ‰“åŒ…åçš„æ–‡ä»¶</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">files</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getFiles</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">bundle</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 2. ç»„è£… HTMLï¼Œæ’å…¥ç›¸åº” metaã€link å’Œ script æ ‡ç­¾</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">source</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">template</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">attributes</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">bundle</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">files</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">publicPath</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">title</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 3. é€šè¿‡ä¸Šä¸‹æ–‡å¯¹è±¡çš„ emitFile æ–¹æ³•ï¼Œè¾“å‡º html æ–‡ä»¶</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">htmlFile</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">EmittedAsset</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        type</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">asset</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">source</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Rollup HTML Asset</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">fileName</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">emitFile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">htmlFile</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ç›¸ä¿¡ä»æ’ä»¶çš„å…·ä½“å®ç°ä¸­ï¼Œä½ ä¹Ÿèƒ½æ„Ÿå—åˆ°è¿™ä¸ªé’©å­çš„å¼ºå¤§ä½œç”¨äº†ã€‚å…¥å‚åˆ†åˆ«ä¸º<code>output é…ç½®</code>ã€<a href="https://rollupjs.org/plugin-development/#generatebundle" target="_blank" rel="noreferrer">æ‰€æœ‰æ‰“åŒ…äº§ç‰©çš„å…ƒä¿¡æ¯å¯¹è±¡</a>ï¼Œé€šè¿‡æ“ä½œå…ƒä¿¡æ¯å¯¹è±¡ä½ å¯ä»¥åˆ é™¤ä¸€äº›ä¸éœ€è¦çš„ chunk æˆ–è€…é™æ€èµ„æºï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ’ä»¶ä¸Šä¸‹æ–‡å¯¹è±¡çš„<code>emitFile</code>æ–¹æ³•è¾“å‡ºè‡ªå®šä¹‰æ–‡ä»¶ã€‚</p><p>å¥½ï¼Œå¸¸ç”¨çš„ Rollup é’©å­æˆ‘ä»¬å°±å…ˆä»‹ç»åˆ°è¿™é‡Œï¼Œç›¸ä¿¡è¿™äº›çŸ¥è¯†ç‚¹å·²ç»è¶³å¤Ÿä½ åº”ä»˜å¤§å¤šæ•°çš„æ„å»ºåœºæ™¯äº†ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¤§å®¶åœ¨åé¢çš„ç« èŠ‚å¯ä»¥äº†è§£åˆ°ï¼ŒVite çš„æ’ä»¶æœºåˆ¶ä¹Ÿæ˜¯åŸºäº Rollup æ¥å®ç°çš„ï¼Œåƒä¸Šé¢ä»‹ç»çš„è¿™äº›å¸¸ç”¨é’©å­åœ¨ Vite å½“ä¸­ä¹Ÿéšå¤„å¯è§ï¼Œå› æ­¤ï¼ŒæŒæ¡äº†è¿™äº›å¸¸ç”¨é’©å­ï¼Œä¹Ÿç›¸å½“äºç»™ Vite æ’ä»¶çš„å­¦ä¹ åšä¸‹äº†å¾ˆå¥½çš„é“ºå«ã€‚</p><h2 id="å°ç»“" tabindex="-1">å°ç»“ <a class="header-anchor" href="#å°ç»“" aria-label="Permalink to &quot;å°ç»“&quot;">â€‹</a></h2><p>å¥½ï¼Œåˆ°è¿™é‡Œæœ¬ç¯‡çš„å†…å®¹å°±ç»“æŸäº†ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè®¤è¯†åˆ° Rollup ä¸ºäº†è¿½æ±‚æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå¼•å…¥äº†æ’ä»¶æœºåˆ¶ï¼Œè€Œåç»™ä½ ä»‹ç»äº† Rollup çš„ <code>Build</code> å’Œ<code>Output</code> ä¸¤å¤§æ„å»ºé˜¶æ®µï¼Œæ¥ç€ç»™ä½ è¯¦ç»†åœ°åˆ†æäº†ä¸¤å¤§æ„å»ºé˜¶æ®µçš„æ’ä»¶å·¥ä½œæµï¼Œæœ€åé€šè¿‡å‡ ä¸ªå®é™…çš„å®˜æ–¹æ’ä»¶å¸¦ä½ ç†Ÿæ‚‰äº†ä¸€äº›å¸¸è§çš„ Hookã€‚</p><p><img src="/awesome-node/assets/11-5.f9ddb93d.webp" alt="Rollupæ’ä»¶å¸¸ç”¨Hooks"></p><p>Rollup çš„æ’ä»¶å¼€å‘æ•´ä½“ä¸Šæ˜¯éå¸¸ç®€æ´å’Œçµæ´»çš„ï¼Œæ€»ç»“ä¸ºä»¥ä¸‹å‡ ä¸ªæ–¹é¢:</p><ol><li><strong>æ’ä»¶é€»è¾‘é›†ä¸­ç®¡ç†</strong>ã€‚å„ä¸ªé˜¶æ®µçš„ Hook éƒ½å¯ä»¥æ”¾åœ¨ä¸€ä¸ªæ’ä»¶ä¸­ç¼–å†™ï¼Œæ¯”å¦‚ä¸Šè¿°ä¸¤ä¸ª Webpack çš„ Loader å’Œ Plugin åŠŸèƒ½åœ¨ Rollup åªéœ€è¦ç”¨ä¸€ä¸ªæ’ä»¶ï¼Œåˆ†åˆ«é€šè¿‡ transform å’Œ renderChunk ä¸¤ä¸ª Hook æ¥å®ç°ã€‚</li><li><strong>æ’ä»¶ API ç®€æ´ï¼Œç¬¦åˆç›´è§‰</strong>ã€‚Rollup æ’ä»¶åŸºæœ¬ä¸Šåªéœ€è¦è¿”å›ä¸€ä¸ªåŒ…å« name å’Œå„ç§é’©å­å‡½æ•°çš„å¯¹è±¡å³å¯ï¼Œä¹Ÿå°±æ˜¯å£°æ˜ä¸€ä¸ª name å±æ€§ï¼Œç„¶åå†™å‡ ä¸ªé’©å­å‡½æ•°å³å¯ã€‚</li><li><strong>æ’ä»¶é—´çš„äº’ç›¸è°ƒç”¨</strong>ã€‚æ¯”å¦‚åˆšåˆšä»‹ç»çš„<code>alias</code>æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡æ’ä»¶ä¸Šä¸‹æ–‡å¯¹è±¡çš„<code>resolve</code>æ–¹æ³•ï¼Œç»§ç»­è°ƒç”¨å…¶å®ƒæ’ä»¶çš„ <code>resolveId</code>é’©å­ï¼Œç±»ä¼¼çš„è¿˜æœ‰<code>load</code>æ–¹æ³•ï¼Œè¿™å°±å¤§å¤§å¢åŠ äº†æ’ä»¶çš„çµæ´»æ€§ã€‚</li></ol><p>ç°åœ¨ï¼Œç›¸ä¿¡ä½ å·²ç»ä»å®è§‚åˆ°ç»†èŠ‚ä¸Šï¼Œå·²ç»å¯¹ Rollup æ’ä»¶æœ‰äº†å…¨é¢çš„æŒæ¡ï¼Œä¸ºæ¥ä¸‹æ¥çš„ Vite å­¦ä¹ æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰å®Œå…¨æŒæ¡ï¼Œä¸ç”¨ç€æ€¥ï¼Œè¿™éƒ¨åˆ†çš„å†…å®¹æœ¬èº«æœ‰ç‚¹éš¾åº¦ï¼Œå¸Œæœ›ä½ èƒ½å›å¤´å¤ä¹ å‡ éï¼Œç›¸ä¿¡ä½ ä¸€å®šèƒ½å½»åº•æ‹¿ä¸‹è¿™äº›å†…å®¹ã€‚å¤§å®¶åŠ æ²¹å§ï¼</p><p>å‚è€ƒé“¾æ¥ï¼š</p><ul><li><a href="https://rollupjs.org/plugin-development/#plugins-overview" target="_blank" rel="noreferrer">Rollupå®˜ç½‘ Pluginå¼€å‘</a></li></ul><p>2023å¹´02æœˆ16æ—¥11:30:38</p></div></div></main><footer class="VPDocFooter" data-v-8682743f data-v-1f0816e8><!--[--><!--]--><div class="edit-info" data-v-1f0816e8><div class="edit-link" data-v-1f0816e8><a class="VPLink link edit-link-button" href="https://github.com/jamessawyer/awesome-node/edit/main/docs/book/vite/11.md" target="_blank" rel="noreferrer" data-v-1f0816e8 data-v-c57314a4><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" aria-label="edit icon" data-v-1f0816e8><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> åœ¨GitHubç¼–è¾‘æ­¤é¡µ<!--]--><!----></a></div><div class="last-updated" data-v-1f0816e8><p class="VPLastUpdated" data-v-1f0816e8 data-v-68dd101d>Last updated: <time datetime="2023-04-04T07:46:34.000Z" data-v-68dd101d></time></p></div></div><div class="prev-next" data-v-1f0816e8><div class="pager" data-v-1f0816e8><a class="pager-link prev" href="/awesome-node/book/vite/10.html" data-v-1f0816e8><span class="desc" data-v-1f0816e8>Previous page</span><span class="title" data-v-1f0816e8>10.RollupåŸºæœ¬ç”¨æ³•</span></a></div><div class="has-prev pager" data-v-1f0816e8><a class="pager-link next" href="/awesome-node/book/vite/12.html" data-v-1f0816e8><span class="desc" data-v-1f0816e8>Next page</span><span class="title" data-v-1f0816e8>12.Viteæ’ä»¶å¼€å‘</span></a></div></div></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"blog_misc_ts-and-express.md\":\"88fb2477\",\"blog_dive_index.md\":\"29902ff6\",\"blog_first.md\":\"47b541aa\",\"blog_resource_advanced.md\":\"e48103c3\",\"blog_resource_basic.md\":\"285c692d\",\"blog_misc_module.md\":\"0ccaf0dc\",\"book_babel_4.md\":\"fc9a8279\",\"book_vite_8.md\":\"1a467669\",\"book_vite_7.md\":\"4f7571ee\",\"book_babel_3.md\":\"e3dcf1ba\",\"book_vite_9.md\":\"16408ea0\",\"book_patterns_the-node-platform.md\":\"ed1c5fe7\",\"book_vite_10.md\":\"ab739d3b\",\"book_vite_1.md\":\"9fc35a8f\",\"book_patterns_module-system_index.md\":\"1312f9cc\",\"book_patterns_module-system_module-define-patterns.md\":\"3f6276d6\",\"book_patterns_module-system_module-system-in-js-and-node.md\":\"877006b8\",\"book_patterns_module-system_the-module-system-and-its-patterns.md\":\"d88ed807\",\"book_patterns_module-system_the-need-for-modules.md\":\"c9f31993\",\"book_vite_11.md\":\"2a52347f\",\"book_vite_12.md\":\"a002d54e\",\"book_vite_14.md\":\"51abb2ec\",\"blog_translate_web-streams-on-node.md\":\"036cceee\",\"book_babel_1.md\":\"bf8ebc3b\",\"book_patterns_callback-and-events.md\":\"b00b63cd\",\"book_patterns_module-system_summary.md\":\"d9fbcbf1\",\"book_vite_18.md\":\"aff8682d\",\"blog_translate_fs-in-node.md\":\"05bac132\",\"book_vite_17.md\":\"735885d5\",\"book_patterns_the-module-system.md\":\"29f95c79\",\"book_vite_2.md\":\"607483ab\",\"book_vite_16.md\":\"74698fed\",\"book_vite_4.md\":\"3fa3f5b6\",\"book_vite_19.md\":\"06f7e6e5\",\"book_vite_15.md\":\"d6971dce\",\"book_patterns_module-system_esm-cjs-interoperability.md\":\"732fe5ff\",\"blog_translate_file-system-paths.md\":\"479b095f\",\"book_babel_index.md\":\"65f6f2b6\",\"book_patterns_module-system_commonjs-modules.md\":\"d8fbc5df\",\"book_vite_3.md\":\"c6951cd8\",\"book_patterns_module-system_esm.md\":\"d9104461\",\"lib_fs-extra_ensuredir.md\":\"5299e7e5\",\"lib_fs-extra_ensurefile.md\":\"010bfb4b\",\"lib_fs-extra_ensurelink.md\":\"ad1ce276\",\"lib_fs-extra_ensuresymlink.md\":\"995dfea6\",\"lib_fs-extra_fs-write-read-writev.md\":\"99742c4e\",\"book_babel_2.md\":\"1700e97b\",\"lib_fs-extra_index.md\":\"70ad673b\",\"lib_fs-extra_move.md\":\"b1aa585e\",\"lib_fs-extra_outputjson.md\":\"8bf9369b\",\"lib_fs-extra_pathexists.md\":\"503db7a8\",\"lib_fs-extra_readjson.md\":\"35bf1c2d\",\"lib_fs-extra_remove.md\":\"576d27cd\",\"lib_fs-extra_writejson.md\":\"afe588ef\",\"lib_fs-extra_outputfile.md\":\"698a87dd\",\"manager_babel.md\":\"52dda5ff\",\"manager_basic.md\":\"3a90c28f\",\"manager_recipe.md\":\"239aeb44\",\"manager_vite.md\":\"6bf269b8\",\"v18doc_file-system.md\":\"b6c9b380\",\"v18doc_path.md\":\"1f1fac18\",\"manager_webpack.md\":\"7b3227ab\",\"book_babel_5.md\":\"86857b7d\",\"core_stream_stream-in-practice.md\":\"f2d1dc3f\",\"framework_express_index.md\":\"8c2e2bc4\",\"framework_nestjs_index.md\":\"d369894a\",\"core_events_index.md\":\"127a7765\",\"lib_fs-extra_copy.md\":\"3a5f3963\",\"lib_fs-extra_emptydir.md\":\"9a5d3d83\",\"core_stream_index.md\":\"31d6fafe\",\"core_stream_stream-visulization.md\":\"d5388329\",\"index.md\":\"747320f3\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Awesome Node\",\"description\":\"Node + Vite + Webpack + Babel\",\"base\":\"/awesome-node/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo.svg\",\"outlineTitle\":\"ç›®å½•\",\"outline\":[2,3],\"editLink\":{\"text\":\"åœ¨GitHubç¼–è¾‘æ­¤é¡µ\",\"pattern\":\"https://github.com/jamessawyer/awesome-node/edit/main/docs/:path\"},\"nav\":[{\"text\":\"ğŸ“„Nodeæ–‡æ¡£\",\"activeMatch\":\"^/v18doc/\",\"link\":\"/v18doc/File-System\"},{\"text\":\"ğŸ“¦å·¥ç¨‹åŒ–\",\"link\":\"/manager/basic\"},{\"text\":\"ğŸ’«æ ¸å¿ƒæ¦‚å¿µ\",\"link\":\"/core/stream/index\"},{\"text\":\"ğŸ¤”blog\",\"link\":\"/blog/first\"},{\"text\":\"ğŸ“šä¹¦ç±\",\"items\":[{\"text\":\"Node Design Patterns\",\"link\":\"/book/patterns/the-node-platform\"},{\"text\":\"æ·±å…¥ç†è§£Vite\",\"link\":\"/book/vite/2\"},{\"text\":\"Babelæ’ä»¶ç§˜ç±\",\"link\":\"/book/babel/2\"}]},{\"text\":\"ğŸ§‘â€ğŸš€æ¡†æ¶\",\"items\":[{\"text\":\"NestJS\",\"link\":\"/framework/nestjs/index\"},{\"text\":\"Express\",\"link\":\"/framework/express/index\"}]},{\"text\":\"ğŸ”¥å¸¸ç”¨åº“\",\"items\":[{\"text\":\"fs-extra\",\"link\":\"/lib/fs-extra/index\"}]}],\"sidebar\":{\"/v18doc/\":[{\"text\":\"Node v18.x ä¸­æ–‡æ–‡æ¡£\",\"items\":[{\"text\":\"File System\",\"link\":\"/v18doc/File-System\"},{\"text\":\"Path\",\"link\":\"/v18doc/Path\"}]}],\"/manager/\":[{\"text\":\"åŸºç¡€çŸ¥è¯†\",\"items\":[{\"text\":\"package.json\",\"link\":\"/manager/basic\"},{\"text\":\"Viteå­¦ä¹ \",\"link\":\"/manager/vite\"},{\"text\":\"Webpackå­¦ä¹ \",\"link\":\"/manager/webpack\"},{\"text\":\"babelç”Ÿæ€\",\"link\":\"/manager/babel\"}]},{\"text\":\"Recipe\",\"items\":[{\"text\":\"Nodeèµ„æº\",\"link\":\"/manager/recipe\"}]}],\"/core/\":[{\"text\":\"EventEmitter\",\"collapsible\":true,\"items\":[{\"text\":\"èµ„æº\",\"link\":\"/core/events/index\"}]},{\"text\":\"Streams\",\"collapsible\":true,\"items\":[{\"text\":\"èµ„æº\",\"link\":\"/core/stream/index\"},{\"text\":\"âš¡Streamå›¾è§£\",\"link\":\"/core/stream/stream-visulization\"},{\"text\":\"âš¡Streamå®æˆ˜\",\"link\":\"/core/stream/stream-in-practice\"}]}],\"/blog/\":[{\"text\":\"èµ„æº\",\"items\":[{\"text\":\"Advanced\",\"link\":\"/blog/resource/advanced\"}]},{\"text\":\"ğŸš€ å¥½æ–‡ç¿»è¯‘\",\"collapsible\":true,\"items\":[{\"text\":\"Path & URLçš„ç”¨æ³•\",\"link\":\"/blog/translate/file-system-paths\"},{\"text\":\"FS in Node\",\"link\":\"/blog/translate/fs-in-node\"},{\"text\":\"Web Streams on Node\",\"link\":\"/blog/translate/web-streams-on-node\"}]},{\"text\":\"MISC\",\"collapsible\":true,\"items\":[{\"text\":\"ESM & CJSæ¨¡å—\",\"link\":\"/blog/misc/module\"},{\"text\":\"Express + typescripeè®¾ç½®\",\"link\":\"/blog/misc/ts-and-express\"}]}],\"/book/patterns\":[{\"text\":\"Nodeè®¾è®¡æ¨¡å¼\",\"items\":[{\"text\":\"the node platform\",\"link\":\"/book/patterns/the-node-platform\"},{\"text\":\"callback and events\",\"link\":\"/book/patterns/callback-and-events\"}]},{\"text\":\"â…¡.æ¨¡å—ç³»ç»Ÿ\",\"collapsible\":true,\"items\":[{\"text\":\"ä»‹ç»\",\"link\":\"/book/patterns/module-system/index\"},{\"text\":\"æ¨¡å—ç³»ç»Ÿçš„å¿…è¦æ€§\",\"link\":\"/book/patterns/module-system/the-need-for-modules\"},{\"text\":\"JSå’ŒNodeä¸­çš„æ¨¡å—ç³»ç»Ÿ\",\"link\":\"/book/patterns/module-system/module-system-in-js-and-node\"},{\"text\":\"æ¨¡å—ç³»ç»Ÿå’Œå…¶æ¨¡å¼\",\"link\":\"/book/patterns/module-system/the-module-system-and-its-patterns\"},{\"text\":\"âš¡CommonJSæ¨¡å—\",\"link\":\"/book/patterns/module-system/commonjs-modules\"},{\"text\":\"ğŸ™†â€â™€ï¸CommonJSæ¨¡å—å¸¸ç”¨æ¨¡å¼å®šä¹‰\",\"link\":\"/book/patterns/module-system/module-define-patterns\"},{\"text\":\"ğŸš€ESM\",\"link\":\"/book/patterns/module-system/esm\"},{\"text\":\"ğŸš€ESMå’ŒCJSå·®å¼‚å’Œäº’æ“æ€§\",\"link\":\"/book/patterns/module-system/esm-cjs-interoperability\"},{\"text\":\"æ€»ç»“\",\"link\":\"/book/patterns/module-system/summary\"}]}],\"/book/vite\":[{\"text\":\"ğŸ”§æ·±å…¥ç†è§£Vite\",\"items\":[{\"text\":\"1.Viteå¼€ç¯‡\",\"link\":\"/book/vite/1\"},{\"text\":\"2.æ¨¡å—æ ‡å‡†\",\"link\":\"/book/vite/2\"},{\"text\":\"3.å¿«é€Ÿä¸Šæ‰‹Vite\",\"link\":\"/book/vite/3\"},{\"text\":\"4.æ ·å¼æ–¹æ¡ˆ\",\"link\":\"/book/vite/4\"},{\"text\":\"7.é¢„æ„å»º\",\"link\":\"/book/vite/7\"},{\"text\":\"8.åŒå¼•æ“æ¶æ„\",\"link\":\"/book/vite/8\"},{\"text\":\"9.æ€§èƒ½æ¨æ‰‹: Esbuild\",\"link\":\"/book/vite/9\"},{\"text\":\"10.RollupåŸºæœ¬ç”¨æ³•\",\"link\":\"/book/vite/10\"},{\"text\":\"11.æ·±å…¥ç†è§£Rollupæ’ä»¶æœºåˆ¶\",\"link\":\"/book/vite/11\"},{\"text\":\"12.Viteæ’ä»¶å¼€å‘\",\"link\":\"/book/vite/12\"},{\"text\":\"14.ä»£ç åˆ†å‰²\",\"link\":\"/book/vite/14\"},{\"text\":\"15.Polyfillå’Œè¯­æ³•é™çº§\",\"link\":\"/book/vite/15\"},{\"text\":\"16.Viteæ­å»ºSSRå·¥ç¨‹\",\"link\":\"/book/vite/16\"},{\"text\":\"17.è”é‚¦æ¨¡å—ä»¥åŠåŸç†\",\"link\":\"/book/vite/17\"},{\"text\":\"18.Pure ESMæ—¶ä»£\",\"link\":\"/book/vite/18\"},{\"text\":\"19.ç³»ç»Ÿå¯¹Viteé¡¹ç›®æ€§èƒ½ä¼˜åŒ–\",\"link\":\"/book/vite/19\"}]}],\"/book/babel\":[{\"text\":\"Babelæ’ä»¶ç§˜ç±\",\"items\":[{\"text\":\"1.Babelçš„ä»‹ç»\",\"link\":\"/book/babel/1\"},{\"text\":\"2.Babelçš„ç¼–è¯‘æµç¨‹\",\"link\":\"/book/babel/2\"},{\"text\":\"3.Babelçš„AST\",\"link\":\"/book/babel/3\"},{\"text\":\"4.Babelçš„API\",\"link\":\"/book/babel/4\"},{\"text\":\"5.å®æˆ˜ï¼šæ’å…¥å‡½æ•°è°ƒç”¨å‚æ•°\",\"link\":\"/book/babel/5\"}]}],\"/lib/fs-extra\":[{\"text\":\"fs-extra\",\"items\":[{\"text\":\"README\",\"link\":\"/lib/fs-extra/index\"},{\"text\":\"copy\",\"link\":\"/lib/fs-extra/copy\"},{\"text\":\"emptyDir\",\"link\":\"/lib/fs-extra/emptyDir\"},{\"text\":\"ensureFile\",\"link\":\"/lib/fs-extra/ensureFile\"},{\"text\":\"ensureDir\",\"link\":\"/lib/fs-extra/ensureDir\"},{\"text\":\"ensureLink\",\"link\":\"/lib/fs-extra/ensureLink\"},{\"text\":\"ensureSymlink\",\"link\":\"/lib/fs-extra/ensureSymlink\"},{\"text\":\"move\",\"link\":\"/lib/fs-extra/move\"},{\"text\":\"outputFile\",\"link\":\"/lib/fs-extra/outputFile\"},{\"text\":\"pathExists\",\"link\":\"/lib/fs-extra/pathExists\"},{\"text\":\"readJson\",\"link\":\"/lib/fs-extra/readJson\"},{\"text\":\"remove\",\"link\":\"/lib/fs-extra/remove\"},{\"text\":\"outputJson\",\"link\":\"/lib/fs-extra/outputJson\"},{\"text\":\"writeJson\",\"link\":\"/lib/fs-extra/writeJson\"},{\"text\":\"fs-write-read-writev\",\"link\":\"/lib/fs-extra/fs-write-read-writev\"}]}],\"/framework/nestjs\":[{\"text\":\"å­¦ä¹ NestJS\",\"items\":[{\"text\":\"èµ„æº\",\"link\":\"/framework/nestjs/index\"}]}],\"/framework/express\":[{\"text\":\"Learn ExpressJS\",\"items\":[{\"text\":\"èµ„æº\",\"link\":\"/framework/express/index\"}]}]}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}")</script>
    
  </body>
</html>