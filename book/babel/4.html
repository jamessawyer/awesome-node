<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Babel APIs | Awesome Node</title>
    <meta name="description" content="Node + Vite + Webpack + Babel">
    <link rel="preload stylesheet" href="/awesome-node/assets/style.620b85d0.css" as="style">
    <script type="module" src="/awesome-node/assets/app.3264e289.js"></script>
    <link rel="preload" href="/awesome-node/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/awesome-node/assets/chunks/framework.7e01c218.js">
  <link rel="modulepreload" href="/awesome-node/assets/chunks/theme.49368662.js">
  <link rel="modulepreload" href="/awesome-node/assets/book_babel_4.md.33a56c4b.lean.js">
  <link rel="icon" href="/awesome-node/favicon.ico">
  <link rel="apple-touch-icon" href="/awesome-node/pwa-192x192.png" sizes="192x192">
  <meta name="keywords" content="Node, Vite, Webpack, Babel">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  <link rel="manifest" href="/awesome-node/manifest.webmanifest">
  <script id="vite-plugin-pwa:register-sw" src="/awesome-node/registerSW.js"></script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-3c37fa57><!--[--><!--]--><!--[--><span tabindex="-1" data-v-63b160dc></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-63b160dc> Skip to content </a><!--]--><!----><header class="VPNav" data-v-3c37fa57 data-v-8a890d25><div class="VPNavBar has-sidebar" data-v-8a890d25 data-v-0a544c9e><div class="container" data-v-0a544c9e><div class="title" data-v-0a544c9e><div class="VPNavBarTitle has-sidebar" data-v-0a544c9e data-v-e701207b><a class="title" href="/awesome-node/" data-v-e701207b><!--[--><!--]--><!--[--><img class="VPImage logo" src="/awesome-node/logo.svg" alt data-v-be3a0179><!--]--><!--[-->Awesome Node<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-0a544c9e><div class="curtain" data-v-0a544c9e></div><div class="content-body" data-v-0a544c9e><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-0a544c9e data-v-e57d8b2c><span id="main-nav-aria-label" class="visually-hidden" data-v-e57d8b2c>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/awesome-node/v18doc/File-System.html" tabindex="0" data-v-e57d8b2c data-v-551d8955 data-v-b4e3029b><!--[-->📄Node文档<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/awesome-node/manager/basic.html" tabindex="0" data-v-e57d8b2c data-v-551d8955 data-v-b4e3029b><!--[-->📦工程化<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/awesome-node/core/stream/index.html" tabindex="0" data-v-e57d8b2c data-v-551d8955 data-v-b4e3029b><!--[-->💫核心概念<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/awesome-node/blog/first.html" tabindex="0" data-v-e57d8b2c data-v-551d8955 data-v-b4e3029b><!--[-->🤔blog<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e57d8b2c data-v-38a74afb><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-38a74afb><span class="text" data-v-38a74afb><!----> 📚书籍 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-38a74afb><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-38a74afb><div class="VPMenu" data-v-38a74afb data-v-9ccc420d><div class="items" data-v-9ccc420d><!--[--><!--[--><div class="VPMenuLink" data-v-9ccc420d data-v-c33197b7><a class="VPLink link" href="/awesome-node/book/patterns/the-node-platform.html" data-v-c33197b7 data-v-b4e3029b><!--[-->Node Design Patterns<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-9ccc420d data-v-c33197b7><a class="VPLink link" href="/awesome-node/book/vite/2.html" data-v-c33197b7 data-v-b4e3029b><!--[-->深入理解Vite<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-9ccc420d data-v-c33197b7><a class="VPLink link" href="/awesome-node/book/babel/2.html" data-v-c33197b7 data-v-b4e3029b><!--[-->Babel插件秘籍<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e57d8b2c data-v-38a74afb><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-38a74afb><span class="text" data-v-38a74afb><!----> 🧑‍🚀框架 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-38a74afb><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-38a74afb><div class="VPMenu" data-v-38a74afb data-v-9ccc420d><div class="items" data-v-9ccc420d><!--[--><!--[--><div class="VPMenuLink" data-v-9ccc420d data-v-c33197b7><a class="VPLink link" href="/awesome-node/framework/nestjs/index.html" data-v-c33197b7 data-v-b4e3029b><!--[-->NestJS<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-9ccc420d data-v-c33197b7><a class="VPLink link" href="/awesome-node/framework/express/index.html" data-v-c33197b7 data-v-b4e3029b><!--[-->Express<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-e57d8b2c data-v-38a74afb><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-38a74afb><span class="text" data-v-38a74afb><!----> 🔥常用库 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-38a74afb><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-38a74afb><div class="VPMenu" data-v-38a74afb data-v-9ccc420d><div class="items" data-v-9ccc420d><!--[--><!--[--><div class="VPMenuLink" data-v-9ccc420d data-v-c33197b7><a class="VPLink link" href="/awesome-node/lib/fs-extra/index.html" data-v-c33197b7 data-v-b4e3029b><!--[-->fs-extra<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-0a544c9e data-v-e886969f><label title="toggle dark mode" data-v-e886969f data-v-3a42abb8><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-3a42abb8 data-v-66437e70><span class="check" data-v-66437e70><span class="icon" data-v-66437e70><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-3a42abb8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-3a42abb8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-0a544c9e data-v-a6896018 data-v-38a74afb><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-38a74afb><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-38a74afb><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-38a74afb><div class="VPMenu" data-v-38a74afb data-v-9ccc420d><!----><!--[--><!--[--><!----><div class="group" data-v-a6896018><div class="item appearance" data-v-a6896018><p class="label" data-v-a6896018>Appearance</p><div class="appearance-action" data-v-a6896018><label title="toggle dark mode" data-v-a6896018 data-v-3a42abb8><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-3a42abb8 data-v-66437e70><span class="check" data-v-66437e70><span class="icon" data-v-66437e70><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-3a42abb8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-3a42abb8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-0a544c9e data-v-998afbbd><span class="container" data-v-998afbbd><span class="top" data-v-998afbbd></span><span class="middle" data-v-998afbbd></span><span class="bottom" data-v-998afbbd></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-3c37fa57 data-v-36e75f6b><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-36e75f6b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-36e75f6b><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-36e75f6b>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-36e75f6b data-v-7142ec04><button class="" data-v-7142ec04>目录 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-7142ec04><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></button><!----></div></div><aside class="VPSidebar" data-v-3c37fa57 data-v-5cc2cdea><div class="curtain" data-v-5cc2cdea></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-5cc2cdea><span class="visually-hidden" id="sidebar-aria-label" data-v-5cc2cdea> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-5cc2cdea><section class="VPSidebarItem level-0 has-active" data-v-5cc2cdea data-v-85dacce7><div class="item" role="button" tabindex="0" data-v-85dacce7><div class="indicator" data-v-85dacce7></div><h2 class="text" data-v-85dacce7>Babel插件秘籍</h2><!----></div><div class="items" data-v-85dacce7><!--[--><div class="VPSidebarItem level-1 is-link" data-v-85dacce7 data-v-85dacce7><div class="item" data-v-85dacce7><div class="indicator" data-v-85dacce7></div><a class="VPLink link link" href="/awesome-node/book/babel/1.html" data-v-85dacce7 data-v-b4e3029b><!--[--><p class="text" data-v-85dacce7>1.Babel的介绍</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-85dacce7 data-v-85dacce7><div class="item" data-v-85dacce7><div class="indicator" data-v-85dacce7></div><a class="VPLink link link" href="/awesome-node/book/babel/2.html" data-v-85dacce7 data-v-b4e3029b><!--[--><p class="text" data-v-85dacce7>2.Babel的编译流程</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-85dacce7 data-v-85dacce7><div class="item" data-v-85dacce7><div class="indicator" data-v-85dacce7></div><a class="VPLink link link" href="/awesome-node/book/babel/3.html" data-v-85dacce7 data-v-b4e3029b><!--[--><p class="text" data-v-85dacce7>3.Babel的AST</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-85dacce7 data-v-85dacce7><div class="item" data-v-85dacce7><div class="indicator" data-v-85dacce7></div><a class="VPLink link link" href="/awesome-node/book/babel/4.html" data-v-85dacce7 data-v-b4e3029b><!--[--><p class="text" data-v-85dacce7>4.Babel的API</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-3c37fa57 data-v-e9ad4d66><div class="VPDoc has-sidebar has-aside" data-v-e9ad4d66 data-v-eb1a3b86><div class="container" data-v-eb1a3b86><div class="aside" data-v-eb1a3b86><div class="aside-curtain" data-v-eb1a3b86></div><div class="aside-container" data-v-eb1a3b86><div class="aside-content" data-v-eb1a3b86><div class="VPDocAside" data-v-eb1a3b86 data-v-ef4bbde4><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-ef4bbde4 data-v-ebea5871><div class="content" data-v-ebea5871><div class="outline-marker" data-v-ebea5871></div><div class="outline-title" data-v-ebea5871>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-ebea5871><span class="visually-hidden" id="doc-outline-aria-label" data-v-ebea5871> Table of Contents for current page </span><ul class="root" data-v-ebea5871 data-v-a4da2cad><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-ef4bbde4></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-eb1a3b86><div class="content-container" data-v-eb1a3b86><!--[--><!--]--><div class="VPDocOutlineDropdown" data-v-eb1a3b86 data-v-5cbe65a9><button class="" data-v-5cbe65a9>目录 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-5cbe65a9><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></button><!----></div><main class="main" data-v-eb1a3b86><div style="position:relative;" class="vp-doc _awesome-node_book_babel_4" data-v-eb1a3b86><div><p>学习了 babel 的编译流程和 AST 之后，我们来学习下 babel 的 api，通过这些 api 来操作 AST，完成代码的转换。</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>注意，我们学习的 api 是 babel 7.x 的，babel 6 的 api 还没有按照 scope 来划分，是 babel-parser 这种，而 babel 7 变成了@babel/parser 这种。但具体 api 差不多，我们学的是一些原理性的东西，这些东西在版本迭代中是不会变的。</p></div><h2 id="babel-的-api-有哪些" tabindex="-1">babel 的 api 有哪些 <a class="header-anchor" href="#babel-的-api-有哪些" aria-label="Permalink to &quot;babel 的 api 有哪些&quot;">​</a></h2><p>我们知道 babel 的编译流程分为三步：parse、transform、generate，每一步都暴露了一些 api 出来。</p><ul><li>parse 阶段有<code>@babel/parser</code>，功能是把源码转成 AST</li><li>transform 阶段有 <code>@babel/traverse</code>，可以遍历 AST，并调用 <code>visitor</code> 函数修改 AST，修改 AST 自然涉及到 AST 的判断、创建、修改等，这时候就需要 <code>@babel/types</code> 了，当需要批量创建 AST 的时候可以使用 <code>@babel/template</code> 来简化 AST 创建逻辑。</li><li>generate 阶段会把 AST 打印为目标代码字符串，同时生成 sourcemap，需要 <code>@babel/generator</code> 包</li><li>中途遇到错误想打印代码位置的时候，使用 <code>@babel/code-frame</code> 包</li><li>babel 的整体功能通过 <code>@babel/core</code> 提供，基于上面的包完成 babel 整体的编译流程，并实现插件功能。</li></ul><p>我们主要学习的就是 <code>@babel/parser</code>，<code>@babel/traverse</code>，<code>@babel/generator</code>，<code>@babel/types</code>，<code>@babel/template</code> 这五个包的 api 的使用。</p><h2 id="babel-parser" tabindex="-1">@babel/parser <a class="header-anchor" href="#babel-parser" aria-label="Permalink to &quot;@babel/parser&quot;">​</a></h2><p>babel parser 叫 babylon，是基于 <code>acorn</code> 实现的，扩展了很多语法，可以支持 es next（现在支持到 es2020）、jsx、flow、typescript 等语法的解析，其中jsx、flow、typescript 这些非标准的语法的解析需要指定语法插件。</p><p>它提供了有两个 api：<code>parse</code> 和 <code>parseExpression</code>。两者都是把源码转成 AST，不过 parse 返回的 AST 根节点是 File（整个 AST），parseExpression 返回的 AST 根节点是是 Expression（表达式的 AST），<strong>粒度不同</strong>。</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">parse</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">options</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ParserOptions</span></span>
<span class="line"><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ParseResult</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">_babel_types</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">File</span><span style="color:#89DDFF;">&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">parseExpression</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">input</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">options</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ParserOptions</span></span>
<span class="line"><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ParseResult</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">_babel_types</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">Expression</span><span style="color:#89DDFF;">&gt;;</span></span>
<span class="line"></span></code></pre></div><p>详细的 options 可以查看<a href="https://babeljs.io/docs/en/babel-parser#options" target="_blank" rel="noreferrer">文档</a>。其实主要分为两类:</p><ol><li>一是 parse 的内容是什么</li><li>二是以什么方式去 parse</li></ol><blockquote><p>1️⃣ <strong>parse 的内容是什么：</strong></p></blockquote><ul><li><code>plugins</code>： 指定jsx、typescript、flow 等插件来解析对应的语法 ⭐</li><li><code>allowXxx</code>： 指定一些语法是否允许，比如函数外的 await、没声明的 export等</li><li><code>sourceType</code>： 指定是否支持解析模块语法，有 module、script、unambiguous 3个取值，module 是解析 es module 语法，script 则不解析 es module 语法，当作脚本执行，unambiguous 则是根据内容是否有 import 和 export 来确定是否解析 es module 语法。⭐</li></ul><blockquote><p>2️⃣ <strong>以什么方式 parse</strong></p></blockquote><ul><li><code>strictMode</code> 是否是严格模式</li><li><code>startLine</code> 从源码哪一行开始 parse</li><li><code>errorRecovery</code> 出错时是否记录错误并继续往下 parse</li><li><code>tokens</code> parse 的时候是否保留 token 信息</li><li><code>ranges</code> 是否在 ast 节点中添加 ranges 属性</li></ul><p>其实最常用的 option 就是 <code>plugins</code>、<code>sourceType</code> 这两个，比如要 parse tsx 模块，那么就可以这样来写：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@babel/parser</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">code</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">sourceType</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">typescript</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="babel-traverse" tabindex="-1">@babel/traverse <a class="header-anchor" href="#babel-traverse" aria-label="Permalink to &quot;@babel/traverse&quot;">​</a></h2><p>parse 出的 AST 由 <code>@babel/traverse</code> 来遍历和修改，babel traverse 包提供了 traverse 方法：</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">traverse</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">parent</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">opts</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><details class="details custom-block"><summary>TS定义</summary><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">declare</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> traverse</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">S</span><span style="color:#89DDFF;">&gt;(</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#A6ACCD;font-style:italic;">parent</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Node</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Node</span><span style="color:#A6ACCD;">[] </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">undefined</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#A6ACCD;font-style:italic;">opts</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TraverseOptions</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">S</span><span style="color:#89DDFF;">&gt;,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#A6ACCD;font-style:italic;">scope</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Scope</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">undefined</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#A6ACCD;font-style:italic;">state</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">S</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#A6ACCD;font-style:italic;">parentPath</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">NodePath</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#A6ACCD;font-style:italic;">parent</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Node</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Node</span><span style="color:#A6ACCD;">[] </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">undefined</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#A6ACCD;font-style:italic;">opts</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TraverseOptions</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#A6ACCD;font-style:italic;">scope</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Scope</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#A6ACCD;font-style:italic;">state</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#A6ACCD;font-style:italic;">parentPath</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">NodePath</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">void</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">visitors</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#A6ACCD;"> visitors</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">verify</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#A6ACCD;"> visitors</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">verify</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">explode</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#A6ACCD;"> visitors</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">explode</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span></code></pre></div></details><p>常用的就前面两个参数，parent 指定要遍历的 AST 节点，opts 指定 visitor 函数。babel 会在遍历 parent 对应的 AST 时调用相应的 visitor 函数。</p><h3 id="遍历过程" tabindex="-1">遍历过程 <a class="header-anchor" href="#遍历过程" aria-label="Permalink to &quot;遍历过程&quot;">​</a></h3><p><code>visitor</code> 对象的 value 是对象或者函数：</p><ul><li>如果 value 为<strong>函数</strong>，那么就相当于是 <code>enter</code> 时调用的函数。</li><li>如果 value 为<strong>对象</strong>，则可以明确指定 <code>enter</code> 或者 <code>exit</code> 时的处理函数。</li></ul><p>函数会接收两个参数 <code>path</code> 和 <code>state</code>。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">visitor</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">Identifier</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">state</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">StringLiteral</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">enter</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">state</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">exit</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">state</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>enter 时调用是在遍历当前节点的子节点前调用，exit 时调用是遍历完当前节点的子节点后调用。</p><p><img src="/awesome-node/assets/4-1.42612d34.webp" alt="vistor"></p><p>可以为单个节点的类型，也可以是多个节点类型通过 <code>|</code> 连接，还可以通过别名指定一系列节点类型。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 1️⃣ 进入 FunctionDeclaration 节点时调用</span></span>
<span class="line"><span style="color:#82AAFF;">traverse</span><span style="color:#A6ACCD;">(ast</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">FunctionDeclaration</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">enter</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">path</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">state</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 2️⃣ 默认是进入节点时调用，和上面等价</span></span>
<span class="line"><span style="color:#82AAFF;">traverse</span><span style="color:#A6ACCD;">(ast</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">FunctionDeclaration</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">path</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">state</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 3️⃣ 进入 FunctionDeclaration 和 VariableDeclaration 节点时调用</span></span>
<span class="line"><span style="color:#82AAFF;">traverse</span><span style="color:#A6ACCD;">(ast</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">FunctionDeclaration|VariableDeclaration</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">path</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">state</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 4️⃣ 通过别名指定离开各种 Declaration 节点时调用</span></span>
<span class="line"><span style="color:#82AAFF;">traverse</span><span style="color:#A6ACCD;">(ast</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">Declaration</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">path</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">state</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>具体的别名有哪些在<a href="https://github.com/babel/babel/blob/main/packages/babel-types/src/ast-types/generated/index.ts#L2489-L2535" target="_blank" rel="noreferrer">babel-types 的类型定义</a>可以查。</p><h3 id="path" tabindex="-1">path <a class="header-anchor" href="#path" aria-label="Permalink to &quot;path&quot;">​</a></h3><p><img src="/awesome-node/assets/4-2.3d55f1c6.webp" alt="path"></p><p>path 是遍历过程中的路径，会保留上下文信息，有很多属性和方法，比如:</p><blockquote><p>获取当前节点以及它的关联节点的属性和方法</p></blockquote><ul><li><code>path.node</code> 指向当前 AST 节点</li><li><code>path.get</code>、<code>path.set</code> 获取和设置当前节点属性的 path</li><li><code>path.parent</code> 指向父级 AST 节点</li><li><code>path.getSibling</code>、<code>path.getNextSibling</code>、<code>path.getPrevSibling</code> 获取兄弟节点</li><li><code>path.find</code> 从当前节点向上查找节点</li></ul><blockquote><p>获取作用域的信息</p></blockquote><ul><li><code>path.scope</code> 获取当前节点的作用域信息</li></ul><blockquote><p>用于判断 AST 类型:isXxx、assertXxx 系列方法</p></blockquote><ul><li><code>path.isXxx</code> 判断当前节点是不是 xx 类型</li><li><code>path.assertXxx</code> 判断当前节点是不是 xx 类型，不是则抛出异常</li></ul><blockquote><p>对 AST 进行增删改</p></blockquote><ul><li><code>path.insertBefore、path.insertAfter</code> 插入节点</li><li><code>path.replaceWith、path.replaceWithMultiple、replaceWithSourceString</code> 替换节点</li><li><code>path.remove</code> 删除节点</li></ul><blockquote><p>跳过一些遍历</p></blockquote><ul><li><code>path.skip</code> 跳过当前节点的子节点的遍历</li><li><code>path.stop</code> 结束后续遍历</li></ul><p><img src="/awesome-node/assets/4-3.a05d23fa.webp" alt="path属性和方法"></p><p>上面罗列了几个常用的 api，可以通过这些 api 完成对 AST 的操作。当然，path 的 api 不是只有这些，后面实战案例用到了再介绍。</p><h3 id="state" tabindex="-1">state <a class="header-anchor" href="#state" aria-label="Permalink to &quot;state&quot;">​</a></h3><p>第二个参数 state 则是遍历过程中在不同节点之间传递数据的机制，插件会通过 state 传递 options 和 file 信息，我们也可以通过 state 存储一些遍历过程中的共享数据。</p><p><img src="/awesome-node/assets/4-4.ad0fa397.webp" alt="state"></p><h2 id="babel-types" tabindex="-1">@babel/types <a class="header-anchor" href="#babel-types" aria-label="Permalink to &quot;@babel/types&quot;">​</a></h2><p>遍历 AST 的过程中需要创建一些 AST 和判断 AST 的类型，这时候就需要 <code>@babel/types</code> 包。</p><p>举例来说，如果要创建<code>IfStatement</code>就可以调用</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ifStatement</span><span style="color:#A6ACCD;">(test</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> consequent</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> alternate)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>而判断节点是否是 IfStatement 就可以调用 <code>isIfStatement</code> 或者 <code>assertIfStatement</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isIfStatement</span><span style="color:#A6ACCD;">(node</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> opts)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">assertIfStatement</span><span style="color:#A6ACCD;">(node</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> opts)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>opts 可以指定一些属性是什么值，增加更多限制条件，做更精确的判断。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isIdentifier</span><span style="color:#A6ACCD;">(node</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">paths</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p><code>isXxx</code> 会返回 boolean 表示结果，而 <code>assertXxx</code> 则会在类型不一致时抛异常。</p><p>所有的 AST 的 build、assert 的 api 可以在 <a href="https://babeljs.io/docs/en/babel-types#api" target="_blank" rel="noreferrer">babel types 文档</a>中查。</p><h2 id="babel-template" tabindex="-1">@babel/template <a class="header-anchor" href="#babel-template" aria-label="Permalink to &quot;@babel/template&quot;">​</a></h2><p>通过 <code>@babel/types</code> 创建 AST 还是比较麻烦的，要一个个的创建然后组装，如果 AST 节点比较多的话需要写很多代码，这时候就可以使用 <code>@babel/template</code> 包来批量创建。</p><p>这个包有这些 api：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> ast </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">template</span><span style="color:#A6ACCD;">(code</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [opts])(args)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> ast </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> template</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ast</span><span style="color:#A6ACCD;">(code</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [opts])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> ast </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> template</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">program</span><span style="color:#A6ACCD;">(code</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> [opts])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><ul><li>如果是根据模版创建整个 AST，那么用 <code>template.ast</code> 或者 <code>template.program</code> 方法，这俩都是直接返回 ast 的，<code>template.program</code> 返回的 AST 的根节点是 Program。</li><li>如果知道具体创建的 AST 的类型，可以使用 template.expression、template.statement、template.statements 等方法创建具体的 AST。</li><li>默认 template.ast 创建的 Expression 会被包裹一层 ExpressionStatement 节点（会被当成表达式语句来 parse），但当 template.expression 方法创建的 AST 就不会。</li></ul><p>如果模版中有<strong>占位符</strong>，那么就用 template 的 api，在模版中写一些占位的参数，调用时传入这些占位符参数对应的 AST 节点。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> fn </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">template</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">console.log(NAME)</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// NAME是占位符</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> ast </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fn</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">NAME</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> t</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringLiteral</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>或者</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> fn </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">template</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">console.log(%%NAME%%)</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> ast </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fn</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">NAME</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> t</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringLiteral</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>这两种占位符的写法都可以，当占位符和其他变量名冲突时可以用第二种。</p><h2 id="babel-generator" tabindex="-1">@babel/generator <a class="header-anchor" href="#babel-generator" aria-label="Permalink to &quot;@babel/generator&quot;">​</a></h2><p>AST 转换完之后就要打印成目标代码字符串，通过 <code>@babel/generator</code> 包的 generate api</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">ast</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">opts</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">code</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">code</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">map</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span></code></pre></div><ul><li>第一个参数是要打印的 AST</li><li>第二个参数是 options，指定打印的一些细节，比如通过 comments 指定是否包含注释，通过 minified 指定是否包含空白字符</li><li>第三个参数当多个文件合并打印的时候需要用到</li></ul><p>options 中常用的是 <code>sourceMaps</code>，开启了这个选项才会生成 sourcemap</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> code</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> map </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">generate</span><span style="color:#A6ACCD;">(ast</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">sourceMaps</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="babel-code-frame" tabindex="-1">@babel/code-frame <a class="header-anchor" href="#babel-code-frame" aria-label="Permalink to &quot;@babel/code-frame&quot;">​</a></h2><p>当有错误信息要打印的时候，需要打印错误位置的代码，可以使用<code>@babel/code-frame</code>。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">codeFrameColumns</span><span style="color:#A6ACCD;">(rawLines</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> location</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">/* options */</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>options 可以设置 highlighted （是否高亮）、message（展示啥错误信息）。</p><p>比如</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> codeFrameColumns </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@babel/code-frame</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">XXX 错误了</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">codeFrameColumns</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">const name = guang</span><span style="color:#89DDFF;">`</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      start</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> line</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> column</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">14</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      highlightCode</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">err</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">message</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">main</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span></code></pre></div><p>会有比较友好的打印信息:</p><p><img src="/awesome-node/assets/4-5.b1d5c33d.webp" alt="code-frame"></p><h2 id="babel-core" tabindex="-1">@babel/core <a class="header-anchor" href="#babel-core" aria-label="Permalink to &quot;@babel/core&quot;">​</a></h2><p>前面的包是完成某一部分的功能的，而 <code>@babel/core</code> 包则是基于它们完成整个编译流程，从源码到目标代码，生成 sourcemap。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">transformSync</span><span style="color:#A6ACCD;">(code</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> options)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// =&gt; { code, map, ast }</span></span>
<span class="line"><span style="color:#82AAFF;">transformFileSync</span><span style="color:#A6ACCD;">(filename</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> options)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// =&gt; { code, map, ast }</span></span>
<span class="line"><span style="color:#82AAFF;">transformFromAstSync</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  parsedAst</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  sourceCode</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  options</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// =&gt; { code, map, ast }</span></span>
<span class="line"></span></code></pre></div><p>前三个 <code>transformXxx</code> 的 api 分别是从源代码、源代码文件、源代码 AST 开始处理，最终生成目标代码和 sourcemap。</p><p>options 主要配置 plugins 和 presets，指定具体要做什么转换。</p><p>这些 api 也同样提供了异步的版本，异步地进行编译，返回一个 promise</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">transformAsync</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">code();</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> options)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">result</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#82AAFF;">transformFileAsync</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">filename.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> options)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">result</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#82AAFF;">transformFromAstAsync</span><span style="color:#A6ACCD;">(parsedAst</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> sourceCode</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> options)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">result</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>注意：transformXxx 的 api，已经被标记为过时了，后续会删掉，不建议用，直接用 transformXxxSync 和 transformXxxAsync。</p></div><p>@babel/core 包还有一个 createConfigItem 的 api，用于 plugin 和 preset 的封装，后面章节会涉及到。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">createConfigItem</span><span style="color:#A6ACCD;">(value</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> options) </span><span style="color:#676E95;font-style:italic;">// configItem</span></span>
<span class="line"></span></code></pre></div><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>这一节我们了解了编译过程中各阶段的 api：</p><ul><li><code>@babel/parser</code> 对源码进行 parse，可以通过 plugins、sourceType 等来指定 parse 语法</li><li><code>@babel/traverse</code> 通过 visitor 函数对遍历到的 ast 进行处理，分为 enter 和 exit 两个阶段，具体操作 AST 使用 path 的 api，还可以通过 state 来在遍历过程中传递一些数据</li><li><code>@babel/types</code> 用于创建、判断 AST 节点，提供了 xxx、isXxx、assertXxx 的 api</li><li><code>@babel/template</code> 用于批量创建节点</li><li><code>@babel/code-frame</code> 可以创建友好的报错信息</li><li><code>@babel/generator</code> 打印 AST 成目标代码字符串，支持 comments、minified、sourceMaps 等选项。</li><li><code>@babel/core</code> 基于上面的包来完成 babel 的编译流程，可以从源码字符串、源码文件、AST 开始。</li></ul><p>学完这一节，我们可以用 babel 的 api 来实现一些功能了，下一节开始第一个实战案例。</p><p>2023年03月21日16:04:59</p></div></div></main><footer class="VPDocFooter" data-v-eb1a3b86 data-v-2e64ed46><!--[--><!--]--><div class="edit-info" data-v-2e64ed46><div class="edit-link" data-v-2e64ed46><a class="VPLink link edit-link-button" href="https://github.com/jamessawyer/awesome-node/edit/main/docs/book/babel/4.md" target="_blank" rel="noreferrer" data-v-2e64ed46 data-v-b4e3029b><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" aria-label="edit icon" data-v-2e64ed46><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> 在GitHub编辑此页<!--]--><!----></a></div><div class="last-updated" data-v-2e64ed46><p class="VPLastUpdated" data-v-2e64ed46 data-v-2ef2e6f3>Last updated: <time datetime="2023-03-21T08:12:54.000Z" data-v-2ef2e6f3></time></p></div></div><div class="prev-next" data-v-2e64ed46><div class="pager" data-v-2e64ed46><a class="pager-link prev" href="/awesome-node/book/babel/3.html" data-v-2e64ed46><span class="desc" data-v-2e64ed46>Previous page</span><span class="title" data-v-2e64ed46>3.Babel的AST</span></a></div><div class="has-prev pager" data-v-2e64ed46><!----></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"blog_dive_index.md\":\"04340839\",\"blog_first.md\":\"ac3a0092\",\"book_vite_10.md\":\"9c62f411\",\"blog_translate_web-streams-on-node.md\":\"0564edfb\",\"blog_translate_file-system-paths.md\":\"059751e0\",\"book_patterns_callback-and-events.md\":\"8a4315e7\",\"book_patterns_the-module-system.md\":\"cce64274\",\"book_patterns_the-node-platform.md\":\"3975a76a\",\"book_vite_1.md\":\"393ae207\",\"book_babel_3.md\":\"2ee31c98\",\"book_patterns_module-system_esm-cjs-interoperability.md\":\"454d8916\",\"book_babel_2.md\":\"da3723b7\",\"blog_translate_fs-in-node.md\":\"831fc5fa\",\"book_patterns_module-system_esm.md\":\"d32aa311\",\"book_vite_11.md\":\"c26019ea\",\"book_vite_12.md\":\"9b2a8abc\",\"book_vite_14.md\":\"9be0a3c7\",\"book_vite_15.md\":\"39858a0a\",\"book_vite_16.md\":\"ac83f3fc\",\"book_vite_17.md\":\"f7b6d257\",\"book_vite_18.md\":\"4edaa1b7\",\"book_vite_19.md\":\"31b83c3b\",\"book_patterns_module-system_commonjs-modules.md\":\"716f4a3e\",\"book_vite_2.md\":\"ade58327\",\"book_vite_3.md\":\"b5932dfb\",\"blog_misc_ts-and-express.md\":\"ed67c015\",\"book_vite_4.md\":\"a2b52534\",\"book_vite_7.md\":\"e28b04af\",\"book_vite_8.md\":\"fbaa2b63\",\"core_events_index.md\":\"cf754b25\",\"core_stream_index.md\":\"ca809ce6\",\"core_stream_stream-in-practice.md\":\"432589c4\",\"core_stream_stream-visulization.md\":\"057e753a\",\"framework_express_index.md\":\"eff9762b\",\"index.md\":\"3d28b472\",\"lib_fs-extra_copy.md\":\"f6fe215a\",\"lib_fs-extra_ensuredir.md\":\"6b2a53fb\",\"lib_fs-extra_ensurefile.md\":\"69d5a194\",\"lib_fs-extra_ensurelink.md\":\"a8fc6281\",\"lib_fs-extra_ensuresymlink.md\":\"4aafc889\",\"lib_fs-extra_fs-write-read-writev.md\":\"6207194b\",\"lib_fs-extra_index.md\":\"7336ce90\",\"lib_fs-extra_move.md\":\"5e016992\",\"lib_fs-extra_outputfile.md\":\"f87491f8\",\"lib_fs-extra_outputjson.md\":\"2a0216d2\",\"lib_fs-extra_pathexists.md\":\"e1ea7bab\",\"lib_fs-extra_remove.md\":\"63eb6d7f\",\"lib_fs-extra_writejson.md\":\"a9fff486\",\"manager_babel.md\":\"6d9841a7\",\"manager_basic.md\":\"98a35ea4\",\"manager_recipe.md\":\"793f1a26\",\"manager_vite.md\":\"9698576c\",\"v18doc_file-system.md\":\"c25bf5f4\",\"book_patterns_module-system_module-define-patterns.md\":\"eb537b80\",\"book_babel_4.md\":\"33a56c4b\",\"book_babel_index.md\":\"344d3dbf\",\"book_patterns_module-system_index.md\":\"825440fe\",\"blog_misc_module.md\":\"d89e112e\",\"book_babel_1.md\":\"7123a8fd\",\"lib_fs-extra_emptydir.md\":\"6185772b\",\"book_patterns_module-system_summary.md\":\"48792e3c\",\"book_patterns_module-system_the-module-system-and-its-patterns.md\":\"8a1dd0c7\",\"book_patterns_module-system_the-need-for-modules.md\":\"4b320638\",\"framework_nestjs_index.md\":\"43f980a1\",\"book_patterns_module-system_module-system-in-js-and-node.md\":\"746a8ad6\",\"manager_webpack.md\":\"d5b7c572\",\"book_vite_9.md\":\"f5dad383\",\"v18doc_path.md\":\"3cb90dbd\",\"lib_fs-extra_readjson.md\":\"6808ede3\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Awesome Node\",\"description\":\"Node + Vite + Webpack + Babel\",\"base\":\"/awesome-node/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo.svg\",\"outlineTitle\":\"目录\",\"outline\":[2,3],\"editLink\":{\"text\":\"在GitHub编辑此页\",\"pattern\":\"https://github.com/jamessawyer/awesome-node/edit/main/docs/:path\"},\"nav\":[{\"text\":\"📄Node文档\",\"activeMatch\":\"^/v18doc/\",\"link\":\"/v18doc/File-System\"},{\"text\":\"📦工程化\",\"link\":\"/manager/basic\"},{\"text\":\"💫核心概念\",\"link\":\"/core/stream/index\"},{\"text\":\"🤔blog\",\"link\":\"/blog/first\"},{\"text\":\"📚书籍\",\"items\":[{\"text\":\"Node Design Patterns\",\"link\":\"/book/patterns/the-node-platform\"},{\"text\":\"深入理解Vite\",\"link\":\"/book/vite/2\"},{\"text\":\"Babel插件秘籍\",\"link\":\"/book/babel/2\"}]},{\"text\":\"🧑‍🚀框架\",\"items\":[{\"text\":\"NestJS\",\"link\":\"/framework/nestjs/index\"},{\"text\":\"Express\",\"link\":\"/framework/express/index\"}]},{\"text\":\"🔥常用库\",\"items\":[{\"text\":\"fs-extra\",\"link\":\"/lib/fs-extra/index\"}]}],\"sidebar\":{\"/v18doc/\":[{\"text\":\"Node v18.x 中文文档\",\"items\":[{\"text\":\"File System\",\"link\":\"/v18doc/File-System\"},{\"text\":\"Path\",\"link\":\"/v18doc/Path\"}]}],\"/manager/\":[{\"text\":\"基础知识\",\"items\":[{\"text\":\"package.json\",\"link\":\"/manager/basic\"},{\"text\":\"Vite学习\",\"link\":\"/manager/vite\"},{\"text\":\"Webpack学习\",\"link\":\"/manager/webpack\"},{\"text\":\"babel生态\",\"link\":\"/manager/babel\"}]},{\"text\":\"Recipe\",\"items\":[{\"text\":\"Node资源\",\"link\":\"/manager/recipe\"}]}],\"/core/\":[{\"text\":\"EventEmitter\",\"collapsible\":true,\"items\":[{\"text\":\"资源\",\"link\":\"/core/events/index\"}]},{\"text\":\"Streams\",\"collapsible\":true,\"items\":[{\"text\":\"资源\",\"link\":\"/core/stream/index\"},{\"text\":\"⚡Stream图解\",\"link\":\"/core/stream/stream-visulization\"},{\"text\":\"⚡Stream实战\",\"link\":\"/core/stream/stream-in-practice\"}]}],\"/blog/\":[{\"text\":\"blog\",\"items\":[{\"text\":\"第一篇blog\",\"link\":\"/blog/first\"}]},{\"text\":\"🚀 好文翻译\",\"collapsible\":true,\"items\":[{\"text\":\"Path & URL的用法\",\"link\":\"/blog/translate/file-system-paths\"},{\"text\":\"FS in Node\",\"link\":\"/blog/translate/fs-in-node\"},{\"text\":\"Web Streams on Node\",\"link\":\"/blog/translate/web-streams-on-node\"}]},{\"text\":\"MISC\",\"collapsible\":true,\"items\":[{\"text\":\"ESM & CJS模块\",\"link\":\"/blog/misc/module\"},{\"text\":\"Express + typescripe设置\",\"link\":\"/blog/misc/ts-and-express\"}]}],\"/book/patterns\":[{\"text\":\"Node设计模式\",\"items\":[{\"text\":\"the node platform\",\"link\":\"/book/patterns/the-node-platform\"},{\"text\":\"callback and events\",\"link\":\"/book/patterns/callback-and-events\"}]},{\"text\":\"Ⅱ.模块系统\",\"collapsible\":true,\"items\":[{\"text\":\"介绍\",\"link\":\"/book/patterns/module-system/index\"},{\"text\":\"模块系统的必要性\",\"link\":\"/book/patterns/module-system/the-need-for-modules\"},{\"text\":\"JS和Node中的模块系统\",\"link\":\"/book/patterns/module-system/module-system-in-js-and-node\"},{\"text\":\"模块系统和其模式\",\"link\":\"/book/patterns/module-system/the-module-system-and-its-patterns\"},{\"text\":\"⚡CommonJS模块\",\"link\":\"/book/patterns/module-system/commonjs-modules\"},{\"text\":\"🙆‍♀️CommonJS模块常用模式定义\",\"link\":\"/book/patterns/module-system/module-define-patterns\"},{\"text\":\"🚀ESM\",\"link\":\"/book/patterns/module-system/esm\"},{\"text\":\"🚀ESM和CJS差异和互操性\",\"link\":\"/book/patterns/module-system/esm-cjs-interoperability\"},{\"text\":\"总结\",\"link\":\"/book/patterns/module-system/summary\"}]}],\"/book/vite\":[{\"text\":\"🔧深入理解Vite\",\"items\":[{\"text\":\"1.Vite开篇\",\"link\":\"/book/vite/1\"},{\"text\":\"2.模块标准\",\"link\":\"/book/vite/2\"},{\"text\":\"3.快速上手Vite\",\"link\":\"/book/vite/3\"},{\"text\":\"4.样式方案\",\"link\":\"/book/vite/4\"},{\"text\":\"7.预构建\",\"link\":\"/book/vite/7\"},{\"text\":\"8.双引擎架构\",\"link\":\"/book/vite/8\"},{\"text\":\"9.性能推手: Esbuild\",\"link\":\"/book/vite/9\"},{\"text\":\"10.Rollup基本用法\",\"link\":\"/book/vite/10\"},{\"text\":\"11.深入理解Rollup插件机制\",\"link\":\"/book/vite/11\"},{\"text\":\"12.Vite插件开发\",\"link\":\"/book/vite/12\"},{\"text\":\"14.代码分割\",\"link\":\"/book/vite/14\"},{\"text\":\"15.Polyfill和语法降级\",\"link\":\"/book/vite/15\"},{\"text\":\"16.Vite搭建SSR工程\",\"link\":\"/book/vite/16\"},{\"text\":\"17.联邦模块以及原理\",\"link\":\"/book/vite/17\"},{\"text\":\"18.Pure ESM时代\",\"link\":\"/book/vite/18\"},{\"text\":\"19.系统对Vite项目性能优化\",\"link\":\"/book/vite/19\"}]}],\"/book/babel\":[{\"text\":\"Babel插件秘籍\",\"items\":[{\"text\":\"1.Babel的介绍\",\"link\":\"/book/babel/1\"},{\"text\":\"2.Babel的编译流程\",\"link\":\"/book/babel/2\"},{\"text\":\"3.Babel的AST\",\"link\":\"/book/babel/3\"},{\"text\":\"4.Babel的API\",\"link\":\"/book/babel/4\"}]}],\"/lib/fs-extra\":[{\"text\":\"fs-extra\",\"items\":[{\"text\":\"README\",\"link\":\"/lib/fs-extra/index\"},{\"text\":\"copy\",\"link\":\"/lib/fs-extra/copy\"},{\"text\":\"emptyDir\",\"link\":\"/lib/fs-extra/emptyDir\"},{\"text\":\"ensureFile\",\"link\":\"/lib/fs-extra/ensureFile\"},{\"text\":\"ensureDir\",\"link\":\"/lib/fs-extra/ensureDir\"},{\"text\":\"ensureLink\",\"link\":\"/lib/fs-extra/ensureLink\"},{\"text\":\"ensureSymlink\",\"link\":\"/lib/fs-extra/ensureSymlink\"},{\"text\":\"move\",\"link\":\"/lib/fs-extra/move\"},{\"text\":\"outputFile\",\"link\":\"/lib/fs-extra/outputFile\"},{\"text\":\"pathExists\",\"link\":\"/lib/fs-extra/pathExists\"},{\"text\":\"readJson\",\"link\":\"/lib/fs-extra/readJson\"},{\"text\":\"remove\",\"link\":\"/lib/fs-extra/remove\"},{\"text\":\"outputJson\",\"link\":\"/lib/fs-extra/outputJson\"},{\"text\":\"writeJson\",\"link\":\"/lib/fs-extra/writeJson\"},{\"text\":\"fs-write-read-writev\",\"link\":\"/lib/fs-extra/fs-write-read-writev\"}]}],\"/framework/nestjs\":[{\"text\":\"学习NestJS\",\"items\":[{\"text\":\"资源\",\"link\":\"/framework/nestjs/index\"}]}],\"/framework/express\":[{\"text\":\"Learn ExpressJS\",\"items\":[{\"text\":\"资源\",\"link\":\"/framework/express/index\"}]}]}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}")</script>
    
  </body>
</html>