---
title: æ·±å…¥ç†è§£webpackæ ¸å¿ƒé…ç½®ç»“æ„
---

Webpack æ˜¯ä¸€ç§ **ã€Œé…ç½®ã€** é©±åŠ¨çš„æ„å»ºå·¥å…·ï¼Œæ‰€ä»¥ç«™åœ¨åº”ç”¨çš„è§’åº¦ï¼Œå¿…é¡»æ·±å…¥å­¦ä¹  Webpack çš„å„é¡¹é…ç½®è§„åˆ™ï¼Œæ‰èƒ½çµæ´»åº”å¯¹å„ç§æ„å»ºéœ€æ±‚ã€‚æœ¬æ–‡å°†ä½œä¸ºå°å†Œåº”ç”¨ç³»åˆ—çš„ä¸€ä¸ªæ€»ç»“ï¼Œæ±‡æ€»ä¸åº”ç”¨é…ç½®ç›¸å…³çš„å„é¡¹çŸ¥è¯†ç‚¹ï¼ŒåŒ…æ‹¬ï¼š

- å‰–æé…ç½®ç»“æ„è§„åˆ™ï¼Œè§£é‡Š`å¯¹è±¡ã€æ•°ç»„ã€å‡½æ•°`ä¸‰ç§å½¢æ€çš„å†™æ³•ï¼Œä»¥åŠå„è‡ªåº”å¯¹çš„åœºæ™¯ï¼›
- è¯¦ç»†è®²è§£ç¯å¢ƒæ²»ç†çš„æ„ä¹‰ï¼Œä»¥åŠå¦‚ä½•å€ŸåŠ©`å¤šæ–‡ä»¶`å®ç°ç¯å¢ƒæ²»ç†ï¼›
- å®Œæ•´ã€æ¸…æ™°åœ°ä»‹ç»è‹¥å¹²æ ¸å¿ƒé…ç½®é¡¹ï¼š`entry/output/target/mode`ï¼Œå¸®åŠ©ä½ æ›´æ·±å…¥ç†è§£é…ç½®è§„åˆ™ã€‚



## é…ç½®ç»“æ„è¯¦è§£

åœ¨å‰é¢ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»ç¼–å†™äº†è®¸å¤š Webpack é…ç½®ç¤ºä¾‹ï¼Œå…¶å¤§å¤šæ•°éƒ½ä»¥å•æ–‡ä»¶å¯¼å‡ºå•ä¸ªé…ç½®å¯¹è±¡æ–¹å¼å®ç°ï¼Œç±»ä¼¼ï¼š

```js
module.exports = {
  entry: './src/index.js',
  // å…¶ä»–é…ç½®...
}
```

å®é™…ä¸Šï¼ŒWebpack è¿˜æ”¯æŒä»¥æ•°ç»„ã€å‡½æ•°æ–¹å¼é…ç½®è¿è¡Œå‚æ•°ï¼Œä»¥é€‚é…ä¸åŒåœºæ™¯åº”ç”¨éœ€æ±‚ï¼Œå®ƒä»¬ä¹‹é—´å¤§è‡´ä¸ŠåŒºåˆ«ï¼š

- **å•ä¸ªé…ç½®å¯¹è±¡**ï¼šæ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§æ–¹å¼ï¼Œé€»è¾‘ç®€å•ï¼Œé€‚åˆå¤§å¤šæ•°ä¸šåŠ¡é¡¹ç›®ï¼›
- **é…ç½®å¯¹è±¡æ•°ç»„**ï¼šæ¯ä¸ªæ•°ç»„é¡¹éƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„é…ç½®å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½ä¼šè§¦å‘ä¸€æ¬¡å•ç‹¬çš„æ„å»ºï¼Œé€šå¸¸ç”¨äºéœ€è¦ä¸ºåŒä¸€ä»½ä»£ç æ„å»ºå¤šç§äº§ç‰©çš„åœºæ™¯ï¼Œå¦‚ `Library`ï¼›
- **å‡½æ•°**ï¼šWebpack å¯åŠ¨æ—¶ä¼šæ‰§è¡Œè¯¥å‡½æ•°è·å–é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°ä¸­æ ¹æ®ç¯å¢ƒå‚æ•°(å¦‚ `NODE_ENV`)åŠ¨æ€è°ƒæ•´é…ç½®å¯¹è±¡ã€‚

ä¸‹é¢æˆ‘ä»¬ç€é‡ä»‹ç»æ•°ç»„ã€å‡½æ•°ä¸¤ç§æ–¹å¼ã€‚



### ä½¿ç”¨é…ç½®æ•°ç»„

å¯¼å‡ºæ•°ç»„çš„æ–¹å¼å¾ˆç®€å•ï¼Œå¦‚ï¼š

::: code-group

```js [webpack.config.js]
module.exports = [
  {
    entry: './src/index.js',
    // ...
  },
  {
    entry: './src/index.js',
    // ...
  },
]
```

:::

ä½¿ç”¨æ•°ç»„æ–¹å¼æ—¶ï¼ŒWebpack ä¼šåœ¨å¯åŠ¨ååˆ›å»ºå¤šä¸ª `Compilation` å®ä¾‹ï¼Œå¹¶è¡Œæ‰§è¡Œæ„å»ºå·¥ä½œï¼Œä½†éœ€è¦æ³¨æ„ï¼Œ`Compilation` å®ä¾‹é—´åŸºæœ¬ä¸Šä¸ä½œé€šè®¯ï¼Œè¿™æ„å‘³ç€è¿™ç§å¹¶è¡Œæ„å»ºå¯¹è¿è¡Œæ€§èƒ½å¹¶æ²¡æœ‰ä»»ä½•æ­£å‘æ”¶ç›Šï¼Œä¾‹å¦‚æŸä¸ª Module åœ¨ `Compilation` å®ä¾‹ A ä¸­å®Œæˆè§£æã€æ„å»ºåï¼Œåœ¨å…¶å®ƒ `Compilation` ä¸­ä¾ç„¶éœ€è¦å®Œæ•´ç»å†æ„å»ºæµç¨‹ï¼Œæ— æ³•ç›´æ¥å¤ç”¨ç»“æœğŸ˜…ã€‚

æ•°ç»„æ–¹å¼ä¸»è¦ç”¨äºåº”å¯¹â€œåŒä¸€ä»½ä»£ç æ‰“åŒ…å‡ºå¤šç§äº§ç‰©â€çš„åœºæ™¯ï¼Œä¾‹å¦‚åœ¨æ„å»º `Library` æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦åŒæ—¶æ„å»ºå‡º ESM/CMD/UMD ç­‰æ¨¡å—æ–¹æ¡ˆçš„äº§ç‰©ï¼Œå¦‚ï¼š

::: code-group

```js [webpack.config.js] {10,19}
/**
 * @type {import('webpack').Configuration}
 */
module.exports = [
  {
    output: {
      filename: './dist-amd.js',
      libraryTarget: 'amd',
    },
    name: 'amd',
    entry: './app.js',
    mode: 'production',
  },
  {
    output: {
      filename: './dist-commonjs.js',
      libraryTarget: 'commonjs',
    },
    name: 'commonjs',
    entry: './app.js',
    mode: 'production',
  },
]
```

:::



::: tip

ä½¿ç”¨é…ç½®æ•°ç»„æ—¶ï¼Œè¿˜å¯ä»¥é€šè¿‡ `--config-name` å‚æ•°æŒ‡å®šéœ€è¦æ„å»ºçš„é…ç½®å¯¹è±¡ï¼Œä¾‹å¦‚ä¸Šä¾‹é…ç½®ä¸­è‹¥æ‰§è¡Œ `npx webpack --config-name='amd'`ï¼Œåˆ™ä»…ä½¿ç”¨æ•°ç»„ä¸­ `name='amd'` çš„é¡¹åšæ„å»ºã€‚

:::

æ­¤æ—¶é€‚åˆä½¿ç”¨é…ç½®æ•°ç»„æ–¹å¼è§£å†³ï¼›è‹¥æ˜¯â€œå¤šä»½ä»£ç æ‰“åŒ…å¤šä»½äº§ç‰©â€çš„åœºæ™¯ï¼Œåˆ™å»ºè®®ä½¿ç”¨ `entry` é…ç½®å¤šä¸ªåº”ç”¨å…¥å£ã€‚

ä½¿ç”¨æ•°ç»„æ–¹å¼æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å€ŸåŠ© [webpack-merge](https://www.npmjs.com/package/webpack-merge) å·¥å…·ç®€åŒ–é…ç½®é€»è¾‘ï¼Œå¦‚ï¼š

::: code-group

```js [webpack.config.js] {16,22}
const { merge } = require('webpack-merge')

/**
 * @type {import('webpack').Configuration}
 */
const baseConfig = {
  output: {
    path: "./dist"
  },
  name: "amd",
  entry: "./app.js",
  mode: "production",
}

module.exports = [
  merge(baseConfig, {
    output: {
      filename: '[name]-amd.js',
      libraryTarget: 'amd'
    }
  }),
  merge(baseConfig, {
    output: {
      filename: '[name]-commonjs.js',
      libraryTarget: 'commonjs'
    }
  }),
]
```

:::

ç¤ºä¾‹ä¸­å°†å…¬å…±é…ç½®æŠ½å–ä¸º `baseConfig` å¯¹è±¡ï¼Œä¹‹åé…åˆ `webpack-merge` åˆ›å»ºä¸åŒç›®æ ‡æ•°ç»„é¡¹ï¼Œè¿™ç§æ–¹å¼å¯æœ‰æ•ˆå‡å°‘é‡å¤çš„é…ç½®ä»£ç ï¼Œéå¸¸æ¨èä½¿ç”¨ã€‚

:::info

`webpack-merge` æ˜¯ Webpack ç”Ÿæ€å†…ä¸“é—¨ç”¨äºåˆå¹¶é…ç½®å¯¹è±¡çš„å·¥å…·ï¼Œåé¢æˆ‘ä»¬è¿˜ä¼šå±•å¼€è®²è§£ä½¿ç”¨æ–¹æ³•ã€‚

:::



### ä½¿ç”¨é…ç½®å‡½æ•°

é…ç½®å‡½æ•°æ–¹å¼è¦æ±‚åœ¨é…ç½®æ–‡ä»¶ä¸­å¯¼å‡ºä¸€ä¸ªå‡½æ•°ï¼Œå¹¶åœ¨å‡½æ•°ä¸­è¿”å› Webpack é…ç½®å¯¹è±¡ï¼Œæˆ–é…ç½®æ•°ç»„ï¼Œæˆ– `Promise` å¯¹è±¡ï¼Œå¦‚ï¼š

```js
module.exports = function(env, argv) {
  // ...
  return {
    entry: './src/index.js',
    // å…¶å®ƒé…ç½®...
  }
}
```

è¿è¡Œæ—¶ï¼ŒWebpack ä¼šä¼ å…¥ä¸¤ä¸ªç¯å¢ƒå‚æ•°å¯¹è±¡ï¼š

- `env`ï¼šé€šè¿‡ `--env` ä¼ é€’çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œé€‚ç”¨äºè‡ªå®šä¹‰å‚æ•°ï¼Œä¾‹å¦‚ï¼š

  | å‘½ä»¤ï¼š                                                       | `env`å‚æ•°å€¼ï¼š                                    |
  | ------------------------------------------------------------ | ------------------------------------------------ |
  | npx webpack --env prod                                       | `{ prod: true }`                                 |
  | npx webpack --env prod --env min                             | `{ prod: true, min: true }`                      |
  | npx webpack --env foo=bar=app                                | `{ foo: 'bar=app' }`                             |
  | npx webpack --env platform=app --env production              | `{ platform: 'app', production: true }`          |
  | npx webpack --env app.platform="staging" --env app.name="test" | `{ app: { platform: 'staging', name: 'test' } }` |

- `argv`: å‘½ä»¤è¡Œ [Flags](https://webpack.js.org/api/cli/#flags) å‚æ•°ï¼Œæ”¯æŒ `entry`/`output-path`/`mode`/`merge` ç­‰

â€œ**é…ç½®å‡½æ•°**â€è¿™ç§æ–¹å¼çš„æ„ä¹‰åœ¨äºï¼Œå…è®¸ç”¨æˆ·æ ¹æ®å‘½ä»¤è¡Œå‚æ•°åŠ¨æ€åˆ›å»ºé…ç½®å¯¹è±¡ï¼Œå¯ç”¨äºå®ç°ç®€å•çš„å¤šç¯å¢ƒæ²»ç†ç­–ç•¥ï¼Œä¾‹å¦‚ï¼š

::: code-group

```js [webpack.config.js]
module.exports = function(env, argv) {
  return {
    mode: argv.mode ? 'production' : 'development',
    devtool: argv.mode ? 'source-map' : 'eval',
    output: {
       path: path.join(__dirname, `./dist/${env.app.type}`,
      filename: '[name].js'
    },
    plugins: [
      new TerserPlugin({
        terserOptions: {
          compress: argv.mode === "production", 
        },
      }),
    ],
  }
}
```

:::

ç¤ºä¾‹æ”¯æŒé€šè¿‡å‘½ä»¤è¡Œä¼ å…¥ `env.app.type` ä¸ `argv.mode` å€¼ï¼Œå†³å®šæœ€ç»ˆé…ç½®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒåœºæ™¯ä¼ å…¥ä¸åŒå‘½ä»¤è¡Œå‚æ•°ï¼Œä»è€Œå®ç°ç¯å¢ƒéš”ç¦»æ•ˆæœã€‚

ä¸è¿‡è¿™ç§æ–¹å¼å¹¶ä¸å¸¸ç”¨ï¼Œä¸€æ˜¯å› ä¸ºéœ€è¦åœ¨é…ç½®å‡½æ•°å†…åšè®¸å¤šé€»è¾‘åˆ¤æ–­ï¼Œå¤æ‚åœºæ™¯ä¸‹å¯èƒ½å¯è¯»æ€§ä¼šå¾ˆä½ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼›äºŒæ˜¯å¼ºä¾èµ–äºå‘½ä»¤è¡Œå‚æ•°ï¼Œå¯èƒ½æœ€ç»ˆéœ€è¦å†™å‡ºä¸€ä¸²å¾ˆé•¿çš„è¿è¡Œå‘½ä»¤ï¼Œåº”ç”¨ä½“éªŒè¾ƒå·®ã€‚ç›®å‰ç¤¾åŒºæ¯”è¾ƒæµè¡Œé€šè¿‡ä¸åŒé…ç½®æ–‡ä»¶åŒºåˆ†ä¸åŒç¯å¢ƒçš„è¿è¡Œé…ç½®ï¼Œé…åˆ `--config` å‚æ•°å®ç°ç¯å¢ƒæ²»ç†ï¼Œä¸‹é¢æˆ‘ä»¬ä¼šå±•å¼€è®²è§£è¿™ç§æ–¹æ¡ˆã€‚

æœ€åç®€å•æ€»ç»“ä¸‹ï¼ŒWebpack æ”¯æŒä¸‰ç§é…ç½®æ–¹å¼ï¼šå¯¹è±¡ã€æ•°ç»„ã€å‡½æ•°ï¼Œå…¶ä¸­å¯¹è±¡æ–¹å¼æœ€ç®€å•ï¼Œä¸”èƒ½å¤Ÿåº”å¯¹å¤§å¤šæ•°ä¸šåŠ¡å¼€å‘åœºæ™¯ï¼Œæ‰€ä»¥ä½¿ç”¨ç‡æœ€é«˜ï¼›æ•°ç»„æ–¹å¼ä¸»è¦ç”¨äºæ„å»º Library åœºæ™¯ï¼›å‡½æ•°æ–¹å¼çµæ´»æ€§è¾ƒé«˜ï¼Œå¯ç”¨äºå®ç°ä¸€äº›ç®€å•çš„ç¯å¢ƒæ²»ç†ç­–ç•¥ã€‚åŒå­¦ä»¬å¯æ ¹æ®å®é™…åœºæ™¯ï¼Œæ‹©ä¼˜é€‰ç”¨ã€‚



## ç¯å¢ƒæ²»ç†ç­–ç•¥

åœ¨ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–å®è·µä¸­ï¼Œé€šå¸¸éœ€è¦å°†åŒä¸€ä¸ªåº”ç”¨é¡¹ç›®éƒ¨ç½²åœ¨ä¸åŒç¯å¢ƒ(å¦‚ç”Ÿäº§ç¯å¢ƒã€å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒ)ä¸­ï¼Œä»¥æ»¡è¶³é¡¹ç›®å‚ä¸å„æ–¹çš„ä¸åŒéœ€æ±‚ã€‚è¿™å°±è¦æ±‚æˆ‘ä»¬èƒ½æ ¹æ®éƒ¨ç½²ç¯å¢ƒéœ€æ±‚ï¼Œå¯¹åŒä¸€ä»½ä»£ç æ‰§è¡Œå„æœ‰ä¾§é‡çš„æ‰“åŒ…ç­–ç•¥ï¼Œä¾‹å¦‚ï¼š

- å¼€å‘ç¯å¢ƒéœ€è¦ä½¿ç”¨ `webpack-dev-server` å®ç° Hot Module Replacementï¼›
- æµ‹è¯•ç¯å¢ƒéœ€è¦å¸¦ä¸Šå®Œæ•´çš„ Soucemap å†…å®¹ï¼Œä»¥å¸®åŠ©æ›´å¥½åœ°å®šä½é—®é¢˜ï¼›
- ç”Ÿäº§ç¯å¢ƒéœ€è¦å°½å¯èƒ½æ‰“åŒ…å‡ºæ›´å¿«ã€æ›´å°ã€æ›´å¥½çš„åº”ç”¨ä»£ç ï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒã€‚

Webpack ä¸­æœ‰è®¸å¤šå®ç°ç¯å¢ƒæ²»ç†çš„æ–¹æ¡ˆï¼Œæ¯”å¦‚ä¸Šé¢ä»‹ç»è¿‡çš„ï¼Œä½¿ç”¨â€œé…ç½®å‡½æ•°â€é…åˆå‘½ä»¤è¡Œå‚æ•°åŠ¨æ€è®¡ç®—é…ç½®å¯¹è±¡ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸šç•Œæ¯”è¾ƒæµè¡Œå°†ä¸åŒç¯å¢ƒé…ç½®åˆ†åˆ«ç»´æŠ¤åœ¨å•ç‹¬çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå¦‚ï¼š

```bash
.
â””â”€â”€ config
  â”œâ”€â”€ webpack.common.js
  â”œâ”€â”€ webpack.development.js
  â”œâ”€â”€ webpack.testing.js
  â””â”€â”€ webpack.production.js
```

ä¹‹åé…åˆ `--config` é€‰é¡¹æŒ‡å®šé…ç½®ç›®æ ‡ï¼Œå¦‚ï¼š

```bash
npx webpack --config webpack.development.js
```

è¿™ç§æ¨¡å¼ä¸‹é€šå¸¸ä¼šå°†éƒ¨åˆ†é€šç”¨é…ç½®æ”¾åœ¨åŸºç¡€æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸Šä¾‹çš„ `webpack.common.js`ï¼Œä¹‹ååœ¨å…¶å®ƒæ–‡ä»¶ä¸­å¼•å…¥è¯¥æ¨¡å—å¹¶ä½¿ç”¨ [webpack-merge](https://www.npmjs.org/package/webpack-merge) åˆå¹¶é…ç½®å¯¹è±¡ã€‚

`webpack-merge` æ˜¯ä¸€ä¸ªä¸“ä¸º Webpack è®¾è®¡çš„æ•°æ®åˆå¹¶(`merge`)çš„å·¥å…·ï¼ŒåŠŸèƒ½é€»è¾‘ä¸ Lodash çš„ [merge](https://devdocs.io/lodash~4/index#merge) å‡½æ•°ã€ [Object.assign](https://devdocs.io/javascript/global_objects/object/assign) ç­‰ç›¸ä¼¼ï¼Œä½†æ”¯æŒæ›´å¤šç‰¹æ€§ï¼Œå¦‚ï¼š

- æ”¯æŒæ•°ç»„å±æ€§åˆå¹¶ï¼Œä¾‹å¦‚ï¼š

  ```js
  merge({ arr: [1] }, { arr: [2] })
  // { arr: [1, 2] }
  ```

- æ”¯æŒå‡½æ•°å±æ€§åˆå¹¶ï¼Œä¾‹å¦‚ï¼š

  ```js
  const res = merge(
    { func: () => console.log(1) },
    { func: () => console.log(2) }
  );
  res.func();
  // => 1,2 
  ```

- æ”¯æŒè®¾å®šå¯¹è±¡åˆå¹¶ç­–ç•¥ï¼Œæ”¯æŒ `match/append/prepend/replace/merge` è§„åˆ™ï¼›

- æ”¯æŒä¼ å…¥è‡ªå®šä¹‰å¯¹è±¡åˆå¹¶å‡½æ•°ï¼›

- ç­‰ç­‰ã€‚

è¿™äº›ç‰¹æ€§èƒ½æ›´å¥½åœ°æ”¯æŒ Webpack è¿™ç§é«˜åº¦å¤æ‚çš„æ•°æ®åˆå¹¶åœºæ™¯ï¼Œä¾‹å¦‚å¯¹äº `module.rules` æ•°ç»„ï¼Œè‹¥åªæ˜¯ä½¿ç”¨ `Object.assign` åšåˆå¹¶ï¼Œåˆ™åªä¼šå¯¼è‡´åé¢å¯¹è±¡å±æ€§æ›¿æ¢äº†å‰é¢å¯¹è±¡å±æ€§ï¼›è€Œä½¿ç”¨ `webpack-merge` èƒ½å¤Ÿå®ç°ä¸¤ä¸ªæ•°ç»„é¡¹åˆå¹¶ï¼Œæ›´ç¬¦åˆé¢„æœŸã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª [ç¤ºä¾‹](https://github.com/Tecvan-fe/webpack-book-samples/blob/main/env-manage/webpack.common.js) ç®€å•ä¸²ä¸€ä¸‹ä¸ `webpack-merge` å®ç°ç¯å¢ƒç®¡ç†çš„è¿‡ç¨‹ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†é€šç”¨é…ç½®æ”¾åœ¨å…¬å…±æ–‡ä»¶ä¸­ï¼Œå¦‚ï¼š

::: code-group

```js [webpack.common.js]
const path = require('node:path');
const HTMLWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  entry: { main: './src/index.js' },
  output: {
    filename: '[name].js',
    path: path.resolve(__dirname, 'dist'),
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        use: ['babel-loader'],
      },
    ],
  },
  plugins: [new HTMLWebpackPlugin()],
};
```

:::

å…¶æ¬¡ï¼Œéœ€è¦å®‰è£… `webpack-merge` åšé…ç½®åˆå¹¶æ“ä½œï¼š

```bash
pnpm i -D webpack-merge
```

ä¹‹åï¼Œåˆ›å»ºå¯¹åº”ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼Œå¦‚ `webpack.development.js`ï¼Œå¹¶è¾“å…¥å¼€å‘ç¯å¢ƒä¸“ç”¨é…ç½®ä»£ç ï¼Œå¦‚ï¼š

::: code-group

```js [webpack.development.js]
const { merge } = require('webpack-merge');
const baseConfig = require('./webpack.common');

// ä½¿ç”¨ webpack-merge åˆå¹¶é…ç½®å¯¹è±¡
module.exports = merge(baseConfig, {
  mode: 'development',
  devtool: 'source-map',
  devServer: { hot: true },
})
```

:::

æœ€åï¼Œæ‰§è¡Œæ„å»ºå‘½ä»¤å¹¶é€šè¿‡ `--config` å‚æ•°ä¼ å…¥é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œå¦‚ï¼š

```bash
npx webpack --config=webpack.development.js
```

è‡³æ­¤ï¼Œæ ·ä¾‹å¤§è‡´æ­å»ºå®Œæ¯•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿˜å¯ä»¥ç»§ç»­ä¸ºæ›´å¤šæ„å»ºç¯å¢ƒé…å¤‡ç‰¹å®šçš„é…ç½®æ–‡ä»¶ï¼Œæµç¨‹åŒä¸Šï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚



## æ ¸å¿ƒé…ç½®é¡¹æ±‡æ€»

åœ¨å‰é¢ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»åŸºäºå„ç§åº”ç”¨åœºæ™¯ç»¼åˆè®²è§£äº† Webpack æ–¹æ–¹é¢é¢çš„åº”ç”¨æ–¹æ³•ï¼Œå…¶ä¸­æ¶‰åŠå¤šè¾¾ä¸Šç™¾ç§é…ç½®é¡¹ï¼Œä¸å¤ªå¯èƒ½ä¸€ä¸€è¯¦ç»†è®²è§£ï¼Œä½†å¤§è‡´ä¸Šå¯ä»¥åˆ’åˆ†ä¸‹å›¾ä¸­å±•ç¤ºçš„å‡ ç§åˆ†ç±»ï¼š

![webpackæµç¨‹](./imgs/2-2.webp)

åŒ…æ‹¬ï¼šæµç¨‹é…ç½®ã€æ€§èƒ½ä¼˜åŒ–ç±»é…ç½®ã€æ—¥å¿—ç±»é…ç½®ã€å¼€å‘æ•ˆç‡ç±»é…ç½®ç­‰ï¼Œè¿™é‡Œé¢è¾ƒå¸¸ç”¨ï¼Œéœ€è¦ç€é‡å­¦ä¹ çš„é…ç½®æœ‰ï¼š

- `entry`ï¼šå£°æ˜é¡¹ç›®å…¥å£æ–‡ä»¶ï¼ŒWebpack ä¼šä»è¿™ä¸ªæ–‡ä»¶å¼€å§‹é€’å½’æ‰¾å‡ºæ‰€æœ‰æ–‡ä»¶ä¾èµ–ï¼›
- `output`ï¼šå£°æ˜æ„å»ºç»“æœçš„å­˜æ”¾ä½ç½®ï¼›
- `target`ï¼šç”¨äºé…ç½®ç¼–è¯‘äº§ç‰©çš„ç›®æ ‡è¿è¡Œç¯å¢ƒï¼Œæ”¯æŒ `web`ã€`node`ã€`electron` ç­‰å€¼ï¼Œä¸åŒå€¼æœ€ç»ˆäº§ç‰©ä¼šæœ‰æ‰€å·®å¼‚ï¼›
- `mode`ï¼šç¼–è¯‘æ¨¡å¼çŸ­è¯­ï¼Œæ”¯æŒ `development`ã€`production` ç­‰å€¼ï¼ŒWebpack ä¼šæ ¹æ®è¯¥å±æ€§æ¨æ–­é»˜è®¤é…ç½®ï¼›
- `optimization`ï¼šç”¨äºæ§åˆ¶å¦‚ä½•ä¼˜åŒ–äº§ç‰©åŒ…ä½“ç§¯ï¼Œå†…ç½® Dead Code Eliminationã€Scope Hoistingã€ä»£ç æ··æ·†ã€ä»£ç å‹ç¼©ç­‰åŠŸèƒ½ï¼›
- `module`ï¼šç”¨äºå£°æ˜æ¨¡å—åŠ è½½è§„åˆ™ï¼Œä¾‹å¦‚é’ˆå¯¹ä»€ä¹ˆç±»å‹çš„èµ„æºéœ€è¦ä½¿ç”¨å“ªäº› Loader è¿›è¡Œå¤„ç†ï¼›
- `plugin`ï¼šWebpack æ’ä»¶åˆ—è¡¨ã€‚

å…¶ä¸­ï¼Œ`optimization/module/plugin` å±æ€§å°†åœ¨åç»­ç« èŠ‚åšä¸“é—¨ä»‹ç»ï¼Œæ­¤å¤„å…ˆä¸å±•å¼€ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†é›†ä¸­è®²è§£ `entry/output/target/mode` å±æ€§ï¼Œå¸®ä½ æ›´å…¨é¢ã€ç«‹ä½“ã€é€å½»åœ°ç†è§£ Webpack é…ç½®é¡¹é€»è¾‘ã€‚



### entryé…ç½®è¯¦è§£

Webpack çš„åŸºæœ¬è¿è¡Œé€»è¾‘æ˜¯ä» **ã€Œå…¥å£æ–‡ä»¶ã€** å¼€å§‹ï¼Œé€’å½’åŠ è½½ã€æ„å»ºæ‰€æœ‰é¡¹ç›®èµ„æºï¼Œæ‰€ä»¥å‡ ä¹æ‰€æœ‰é¡¹ç›®éƒ½å¿…é¡»ä½¿ç”¨ [entry](https://webpack.js.org/configuration/entry-context/) é…ç½®é¡¹æ˜ç¡®å£°æ˜é¡¹ç›®å…¥å£ã€‚`entry` é…ç½®è§„åˆ™æ¯”è¾ƒå¤æ‚ï¼Œæ”¯æŒå¦‚ä¸‹å½¢æ€ï¼š

- å­—ç¬¦ä¸²ï¼šæŒ‡å®šå…¥å£æ–‡ä»¶è·¯å¾„ï¼›
- å¯¹è±¡ï¼šå¯¹è±¡å½¢æ€åŠŸèƒ½æ¯”è¾ƒå®Œå¤‡ï¼Œé™¤äº†å¯ä»¥æŒ‡å®šå…¥å£æ–‡ä»¶åˆ—è¡¨å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®šå…¥å£ä¾èµ–ã€Runtime æ‰“åŒ…æ–¹å¼ç­‰ï¼›
- å‡½æ•°ï¼šåŠ¨æ€ç”Ÿæˆ Entry é…ç½®ä¿¡æ¯ï¼Œå‡½æ•°ä¸­å¯è¿”å›å­—ç¬¦ä¸²ã€å¯¹è±¡æˆ–æ•°ç»„ï¼›
- æ•°ç»„ï¼šæŒ‡æ˜å¤šä¸ªå…¥å£æ–‡ä»¶ï¼Œæ•°ç»„é¡¹å¯ä»¥ä¸ºä¸Šè¿°ä»‹ç»çš„æ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²ã€å¯¹è±¡ã€å‡½æ•°å½¢å¼ï¼ŒWebpack ä¼šå°†æ•°ç»„æŒ‡æ˜çš„å…¥å£å…¨éƒ¨æ‰“åŒ…æˆä¸€ä¸ª Bundleã€‚

ä¾‹å¦‚ï¼š

::: code-group

```js [webpack.config.js]
module.exports = {
  //...
  entry: {
    // 1ï¸âƒ£ å­—ç¬¦ä¸²å½¢æ€
    home: './home.js',
    // 2ï¸âƒ£ æ•°ç»„å½¢æ€
    shared: ['react', 'react-dom', 'redux', 'react-redux'],
    // 3ï¸âƒ£ å¯¹è±¡å½¢æ€
    personal: {
      import: './personal.js',
      filename: 'pages/personal.js',
      dependOn: 'shared',
      chunkLoading: 'jsonp',
      asyncChunks: true
    },
    // 4ï¸âƒ£ å‡½æ•°å½¢æ€
    admin: function() {
      return './admin.js';
    }
  },
};
```

:::

è¿™å…¶ä¸­ï¼Œ**ã€Œå¯¹è±¡ã€** å½¢æ€çš„é…ç½®é€»è¾‘æœ€ä¸ºå¤æ‚ï¼Œæ”¯æŒå¦‚ä¸‹é…ç½®å±æ€§ï¼š

- `import`ï¼šå£°æ˜å…¥å£æ–‡ä»¶ï¼Œæ”¯æŒè·¯å¾„å­—ç¬¦ä¸²æˆ–è·¯å¾„æ•°ç»„(å¤šå…¥å£)ï¼›
- `dependOn`ï¼šå£°æ˜è¯¥å…¥å£çš„å‰ç½®ä¾èµ– Bundleï¼›
- `runtime`ï¼šè®¾ç½®è¯¥å…¥å£çš„ Runtime Chunkï¼Œè‹¥è¯¥å±æ€§ä¸ä¸ºç©ºï¼ŒWebpack ä¼šå°†è¯¥å…¥å£çš„è¿è¡Œæ—¶ä»£ç æŠ½ç¦»æˆå•ç‹¬çš„ Bundleï¼›
- `filename`ï¼šæ•ˆæœä¸ [output.filename](https://webpack.js.org/configuration/output/#outputfilename) ç±»åŒï¼Œç”¨äºå£°æ˜è¯¥æ¨¡å—æ„å»ºäº§ç‰©è·¯å¾„ï¼›
- `library`ï¼šå£°æ˜è¯¥å…¥å£çš„ [output.library](https://webpack.js.org/configuration/output/#outputlibrary) é…ç½®ï¼Œä¸€èˆ¬åœ¨æ„å»º NPM Library æ—¶ä½¿ç”¨ï¼›
- `publicPath`ï¼šæ•ˆæœä¸ [output.publicPath](https://webpack.js.org/configuration/output/#outputpublicpath) ç›¸åŒï¼Œç”¨äºå£°æ˜è¯¥å…¥å£æ–‡ä»¶çš„å‘å¸ƒ URLï¼›
- `chunkLoading`ï¼šæ•ˆæœä¸ [output.chunkLoading](https://webpack.js.org/configuration/output/#outputchunkloading) ç›¸åŒï¼Œç”¨äºå£°æ˜å¼‚æ­¥æ¨¡å—åŠ è½½çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œæ”¯æŒ `false/jsonp/require/import` ç­‰å€¼ï¼›
- `asyncChunks`ï¼šæ•ˆæœä¸ [output.asyncChunks](https://webpack.js.org/configuration/output/#outputasyncchunks) ç›¸åŒï¼Œç”¨äºå£°æ˜æ˜¯å¦æ”¯æŒå¼‚æ­¥æ¨¡å—åŠ è½½ï¼Œé»˜è®¤å€¼ä¸º `true`ã€‚

è€Œè¿™äº›å±æ€§ä¸­ï¼Œ`dependOn` ä¸ `runtime` æœ€ä¸ºæ™¦æ¶©éš¾æ‡‚ï¼Œæœ‰å¿…è¦æ„é€ å®ä¾‹ï¼Œå±•å¼€è®²è§£ã€‚



> 1ï¸âƒ£ ä½¿ç”¨ `entry.dependOn` å£°æ˜å…¥å£ä¾èµ–ï¼š

`dependOn` å±æ€§ç”¨äºå£°æ˜å‰ç½® Bundle ä¾èµ–ï¼Œä»æ•ˆæœä¸Šçœ‹èƒ½å¤Ÿå‡å°‘é‡å¤ä»£ç ï¼Œä¼˜åŒ–æ„å»ºäº§ç‰©è´¨é‡ã€‚ä¾‹å¦‚ï¼š

::: code-group

```js [webpack.config.js] {7}
module.exports = {
  //...
  entry: {
    main: './src/index.js',
    foo: {
      import: './src/foo.js',
      dependOn: 'main'
    }
};
```

:::

ğŸŒ°ä»£ç ï¼š

::: code-group

```js [./src/index.js]
import bar from './bar'

console.log(bar)
console.log('index module file')
```

```js [./src/foo.js]
import bar from './bar'

console.log(bar)
console.log('foo module file')
```

```js [./src/bar.js]
export default 'bar'
```

:::



ç¤ºä¾‹ä¸­ï¼Œ`foo` å…¥å£çš„ `dependOn` å±æ€§æŒ‡å‘ `main` å…¥å£ï¼Œæ­¤æ—¶ Webpack è®¤ä¸ºï¼šå®¢æˆ·ç«¯åœ¨åŠ è½½ `foo` äº§ç‰©ä¹‹å‰å¿…ç„¶ä¼šåŠ è½½ `main`ï¼Œå› æ­¤å¯ä»¥å°†é‡å¤çš„æ¨¡å—ä»£ç ã€è¿è¡Œæ—¶ä»£ç ç­‰éƒ½æ”¾åˆ° `main` äº§ç‰©ï¼Œå‡å°‘ä¸å¿…è¦çš„é‡å¤ï¼Œæœ€ç»ˆæ‰“åŒ…ç»“æœï¼š

![entry-dependOn](./imgs/11-1.webp)

å·¦è¾¹ä¸º `main` äº§ç‰©ï¼ŒåŒ…å«æ‰€æœ‰æ¨¡å—ã€è¿è¡Œæ—¶ä»£ç ï¼Œä¸æ™®é€š Bundle æ— å¼‚ï¼›å³è¾¹ä¸º `foo` äº§ç‰©ï¼Œä»£ç ç»“æ„éå¸¸æ¸…çˆ½ã€‚ä½œä¸ºå¯¹æ¯”ï¼Œè‹¥ä¸æŒ‡å®š `dependOn` å±æ€§ï¼Œåˆ™æ„å»ºç»“æœï¼š

![without dependOn](./imgs/11-2.webp)

å¯ä»¥çœ‹å‡ºä¸¤è¾¹å†…å®¹å¹¶æ— å·®å¼‚ã€‚

`dependOn` é€‚ç”¨äºå“ªäº›æœ‰æ˜ç¡®å…¥å£ä¾èµ–çš„åœºæ™¯ï¼Œä¾‹å¦‚æˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªä¸»æ¡†æ¶ Bundleï¼Œå…¶ä¸­åŒ…å«äº†é¡¹ç›®åŸºæœ¬æ¡†æ¶(å¦‚ React)ï¼Œä¹‹åè¿˜éœ€è¦ä¸ºæ¯ä¸ªé¡µé¢å•ç‹¬æ„å»º Bundleï¼Œè¿™äº›é¡µé¢ä»£ç ä¹Ÿéƒ½ä¾èµ–äºä¸»æ¡†æ¶ä»£ç ï¼Œæ­¤æ—¶å¯ç”¨ `dependOn` å±æ€§ä¼˜åŒ–äº§ç‰©å†…å®¹ï¼Œå‡å°‘ä»£ç é‡å¤ã€‚

- [entry-dependOn github online](https://github1s.com/Tecvan-fe/webpack-book-samples/blob/main/entry-obj/webpack.config.js)



> 2ï¸âƒ£ ä½¿ç”¨ `entry.runtime` ç®¡ç†è¿è¡Œæ—¶ä»£ç ï¼š

ä¸ºæ”¯æŒäº§ç‰©ä»£ç åœ¨å„ç§ç¯å¢ƒä¸­æ­£å¸¸è¿è¡Œï¼ŒWebpack ä¼šåœ¨äº§ç‰©æ–‡ä»¶ä¸­æ³¨å…¥ä¸€ç³»åˆ—è¿è¡Œæ—¶ä»£ç ï¼Œç”¨ä»¥æ”¯æ’‘èµ·æ•´ä¸ªåº”ç”¨æ¡†æ¶ã€‚è¿è¡Œæ—¶ä»£ç çš„å¤šå¯¡å–å†³äºæˆ‘ä»¬ç”¨åˆ°å¤šå°‘ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼š

- éœ€è¦å¯¼å…¥å¯¼å‡ºæ–‡ä»¶æ—¶ï¼Œå°†æ³¨å…¥ `__webpack_require__.r` ç­‰ï¼›
- ä½¿ç”¨å¼‚æ­¥åŠ è½½æ—¶ï¼Œå°†æ³¨å…¥ `__webpack_require__.l` ç­‰ï¼›
- ç­‰ç­‰ã€‚

ä¸è¦å°çœ‹è¿è¡Œæ—¶ä»£ç é‡ï¼Œæç«¯æƒ…å†µä¸‹ç”šè‡³æœ‰å¯èƒ½è¶…è¿‡ä¸šåŠ¡ä»£ç æ€»é‡ï¼ä¸ºæ­¤ï¼Œå¿…è¦æ—¶æˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨ [runtime](https://webpack.js.org/concepts/entry-points/#entrydescription-object) é…ç½®å°†è¿è¡Œæ—¶æŠ½ç¦»ä¸ºç‹¬ç«‹ Bundleï¼Œä¾‹å¦‚ï¼š

::: code-group

```js [webpack.config.js] {13,17}
const path = require('node:path')

/**
 * @type {import('webpack').Configuration}
 */

module.exports = {
  mode: 'development',
  devtool: false,
  entry: {
    main: {
      import: './src/index.js',
      runtime: 'common-runtime'
    },
    foo: {
      import: './src/foo.js',
      runtime: 'common-runtime'
    }
  },
  output: {
    clean: true,
    filename: '[name].js',
    path: path.join(__dirname, 'dist')
  },
}
```

:::

ğŸŒ°ä»£ç ï¼š

::: code-group

```js [./src/index.js]
import bar from './bar'

console.log(bar)
console.log('index module file')
```

```js [./src/foo.js]
import bar from './bar'

console.log(bar)
console.log('foo module file')
```

```js [./src/bar.js]
export default 'bar'
```

:::

ç¤ºä¾‹ä¸­ï¼Œ`main` ä¸ `foo` å…¥å£å‡å°† `runtime` å£°æ˜ä¸º `common-runtime`ï¼Œæ­¤æ—¶ Webpack ä¼šå°†è¿™ä¸¤ä¸ªå…¥å£çš„è¿è¡Œæ—¶ä»£ç éƒ½æŠ½å–å‡ºæ¥ï¼Œæ”¾åœ¨ `common-runtime` Bundle ä¸­ï¼Œæ•ˆæœï¼š

![entry runtime](./imgs/11-3.webp)

`entry.runtime` æ˜¯ä¸€ç§å¸¸ç”¨çš„åº”ç”¨æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µï¼Œå»ºè®®å¤§å®¶å¤šåšå°è¯•ã€ä½¿ç”¨ğŸš€ã€‚

- [entry-runtime github online](https://github1s.com/Tecvan-fe/webpack-book-samples/blob/main/entry-runtime/webpack.config.js)

### ä½¿ç”¨ `output` å£°æ˜è¾“å‡ºæ–¹å¼

Webpack çš„ [output](https://webpack.js.org/configuration/output/) é…ç½®é¡¹ç”¨äºå£°æ˜ï¼šå¦‚ä½•è¾“å‡ºæ„å»ºç»“æœï¼Œæ¯”å¦‚äº§ç‰©æ”¾åœ¨ä»€ä¹ˆåœ°æ–¹ã€æ–‡ä»¶åæ˜¯ä»€ä¹ˆã€æ–‡ä»¶ç¼–ç ç­‰ã€‚`output` æ”¯æŒè®¸å¤šå­é…ç½®é¡¹ï¼ŒåŒ…æ‹¬ï¼š

- [output.path](https://webpack.js.org/configuration/output/#outputpath)ï¼šå£°æ˜äº§ç‰©æ”¾åœ¨ä»€ä¹ˆæ–‡ä»¶ç›®å½•ä¸‹ï¼›âœ…
- [output.filename](https://webpack.js.org/configuration/output/#outputfilename)ï¼šå£°æ˜äº§ç‰©æ–‡ä»¶åè§„åˆ™ï¼Œæ”¯æŒ `[name]/[hash]` ç­‰å ä½ç¬¦ï¼›âœ…
- [output.publicPath](https://webpack.js.org/configuration/output/#outputpublicpath)ï¼šæ–‡ä»¶å‘å¸ƒè·¯å¾„ï¼Œåœ¨ Web åº”ç”¨ä¸­ä½¿ç”¨ç‡è¾ƒé«˜ï¼›âœ…
- [output.clean](https://webpack.js.org/configuration/output/#outputclean)ï¼šæ˜¯å¦è‡ªåŠ¨æ¸…é™¤ `path` ç›®å½•ä¸‹çš„å†…å®¹ï¼Œè°ƒè¯•æ—¶ç‰¹åˆ«å¥½ç”¨ï¼›
- [output.library](https://webpack.js.org/configuration/output/#outputlibrary)ï¼šNPM Library å½¢æ€ä¸‹çš„ä¸€äº›äº§ç‰©ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼šLibrary åç§°ã€æ¨¡å—åŒ–(UMD/CMD ç­‰)è§„èŒƒï¼›
- [output.chunkLoading](https://webpack.js.org/configuration/output/#outputchunkloading)ï¼šå£°æ˜åŠ è½½å¼‚æ­¥æ¨¡å—çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œæ”¯æŒ `false/jsonp/require` ç­‰æ–¹å¼ã€‚
- ç­‰ç­‰ã€‚

å¯¹äº Web åº”ç”¨åœºæ™¯ï¼Œå¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ `path/filename/publicPath` å³å¯æ»¡è¶³éœ€æ±‚ï¼Œå…¶å®ƒå±æ€§ä½¿ç”¨ç‡ä¸é«˜ï¼Œç¯‡å¹…å…³ç³»ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚



### ä½¿ç”¨ `target` è®¾ç½®æ„å»ºç›®æ ‡

è™½ç„¶å¤šæ•°æ—¶å€™ Webpack éƒ½è¢«ç”¨äºæ‰“åŒ… Web åº”ç”¨ï¼Œä½†å®é™…ä¸Š Webpack è¿˜æ”¯æŒæ„å»º Nodeã€Electronã€NW.jsã€WebWorker ç­‰åº”ç”¨å½¢æ€ï¼Œè¿™ä¸€ç‰¹æ€§ä¸»è¦é€šè¿‡ [target](https://webpack.js.org/configuration/target/) é…ç½®æ§åˆ¶ï¼Œæ”¯æŒå¦‚ä¸‹æ•°å€¼ï¼š

- `node[[X].Y]`ï¼šç¼–è¯‘ä¸º Node åº”ç”¨ï¼Œæ­¤æ—¶å°†ä½¿ç”¨ Node çš„ `require` æ–¹æ³•åŠ è½½å…¶å®ƒ Chunkï¼Œæ”¯æŒæŒ‡å®š Node ç‰ˆæœ¬ï¼Œå¦‚ï¼š`node12.13`ï¼›
- `async-node[[X].Y]`ï¼šç¼–è¯‘ä¸º Node åº”ç”¨ï¼Œä¸ `node` ç›¸æ¯”ä¸»è¦å·®å¼‚åœ¨äºï¼š`async-node` æ–¹å¼å°†ä»¥å¼‚æ­¥(Promise)æ–¹å¼åŠ è½½å¼‚æ­¥æ¨¡å—(`node` æ—¶ç›´æ¥ä½¿ç”¨ `require`)ã€‚æ”¯æŒæŒ‡å®š Node ç‰ˆæœ¬ï¼Œå¦‚ï¼š`async-node12.13`ï¼›
- `nwjs[[X].Y]`ï¼šç¼–è¯‘ä¸º NW.js åº”ç”¨ï¼›
- `node-webkit[[X].Y]`ï¼šåŒ `nwjs`ï¼›
- `electron[[X].Y]-main`ï¼šæ„å»ºä¸º Electron [ä¸»è¿›ç¨‹](https://www.electronjs.org/zh/docs/latest/tutorial/process-model#ä¸»è¿›ç¨‹)ï¼›
- `electron[[X].Y]-renderer`ï¼šæ„å»ºä¸º Electron [æ¸²æŸ“è¿›ç¨‹](https://www.electronjs.org/zh/docs/latest/tutorial/process-model#æ¸²æŸ“å™¨è¿›ç¨‹)ï¼›
- `electron[[X].Y]-preload`ï¼šæ„å»ºä¸º Electron Preload [è„šæœ¬](https://www.electronjs.org/zh/docs/latest/tutorial/process-model#preload-è„šæœ¬)ï¼›
- `web`ï¼šæ„å»ºä¸º Web åº”ç”¨ï¼›
- `esX`ï¼šæ„å»ºä¸ºç‰¹å®šç‰ˆæœ¬ ECMAScript å…¼å®¹çš„ä»£ç ï¼Œæ”¯æŒ `es5`ã€`es2020` ç­‰ï¼›
- `browserslist`ï¼šæ ¹æ®æµè§ˆå™¨å¹³å°ä¸ç‰ˆæœ¬ï¼Œæ¨æ–­éœ€è¦å…¼å®¹çš„ ES ç‰¹æ€§ï¼Œæ•°æ®æ¥æºäº [Browserslist](https://github.com/browserslist/browserslist#queries) é¡¹ç›®ï¼Œç”¨æ³•å¦‚ï¼š`browserslist: 'last 2 major versions'`ã€‚

ä¸åŒæ„å»ºç›®æ ‡ä¼šæ ¹æ®å¹³å°ç‰¹æ€§æ‰“åŒ…å‡ºç•¥æœ‰å·®å¼‚çš„ç»“æœ(ä¸»è¦ä½“ç°åœ¨è¿è¡Œæ—¶ä¸ NPM Library)ï¼Œä¾‹å¦‚å¯¹äºä¸‹é¢è¿™ç§ä½¿ç”¨äº†å¼‚æ­¥å¯¼å…¥çš„ä»£ç ï¼š

::: code-group

```js [./src/index.js]
import('./foo').then(console.log)
```

```js [./src/foo.js]
export default 'foo'
```

:::

ä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼ŒåŒæ—¶æ„å»º `node` ä¸ `web` ç‰ˆæœ¬ï¼š

::: code-group

```js [webpack.config.js] {22,28}
const path = require('node:path')
const { merge } = require('webpack-merge')

/**
 * @type {import('webpack').Configuration}
 */
const baseConfig = {
  mode: 'development',
  target: 'web',
  devtool: false,
  entry: {
    main: { import: './src/index.js' }
  },
  output: {
    clean: true,
    path: path.join(__dirname, 'dist')
  },
}

module.exports = [
  merge(baseConfig, {
    target: 'web',
    output: {
      filename: 'web-[name].js'
    }
  }),
  merge(baseConfig, {
    target: 'node',
    output: {
      filename: 'node-[name].js'
    }
  }),
]
```

:::

ğŸŒ°ä»£ç 

::: code-group

```js [./src/index.js]
import('./foo').then(console.log)
```

```js [./src/foo.js]
export default 'foo'
```

:::

ä¹‹åï¼Œæ‰§è¡Œæ„å»ºå‘½ä»¤ï¼Œç»“æœï¼š

![entry target](./imgs/11-4.webp)

å¯ä»¥çœ‹åˆ°å·¦è¾¹ `web` ç‰ˆæœ¬ä¸­éœ€è¦æ³¨å…¥ä½¿ç”¨ JSONP å¼‚æ­¥åŠ è½½ JS æ–‡ä»¶çš„è¿è¡Œæ—¶ä»£ç ï¼›è€Œå³è¾¹ `node` ç‰ˆæœ¬åˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ Node ç¯å¢ƒä¸‹çš„ `require` å®ç°å¼‚æ­¥åŠ è½½ï¼Œå› æ­¤ä¸éœ€è¦æ³¨å…¥ç›¸å…³è¿è¡Œæ—¶ã€‚

- [entry target github online](https://github1s.com/Tecvan-fe/webpack-book-samples/blob/main/target-node-web/webpack.config.js)



### ä½¿ç”¨ `mode` çŸ­è¯­

Webpack [å†…ç½®](https://github.com/webpack/webpack/blob/main/lib/config/defaults.js) äº†è®¸å¤šæ„å»ºä¼˜åŒ–ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ [mode](https://webpack.js.org/configuration/mode/) é…ç½®é¡¹åˆ‡æ¢é»˜è®¤ä¼˜åŒ–è§„åˆ™ï¼Œæ”¯æŒå¦‚ä¸‹å€¼ï¼š

- `production`ï¼šé»˜è®¤å€¼ï¼Œç”Ÿäº§æ¨¡å¼ï¼Œä½¿ç”¨è¯¥å€¼æ—¶ Webpack ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å¼€å¯ä¸€ç³»åˆ—ä¼˜åŒ–æªæ–½ï¼šThree-Shakingã€Terser å‹ç¼©ä»£ç ã€SplitChunk æèµ·å…¬å…±ä»£ç ï¼Œé€šå¸¸ç”¨äºç”Ÿäº§ç¯å¢ƒæ„å»ºï¼›
- `development`ï¼šå¼€å‘æ¨¡å¼ï¼Œä½¿ç”¨è¯¥å€¼æ—¶ Webpack ä¼šä¿ç•™æ›´è¯­ä¹‰åŒ–çš„ Module ä¸ Chunk åç§°ï¼Œæ›´æœ‰åŠ©äºè°ƒè¯•ï¼Œé€šå¸¸ç”¨äºå¼€å‘ç¯å¢ƒæ„å»ºï¼›
- `none`ï¼šå…³é—­æ‰€æœ‰å†…ç½®ä¼˜åŒ–è§„åˆ™ã€‚

`mode` è§„åˆ™æ¯”è¾ƒç®€å•ï¼Œä¸€èˆ¬åœ¨å¼€å‘æ¨¡å¼ä½¿ç”¨ `mode = 'development'`ï¼Œç”Ÿäº§æ¨¡å¼ä½¿ç”¨ `mode = 'production'` å³å¯ã€‚



## æ€»ç»“

è‡³æ­¤ï¼Œå…³äº Webpack é…ç½®è§„åˆ™çš„é‡è¦çŸ¥è¯†ç‚¹å°±è¡¥å……å®Œæ¯•äº†ï¼Œæˆ‘ä»¬ä¸»è¦éœ€è¦ç†è§£ï¼š

- Webpack é…ç½®æ–‡ä»¶æ”¯æŒå¯¼å‡ºå¯¹è±¡ã€æ•°ç»„ã€å‡½æ•°ä¸‰ç§å½¢æ€ï¼Œå…¶ä¸­å¯¹è±¡å½¢å¼æœ€ä¸ºå¸¸ç”¨ï¼Œè¶³å¤Ÿåº”å¯¹å¤šæ•°ä¸šåŠ¡é¡¹ç›®åœºæ™¯ï¼›æ•°ç»„å½¢å¼é€‚ç”¨äºéœ€è¦ä¸ºåŒä¸€ä»½ä»£ç åŒæ—¶æ„å»ºå¤šç§äº§ç‰©çš„åœºæ™¯ï¼Œå¦‚ NPM Libraryï¼›å‡½æ•°å½¢æ€é€‚ç”¨äºéœ€è¦åŠ¨æ€ç”Ÿæˆé…ç½®è§„åˆ™çš„åœºæ™¯ï¼›
- ä¸ºæ–¹ä¾¿ç®¡ç†é…ç½®é€»è¾‘ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å¼•å…¥ä¸€äº›ç¯å¢ƒæ²»ç†ç­–ç•¥ï¼Œç›®å‰ä¸šç•Œæ¯”è¾ƒå¸¸ç”¨å•ç‹¬é…ç½®æ–‡ä»¶ç®¡ç†å•ä¸ªæ„å»ºç¯å¢ƒï¼›
- `entry` é…ç½®é¡¹æ”¯æŒå­—ç¬¦ä¸²ã€å¯¹è±¡ã€å‡½æ•°ã€æ•°ç»„ç­‰æ–¹å¼ï¼Œå…¶ä¸­å¯¹è±¡å½¢å¼ä¸‹çš„ `dependOn/runtime` è§„åˆ™æ¯”è¾ƒå¤æ‚ï¼Œå»ºè®®æ·±å…¥å­¦ä¹ ï¼›
- `output` ç”¨äºå£°æ˜æ„å»ºäº§ç‰©çš„è¾“å‡ºè§„åˆ™ï¼›
- `target` ç”¨äºè®¾ç½®æ„å»ºç›®æ ‡ï¼Œä¸åŒç›®æ ‡ä¼šå¯¼è‡´äº§ç‰©å†…å®¹æœ‰è½»å¾®å·®å¼‚ï¼Œæ”¯æŒ Nodeã€Webã€Electronã€WebWorker ç­‰åœºæ™¯ï¼›
- `mode` æ„å»ºæ¨¡å¼ï¼Œæ”¯æŒ `development/production/none` ä¸‰ç§å€¼ã€‚

ç»“åˆå‰é¢è‹¥å¹²åº”ç”¨ä»‹ç»çš„ç« èŠ‚ï¼Œç›¸ä¿¡å·²ç»å¸®ä½ æ­å»ºèµ·ä¸€å¥—ä½“ç³»åŒ–çš„åº”ç”¨æ–¹æ³•è®ºï¼Œå·²ç»è¶³ä»¥åº”ä»˜å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ã€‚åç»­ç« èŠ‚æˆ‘ä»¬å°†è½¬å…¥æ›´é«˜é˜¶çš„å†…å®¹ï¼ŒåŒ…æ‹¬ï¼šå¦‚ä½•å¼€å‘ Loaderã€Pluginï¼›å¦‚ä½•ä¼˜åŒ–æ„å»ºä¸åº”ç”¨æ€§èƒ½ï¼›Webpack æ„å»ºåŸç†ç­‰ã€‚



## æ€è€ƒé¢˜

å‡è®¾åœ¨é…ç½®æ–‡ä»¶ä¸­éœ€è¦é€šè¿‡è¿œç¨‹æ¥å£åŠ¨æ€è·å–é…ç½®ç‰‡æ®µï¼Œå¦‚ä½•å®ç°æ¯”è¾ƒä¼˜é›…ï¼Ÿè¯·è¯•è¯•ã€‚



::: details chatgptå›ç­”

å¯ä»¥é€šè¿‡ä½¿ç”¨ `webpack-merge` å’Œ `axios` åº“æ¥å®ç°ä¼˜é›…åœ°åŠ¨æ€è·å–é…ç½®ç‰‡æ®µã€‚

é¦–å…ˆï¼Œå®‰è£… `webpack-merge` å’Œ `axios` åº“ï¼š

```js
pnpm i webpack-merge axios -D
```

ç„¶åï¼Œåœ¨ webpack é…ç½®æ–‡ä»¶ä¸­å¼•å…¥è¿™ä¸¤ä¸ªåº“ï¼š

```js
const merge = require('webpack-merge');
const axios = require('axios');
```

æ¥ä¸‹æ¥ï¼Œåœ¨éœ€è¦åŠ¨æ€è·å–é…ç½®ç‰‡æ®µçš„åœ°æ–¹ï¼Œä½¿ç”¨ `axios` å‘é€è¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚æˆåŠŸåå°†è¿”å›çš„æ•°æ®ä¸åŸæœ‰çš„é…ç½®åˆå¹¶ï¼Œæœ€ç»ˆè¿”å›æ–°çš„é…ç½®ã€‚ä¾‹å¦‚ï¼š

```js
module.exports = async () => {
  // å…ˆè·å–åŸæœ‰çš„é…ç½®
  const baseConfig = {
    entry: 'index.js',
    output: {
      filename: 'bundle.js'
    },
    // ...
  };

  // å‘é€è¯·æ±‚è·å–é…ç½®ç‰‡æ®µ
  const { data } = await axios.get('http://example.com/config-fragment.js');

  // åˆå¹¶åŸæœ‰çš„é…ç½®å’Œæ–°çš„é…ç½®ç‰‡æ®µ
  const mergedConfig = merge(baseConfig, data);

  return mergedConfig;
};
```

æœ€åï¼Œè®°å¾—åœ¨é…ç½®æ–‡ä»¶ä¸­å¯¼å‡ºä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œä»¥ä¾¿èƒ½å¤ŸåŠ¨æ€è·å–é…ç½®ç‰‡æ®µã€‚

:::



2023å¹´04æœˆ11æ—¥17:58:45

