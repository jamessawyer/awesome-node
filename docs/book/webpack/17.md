---
title: ä»£ç å‹ç¼©
---

**ä»£ç å‹ç¼©** æ˜¯æŒ‡åœ¨ä¸æ”¹å˜ä»£ç åŠŸèƒ½çš„å‰æä¸‹ï¼Œä»å£°æ˜å¼ï¼ˆHTMLã€CSSï¼‰æˆ–å‘½ä»¤å¼ï¼ˆJavaScriptï¼‰è¯­è¨€ä¸­åˆ é™¤æ‰€æœ‰ä¸å¿…è¦çš„å­—ç¬¦ï¼ˆå¤‡æ³¨ã€å˜é‡åå‹ç¼©ã€é€»è¾‘è¯­å¥åˆå¹¶ç­‰ï¼‰ï¼Œå‡å°‘ä»£ç ä½“ç§¯çš„è¿‡ç¨‹ï¼Œè¿™åœ¨ Web åœºæ™¯ä¸­èƒ½å¤Ÿæœ‰æ•ˆå‡å°‘æµè§ˆå™¨ä»æœåŠ¡å™¨è·å–ä»£ç èµ„æºæ‰€éœ€è¦æ¶ˆè€—çš„ä¼ è¾“é‡ï¼Œé™ä½ç½‘ç»œé€šè®¯è€—æ—¶ï¼Œæå‡é¡µé¢å¯åŠ¨é€Ÿåº¦ï¼Œæ˜¯ä¸€ç§éå¸¸åŸºç¡€ä¸”æ€§ä»·æ¯”ç‰¹åˆ«é«˜çš„åº”ç”¨æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆã€‚

åœ¨ Webpack ç”Ÿæ€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©å„ç§æ’ä»¶è½»æ¾å®ç°åº”ç”¨ä»£ç å‹ç¼©ï¼Œæœ¬æ–‡å°†ä»ä»£ç å‹ç¼©çš„åŸºæœ¬åŸç†å¼€å§‹è®²èµ·ï¼Œä¹‹åä»‹ç»è‹¥å¹²é€‚ç”¨äº JavaScriptã€CSSã€HTML çš„ä»£ç å‹ç¼©å·¥å…·ã€‚



## ä»£ç å‹ç¼©åŸç†

â€œä»£ç å‹ç¼©â€æœ€å…³é”®çš„é—®é¢˜æ˜¯ï¼šå¦‚ä½•ç”¨â€œ**æ›´ç²¾ç®€**â€çš„ä»£ç è¡¨è¾¾â€œ**åŒä¸€å¥—**â€ç¨‹åºé€»è¾‘ï¼Ÿè¿™å¹¶ä¸æ˜¯ä»€ä¹ˆé»‘é­”æ³•ï¼Œåº•å±‚é€»è¾‘ç®€å•çš„ç”šè‡³æœ‰ç‚¹ç²—æš´ï¼Œæ‹†å¼€æ¥çœ‹ï¼š

â€œ**æ›´ç²¾ç®€**â€æ„å‘³ç€å¯ä»¥é€‚å½“ â€”â€” ç”šè‡³å®Œå…¨ç‰ºç‰²å¯è¯»æ€§ã€è¯­ä¹‰ã€ä¼˜é›…åº¦è€ŒåŠ›æ±‚ç”¨æœ€å°‘å­—ç¬¦æ•°çš„æ–¹å¼ä¹¦å†™ä»£ç ã€‚æ¯”å¦‚è¯´ `const name = 'tecvan';`ï¼Œè¿™ä¸ªçœ‹èµ·æ¥éå¸¸ç®€å•çš„èµ‹å€¼è¯­å¥å°±æœ‰ä¸å°‘å¯ä»¥ç²¾ç®€çš„å­—ç¬¦ï¼š

- å˜é‡å `name` è¯­ä¹‰å¾ˆæ˜ç¡®ï¼Œå¤§å¤šæ•°â€œäººâ€çœ‹åˆ°å°±åŸºæœ¬æ˜ç™½æ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Œä½†è¿™å¯¹è®¡ç®—æœºå¹¶æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å°† `name` ä¿®æ”¹ä¸º `a` â€”â€” ä» 4 ä¸ªå­—ç¬¦ç²¾ç®€ä¸º 1 ä¸ªå­—ç¬¦ï¼Œä½†ä»ä¿æŒæ”¹åŠ¨å‰åé€»è¾‘ã€åŠŸèƒ½æ•ˆæœå®Œå…¨ä¸€è‡´ï¼›
- èµ‹å€¼æ“ä½œç¬¦ `=` å‰åéƒ½æœ‰ç©ºæ ¼ï¼Œè¿™ç§æ ¼å¼å¯¹é˜…è¯»ä»£ç çš„â€œäººâ€å¾ˆå‹å¥½ï¼Œè§†è§‰æ•ˆæœéå¸¸èˆ’é€‚ã€æ•´é½ï¼Œä½†å¯¹è®¡ç®—æœºè€Œè¨€åŒæ ·æ¯«æ— æ„ä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™å‰åä¸¤ä¸ªç©ºæ ¼åˆ æ‰ â€”â€” ç²¾ç®€äº†ä¸¤ä¸ªå­—ç¬¦ï¼›
- è™½ç„¶ `const` ä¸ `let` å…³é”®è¯çš„åŠŸèƒ½ä¸åŒï¼Œä½†ç‰¹å®šæƒ…å†µä¸‹æˆ‘ä»¬åŒæ ·èƒ½ç‰ºç‰²ä¸€éƒ¨åˆ†åŠŸèƒ½æ€§ï¼Œç”¨ `let` æ›¿æ¢ `const`ï¼Œä» 5 ä¸ªå­—ç¬¦ç²¾ç®€ä¸º 1 ä¸ªå­—ç¬¦ã€‚

ç»è¿‡ä¸Šé¢ä¸‰ä¸ªæ­¥éª¤ä¹‹åï¼Œä»£ç ä» `const name = 'tecvan';` â€”â€” 22 ä¸ªå­—ç¬¦ï¼Œç²¾ç®€ä¸º `let a='tecvan';` â€”â€” 18 ä¸ªå­—ç¬¦ï¼Œå¾€å¤§äº†è¯´æ˜¯èŠ‚çœäº† **18%** çš„ä»£ç ä½“ç§¯ã€‚å…¶å®ƒè¯­è¨€çš„ä»£ç å‹ç¼©è§„åˆ™ä¹ŸåŸºæœ¬éƒ½æ˜¯æŒ‰ç…§ä¸Šé¢è¿™ç§å¥—è·¯å®ç°çš„ã€‚

å…¶æ¬¡ï¼Œâ€œ**åŒä¸€å¥—**â€æ„å‘³ç€ä¿®æ”¹å‰åå¿…é¡»ä¿æŒä¸€è‡´çš„ä»£ç é€»è¾‘ã€æ‰§è¡Œæµç¨‹ã€åŠŸèƒ½æ•ˆæœç­‰ï¼Œä¾‹å¦‚ï¼š

```js
const a = 1;
const b = 2;
const c = a + b;
```

ä»£ç ä¸­ï¼Œ`a/b` éƒ½æ˜¯å­—é¢é‡å¸¸é‡ï¼Œé‚£ä¹ˆæ•´æ®µä»£ç å®Œå…¨å¯ä»¥ç²¾ç®€ä¸º `const c = 3` ï¼Œçœç•¥æ‰ `a/b` å˜é‡çš„å£°æ˜è¯­å¥ï¼Œå‰åè¿˜èƒ½ä¿æŒåŠŸèƒ½å®Œå…¨ä¸€è‡´ã€‚

ä¸ºäº†åº”å¯¹è¿™ä¸¤ä¸ªæŒ‘æˆ˜ï¼Œå¾ˆè‡ªç„¶çš„æˆ‘ä»¬å¯ä»¥å…ˆå°†å­—ç¬¦ä¸²å½¢æ€çš„ä»£ç è½¬æ¢ä¸ºç»“æ„åŒ–ã€å®¹æ˜“åˆ†æå¤„ç†çš„ `AST`ï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰å½¢æ€ï¼Œä¹‹ååœ¨ AST ä¸Šåº”ç”¨ä¸Šé¢çš„è§„åˆ™åšå„ç§è¯­æ³•ã€è¯­ä¹‰ã€é€»è¾‘æ¨ç†ä¸ç®€åŒ–æ›¿æ¢ï¼Œæœ€åæŒ‰ç²¾ç®€è¿‡çš„ AST ç”Ÿæˆç»“æœä»£ç ã€‚

![AST](./imgs/17-1.webp)

ç¤¾åŒºæ›¾ç»å‡ºç°è¿‡éå¸¸éå¸¸å¤š JavaScriptã€HTMLã€CSS ä»£ç å‹ç¼©å·¥å…·ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯æŒ‰ç…§ä¸Šé¢è¿™ç§å¥—è·¯å®ç°çš„ï¼ŒåŒ…æ‹¬ï¼š[Terser](https://github.com/terser/terser)ã€[ESBuild](https://esbuild.github.io/)ã€[CSS-Nano](https://cssnano.co/)ã€[babel-minify](https://github.com/babel/minify)ã€[htmlMinifierTerser](https://github.com/terser/html-minifier-terser) ç­‰ï¼Œå¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Webpack ä¸­è½»æ¾æ¥å…¥è¿™äº›å·¥å…·ï¼Œå®ç°ä»£ç å‹ç¼©ã€‚



## å‹ç¼©JS - TerserWebpackPlugin

[Terser](https://github.com/terser/terser) æ˜¯å½“ä¸‹ [æœ€ä¸ºæµè¡Œ](https://npmtrends.com/babel-minify-vs-terser-vs-uglify-js) çš„ ES6 ä»£ç å‹ç¼©å·¥å…·ä¹‹ä¸€ï¼Œæ”¯æŒ [Dead-Code Eliminate](https://en.wikipedia.org/wiki/Dead-code_elimination)ã€åˆ é™¤æ³¨é‡Šã€åˆ é™¤ç©ºæ ¼ã€ä»£ç åˆå¹¶ã€å˜é‡åç®€åŒ–ç­‰ç­‰[ä¸€ç³»åˆ—](https://github.com/terser/terser#compress-options)ä»£ç å‹ç¼©åŠŸèƒ½ã€‚Terser çš„å‰èº«æ˜¯å¤§åé¼é¼çš„ [UglifyJS](https://github.com/mishoo/UglifyJS)ï¼Œå®ƒåœ¨ UglifyJS åŸºç¡€ä¸Šå¢åŠ äº† ES6 è¯­æ³•æ”¯æŒï¼Œå¹¶é‡æ„ä»£ç è§£æã€å‹ç¼©ç®—æ³•ï¼Œä½¿å¾—æ‰§è¡Œæ•ˆç‡ä¸å‹ç¼©ç‡éƒ½æœ‰è¾ƒå¤§æå‡ï¼š(æ•°æ®æ¥æºï¼šhttps://github.com/babel/minify)

![JSå‹ç¼©å·¥å…·Benchmark](./imgs/17-2.webp)

Webpack5.0 åé»˜è®¤ä½¿ç”¨ Terser ä½œä¸º JavaScript ä»£ç å‹ç¼©å™¨ï¼Œç®€å•ç”¨æ³•åªéœ€é€šè¿‡ `optimization.minimize` é…ç½®é¡¹å¼€å¯å‹ç¼©åŠŸèƒ½å³å¯ï¼š

```js
module.exports = {
  //...
  optimization: {
    minimize: true
  }
};
```

::: tip

ä½¿ç”¨ `mode = 'production'` å¯åŠ¨ç”Ÿäº§æ¨¡å¼æ„å»ºæ—¶ï¼Œé»˜è®¤ä¹Ÿä¼šå¼€å¯ Terser å‹ç¼©ã€‚

:::

Terser æ”¯æŒè®¸å¤šå‹ç¼©[é…ç½®](https://github.com/terser/terser#compress-options)ï¼š

- `dead_code`ï¼šæ˜¯å¦åˆ é™¤ä¸å¯è§¦è¾¾çš„ä»£ç  â€”â€” ä¹Ÿå°±æ˜¯æ‰€è°“çš„æ­»ä»£ç ï¼›
- `booleans_as_integers`ï¼šæ˜¯å¦å°† Boolean å€¼å­—é¢é‡è½¬æ¢ä¸º 0ã€1ï¼›
- `join_vars`ï¼šæ˜¯å¦åˆå¹¶è¿ç»­çš„å˜é‡å£°æ˜ï¼Œå¦‚ `var a = 1; var b = 2;` åˆå¹¶ä¸º `var a=1,b=2;`ï¼›
- ç­‰ç­‰ã€‚

å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨é»˜è®¤ Terser é…ç½®å³å¯ï¼Œå¿…è¦æ—¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»º [terser-webpack-plugin](https://github.com/webpack-contrib/terser-webpack-plugin) å®ä¾‹å¹¶ä¼ å…¥å‹ç¼©é…ç½®å®ç°æ›´ç²¾ç»†çš„å‹ç¼©åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š

::: code-group

```js [webpack.config.js]
const TerserPlguin = require('terser-webpack-plugin')

module.exports = {
  // ...
  optimization: {
    minimize: true,
    minimizer: [
      new TerserPlugin({
        terserOptions: {
          compress: {
            reduce_vars: true,
            pure_funcs: ['console.log']
          }
        }
      })
    ]
  }
}
```

:::



::: tip

ç¤ºä¾‹ä¸­çš„ `minimize` ç”¨äºæ§åˆ¶æ˜¯å¦å¼€å¯å‹ç¼©ï¼Œåªæœ‰ `minimize = true'` æ—¶æ‰ä¼šè°ƒç”¨ `minimizer` å£°æ˜çš„å‹ç¼©å™¨æ•°ç»„ï¼ˆæ²¡é”™ï¼Œè¿™æ˜¯æ•°ç»„å½¢å¼ï¼‰æ‰§è¡Œå‹ç¼©æ“ä½œã€‚

å¦å¤–ï¼ŒWebpack4 é»˜è®¤ä½¿ç”¨ [uglifyjs-webpack-plugin](https://www.npmjs.com/package/uglifyjs-webpack-plugin) å‹ç¼©ä»£ç ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `minimizer` æ•°ç»„æ›¿æ¢ä¸º Terser æ’ä»¶ã€‚

:::

terser-webpack-pluginæ˜¯ä¸€ä¸ªé¢‡ä¸ºå¤æ‚çš„ Webpack æ’ä»¶ï¼Œæä¾›ä¸‹è¿° [é…ç½®é¡¹](https://www.npmjs.com/package/terser-webpack-plugin#options)ï¼š

- `test`ï¼šåªæœ‰å‘½ä¸­è¯¥é…ç½®çš„äº§ç‰©è·¯å¾„æ‰ä¼šæ‰§è¡Œå‹ç¼©ï¼ŒåŠŸèƒ½ä¸ [module.rules.test](https://webpack.js.org/configuration/module/#ruletest) ç›¸ä¼¼ï¼›
- `include`ï¼šåœ¨è¯¥èŒƒå›´å†…çš„äº§ç‰©æ‰ä¼šæ‰§è¡Œå‹ç¼©ï¼ŒåŠŸèƒ½ä¸ [module.rules.include](https://webpack.js.org/configuration/module/#ruleinclude) ç›¸ä¼¼ï¼›
- `exclude`ï¼šä¸ `include` ç›¸åï¼Œä¸åœ¨è¯¥èŒƒå›´å†…çš„äº§ç‰©æ‰ä¼šæ‰§è¡Œå‹ç¼©ï¼ŒåŠŸèƒ½ä¸ [module.rules.exclude](https://webpack.js.org/configuration/module/#ruleexclude) ç›¸ä¼¼ï¼›
- `parallel`ï¼šæ˜¯å¦å¯åŠ¨å¹¶è¡Œå‹ç¼©ï¼Œé»˜è®¤å€¼ä¸º `true`ï¼Œæ­¤æ—¶ä¼šæŒ‰ `os.cpus().length - 1` å¯åŠ¨è‹¥å¹²è¿›ç¨‹å¹¶å‘æ‰§è¡Œï¼›
- `minify`ï¼šç”¨äºé…ç½®å‹ç¼©å™¨ï¼Œæ”¯æŒä¼ å…¥è‡ªå®šä¹‰å‹ç¼©å‡½æ•°ï¼Œä¹Ÿæ”¯æŒ `swc/esbuild/uglifyjs` ç­‰å€¼ï¼Œä¸‹é¢æˆ‘ä»¬å†å±•å¼€è®²è§£ï¼›
- `terserOptions`ï¼šä¼ å…¥ `minify` â€”â€” â€œå‹ç¼©å™¨â€å‡½æ•°çš„é…ç½®å‚æ•°ï¼›
- `extractComments`ï¼šæ˜¯å¦å°†ä»£ç ä¸­çš„å¤‡æ³¨æŠ½å–ä¸ºå•ç‹¬æ–‡ä»¶ï¼Œå¯é…åˆç‰¹æ®Šå¤‡æ³¨å¦‚ `@license` ä½¿ç”¨ã€‚

ğŸŒ°è¿™äº›é…ç½®é¡¹æ€»ç»“ä¸‹æ¥æœ‰ä¸¤ä¸ªå€¼å¾—å…³æ³¨çš„é€»è¾‘ï¼š

1. å¯ä»¥é€šè¿‡ `test/include/exclude` è¿‡æ»¤æ’ä»¶çš„æ‰§è¡ŒèŒƒå›´ï¼Œè¿™ä¸ªåŠŸèƒ½é…åˆ `minimizer` çš„æ•°ç»„ç‰¹æ€§ï¼Œå¯ä»¥å®ç°é’ˆå¯¹ä¸åŒäº§ç‰©æ‰§è¡Œä¸åŒçš„å‹ç¼©ç­–ç•¥ï¼Œä¾‹å¦‚ï¼š

   ```js
   const TerserPlugin = require("terser-webpack-plugin");
   
   module.exports = {
     entry: { foo: "./src/foo.js", bar: "./src/bar.js" },
     output: {
       filename: "[name].js",
       // ...
     },
     optimization: {
       minimize: true,
       minimizer: [
         new TerserPlugin({
           test: /foo\.js$/i,
           extractComments: "all",
         }),
         new TerserPlugin({
           test: /bar\.js/,
           extractComments: false,
         }),
       ],
     },
   };
   ```

   [ç¤ºä¾‹](https://github.com/Tecvan-fe/webpack-book-samples/blob/main/minify-terser/webpack.config.js)ä¸­ï¼Œé’ˆå¯¹ `foo.js` äº§ç‰©æ–‡ä»¶ä¼šæ‰§è¡Œ `exctractComments` é€»è¾‘ï¼Œå°†å¤‡æ³¨ä¿¡æ¯æŠ½å–ä¸ºå•ç‹¬æ–‡ä»¶ï¼›è€Œé’ˆå¯¹ `bar.js`ï¼Œç”±äº `extractComments = false`ï¼Œä¸å•ç‹¬æŠ½å–å¤‡æ³¨å†…å®¹ã€‚

2. ğŸš€terser-webpack-pluginæ’ä»¶å¹¶ä¸åªæ˜¯ Terser çš„ç®€å•åŒ…è£…ï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ªä»£ç å‹ç¼©åŠŸèƒ½éª¨æ¶ï¼Œåº•å±‚è¿˜æ”¯æŒä½¿ç”¨ SWCã€UglifyJSã€ESBuild ä½œä¸ºå‹ç¼©å™¨ï¼Œä½¿ç”¨æ—¶åªéœ€è¦é€šè¿‡ `minify` å‚æ•°åˆ‡æ¢å³å¯ï¼Œä¾‹å¦‚ï¼š

   ```js {6}
   module.exports = {
     optimization: {
       minimize: true,
       minimizer: [
         new TerserPlugin({
           minify: TerserPlugin.swcMinify,
           // `terserOptions` å°†è¢«ä¼ é€’åˆ° `swc` (`@swc/core`) å·¥å…·
           // å…·ä½“é…ç½®å‚æ•°å¯å‚è€ƒï¼šhttps://swc.rs/docs/config-js-minify
           terserOptions: {},
         }),
       ],
     },
   };
   ```

- [ğŸŒ° minify-terser - @github](https://github.com/Tecvan-fe/webpack-book-samples/blob/main/minify-terser/webpack.config.js)

TerserPlugin å†…ç½®å¦‚ä¸‹å‹ç¼©å™¨ï¼š

- `TerserPlugin.terserMinify`ï¼šä¾èµ–äº `terser` åº“ï¼›
- `TerserPlugin.uglifyJsMinify`ï¼šä¾èµ–äº `uglify-js`ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£… `yarn add -D uglify-js`ï¼›
- `TerserPlugin.swcMinify`ï¼šä¾èµ–äº `@swc/core`ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£… `yarn add -D` `@swc/core`ï¼›âœ…
- `TerserPlugin.esbuildMinify`ï¼šä¾èµ–äº `esbuild`ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£… `yarn add -D esbuild`ã€‚

å¦å¤–ï¼Œ`terserOptions` é…ç½®ä¹Ÿä¸ä»…ä»…ä¸“ä¾› `terser` ä½¿ç”¨ï¼Œè€Œæ˜¯ä¼šé€ä¼ ç»™å…·ä½“çš„ `minifier`ï¼Œå› æ­¤ä½¿ç”¨ä¸åŒå‹ç¼©å™¨æ—¶æ”¯æŒçš„é…ç½®é€‰é¡¹ä¹Ÿä¼šä¸åŒã€‚



ä¸åŒå‹ç¼©å™¨åŠŸèƒ½ã€æ€§èƒ½å·®å¼‚è¾ƒå¤§ï¼Œæ®æˆ‘äº†è§£ï¼ŒESBuild ä¸ SWC è¿™ä¸¤ä¸ªåŸºäº Go ä¸ Rust ç¼–å†™çš„å‹ç¼©å™¨æ€§èƒ½æ›´ä½³ï¼Œä¸”æ•ˆæœå·²ç»åŸºæœ¬è¶‹äºç¨³å®šï¼Œè™½ç„¶åŠŸèƒ½è¿˜æ¯”ä¸ä¸Š Terserï¼Œä½†æŸäº›æ„å»ºæ€§èƒ½æ•æ„Ÿåœºæ™¯ä¸‹ä¸å¤±ä¸ºä¸€ç§ä¸é”™çš„é€‰æ‹©ã€‚



## å‹ç¼©CSS - CssMinimizerWebpackPlugin

CSS æ˜¯ä¸€ç§çµæ´»å¤šå˜å¾—ç•¥æ˜¾å¤æ‚çš„å£°æ˜å¼è¯­è¨€ï¼ŒåŒæ ·çš„æ ·å¼æ•ˆæœå¯ä»¥è¢«è¡¨è¾¾æˆéå¸¸å¤šæ ·çš„ä»£ç è¯­å¥ï¼Œä¾‹å¦‚ä¸€ä¸ªéå¸¸å…¸å‹çš„æ¡ˆä¾‹ï¼š`margin: 10px`ï¼Œå¯ä»¥è¢«å†™æˆï¼š

```css
margin: 10px 10px;

# æˆ–è€…
margin-left: 10px; margin-right: 10px;...
```

è¿™äº›ä¸åŒçš„è¡¨è¿°æ–¹å¼æœ€ç»ˆå®ç°çš„æ ·å¼æ•ˆæœç›¸åŒï¼Œé‚£ç†æ‰€å½“ç„¶çš„å¯ä»¥ç”¨æœ€ç²¾ç®€çš„æ–¹å¼å‹ç¼©ä»£ç ã€‚æ‰©å±•å¼€æ¥ï¼š

```css
h1::before,
h1:before {
  /* ä¸‹é¢å„ç§å¤‡æ³¨éƒ½å¯ä»¥åˆ é™¤ */
  /* margin å€¼å¯ç®€å†™ */
  margin: 10px 20px 10px 20px; 
  /* é¢œè‰²å€¼ä¹Ÿå¯ä»¥ç®€å†™ */
  color: #ff0000; 
  /* åˆ é™¤é‡å¤å±æ€§ */
  font-weight: 400;
  font-weight: 400; 
  /* position å­—é¢é‡å€¼å¯ç®€åŒ–ä¸ºç™¾åˆ†æ¯” */
  background-position: bottom right;
  /* æ¸å˜å‚æ•°å¯ç²¾ç®€ */
  background: linear-gradient(
    to bottom,
    #ffe500 0%,
    #ffe500 50%,
    #121 50%,
    #121 100%
  ); 
  /* åˆå§‹å€¼ä¹Ÿå¯ç²¾ç®€ */
  min-width: initial;
}
```

ä¸Šè¿°ä»£ç å°±æœ‰ä¸å°‘åœ°æ–¹å¯ä»¥ç²¾ç®€ä¼˜åŒ–ï¼Œä½¿ç”¨ [cssnano](https://cssnano.co/) å‹ç¼©åå¤§è‡´ä¸Šå¯ç®€åŒ–ä¸ºï¼š

```css
h1:before {
  margin: 10px 20px;
  color: red;
  font-weight: 400;
  background-position: 100% 100%;
  quotes: "Â«" "Â»";
  background: linear-gradient(180deg, #ffe500, #ffe500 50%, #121 0, #121);
  min-width: 0;
}
```

ä»åŸæ¥çš„ 422 ä¸ªå­—ç¬¦ç²¾ç®€ä¸º 212 ä¸ªå­—ç¬¦ï¼Œæ¥è¿‘ 50%ï¼Œæˆ‘ä»¬æ—¥å¸¸ç¼–å†™çš„ CSS è¯­å¥ä¹Ÿè·Ÿä¸Šè¿°ç¤ºä¾‹ç±»ä¼¼ï¼Œé€šå¸¸éƒ½ä¼šæœ‰ä¸å°‘å¯ä»¥ä¼˜åŒ–å‹ç¼©çš„åœ°æ–¹ã€‚

ğŸŒ°Webpack ç¤¾åŒºä¸­æœ‰ä¸å°‘å®ç° CSS ä»£ç å‹ç¼©çš„æ’ä»¶ï¼Œä¾‹å¦‚ï¼š[css-minimizer-webpack-plugin](https://webpack.js.org/plugins/css-minimizer-webpack-plugin/)ï¼Œç”¨æ³•ï¼š

1. å®‰è£…ä¾èµ–ï¼š

   ```bash
   pnpm i -D css-minimizer-webpack-plugin
   ```

2. ä¿®æ”¹ Webpack é…ç½®ï¼š

   ```js {11,18,25}
   const CssMinimizerPlugin = require('css-minimizer-webpack-plugin')
   const MiniCssExtractPlugin = require('mini-css-extract-plugin')
   
   module.exports = {
     //...
     module: {
       rules: [
         {
           test: /.css$/,
           // æ³¨æ„ï¼Œè¿™é‡Œç”¨çš„æ˜¯ `MiniCssExtractPlugin.loader` è€Œä¸æ˜¯ `style-loader`
           use: [MiniCssExtractPlugin.loader, "css-loader"],
         },
       ],
     },
     optimization: {
       minimize: true,
       minimizer: [
         // Webpack5 ä¹‹åï¼Œçº¦å®šä½¿ç”¨ `'...'` å­—é¢é‡ä¿ç•™é»˜è®¤ `minimizer` é…ç½®
         "...",
         new CssMinimizerPlugin(),
       ],
     },
     // éœ€è¦ä½¿ç”¨ `mini-css-extract-plugin` å°† CSS ä»£ç æŠ½å–ä¸ºå•ç‹¬æ–‡ä»¶
     // æ‰èƒ½å‘½ä¸­ `css-minimizer-webpack-plugin` é»˜è®¤çš„ `test` è§„åˆ™
     plugins: [new MiniCssExtractPlugin()],
   }
   ```

è¿™é‡Œçš„é…ç½®é€»è¾‘ï¼Œä¸€æ˜¯ä½¿ç”¨ `mini-css-extract-plugin` å°† CSS ä»£ç æŠ½å–ä¸ºå•ç‹¬çš„ CSS äº§ç‰©æ–‡ä»¶ï¼Œè¿™æ ·æ‰èƒ½å‘½ä¸­ `css-minimizer-webpack-plugin` é»˜è®¤çš„ `test` é€»è¾‘ï¼›äºŒæ˜¯ä½¿ç”¨ `css-minimizer-webpack-plugin` å‹ç¼© CSS ä»£ç ã€‚æ•ˆæœï¼š

![css minimizer](./imgs/17-3.webp)

- [ğŸŒ° minify-css - @github](https://github.com/Tecvan-fe/webpack-book-samples/blob/main/minify-css/webpack.config.js)

ä¸ `terser-webpack-plugin` ç±»ä¼¼ï¼Œ`css-minimizer-webpack-plugin` ä¹Ÿæ”¯æŒ `testã€includeã€excludeã€minifyã€minimizerOptions` é…ç½®ï¼Œå…¶ä¸­ `minify` æ”¯æŒï¼š

- CssMinimizerPlugin.cssnanoMinifyï¼šé»˜è®¤å€¼ï¼Œä½¿ç”¨ [cssnano](https://cssnano.co/) å‹ç¼©ä»£ç ï¼Œä¸éœ€è¦é¢å¤–å®‰è£…ä¾èµ–ï¼›
- CssMinimizerPlugin.cssoMinifyï¼šä½¿ç”¨ [csso](https://github.com/css/csso) å‹ç¼©ä»£ç ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ä¾èµ– `yarn add -D csso`ï¼›
- CssMinimizerPlugin.cleanCssMinifyï¼šä½¿ç”¨ [clean-css](https://github.com/clean-css/clean-css) å‹ç¼©ä»£ç ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ä¾èµ– `yarn add -D clean-css`ï¼›
- CssMinimizerPlugin.esbuildMinifyï¼šä½¿ç”¨ [ESBuild](https://esbuild.github.io/) å‹ç¼©ä»£ç ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ä¾èµ– `yarn add -D esbuild`ï¼›
- CssMinimizerPlugin.parcelCssMinifyï¼šä½¿ç”¨ [parcel-css](https://github.com/parcel-bundler/parcel-css) å‹ç¼©ä»£ç ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ä¾èµ– `yarn add -D` `@parcel/css`ã€‚

::: tip

åŒæ ·çš„ï¼Œ`minimizerOptions` ä¹Ÿæ˜¯ç›´æ¥é€ä¼ ç»™å…·ä½“ `minify`ï¼Œå…·ä½“é…ç½®é€‰é¡¹å¯å‚è€ƒ [å®˜æ–¹æ–‡æ¡£](https://webpack.js.org/plugins/css-minimizer-webpack-plugin/#minimizeroptions)ã€‚

:::

å…¶ä¸­ `parcel-css` ä¸ ESBuild å‹ç¼©æ€§èƒ½ç›¸å¯¹è¾ƒä½³ï¼š

![csså‹ç¼©å™¨benchmark](./imgs/17-4.webp)

ä½†ä¸¤è€…åŠŸèƒ½ä¸å…¼å®¹æ€§ç¨å¼±ï¼Œå¤šæ•°æƒ…å†µä¸‹æ¨èä½¿ç”¨ `cssnano`ã€‚



## å‹ç¼©HTML - HtmlMinifierTerser

ç°ä»£ Web åº”ç”¨å¤§å¤šä¼šé€‰æ‹©ä½¿ç”¨ Reactã€Vue ç­‰ MVVM æ¡†æ¶ï¼Œè¿™è¡ç”Ÿå‡ºæ¥çš„ä¸€ä¸ªå‰¯ä½œç”¨æ˜¯åŸç”Ÿ HTML çš„å¼€å‘éœ€æ±‚è¶Šæ¥è¶Šå°‘ï¼ŒHTML ä»£ç å æ¯”è¶Šæ¥è¶Šä½ï¼Œæ‰€ä»¥å¤§å¤šæ•°ç°ä»£ Web é¡¹ç›®ä¸­å…¶å®å¹¶ä¸éœ€è¦è€ƒè™‘ä¸º HTML é…ç½®ä»£ç å‹ç¼©å·¥ä½œæµã€‚ä¸è¿‡å‡¡äº‹éƒ½æœ‰ä¾‹å¤–ï¼ŒæŸäº›åœºæ™¯å¦‚ SSG æˆ–å®˜ç½‘ä¸€ç±»åé™æ€çš„åº”ç”¨ä¸­å°±å­˜åœ¨å¤§é‡å¯è¢«ä¼˜åŒ–çš„ HTML ä»£ç ï¼Œä¸ºæ­¤ç¤¾åŒºä¹Ÿæä¾›äº†ä¸€äº›ç›¸å…³çš„å·¥ç¨‹åŒ–å·¥å…·ï¼Œä¾‹å¦‚ `html-minifier-terser`ã€‚

[html-minifier-terser](https://github.com/terser/html-minifier-terser) æ˜¯ä¸€ä¸ªåŸºäº JavaScript å®ç°çš„ã€é«˜åº¦å¯é…ç½®çš„ HTML å‹ç¼©å™¨ï¼Œæ”¯æŒä¸€ç³»åˆ— [å‹ç¼©ç‰¹æ€§](https://github.com/terser/html-minifier-terser#options-quick-reference) å¦‚ï¼š

1. `collapseWhitespace`ï¼šåˆ é™¤èŠ‚ç‚¹é—´çš„ç©ºå­—ç¬¦ä¸²ï¼Œå¦‚ï¼š

   ```jsx
   <!-- åŸå§‹ä»£ç ï¼š -->
   <div> <p>    foo </p>    </div>
   
   <!-- ç»è¿‡å‹ç¼©çš„ä»£ç ï¼š -->
   <div><p>foo</p></div>
   ```

2. `removeComments`ï¼šåˆ é™¤å¤‡æ³¨ï¼Œå¦‚ï¼š

   ```jsx
   <!-- åŸå§‹ä»£ç ï¼š -->
   <!-- some comment --><p>blah</p>
   
   <!-- ç»è¿‡å‹ç¼©çš„ä»£ç ï¼š -->
   <p>blah</p>
   ```

3. `collapseBooleanAttributes`ï¼šåˆ é™¤ HTML çš„ [Boolean å±æ€§å€¼](https://www.w3.org/TR/html4/intro/sgmltut.html#h-3.3.4.2)ï¼Œå¦‚ï¼š

   ```jsx
   <!-- åŸå§‹ä»£ç ï¼š -->
   <input value="foo" readonly="readonly">
   
   <!-- ç»è¿‡å‹ç¼©çš„ä»£ç ï¼š -->
   <input value="foo" readonly>
   ```

4. ç­‰ç­‰

ğŸŒ°æˆ‘ä»¬å¯ä»¥å€ŸåŠ© [html-minimizer-webpack-plugin](https://webpack.js.org/plugins/html-minimizer-webpack-plugin/) æ’ä»¶æ¥å…¥ `html-minifier-terser` å‹ç¼©å™¨ï¼Œæ­¥éª¤ï¼š

1. å®‰è£…ä¾èµ–ï¼š

   ```bash
   pnpm i -D html-minimizer-webpack-plugin
   ```

2. ä¿®æ”¹ Webpack é…ç½®ï¼Œå¦‚ï¼š

   ```js
   const HtmlWebpackPlugin = require("html-webpack-plugin");
   const HtmlMinimizerPlugin = require("html-minimizer-webpack-plugin");
   
   module.exports = {
     // ...
     optimization: {
       minimize: true,
       minimizer: [
         // Webpack5 ä¹‹åï¼Œçº¦å®šä½¿ç”¨ `'...'` å­—é¢é‡ä¿ç•™é»˜è®¤ `minimizer` é…ç½®
         "...",
         new HtmlMinimizerPlugin({
           minimizerOptions: {
             // æŠ˜å  Boolean å‹å±æ€§
             collapseBooleanAttributes: true,
             // ä½¿ç”¨ç²¾ç®€ `doctype` å®šä¹‰
             useShortDoctype: true,
             // ...
           },
         }),
       ],
     },
     plugins: [
       // ç®€å•èµ·è§ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `html-webpack-plugin` è‡ªåŠ¨ç”Ÿæˆ HTML æ¼”ç¤ºæ–‡ä»¶
       new HtmlWebpackPlugin({
         templateContent: `<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
       <html>
         <head>
           <meta charset="UTF-8" />
           <title>webpack App</title>
         </head>
         <body>
           <input readonly="readonly"/>
           <!-- comments -->
           <script src="http://www.lilnong.top/urlTrans?group=juejin&url=index_bundle.js"></script>
         </body>
       </html>`,
       }),
     ],
   };
   ```

- [ğŸŒ° minify-html - @github](https://github.com/Tecvan-fe/webpack-book-samples/blob/main/minify-html/webpack.config.js)

è¿™æ®µé…ç½®çš„å…³é”®é€»è¾‘ï¼Œä¸€æ˜¯é€šè¿‡ `html-webpack-plugin` ç”Ÿæˆ HTML æ–‡ä»¶ï¼Œè¿™é‡Œä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ç‰¹æ„åœ¨ HTML æ¨¡æ¿ `templateContent` ä¸­æ’å…¥ä¸€äº›å¯ä»¥è¢«å‹ç¼©çš„ä»£ç ï¼›äºŒæ˜¯é€šè¿‡ `html-minimizer-plugin` å‹ç¼© HTML ä»£ç ï¼Œæ•ˆæœï¼š

![minify html](./imgs/17-5.webp)

ä¸Šå›¾ä¸­å·¦è¾¹æ˜¯æ­£å¸¸æ„å»ºç»“æœï¼Œå³å›¾æ˜¯ç»è¿‡ `html-minimizer-plugin` å‹ç¼©åçš„æ„å»ºç»“æœï¼Œå¯ä»¥çœ‹åˆ°å¦‚ `doctype` æ ‡ç­¾è¢«åˆ æ‰è‹¥å¹²ä¸é‡è¦çš„å£°æ˜ï¼Œæ–‡æ¡£ä¸­çš„å¤‡æ³¨ä¹Ÿè¢«åˆ é™¤ï¼Œç­‰ç­‰ã€‚

ä¸ `terser-webpack-plugin` ç±»ä¼¼ï¼Œ[html-minimizer-webpack-plugin](https://webpack.js.org/plugins/html-minimizer-webpack-plugin/) ä¹Ÿæ”¯æŒ `includeã€testã€minimizerOptions` ç­‰ç­‰ä¸€ç³»åˆ—é…ç½®ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚

æ³¨æ„ï¼Œ[html-minifier-terser](https://github.com/terser/html-minifier-terser) æä¾›çš„é»˜è®¤é…ç½®æœ‰ç‚¹è¿‡äºä¿å®ˆï¼Œä¾‹å¦‚ `removeComments` â€”â€” ç”¨äºç§»é™¤ä»£ç å¤‡æ³¨çš„é…ç½®ï¼Œæˆ–è€… `useShortDoctype` ç”¨äºç®€åŒ– `<doctype>` æ ‡ç­¾çš„é…ç½®ï¼Œé»˜è®¤ç«Ÿç„¶éƒ½æ˜¯ falseï¼Œè¿™æ”¾åœ¨å½“ä¸‹æµè§ˆå™¨åŠŸèƒ½å·²ç»éå¸¸å¼ºåŠ²ï¼Œå…¼å®¹æ€§é—®é¢˜å·²ç»è¢«å¤§å¤§æŠ¹å¹³çš„èƒŒæ™¯ä¸‹ï¼Œæœ‰ç‚¹å¤§å¯ä¸å¿…äº†ã€‚å› æ­¤ï¼Œå»ºè®®ä½ ä½¿ç”¨æ—¶å…ˆåˆ° [å®˜ç½‘](https://github.com/terser/html-minifier-terser#options-quick-reference) ä»”ç»†äº†è§£å„é¡¹é…ç½®ï¼Œå°½å¯èƒ½å¼€å¯æ›´å¤šå‹ç¼©åŠŸèƒ½ã€‚



## æ€»ç»“

ç»¼ä¸Šï¼Œä»£ç å‹ç¼©çš„é‡ç‚¹å°±åœ¨äºâ€œä¿æŒåŠŸèƒ½æ€§â€çš„å‰æä¸‹å°½å¯èƒ½â€œåˆ é™¤â€ä¸å¿…è¦çš„å­—ç¬¦ï¼ŒåŸç†è™½ä¸å¤æ‚ä½†å¿…é¡»å¯¹è¯­è¨€ç‰¹æ€§æœ‰æ¯”è¾ƒæ·±çš„ç†è§£æ‰èƒ½å®ç°ï¼Œæ‰€å¹¸ç¤¾åŒºå·²ç»æä¾›äº†å„ç§å„æ ·çš„å‹ç¼©å·¥å…·ï¼Œæˆ‘ä»¬åªéœ€è¦ç®€å•é…ç½®å°±èƒ½è½»æ¾æ¥å…¥ã€‚

åœ¨ Webpack ä¸­éœ€è¦ä½¿ç”¨ `optimization.minimizer` æ•°ç»„æ¥å…¥ä»£ç å‹ç¼©æ’ä»¶ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ’ä»¶æœ‰ï¼š

- `terser-webpack-plugin`ï¼šç”¨äºå‹ç¼© ES6 ä»£ç çš„æ’ä»¶ï¼›
- `css-minimizer-webpack-plugin`ï¼šç”¨äºå‹ç¼© CSS ä»£ç çš„æ’ä»¶ï¼›
- `html-minifier-terser`ï¼šç”¨äºå‹ç¼© HTML ä»£ç çš„æ’ä»¶

è¿™äº›æ’ä»¶ç”¨æ³•éå¸¸ç›¸ä¼¼ï¼Œéƒ½æ”¯æŒ `include/test/exclude` é…ç½®é¡¹ï¼Œç”¨äºæ§åˆ¶å‹ç¼©åŠŸèƒ½çš„åº”ç”¨èŒƒå›´ï¼›ä¹Ÿéƒ½æ”¯æŒ `minify` é…ç½®é¡¹ï¼Œç”¨äºåˆ‡æ¢å‹ç¼©å™¨ï¼Œå€ŸåŠ©è¿™ä¸ªé…ç½®æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ€§èƒ½æ›´ä½³çš„å·¥å…·ï¼Œå¦‚ ESBuild æ‰§è¡Œå‹ç¼©ã€‚



## æ€è€ƒé¢˜

ä»£ç å‹ç¼©ä¸ä»£ç æ··æ·†æ˜¯ä»€ä¹ˆå…³ç³»ï¼Œåˆ†åˆ«ç”¨äºè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿå‹ç¼©èƒ½ä»£ç æ··æ·†æ•ˆæœå—ï¼Ÿ



::: details chatgptå›ç­”

1ï¸âƒ£ **ä»£ç å‹ç¼©ä¸ä»£ç æ··æ·†æ˜¯ä»€ä¹ˆå…³ç³»ï¼Œåˆ†åˆ«ç”¨äºè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ**

ä»£ç å‹ç¼©å’Œä»£ç æ··æ·†æœ‰äº›å…³è”ï¼Œä½†å®ƒä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µã€‚ä»£ç å‹ç¼©é€šå¸¸æ˜¯æŒ‡ä½¿ç”¨å·¥å…·å°†æºä»£ç æ–‡ä»¶å‹ç¼©æˆæœ€å°çš„æ–‡ä»¶å¤§å°ï¼Œä»¥ä¾¿äºç½‘ç»œä¼ è¾“å’ŒåŠ å¿«é¡µé¢åŠ è½½é€Ÿåº¦ã€‚åŒæ—¶ï¼Œå‹ç¼©ä»£ç è¿˜å¯ä»¥å‡å°‘å¸¦å®½ä½¿ç”¨å’Œå­˜å‚¨æˆæœ¬ã€‚

ä»£ç æ··æ·†åˆ™æ˜¯æŒ‡ä½¿ç”¨å·¥å…·å°†æºä»£ç è¿›è¡ŒåŠ å¯†å’Œè½¬æ¢ï¼Œä½¿å…¶éš¾ä»¥é˜…è¯»å’Œç†è§£ï¼Œä»è€Œå¢åŠ äº†åç¼–è¯‘å’Œç›—å–ä»£ç çš„éš¾åº¦ã€‚æ··æ·†ä»£ç è¿˜å¯ä»¥å¢åŠ ä»£ç çš„å®‰å…¨æ€§å’Œä¿æŠ¤çŸ¥è¯†äº§æƒã€‚å› æ­¤ï¼Œä»£ç æ··æ·†æ›´ä¾§é‡äºä»£ç çš„å®‰å…¨æ€§å’Œä¿å¯†æ€§ï¼Œè€Œä»£ç å‹ç¼©åˆ™æ›´ä¾§é‡äºå‡å°‘æ–‡ä»¶å¤§å°å’Œæé«˜é¡µé¢æ€§èƒ½ã€‚



2ï¸âƒ£ **å‹ç¼©èƒ½ä»£ç æ··æ·†æ•ˆæœå—ï¼Ÿ**

ä»£ç å‹ç¼©å¯ä»¥å‡å°æ–‡ä»¶å¤§å°ï¼Œä½†å®ƒå¹¶ä¸èƒ½èµ·åˆ°æ··æ·†ä»£ç çš„ä½œç”¨ã€‚è™½ç„¶å‹ç¼©åçš„ä»£ç å¯èƒ½éš¾ä»¥é˜…è¯»ï¼Œä½†æ˜¯å®ƒçš„é€»è¾‘å’Œç»“æ„å¹¶æœªè¢«æ”¹å˜ï¼Œä»£ç å‹ç¼©ä¹Ÿä¸ä¼šåœ¨ä»£ç ä¸­æ·»åŠ é¢å¤–çš„æ··æ·†å†…å®¹ã€‚

ç›¸åï¼Œä»£ç æ··æ·†æ˜¯ä¸€ç§ç‰¹å®šçš„ä¼˜åŒ–æ–¹æ³•ï¼Œå®ƒé€šè¿‡æ”¹å˜å’Œéšè—ä»£ç çš„ç»“æ„å’Œé€»è¾‘ï¼Œä½¿ä»£ç éš¾ä»¥è¢«ç ´è§£å’Œç›—ç”¨ï¼Œä»è€Œå¢å¼ºä»£ç çš„å®‰å…¨æ€§ã€‚è™½ç„¶ä»£ç æ··æ·†æœ‰æ—¶ä¹Ÿä¼šé™ä½ä»£ç çš„å¯è¯»æ€§ï¼Œä½†å®ƒå…·æœ‰å‰æ‰€æœªæœ‰çš„ç¨‹åº¦çš„å®‰å…¨æ€§ï¼Œå¯ä»¥åœ¨ä¿éšœä»£ç è¿è¡Œæ•ˆç‡çš„åŒæ—¶æé«˜ä»£ç çš„å®‰å…¨æ€§ã€‚

å› æ­¤ï¼Œè™½ç„¶ä»£ç å‹ç¼©å’Œä»£ç æ··æ·†éƒ½æ˜¯ä¼˜åŒ–ä»£ç çš„æ–¹æ³•ï¼Œä½†å®ƒä»¬çš„ç›®çš„å’Œå®ç°æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œä»»ä½•ä¸€ç§æ–¹æ³•å•ç‹¬ä½¿ç”¨éƒ½ä¸èƒ½å–ä»£å¦ä¸€ç§æ–¹æ³•çš„ä½œç”¨ã€‚

:::



2023å¹´04æœˆ19æ—¥14:54:14
