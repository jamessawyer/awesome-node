---
title: æ€§èƒ½åˆ†æå·¥å…·
---

Webpack æœ€å¤§çš„ä¼˜åŠ¿åœ¨äºå®ƒçš„åŠŸèƒ½éå¸¸å¼ºå¤§ã€å…¨é¢ï¼ŒåŠ ä¹‹ç¹è£æ´»è·ƒçš„ç»„ä»¶ç”Ÿæ€ï¼Œå·²ç»è¶³å¤Ÿåº”å¯¹å‡ ä¹æ‰€æœ‰ Web æ„å»ºéœ€æ±‚ï¼ŒåŒ…æ‹¬ï¼šSPAã€MPAã€SSRã€æ¡Œé¢åº”ç”¨ã€Node ç¨‹åºã€WebAssemblyã€PWAã€å¾®å‰ç«¯ç­‰ç­‰ï¼Œæ‰€ä»¥å³ä½¿åœ¨è¿‘å‡ å¹´å·¥ç¨‹åŒ–é¢†åŸŸå¼‚å†›çªèµ·ã€ç™¾èŠ±é½æ”¾çš„èƒŒæ™¯ä¸‹ï¼ŒWebpack ä¹Ÿä¾ç„¶èƒ½ä¿æŒè€å¤§å“¥çš„ä½ç½®ã€‚

ä½†è½¯ä»¶ä¸–ç•Œæ²¡æœ‰é“¶å¼¹ï¼Webpack åœ¨å¤§å‹é¡¹ç›®ä¸­é€šå¸¸æ€§èƒ½è¡¨ç°ä¸ä½³ï¼Œè¿™ä¸€æ–¹é¢æ˜¯å› ä¸º JavaScript è¯­è¨€çš„å•çº¿ç¨‹æ¶æ„å†³å®šäº† Webpack çš„è¿ç®—æ•ˆç‡å°±ä¸å¯èƒ½å¾ˆé«˜ï¼›å¦ä¸€æ–¹é¢åˆ™æ˜¯å› ä¸ºåœ¨å¤§å‹é¡¹ç›®ä¸­ï¼ŒWebpack é€šå¸¸éœ€è¦å€ŸåŠ©è®¸å¤šç»„ä»¶ï¼ˆæ’ä»¶ã€Loaderï¼‰å®Œæˆå¤§é‡çš„æ–‡ä»¶è¯»å†™ã€ä»£ç ç¼–è¯‘æ“ä½œã€‚

å¹¸è¿çš„æ˜¯ï¼Œç«™åœ¨å¼€å‘è€…è§†è§’ï¼Œæˆ‘ä»¬æœ‰è®¸å¤šè¡Œä¹‹æœ‰æ•ˆçš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³•ï¼ŒåŒ…æ‹¬ç¼“å­˜ã€å¹¶å‘ã€ä¼˜åŒ–æ–‡ä»¶å¤„ç†æ­¥éª¤ç­‰ï¼Œä½†åœ¨ç€æ‰‹ä¼˜åŒ–ä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆç®€å•äº†è§£ä¸€ä¸‹ Webpack æ‰“åŒ…çš„æ ¸å¿ƒæµç¨‹ï¼›äº†è§£å“ªäº›æ­¥éª¤æ¯”è¾ƒè€—æ—¶ï¼Œå¯èƒ½ä¼šé€ æˆæ€§èƒ½å¡ç‚¹ï¼›ä»¥åŠï¼Œå¦‚ä½•å€ŸåŠ©ä¸€äº›å¯è§†åŒ–å·¥å…·åˆ†æ Webpack çš„ç¼–è¯‘æ€§èƒ½ã€‚



## æ ¸å¿ƒæµç¨‹

ğŸ“šWebpack æœ€æœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œä¸€æ˜¯ä½¿ç”¨é€‚å½“ Loader å°†ä»»æ„ç±»å‹æ–‡ä»¶è½¬è¯‘ä¸º JavaScript ä»£ç ï¼Œä¾‹å¦‚å°† CSS ä»£ç è½¬è¯‘ä¸º JS å­—ç¬¦ä¸²ï¼Œå°†å¤šåª’ä½“æ–‡ä»¶è½¬è¯‘ä¸º Base64 ä»£ç ç­‰ï¼›äºŒæ˜¯å°†è¿™äº›ç»è¿‡ Loader å¤„ç†çš„æ–‡ä»¶èµ„æºåˆå¹¶ã€æ‰“åŒ…æˆå‘ä¸‹å…¼å®¹çš„äº§ç‰©æ–‡ä»¶ã€‚

ä¸ºäº†å®ç°è¿™äº›åŠŸèƒ½ï¼ŒWebpack åº•å±‚çš„å·¥ä½œæµç¨‹å¤§è‡´å¯ä»¥æ€»ç»“ä¸ºè¿™ä¹ˆå‡ ä¸ªé˜¶æ®µï¼š

1. åˆå§‹åŒ–é˜¶æ®µï¼š
   - **åˆå§‹åŒ–å‚æ•°**ï¼šä»é…ç½®æ–‡ä»¶ã€ é…ç½®å¯¹è±¡ã€Shell å‚æ•°ä¸­è¯»å–ï¼Œä¸é»˜è®¤é…ç½®ç»“åˆå¾—å‡ºæœ€ç»ˆçš„å‚æ•°ï¼›
   - **åˆ›å»ºç¼–è¯‘å™¨å¯¹è±¡**ï¼šç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„å‚æ•°åˆ›å»º `Compiler` å¯¹è±¡ï¼›
   - **åˆå§‹åŒ–ç¼–è¯‘ç¯å¢ƒ**ï¼šåŒ…æ‹¬æ³¨å…¥å†…ç½®æ’ä»¶ã€æ³¨å†Œå„ç§æ¨¡å—å·¥å‚ã€åˆå§‹åŒ– RuleSet é›†åˆã€åŠ è½½é…ç½®çš„æ’ä»¶ç­‰ï¼›
   - **å¼€å§‹ç¼–è¯‘**ï¼šæ‰§è¡Œ `compiler` å¯¹è±¡çš„ `run` æ–¹æ³•ï¼Œåˆ›å»º `Compilation` å¯¹è±¡ï¼›
   - **ç¡®å®šå…¥å£**ï¼šæ ¹æ®é…ç½®ä¸­çš„ `entry` æ‰¾å‡ºæ‰€æœ‰çš„å…¥å£æ–‡ä»¶ï¼Œè°ƒç”¨ `compilation.addEntry` å°†å…¥å£æ–‡ä»¶è½¬æ¢ä¸º `dependence` å¯¹è±¡ã€‚
2. æ„å»ºé˜¶æ®µï¼š
   - **ç¼–è¯‘æ¨¡å—(`make`)**ï¼šä» `entry` æ–‡ä»¶å¼€å§‹ï¼Œè°ƒç”¨ `loader` å°†æ¨¡å—è½¬è¯‘ä¸ºæ ‡å‡† JS å†…å®¹ï¼Œè°ƒç”¨ JS è§£æå™¨å°†å†…å®¹è½¬æ¢ä¸º AST å¯¹è±¡ï¼Œä»ä¸­æ‰¾å‡ºè¯¥æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œå† **é€’å½’** å¤„ç†è¿™äº›ä¾èµ–æ¨¡å—ï¼Œç›´åˆ°æ‰€æœ‰å…¥å£ä¾èµ–çš„æ–‡ä»¶éƒ½ç»è¿‡äº†æœ¬æ­¥éª¤çš„å¤„ç†ï¼›
   - **å®Œæˆæ¨¡å—ç¼–è¯‘**ï¼šä¸Šä¸€æ­¥é€’å½’å¤„ç†æ‰€æœ‰èƒ½è§¦è¾¾åˆ°çš„æ¨¡å—åï¼Œå¾—åˆ°äº†æ¯ä¸ªæ¨¡å—è¢«ç¿»è¯‘åçš„å†…å®¹ä»¥åŠå®ƒä»¬ä¹‹é—´çš„`ä¾èµ–å…³ç³»å›¾`ã€‚
3. å°è£…é˜¶æ®µï¼š
   - **åˆå¹¶(`seal`)**ï¼šæ ¹æ®å…¥å£å’Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œç»„è£…æˆä¸€ä¸ªä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„ `Chunk`ï¼›
   - **ä¼˜åŒ–(optimization)**ï¼šå¯¹ä¸Šè¿° `Chunk` æ–½åŠ ä¸€ç³»åˆ—ä¼˜åŒ–æ“ä½œï¼ŒåŒ…æ‹¬ï¼štree-shakingã€terserã€scope-hoistingã€å‹ç¼©ã€Code Split ç­‰ï¼›
   - **å†™å…¥æ–‡ä»¶ç³»ç»Ÿ(emitAssets)**ï¼šåœ¨ç¡®å®šå¥½è¾“å‡ºå†…å®¹åï¼Œæ ¹æ®é…ç½®ç¡®å®šè¾“å‡ºçš„è·¯å¾„å’Œæ–‡ä»¶åï¼ŒæŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æœ‰ä¸å°‘å¯èƒ½é€ æˆæ€§èƒ½é—®é¢˜çš„åœ°æ–¹ï¼š

1. æ„å»ºé˜¶æ®µï¼š
   - é¦–å…ˆéœ€è¦å°†æ–‡ä»¶çš„ç›¸å¯¹å¼•ç”¨è·¯å¾„è½¬æ¢ä¸ºç»å¯¹è·¯å¾„ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½æ¶‰åŠå¤šæ¬¡ IO æ“ä½œï¼Œæ‰§è¡Œæ•ˆç‡å–å†³äº **æ–‡ä»¶å±‚æ¬¡æ·±åº¦**ï¼›
   - æ‰¾åˆ°å…·ä½“æ–‡ä»¶åï¼Œéœ€è¦è¯»å…¥æ–‡ä»¶å†…å®¹å¹¶è°ƒç”¨ [loader-runner](https://github1s.com/webpack/loader-runner/blob/HEAD/lib/LoaderRunner.js) éå† Loader æ•°ç»„å®Œæˆå†…å®¹è½¬è¯‘ï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦æ‰§è¡Œè¾ƒå¯†é›†çš„ CPU æ“ä½œï¼Œæ‰§è¡Œæ•ˆç‡å–å†³äº **Loader çš„æ•°é‡ä¸å¤æ‚åº¦**ï¼›
   - éœ€è¦å°†æ¨¡å—å†…å®¹è§£æä¸º AST ç»“æ„ï¼Œå¹¶éå† AST æ‰¾å‡ºæ¨¡å—çš„ä¾èµ–èµ„æºï¼Œè¿™ä¸ªè¿‡ç¨‹åŒæ ·éœ€è¦è¾ƒå¯†é›†çš„ CPU æ“ä½œï¼Œæ‰§è¡Œæ•ˆç‡å–å†³äº **ä»£ç å¤æ‚åº¦**ï¼›
   - é€’å½’å¤„ç†ä¾èµ–èµ„æºï¼Œæ‰§è¡Œæ•ˆç‡å–å†³äº **æ¨¡å—æ•°é‡**ã€‚
2. å°è£…é˜¶æ®µï¼š
   - æ ¹æ® `splitChunks` é…ç½®ã€`entry` é…ç½®ã€åŠ¨æ€æ¨¡å—å¼•ç”¨è¯­å¥ç­‰ï¼Œç¡®å®šæ¨¡å—ä¸ Chunk çš„æ˜ å°„å…³ç³»ï¼Œå…¶ä¸­ `splitChunks` ç›¸å…³çš„åˆ†åŒ…ç®—æ³•éå¸¸å¤æ‚ï¼Œæ¶‰åŠå¤§é‡ CPU è®¡ç®—ï¼›
   - æ ¹æ® `optimization` é…ç½®æ‰§è¡Œä¸€ç³»åˆ—äº§ç‰©ä¼˜åŒ–æ“ä½œï¼Œç‰¹åˆ«æ˜¯ [Terser](https://github.com/webpack-contrib/terser-webpack-plugin) æ’ä»¶éœ€è¦æ‰§è¡Œå¤§é‡ AST ç›¸å…³çš„è¿ç®—ï¼Œæ‰§è¡Œæ•ˆç‡å–å†³äº **äº§ç‰©ä»£ç é‡**ï¼›

å¯ä»¥çœ‹å‡ºï¼ŒWebpack éœ€è¦æ‰§è¡Œéå¸¸å¯†é›†çš„ IO ä¸ CPU æ“ä½œï¼Œè®¡ç®—æˆæœ¬é«˜ï¼Œå†åŠ ä¸Š Webpack ä»¥åŠå¤§å¤šæ•°ç»„ä»¶éƒ½ä½¿ç”¨ JavaScript ç¼–å†™ï¼Œæ— æ³•å……åˆ†åˆ©ç”¨å¤šæ ¸ CPU èƒ½åŠ›ï¼Œæ‰€ä»¥åœ¨ä¸­å¤§å‹é¡¹æ€§èƒ½é€šå¸¸è¡¨ç°è¾ƒå·®ã€‚

ä¸è¿‡ï¼Œè¿™äº›æ€§èƒ½é—®é¢˜æ˜¯å¯ä»¥è¢«ä¼˜åŒ–çš„ï¼



## æ€§èƒ½åˆ†æ

æœ‰è®¸å¤šè¢«åå¤å®è·µã€è¡Œä¹‹æœ‰æ•ˆçš„æ„å»ºæ€§èƒ½ä¼˜åŒ–æ‰‹æ®µï¼ŒåŒ…æ‹¬å¹¶è¡Œç¼–è¯‘ã€ç¼“å­˜ã€ç¼©å°èµ„æºæœç´¢èŒƒå›´ç­‰ç­‰ï¼Œä½†åœ¨ä»‹ç»è¿™äº›å…·ä½“çš„ä¼˜åŒ–æ–¹æ³•ä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆèŠèŠï¼šå¦‚ä½•æ”¶é›†ã€åˆ†æ Webpack æ‰“åŒ…è¿‡ç¨‹çš„æ€§èƒ½æ•°æ®ã€‚

æ”¶é›†æ•°æ®çš„æ–¹æ³•å¾ˆç®€å• â€”â€” Webpack å†…ç½®äº† [stats](https://webpack.docschina.org/api/stats/) æ¥å£ï¼Œä¸“é—¨ç”¨äºç»Ÿè®¡æ¨¡å—æ„å»ºè€—æ—¶ã€æ¨¡å—ä¾èµ–å…³ç³»ç­‰ä¿¡æ¯ï¼Œæ¨èç”¨æ³•ï¼š

1. æ·»åŠ  `profile = true` é…ç½®ï¼š

   ```js
   // webpack.config.js
   module.exports = {
     // ...
     profile: true
   }
   ```

2. è¿è¡Œç¼–è¯‘å‘½ä»¤ï¼Œå¹¶æ·»åŠ  `--json` å‚æ•°ï¼Œå‚æ•°å€¼ä¸ºæœ€ç»ˆç”Ÿæˆçš„ç»Ÿè®¡æ–‡ä»¶åï¼Œå¦‚ï¼š

   ```bash
   npx webpack --json=stats.json
   ```

ä¸Šè¿°å‘½ä»¤æ‰§è¡Œå®Œæ¯•åï¼Œä¼šåœ¨æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆ `stats.json` æ–‡ä»¶ï¼Œå†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š

::: tip

æˆ–è€…ç›´æ¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤

```bash
npx webpack profile --json=stats.json
```

:::

```json
{
  "version": "5.9.0", // ç”¨æ¥ç¼–è¯‘çš„ webpack ç‰ˆæœ¬
  "hash": "11593e3b3ac85436984a", // ç¼–è¯‘çš„ç‰¹å®šå“ˆå¸Œå€¼
  "time": 2469, // ç¼–è¯‘æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  "publicPath": "auto",
  "outputPath": "/", // webpack çš„è¾“å‡ºç›®å½•è·¯å¾„
  "assetsByChunkName": {
    // è¾“å‡ºèµ„æºå¯¹åº”çš„ Chunk åç§°
    "main": [
      "web.js?h=11593e3b3ac85436984a"
    ],
    "named-chunk": [
      "named-chunk.web.js"
    ],
    "other-chunk": [
      "other-chunk.js",
      "other-chunk.css"
    ]
  },
  "assets": [
    // asset objects åˆ—è¡¨
  ],
  "chunks": [
    // chunk objects åˆ—è¡¨
  ],
  "modules": [
    // module objects åˆ—è¡¨
  ],
  "entryPoints": {
    // entry objects åˆ—è¡¨
  },
  "errors": [
    // error objects åˆ—è¡¨
  ],
  "errorsCount": 0, // é”™è¯¯ä¸ªæ•°
  "warnings": [
    // warning objects åˆ—è¡¨
  ],
  "warningsCount": 0, // å‘Šè­¦ä¸ªæ•°
}
```

`stats` å¯¹è±¡æ”¶é›†äº† Webpack è¿è¡Œè¿‡ç¨‹ä¸­è®¸å¤šå€¼å¾—å…³æ³¨çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š

- `modules`ï¼šæœ¬æ¬¡æ‰“åŒ…å¤„ç†çš„æ‰€æœ‰æ¨¡å—åˆ—è¡¨ï¼Œå†…å®¹åŒ…å«æ¨¡å—çš„å¤§å°ã€æ‰€å± `chunk`ã€æ„å»ºåŸå› ã€ä¾èµ–æ¨¡å—ç­‰ï¼Œç‰¹åˆ«æ˜¯ `modules.profile` å±æ€§ï¼ŒåŒ…å«äº†æ„å»ºè¯¥æ¨¡å—æ—¶ï¼Œè§£æè·¯å¾„ã€ç¼–è¯‘ã€æ‰“åŒ…ã€å­æ¨¡å—æ‰“åŒ…ç­‰å„ä¸ªç¯èŠ‚æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œéå¸¸æœ‰ç”¨ï¼›
- `chunks`ï¼šæ„å»ºè¿‡ç¨‹ç”Ÿæˆçš„ `chunks` åˆ—è¡¨ï¼Œæ•°ç»„å†…å®¹åŒ…å« `chunk` åç§°ã€å¤§å°ã€åŒ…å«äº†å“ªäº›æ¨¡å—ç­‰ï¼›
- `assets`ï¼šç¼–è¯‘åæœ€ç»ˆè¾“å‡ºçš„äº§ç‰©åˆ—è¡¨ã€æ–‡ä»¶è·¯å¾„ã€æ–‡ä»¶å¤§å°ç­‰ï¼›
- `entrypoints`ï¼šentry åˆ—è¡¨ï¼ŒåŒ…æ‹¬åŠ¨æ€å¼•å…¥æ‰€ç”Ÿäº§çš„ entry é¡¹ä¹Ÿä¼šåŒ…å«åœ¨è¿™é‡Œé¢ï¼›
- `children`ï¼šå­ Compiler å¯¹è±¡çš„æ€§èƒ½æ•°æ®ï¼Œä¾‹å¦‚ `extract-css-chunk-plugin` æ’ä»¶å†…éƒ¨å°±ä¼šè°ƒç”¨ [compilation.createChildCompiler](https://github1s.com/faceyspacey/extract-css-chunks-webpack-plugin/blob/HEAD/src/loader.js#L82) å‡½æ•°åˆ›å»ºå‡ºå­ Compiler æ¥åš CSS æŠ½å–çš„å·¥ä½œã€‚

::: tip

ç”Ÿæˆçš„JSONæ–‡ä»¶å¯ä»¥ä½¿ç”¨ [jsoncrack](https://jsoncrack.com/editor) æŸ¥çœ‹

:::

ç¯‡å¹…æœ‰é™ï¼Œè¿™é‡Œä¸å±•å¼€ä»‹ç»æ¯ä¸ªèŠ‚ç‚¹çš„å…·ä½“å†…å®¹ï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥æŸ¥é˜… Webpack å®˜ç½‘çš„ [stats](https://webpack.docschina.org/api/stats/) ä»‹ç»æ–‡æ¡£ï¼Œæˆ–åˆ°å°å†Œä»£ç ä»“åº“æŸ¥çœ‹[ç¤ºä¾‹](https://github1s.com/Tecvan-fe/webpack-book-samples/blob/HEAD/stats-with-profile/stats.json)ã€‚

æˆ‘ä»¬å¯ä»¥ä»è¿™äº›æ•°æ®ä¸­åˆ†æå‡ºæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€ä½“ç§¯å æ¯”ã€ç¼–è¯‘æ„å»ºè€—æ—¶ç­‰ï¼ŒWebpack ç¤¾åŒºè¿˜æä¾›äº†è®¸å¤šä¼˜ç§€çš„åˆ†æå·¥å…·ï¼Œèƒ½å¤Ÿå°†è¿™äº›æ•°æ®è½¬æ¢å„ç§é£æ ¼çš„å¯è§†åŒ–å›¾è¡¨ï¼Œå¸®åŠ©æˆ‘ä»¬æ›´é«˜æ•ˆåœ°æ‰¾å‡ºæ€§èƒ½å¡ç‚¹ï¼ŒåŒ…æ‹¬ï¼š

- [Webpack Analysis](https://webpack.github.io/analyse/) ï¼šWebpack å®˜æ–¹æä¾›çš„ï¼ŒåŠŸèƒ½æ¯”è¾ƒå…¨é¢çš„ `stats` å¯è§†åŒ–å·¥å…·ï¼›
- [Statoscope](https://github.com/statoscope/statoscope)ï¼šä¸»è¦ä¾§é‡äºæ¨¡å—ä¸æ¨¡å—ã€æ¨¡å—ä¸ chunkã€chunk ä¸ chunk ç­‰ï¼Œå®ä½“ä¹‹é—´çš„å…³ç³»åˆ†æï¼›
- [Webpack Visualizer](https://chrisbateman.github.io/webpack-visualizer/)ï¼šä¸€ä¸ªç®€å•çš„æ¨¡å—ä½“ç§¯åˆ†æå·¥å…·ï¼ŒçœŸçš„å¾ˆç®€å•ï¼
- [Webpack Bundle Analyzer](https://www.npmjs.com/package/webpack-bundle-analyzer)ï¼šåº”è¯¥æ˜¯ä½¿ç”¨ç‡æœ€é«˜çš„æ€§èƒ½åˆ†æå·¥å…·ä¹‹ä¸€ï¼Œä¸»è¦å®ç°ä»¥ Tree Map æ–¹å¼å±•ç¤ºå„ä¸ªæ¨¡å—çš„ä½“ç§¯å æ¯”ï¼›âœ…
- [Webpack Dashboard](https://www.npmjs.com/package/webpack-dashboard)ï¼šèƒ½å¤Ÿåœ¨ç¼–è¯‘è¿‡ç¨‹å®æ—¶å±•ç¤ºç¼–è¯‘è¿›åº¦ã€æ¨¡å—åˆ†å¸ƒã€äº§ç‰©ä¿¡æ¯ç­‰ï¼›
- [Unused Webpack Plugin](https://www.npmjs.com/package/unused-webpack-plugin)ï¼šèƒ½å¤Ÿæ ¹æ® `stats` æ•°æ®åå‘æŸ¥æ‰¾é¡¹ç›®ä¸­æœªè¢«ä½¿ç”¨çš„æ–‡ä»¶ã€‚



## 1ï¸âƒ£ Webpack Analysis

[Webpack Analysis](https://webpack.github.io/analyse/) æ˜¯ webpack å®˜æ–¹æä¾›çš„å¯è§†åŒ–åˆ†æå·¥å…·ï¼Œç›¸æ¯”äºå…¶å®ƒå·¥å…·ï¼Œå®ƒæä¾›çš„è§†å›¾æ›´å…¨ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ï¼Œèƒ½å¤Ÿé€šè¿‡åˆ›å»ºä¾èµ–å…³ç³»å›¾å¯¹ä½ çš„åŒ…è¿›è¡Œæ›´å½»åº•çš„æ£€æŸ¥ã€‚

ä½¿ç”¨ä¸Šåªéœ€è¦å°†ä¸Šä¸€èŠ‚ `webpack --json=stats.json` å‘½ä»¤ç”Ÿæˆçš„ `stats.json` æ–‡ä»¶å¯¼å…¥é¡µé¢ï¼Œå°±å¯ä»¥çœ‹åˆ°ä¸€äº›å…³é”®ç»Ÿè®¡ä¿¡æ¯ï¼š

![webpack stats info](./imgs/12-1.webp)

ç‚¹å‡»é¡µé¢ä¸­çš„ `modules/chunks/assets` æŒ‰é’®ï¼Œé¡µé¢ä¼šæ¸²æŸ“å‡ºå¯¹åº”å®ä½“çš„ä¾èµ–å…³ç³»å›¾ï¼Œä¾‹å¦‚ï¼š

![webpack stats info - modules](./imgs/12-2.webp)

é™¤ `modules/chunks/assets` å¤–ï¼Œå³ä¸Šæ–¹èœå•æ  **Hints** è¿˜å¯ä»¥æŸ¥çœ‹æ„å»ºè¿‡ç¨‹å„é˜¶æ®µã€å„æ¨¡å—çš„å¤„ç†è€—æ—¶ï¼Œå¯ä»¥ç”¨äºå¯¹æ¯”åˆ†æå„ä¸ªé˜¶æ®µçš„æ€§èƒ½æƒ…å†µï¼š

![hints](./imgs/12-3.webp)

::: warning

ä¸è¿‡ï¼Œå®æµ‹å‘ç° **Hints** è¿˜ä¸æ”¯æŒ webpack 5 ç‰ˆæœ¬çš„ `stats` æ•°æ®ï¼Œç­‰å¾…å®˜æ–¹æ›´æ–°å§ã€‚

:::

[Webpack Analysis](https://webpack.github.io/analyse/) æä¾›äº†éå¸¸é½å…¨çš„åˆ†æè§†è§’ï¼Œä¿¡æ¯å‡ ä¹æ²¡æœ‰å¤±çœŸï¼Œä½†ä¸Šæ‰‹éš¾åº¦ç¨é«˜ï¼Œä¿¡æ¯å™ªéŸ³æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥ç¤¾åŒºè¿˜æä¾›äº†ä¸€ä¸ªç®€åŒ–ç‰ˆ [webpack-deps-tree](https://mshustov.github.io/webpack-deps-tree/static/)ï¼ŒåŠŸèƒ½ç›¸ä¼¼ä½†ç”¨æ³•æ›´ç®€å•ã€ä¿¡æ¯æ›´ç®€æ´ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®å®é™…éœ€è¦äº¤å‰ä½¿ç”¨ã€‚



## 2ï¸âƒ£ Statoscope

[Statoscope](https://github.com/statoscope/statoscope) ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å¯è§†åŒ–åˆ†æå·¥å…·ï¼Œä¸»è¦æä¾›å¦‚ä¸‹åŠŸèƒ½ï¼š

- å®Œæ•´çš„ä¾èµ–å…³ç³»è§†å›¾ï¼Œæ¶µç›– modules/chunks/assets/entrypoints/packages ç»´åº¦ï¼›
- entrypoints/chunks/packages/module ä½“ç§¯åˆ†æï¼›
- é‡å¤åŒ…æ£€æµ‹ï¼›
- å¤šä»½ `stats` æ•°æ®å¯¹æ¯”ï¼›
- ç­‰ç­‰ã€‚

æœ‰ä¸¤ç§ç”¨æ³•ï¼Œä¸€æ˜¯å°† `stats` æ•°æ®å¯¼å…¥åˆ° [Statoscope](https://github.com/statoscope/statoscope) åœ¨çº¿é¡µé¢ï¼›äºŒæ˜¯ä½¿ç”¨ `@statoscope/webpack-plugin` æ’ä»¶ï¼Œç”¨æ³•ï¼š

1. å®‰è£…ä¾èµ–

   ```bash
   pnpm i -D @statoscope/webpack-plugin
   ```

2. æ³¨å†Œæ’ä»¶ï¼š

   ```js
   const StatoscopeWebpackPlugin = require('@statoscope/webpack-plugin').default
   
   module.exports = {
     // ...
     plugins: [new StatoscopeWebpackPlugin()]
   }
   ```

ä¹‹åï¼Œè¿è¡Œ `npx webpack` å‘½ä»¤ï¼Œç¼–è¯‘ç»“æŸåé»˜è®¤æ‰“å¼€åˆ†æè§†å›¾ï¼š

![statoscope](./imgs/12-4.webp)

å¯ä»¥çœ‹åˆ°ï¼ŒStatoscope æä¾›äº†å¤šç§ç»´åº¦çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šChunk æ•°é‡ã€æ¨¡å—æ€»æ•°ã€é‡å¤æ¨¡å—æ ‘ã€ç¼–è¯‘è€—æ—¶ã€Initial Chunk ä½“ç§¯ç­‰ï¼›æ›´é‡è¦çš„æ˜¯ï¼ŒStatoscope è¿˜å±•ç¤ºäº†æ¨¡å—ä¸æ¨¡å—ã€Chunkã€Entry ç­‰ç»´åº¦çš„ä¾èµ–å…³ç³»ï¼š

![statoscope infos](./imgs/12-5.webp)

æˆ‘ä»¬å¯ä»¥æ®æ­¤æ¨æ–­å‡ºæ¨¡å—ä½“ç§¯ã€ä¸ºä½•éœ€è¦æ‰“åŒ…è¯¥æ¨¡å—ã€æœ‰å“ªäº›æ¨¡å—è¢«é‡å¤å¼•ç”¨ç­‰ä¿¡æ¯ã€‚



## 3ï¸âƒ£ Webpack Bundle Analyzer

[Webpack-bundle-analyzer](https://www.npmjs.com/package/webpack-bundle-analyzer) æ˜¯ä¸€ä¸ªéå¸¸æœ‰åçš„æ€§èƒ½åˆ†ææ’ä»¶ï¼Œåªéœ€è¦ä¸€äº›ç®€å•é…ç½®å°±å¯ä»¥åœ¨ Webpack æ„å»ºç»“æŸåç”Ÿæˆ Tree Map å½¢æ€çš„æ¨¡å—åˆ†å¸ƒç»Ÿè®¡å›¾ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å¯¹æ¯” Tree Map å†…å®¹æ¨æ–­å„æ¨¡å—çš„ä½“ç§¯å æ¯”ï¼Œæ˜¯å¦åŒ…å«é‡å¤æ¨¡å—ã€ä¸å¿…è¦çš„æ¨¡å—ç­‰ï¼Œç”¨æ³•ï¼š

1. å®‰è£…ä¾èµ–

   ```bash
   pnpm i -D webpack-bundle-analyzer
   ```

2. æ³¨å†Œæ’ä»¶ï¼š

   ```js
   const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin
   
   module.exports = {
     // ...
     plugins: [new BundleAnalyzerPlugin()]
   }
   ```

ç¼–è¯‘ç»“æŸåï¼Œé»˜è®¤è‡ªåŠ¨æ‰“å¼€æœ¬åœ°è§†å›¾é¡µé¢ï¼š

![webpack-bundle-analyzer](./imgs/12-6.webp)

ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ Webpack-bundle-analyzer å‘½ä»¤ç›´æ¥æ‰“å¼€ `stats` æ–‡ä»¶ï¼š

```bash
npx webpack-bundle-analyzer ./stats.json
```

åŸºäº Webpack Bundle Analyzer æä¾›çš„è§†å›¾ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå‡ºï¼š

- Bundle åŒ…æ‰€åŒ…å«çš„æ¨¡å—å†…å®¹ â€”â€” ä»è€Œæ¨æ–­å‡ºäº§ç‰©ä¸­æ˜¯å¦åŒ…å«é¢„æœŸä¹‹å¤–çš„æ¨¡å—ï¼›
- ç¡®å®šæ¨¡å—ä½“ç§¯å¤§å°ä¸å æ¯” â€”â€” ä»è€Œç¡®å®šæ˜¯å¦å­˜åœ¨ä¼˜åŒ–ç©ºé—´ï¼›
- äº†è§£ Bundle äº§ç‰©ä½“ç§¯ï¼Œä»¥åŠç»è¿‡å‹ç¼©åçš„ä½“ç§¯ã€‚

::: tip

 [webpack-bundle-size-analyzer](https://www.npmjs.com/package/webpack-bundle-size-analyzer)ã€[source-map-explorer](https://github.com/danvk/source-map-explorer ) ç­‰å·¥å…·ä¹Ÿå®ç°äº†ç±»ä¼¼åŠŸèƒ½ï¼Œä½†åˆ†åˆ«é€‚ç”¨äºä¸åŒåœºæ™¯ï¼Œå»ºè®®ä½ ä¹Ÿäº†è§£ä¸€ä¸‹ç›¸å…³ç”¨æ³•ï¼Œæ‹©ä¼˜é€‰ç”¨ã€‚

:::



## 4ï¸âƒ£ Webpack Visualizer

[Webpack Visualizer](https://chrisbateman.github.io/webpack-visualizer/) æ˜¯ä¸€ä¸ªåœ¨çº¿åˆ†æå·¥å…·ï¼Œå¯ç”¨äºæ£€æµ‹ã€å¯è§†åŒ– Webpack äº§ç‰©çš„æ„æˆæ¨¡å—ã€‚æœ‰ä¸¤ç§ç”¨æ³•ï¼Œä¸€æ˜¯å°† `stats.json` æ–‡ä»¶ä¸Šä¼ åˆ°åœ¨çº¿ [é¡µé¢](https://chrisbateman.github.io/webpack-visualizer/)ï¼›äºŒæ˜¯ä½¿ç”¨ `webpack-visualizer-plugin` ç”Ÿæˆç»Ÿè®¡é¡µé¢ï¼Œç”¨æ³•ï¼š

1. å®‰è£…ä¾èµ–

   ```bash
   # webpack-visualizer-plugin  ä¸æ”¯æŒ webpack5
   # webpack-visualizer-plugin2 æ”¯æŒ webpack5
   pnpm i -D webpack-visualizer-plugin2
   ```

2. æ³¨å†Œæ’ä»¶ï¼š

   ```js
   const VisualizerPlugin = require('webpack-visualizer-plugin2')
   
   module.exports = {
     // ...
     plugins: [
       new VisualizerPlugin({
         filename: './stats.html'
       })
     ]
   }
   ```

ä¸¤ç§æ–¹å¼æœ€ç»ˆéƒ½å¯ä»¥ç”Ÿæˆå¦‚ä¸‹è§†å›¾ï¼š

![webpack visualizer](./imgs/12-7.webp)

::: warning

å¾ˆé—æ†¾ï¼Œå®æµ‹å‘ç° [webpack-visualizer-plugin](https://github.com/chrisbateman/webpack-visualizer#plugin-usage) æ’ä»¶å¹´ä¹…å¤±ä¿®ï¼Œåªå…¼å®¹ webpack 1.x ï¼Œæ‰€ä»¥ç°åœ¨å‡ ä¹æ²¡æœ‰ä½¿ç”¨ä»·å€¼äº†ã€‚

:::

æ­¤å¤–ï¼Œåœ¨çº¿å·¥å…· [Webpack Chart](https://alexkuz.github.io/webpack-chart/) ä¹Ÿæä¾›äº†ç±»ä¼¼çš„åŠŸèƒ½ï¼ŒåŠŸèƒ½é‡åˆåº¦å¾ˆé«˜ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è®²äº†ï¼ˆæ›´æ¨èä½¿ç”¨è¿™ä¸ªåº“ï¼Œæ›´åŠ çš„ç›´è§‚ï¼‰ã€‚



## 5ï¸âƒ£ Webpack Dashboard

[webpack-dashboard](https://www.npmjs.com/package/webpack-dashboard) æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå¯è§†åŒ–å·¥å…·ï¼Œèƒ½å¤Ÿåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å®æ—¶å±•ç¤ºç¼–è¯‘è¿›åº¦ã€æ¨¡å—åˆ†å¸ƒã€äº§ç‰©ä¿¡æ¯ç­‰ï¼Œç”¨æ³•ï¼š

1. å®‰è£…ä¾èµ–

   ```bash
   pnpm i -D webpack-dashboard
   ```

2. æ³¨å†Œæ’ä»¶ï¼š

   ```js
   const VisualizerPlugin = require('webpack-visualizer-plugin2')
   
   module.exports = {
     // ...
     plugins: [
       new VisualizerPlugin({
         filename: './stats.html'
       })
     ]
   }
   ```

3. ğŸš¨æ³¨æ„äº†ï¼Œéœ€è¦ç”¨ `webpack-dashboard` å‘½ä»¤å¯åŠ¨ç¼–è¯‘ï¼š

   ```js
   # æ‰“åŒ…
   npx webpack-dashboard -- webpack
   
   # Dev Server
   npx webpack-dashboard -- webpack-dev-server
   
   # è¿è¡Œ Node ç¨‹åº
   npx webpack-dashboard -- node index.js
   ```

ä¹‹åï¼Œå°±å¯ä»¥åœ¨å‘½ä»¤è¡Œçœ‹åˆ°ä¸€ä¸ªæ¼‚äº®çš„å¯è§†åŒ–ç•Œé¢ï¼š

![webpack-dashboard](./imgs/12-8.webp)



## 6ï¸âƒ£ Speed Measure Plugin <Badge type="warning" text="åºŸå¼ƒ" />

[SpeedMeasureWebpackPlugin](https://www.npmjs.com/package/speed-measure-webpack-plugin) æ’ä»¶èƒ½å¤Ÿç»Ÿè®¡å‡ºå„ä¸ª Loaderã€æ’ä»¶çš„å¤„ç†è€—æ—¶ï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®è¿™äº›æ•°æ®åˆ†æå‡ºå“ªäº›ç±»å‹çš„æ–‡ä»¶å¤„ç†æ›´è€—æ—¶é—´ï¼Œç”¨æ³•ï¼š

1. å®‰è£…ä¾èµ–

   ```bash
   pnpm i -D speed-measure-webpack-plugin
   ```

2. ä¿®æ”¹é…ç½®ï¼š

   ```js
   const SpeedMeasurePlugin = require('speed-measure-webpack-plugin');
   
   const smp = new SpeedMeasurePlugin();
   
   const config = {
     entry: "./src/index.ts",
     // ...
   };
   
   // ğŸš€æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ç”¨ `smp.wrap` å‡½æ•°åŒ…è£¹ä½ Webpack é…ç½®
   module.exports = smp.wrap(config);
   ```

ä¹‹åè¿è¡Œæ‰“åŒ…å‘½ä»¤å¦‚ `npx webpack` å³å¯ï¼Œè¿è¡Œæ•ˆæœï¼š

![speed-measure-webpack-plugin](./imgs/12-9.webp)



::: warning

å®æµ‹webpack5å·²ç»ä¸èƒ½å†ä½¿ç”¨è¯¥æ’ä»¶

:::



## 7ï¸âƒ£ UnusedWebpackPlugin

æœ€ååˆ†äº« [UnusedWebpackPlugin](https://www.npmjs.com/package/unused-webpack-plugin) æ’ä»¶ï¼Œå®ƒèƒ½å¤Ÿæ ¹æ® webpack ç»Ÿè®¡ä¿¡æ¯ï¼Œåå‘æŸ¥æ‰¾å‡ºå·¥ç¨‹é¡¹ç›®é‡Œå“ªäº›æ–‡ä»¶æ²¡æœ‰è¢«ç”¨åˆ°ï¼Œæˆ‘æ—¥å¸¸åœ¨å„ç§é¡¹ç›®é‡æ„å·¥ä½œä¸­éƒ½ä¼šç”¨åˆ°ï¼Œéå¸¸å®ç”¨ã€‚ç”¨æ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼š

1. å®‰è£…ä¾èµ–

   ```bash
   pnpm i -D unused-webpack-plugin
   ```

2. ä¿®æ”¹é…ç½®ï¼š

   ```js
   const UnusedWebpackPlugin = require('unused-webpack-plugin');
   
   module.exports = {
     // ...
     plugins: [
       new UnusedWebpackPlugin({
         directories: [path.join(__dirname, 'src')],
         root: path.join(__dirname, '../')
       })
     ]
   }
   ```

ç¤ºä¾‹ä¸­ï¼Œ`directories` ç”¨äºæŒ‡å®šéœ€è¦åˆ†æçš„æ–‡ä»¶ç›®å½•ï¼›`root` ç”¨äºæŒ‡å®šæ ¹è·¯å¾„ï¼Œä¸è¾“å‡ºæœ‰å…³ã€‚é…ç½®æ’ä»¶åï¼Œwebpack æ¯æ¬¡è¿è¡Œå®Œæ¯•éƒ½ä¼šè¾“å‡º `directories` ç›®å½•ä¸­ï¼Œæœ‰å“ªäº›æ–‡ä»¶æ²¡æœ‰è¢«ç”¨åˆ°ï¼š

![unused-webpack-plugin](./imgs/12-10.webp)



## æ€»ç»“

è¿™æ˜¯ä¸€ç¯‡ä»‹ç» Webpack æ€§èƒ½åˆ†æçš„å®è·µæ–¹æ³•ç±»æ–‡ç« ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç†è§£ Webpack ç¼–è¯‘çš„åŸºæœ¬è¿‡ç¨‹ï¼Œä»¥åŠè¿‡ç¨‹ä¸­å„ä¸ªæ­¥éª¤çš„è€—æ—¶ï¼Œç†è§£å“ªäº›èŠ‚ç‚¹å¯èƒ½ä¼šæ¶ˆè€—æ›´å¤šæ—¶é—´ç­‰ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæˆ‘ä»¬æ‰èƒ½æ›´ç²¾ç¡®ã€æœ‰çš„æ”¾çŸ¢åœ°æ’æŸ¥å‡ºé¡¹ç›®ä¸­çš„æ€§èƒ½é—®é¢˜ã€‚

ç†è§£åŸºæœ¬åŸç†åï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©ä¸€ç³»åˆ—å¯è§†åŒ–å·¥å…·åˆ†ææ„å»ºã€äº§ç‰©æ€§èƒ½ï¼Œä½ å¯ä»¥æ²¿ç€ä¸Šé¢çš„ä»‹ç»ï¼Œé€ä¸€è¯•ç”¨ã€å­¦ä¹ è¿™äº›åˆ†æå·¥å…·ã€‚



## æ€è€ƒé¢˜â­

è¯·ä»”ç»†è§‚å¯Ÿ `stats` [ç¤ºä¾‹æ–‡ä»¶](https://github1s.com/Tecvan-fe/webpack-book-samples/blob/HEAD/stats-with-profile/stats.json)ï¼Œæ€è€ƒå‡ ä¸ªé—®é¢˜ï¼š

1. å¦‚ä½•æ¨æ–­ä¸€ä¸ª Chunk ä¸­åŒ…å«äº†å“ªäº›æ¨¡å—ï¼Ÿ
2. å¦‚ä½•åˆ¤æ–­ Chunk ç±»å‹(Initial/Async/Runtime Chunk)ï¼Ÿ
3. å¦‚ä½•åˆ†æ Module ä¸ Module ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Ÿ



::: details chatgptå›ç­”

1ï¸âƒ£ **å¦‚ä½•æ ¹æ®webpackçš„ç”Ÿæˆçš„statsæ–‡ä»¶åˆ¤æ–­ä¸€ä¸ªChunkåŒ…å«å“ªäº›æ¨¡å—ï¼Ÿ**

ä½¿ç”¨statsæ–‡ä»¶çš„"**modules**"å±æ€§å¯ä»¥å¾—åˆ°æ‰€æœ‰çš„æ¨¡å—ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®ƒä»¬å±äºå“ªä¸ªchunkã€‚

æ¯ä¸ªchunkéƒ½æœ‰ä¸€ä¸ª"**id**"å±æ€§ï¼Œå¯æ ¹æ®æ­¤å±æ€§åŒ¹é…ä¸Šå¯¹åº”çš„chunkã€‚ç„¶åï¼Œå¯ä»¥é€šè¿‡chunkçš„"modules"å±æ€§æ¥è·å–æ­¤chunkä¸­åŒ…å«çš„æ‰€æœ‰æ¨¡å—ã€‚

ç¤ºä¾‹ä»£ç ï¼š

```js
const stats = require('./stats.json');

// æŸ¥æ‰¾idä¸º0çš„chunk
const chunk = stats.chunks.find(chunk => chunk.id === 0);

// è·å–æ­¤chunkåŒ…å«çš„æ‰€æœ‰æ¨¡å—
const moduleIds = chunk.modules.map(module => module.id);
const modules = stats.modules.filter(module => moduleIds.includes(module.id));

console.log(modules);
```

2ï¸âƒ£ **å¦‚ä½•æ ¹æ®webpackçš„ç”Ÿæˆçš„statsæ–‡ä»¶åˆ¤æ–­ Chunk ç±»å‹(Initial/Async/Runtime Chunk)ï¼Ÿ**

ä½¿ç”¨statsæ–‡ä»¶çš„"chunks"å±æ€§å¯ä»¥è·å–åˆ°æ‰€æœ‰chunkçš„ä¿¡æ¯ï¼Œæ¯ä¸ªchunkéƒ½æœ‰ä¸€ä¸ª"**initial**"å±æ€§ï¼ˆå¸ƒå°”ç±»å‹ï¼‰ï¼Œç”¨æ¥è¡¨ç¤ºæ˜¯å¦æ˜¯Initial Chunkã€‚æ ¹æ®è¿™ä¸ªå±æ€§å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ¤æ–­ä¸€ä¸ªchunkæ˜¯å¦æ˜¯Initial Chunkã€‚

å¯¹äºå¼‚æ­¥Chunkå’Œè¿è¡Œæ—¶Chunkï¼Œåˆ™éœ€è¦åˆ¤æ–­å®ƒä»¬çš„æ¥æºã€‚å¼‚æ­¥Chunkçš„æ¥æºå¯ä»¥é€šè¿‡"**chunk.origins**"å±æ€§å¾—åˆ°ï¼Œå¦‚æœè¿™ä¸ªæ•°ç»„ä¸ºç©ºï¼Œåˆ™è¯´æ˜æ˜¯å¼‚æ­¥Chunkï¼ˆå› ä¸ºå¼‚æ­¥Chunkæ²¡æœ‰ä»»ä½•è¢«ä¾èµ–é¡¹å¼•ç”¨åˆ°çš„æ¨¡å—ï¼Œæ‰€ä»¥æ²¡æœ‰æ¥æºï¼‰ã€‚

è€Œè¿è¡Œæ—¶Chunkåªæœ‰ä¸€ä¸ªï¼Œåœ¨statsæ–‡ä»¶çš„"**entrypoints.runtime**"å±æ€§ä¸­è®°å½•äº†å…¶IDã€‚æ ¹æ®è¿™ä¸ªIDï¼Œå¯ä»¥åœ¨"chunks"æ•°ç»„ä¸­æ‰¾åˆ°å¯¹åº”çš„chunkï¼Œç„¶ååˆ¤æ–­å…¶ç±»å‹ã€‚

ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªChunkæ˜¯Initial Chunkã€Async Chunkè¿˜æ˜¯Runtime Chunkï¼š

```javascript
const stats = require('./stats.json');

// åˆ¤æ–­chunkæ˜¯å¦æ˜¯Initial Chunk
function isInitialChunk(chunk) {
  return chunk.initial === true;
}

// åˆ¤æ–­chunkæ˜¯å¦æ˜¯Async Chunk
function isAsyncChunk(chunk) {
  return chunk.origins.length === 0;
}

// ğŸš¨è¿™ç§æ–¹å¼å¯èƒ½å·²ç»è¿‡æ—¶äº†
// åˆ¤æ–­chunkæ˜¯å¦æ˜¯Runtime Chunk
function isRuntimeChunk(chunk) {
  const runtimeChunkId = stats.entrypoints.runtime.chunks[0];
  return chunk.id === runtimeChunkId;
}
```

æœ‰äº†è¿™äº›åˆ¤æ–­å‡½æ•°ï¼Œä½ å¯ä»¥é€šè¿‡éå†"chunks"æ•°ç»„å¹¶ä½¿ç”¨è¿™äº›å‡½æ•°æ¥ç¡®å®šæ¯ä¸ªchunkçš„ç±»å‹ã€‚



3ï¸âƒ£ **å¦‚ä½•æ ¹æ®webpackçš„ç”Ÿæˆçš„statsæ–‡ä»¶åˆ†æ Module ä¸ Module ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Ÿ**

ä½¿ç”¨statsæ–‡ä»¶ä¸­çš„"modules"å’Œ"chunks"å±æ€§å¯ä»¥åˆ†æå‡ºæ¨¡å—å’Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚

é¦–å…ˆéœ€è¦éå†æ‰€æœ‰çš„chunkï¼Œè·å–æ¯ä¸ªchunkåŒ…å«çš„æ¨¡å—ã€‚ç»Ÿè®¡æ¯ä¸ªæ¨¡å—å‡ºç°çš„æ¬¡æ•°ï¼Œå¯ä»¥å¾—åˆ°æ¯ä¸ªæ¨¡å—è¢«å“ªäº›chunkå¼•ç”¨äº†ã€‚

æ¥ç€éå†æ‰€æœ‰çš„æ¨¡å—ï¼Œè·å–æ¯ä¸ªæ¨¡å—å¼•ç”¨çš„å…¶ä»–æ¨¡å—åˆ—è¡¨ã€‚ä½¿ç”¨ä¸€å¼ å›¾æ¥è®°å½•æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå°†æ¯ä¸ªæ¨¡å—ä½œä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒä»¬ä¹‹é—´çš„å¼•ç”¨å…³ç³»ä½œä¸ºè¾¹ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç»Ÿè®¡æ¨¡å—ä¹‹é—´ä¾èµ–å…³ç³»çš„ç¤ºä¾‹ä»£ç ï¼š

```javascript
const stats = require('./stats.json');

const modules = stats.modules;
const chunks = stats.chunks;

// ç»Ÿè®¡æ¯ä¸ªæ¨¡å—è¢«å“ªäº›chunkå¼•ç”¨äº†
const moduleUsages = {};
chunks.forEach(chunk => {
  chunk.modules.forEach(module => {
    const moduleId = module.id;
    if (!moduleUsages[moduleId]) {
      moduleUsages[moduleId] = new Set();
    }
    moduleUsages[moduleId].add(chunk.id);
  });
});

// æ„å»ºæ¨¡å—ä¾èµ–å›¾
const moduleGraph = {};
modules.forEach(module => {
  const moduleId = module.id;
  moduleGraph[moduleId] = moduleGraph[moduleId] || { id: moduleId, deps: [] };

  // æ‰¾å‡ºæ¨¡å—å¼•ç”¨çš„å…¶ä»–æ¨¡å—
  const depIds = module.dependencies
    .map(dep => dep.moduleId)
    .filter(id => id !== undefined);

  // å°†å…¶ä»–æ¨¡å—æ·»åŠ åˆ°å½“å‰æ¨¡å—çš„ä¾èµ–åˆ—è¡¨ä¸­
  depIds.forEach(depId => {
    moduleGraph[moduleId].deps.push(moduleGraph[depId]);
  });

  // æ ‡è®°æ¨¡å—æ˜¯å¦æ˜¯å…¥å£æ¨¡å—
  moduleGraph[moduleId].isEntry = chunkEntryModuleIds.has(moduleId);

  // æ ‡è®°æ¨¡å—è¢«å“ªäº›chunkå¼•ç”¨
  moduleGraph[moduleId].usages = moduleUsages[moduleId];
});

console.log(moduleGraph);
```

è¿è¡Œä¸Šè¿°ä»£ç åï¼Œ"moduleGraph"å¯¹è±¡ä¸­ä¿å­˜äº†æ‰€æœ‰æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼š

```javascript
{
  "0": {
    "id": 0,
    "deps": [{ "id": 1, "deps": [], "isEntry": true, "usages": [1, 2] }],
    "isEntry": true,
    "usages": [0, 1, 2]
  },
  "1": { "id": 1, "deps": [], "isEntry": true, "usages": [0, 3] },
  "2": { "id": 2, "deps": [], "isEntry": false, "usages": [0] }
  // ...
}
```

è¿™ä¸ªç¤ºä¾‹ä»£ç ä¸­ä½¿ç”¨äº†"module.dependencies"æ¥è·å–æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œè¿™éœ€è¦å¯¹webpackè¿›è¡Œé…ç½®ï¼Œä»¥ä¾¿åœ¨æ„å»ºæ—¶å°†è¿™äº›ä¿¡æ¯è®°å½•åˆ°statsæ–‡ä»¶ä¸­ã€‚éœ€è¦è®¾ç½®"module.dependencies"ä¸ºtrueï¼š

```javascript
module: {
  rules: [
    {
      test: /\.jsx?$/,
      use: 'babel-loader',
      resolve: { fullySpecified: false },
      // å°†æ¨¡å—ä¹‹é—´çš„ä¾èµ–ä¿¡æ¯è®°å½•åˆ°statsæ–‡ä»¶ä¸­
      parser: {
        // å¼€å¯æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»åˆ†æ
        dependencies: true
      }
    }
  ]
},
```

:::



2023å¹´04æœˆ20æ—¥13:45:54
