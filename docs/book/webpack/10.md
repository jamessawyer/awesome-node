---
title: å›¾åƒåŠ è½½åŸç†å’Œæœ€ä½³å®è·µ
---

å›¾å½¢å›¾åƒèµ„æºæ˜¯å½“ä»£ Web åº”ç”¨çš„æœ€å¸¸ç”¨ã€å®æƒ çš„å†…å®¹ã€è£…é¥°å…ƒç´ ä¹‹ä¸€ï¼Œä½†åœ¨ Webpack å‡ºç°ä¹‹å‰å¯¹å›¾åƒèµ„æºçš„å¤„ç†å¤æ‚åº¦ç‰¹åˆ«é«˜ï¼Œéœ€è¦å€ŸåŠ©ä¸€ç³»åˆ—å·¥å…·(ç”šè‡³ PhotoShop)å®Œæˆå‹ç¼©ã€é›ªç¢§å›¾ã€hashã€éƒ¨ç½²ç­‰æ“ä½œã€‚

è€Œåœ¨ Webpack ä¸­ï¼Œå›¾åƒä»¥åŠå…¶å®ƒå¤šåª’ä½“èµ„æºéƒ½è¢«æå‡ä¸ºä¸€ç­‰å…¬æ°‘ â€”â€” èƒ½å¤Ÿåƒå¼•ç”¨æ™®é€š JavaScript æ¨¡å—ä¸€æ ·é€šè¿‡ `import/require` è¯­å¥å¯¼å…¥èµ„æºæ¨¡å—ï¼Œè¿™ç§å¼€å‘æ¨¡å¼å…è®¸æˆ‘ä»¬å°†å›¾åƒç›¸å…³çš„å¤„ç†åˆå…¥ç»Ÿä¸€çš„å¿ƒæ™ºæ¨¡å‹ä¸­ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚

æœ¬æ–‡å°†é›†ä¸­ä»‹ç» Webpack ä½“ç³»ä¸‹å¤„ç†å›¾åƒèµ„æºçš„å¸¸è§æ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼š

- å¦‚ä½•ä½¿ç”¨é€‚å½“çš„ Loader å¤„ç†å›¾åƒèµ„æºï¼›
- å¦‚ä½•å€ŸåŠ© Loader æˆ–æ’ä»¶å®ç°å›¾åƒä¼˜åŒ–ï¼ŒåŒ…æ‹¬å‹ç¼©ã€é›ªç¢§å›¾ã€å“åº”å¼å›¾ç‰‡ã€‚



## åœ¨ Webpack 4 ä¸­å¯¼å…¥å›¾åƒ

åŸç”Ÿ Webpack 4 åªèƒ½å¤„ç†æ ‡å‡† JavaScript æ¨¡å—ï¼Œå› æ­¤éœ€è¦å€ŸåŠ© Loader â€”â€” ä¾‹å¦‚ `file-loader`ã€`url-loader`ã€`raw-loader` ç­‰å®Œæˆå›¾åƒåŠ è½½æ“ä½œï¼Œå®è·µä¸­æˆ‘ä»¬é€šå¸¸éœ€è¦æŒ‰èµ„æºç±»å‹é€‰æ‹©é€‚å½“åŠ è½½å™¨ï¼Œç®€å•ä»‹ç»



### file-loader

[file-loader](https://v4.webpack.js.org/loaders/file-loader/)ï¼šå°†å›¾åƒå¼•ç”¨è½¬æ¢ä¸º url è¯­å¥å¹¶ç”Ÿæˆç›¸åº”å›¾ç‰‡æ–‡ä»¶ï¼Œä¾‹å¦‚ä½¿ç”¨å¦‚ä¸‹é…ç½®ï¼š

::: code-group

``` js [webpack.config.js]
module.exports = {
  // ...
  module: {
    rules: [
      {
        test: /\.(png|jpe?g)$/,
        use: ['file-loader']
      }
    ]
  }
}
```

:::

ç»è¿‡ `file-loader` å¤„ç†åï¼ŒåŸå§‹å›¾ç‰‡ä¼šè¢«é‡å‘½åå¹¶å¤åˆ¶åˆ°äº§ç‰©æ–‡ä»¶å¤¹ï¼ŒåŒæ—¶åœ¨ä»£ç ä¸­æ’å…¥å›¾ç‰‡ URL åœ°å€ï¼Œå½¢å¦‚ï¼š

![file-loader](./imgs/10-1.webp)



### url-loader

[url-loader](https://v4.webpack.js.org/loaders/url-loader/)ï¼šæœ‰ä¸¤ç§è¡¨ç°ï¼Œå¯¹äºå°äºé˜ˆå€¼ `limit` çš„å›¾åƒç›´æ¥è½¬åŒ–ä¸º base64 ç¼–ç ï¼›å¤§äºé˜ˆå€¼çš„å›¾åƒåˆ™è°ƒç”¨ `file-loader` è¿›è¡ŒåŠ è½½ï¼Œä¾‹å¦‚å¦‚ä¸‹é…ç½®ï¼š

::: code-group

``` js [webpack.config.js]
module.exports = {
  // ...
  module: {
    rules: [
      {
        test: /\.(png|jpe?g)$/,
        use: [
          {
            loader: 'url-loader',
            options: {
              limit: 1024
            }
          }
        ]
      }
    ]
  }
}
```

:::

ç»è¿‡ `url-loader` å¤„ç†åï¼Œå°äº `limit` å‚æ•°å³ 1024B çš„å›¾ç‰‡ä¼šè¢«è½¬è¯‘ä¸º Base64 ç¼–ç ï¼Œå¦‚ï¼š

![url-loader](./imgs/10-2.webp)

å¯¹äºè¶…è¿‡ `limit` å€¼çš„å›¾ç‰‡åˆ™ç›´æ¥è°ƒç”¨ `file-loader` å®ŒæˆåŠ è½½ã€‚

`url-loader` åŒæ ·é€‚ç”¨äºå¤§å¤šæ•°å›¾ç‰‡æ ¼å¼ï¼Œä¸”èƒ½å°†è®¸å¤šç»†å°çš„å›¾ç‰‡ç›´æ¥å†…åµŒè¿›äº§ç‰©ä¸­ï¼Œå‡å°‘é¡µé¢è¿è¡Œæ—¶éœ€è¦å‘å‡ºçš„ç½‘ç»œè¯·æ±‚æ•°ï¼Œåœ¨ `HTTP 1.1` åŠä¹‹å‰ç‰ˆæœ¬ä¸­èƒ½å¸¦æ¥æ­£å‘çš„æ€§èƒ½æ”¶ç›Šã€‚



### raw-loader

[raw-loader](https://v4.webpack.js.org/loaders/raw-loader)ï¼šä¸åšä»»ä½•è½¬è¯‘ï¼Œåªæ˜¯ç®€å•å°†æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°äº§ç‰©ä¸­ï¼Œé€‚ç”¨äº SVG åœºæ™¯ï¼Œä¾‹å¦‚å¦‚ä¸‹é…ç½®ï¼š

::: code-group

``` js [webpack.config.js]
module.exports = {
  // ...
  module: {
    rules: [
      {
        test: /\.svg$/,
        use: ['raw-loader']
      }
    ]
  }
}
```

:::

ç»è¿‡ `raw-loader` å¤„ç†åï¼ŒSVG èµ„æºä¼šè¢«ç›´æ¥å¤åˆ¶æˆå­—ç¬¦ä¸²å½¢å¼ï¼š

![raw-loader](./imgs/10-3.webp)

é™¤ `raw-loader` å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ Loader åŠ è½½ SVG èµ„æºï¼š

- [svg-inline-loader](https://www.npmjs.com/package/svg-inline-loader)ï¼šèƒ½å¤Ÿè‡ªåŠ¨åˆ é™¤ SVG å›¾ç‰‡ä¸­ä¸æ˜¾å¼æ— å…³çš„å„ç§åŸä¿¡æ¯ï¼Œè¾¾åˆ°å‹ç¼©æ•ˆæœï¼›
- [svg-url-loader](https://www.npmjs.com/package/svg-url-loader)ï¼šä»¥ [DataURL](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/Data_URIs) æ–¹å¼å¯¼å…¥ SVG å›¾ç‰‡ï¼Œç›¸æ¯”äº Base64 æ›´èŠ‚çœç©ºé—´ï¼›
- [react-svg-loader](https://www.npmjs.com/package/react-svg-loader)ï¼šå¯¼å…¥ SVG å›¾ç‰‡å¹¶è‡ªåŠ¨è½¬åŒ–ä¸º React ç»„ä»¶å½¢æ€ï¼Œæ•ˆæœç±»ä¼¼ [@svgr/webpack](https://www.npmjs.com/package/@svgr/webpack)ï¼›
- [vue-svg-loader](https://www.npmjs.com/package/vue-svg-loader)ï¼šå¯¼å…¥ SVG å›¾ç‰‡å¹¶è‡ªåŠ¨è½¬åŒ–ä¸º Vue ç»„ä»¶å½¢æ€ã€‚



## åœ¨ Webpack 5 ä¸­å¯¼å…¥å›¾åƒ

ä¸Šè¿° `file-loader`ã€`url-loader`ã€`raw-loader` éƒ½å¹¶ä¸å±€é™äºå¤„ç†å›¾ç‰‡ï¼Œå®ƒä»¬è¿˜å¯ä»¥è¢«ç”¨äºåŠ è½½ä»»æ„ç±»å‹çš„å¤šåª’ä½“æˆ–æ–‡æœ¬æ–‡ä»¶ï¼Œä½¿ç”¨é¢‘ç‡æé«˜ï¼Œå‡ ä¹å·²ç»æˆä¸ºæ ‡é…ç»„ä»¶ï¼æ‰€ä»¥ Webpack5 ç›´æ¥å†…ç½®äº†è¿™äº›èƒ½åŠ›ï¼Œå¼€ç®±å³å¯ä½¿ç”¨ã€‚

ç”¨æ³•ä¸Šï¼ŒåŸæœ¬éœ€è¦å®‰è£…ã€å¯¼å…¥ Loaderï¼ŒWebpack5 ä¹‹ååªéœ€è¦é€šè¿‡ `module.rules.type` å±æ€§æŒ‡å®š[èµ„æºç±»å‹](https://webpack.js.org/guides/asset-modules/)å³å¯ï¼Œå¯¹æ¯”æ¥çœ‹ï¼š



### type = "asset/resource"

file-loader å¯¹æ ‡åˆ° type = "asset/resource"

::: code-group

``` js [webpack.config.js]
module.exports = {
  // ...
  module: {
    rules: [
      {
        test: /\.(png|jpe?g)$/,
        use: ['file-loader'], // [!code --]
        type: 'asset/resource' // [!code ++]
      }
    ]
  }
}
```

:::



::: tip

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`asset/resource` ç”Ÿæˆçš„æ–‡ä»¶ä¼šä»¥ `[hash][ext][query]` æ–¹å¼é‡å‘½åï¼Œå¯ä»¥é€šè¿‡ [output.assetModuleFilename](https://webpack.js.org/configuration/output/#outputassetmodulefilename) å±æ€§æ§åˆ¶ã€‚

:::



### type = "asset/inline" || type = "asset"

`url-loader` å¯¹æ ‡åˆ° `type = "asset"` æˆ– `type = "asset/inline"`ï¼š



::: code-group

``` js [webpack.config.js]
module.exports = {
  // ...
  module: {
    rules: [
      {
        test: /\.(png|jpe?g)$/,
        use: [  // [!code --]
          {  // [!code --]
            loader: 'url-loader',  // [!code --]
            options: {  // [!code --]
              limit: 1024  // [!code --]
            }  // [!code --]
          }  // [!code --]
        ],  // [!code --]
        type: 'asset', // [!code ++]
        parser: { // [!code ++]
          dataUrlCondition: { // [!code ++]
            // 1kb // [!code ++]
            maxSize: 1024 // [!code ++]
          } // [!code ++]
        } // [!code ++]
      }
    ]
  }
}
```

:::

å…¶ä¸­ï¼Œ[module.rules.parser.dataUrlCondition](https://webpack.js.org/configuration/module/#ruleparserdataurlcondition) ç”¨äºé™å®šæ–‡ä»¶å¤§å°é˜ˆå€¼ï¼Œå¯¹æ ‡ `url-loader` çš„ `limit` å±æ€§ã€‚



### type = "asset/source"

`raw-loader` å¯¹æ ‡åˆ° `type = "asset/source"`ï¼š

::: code-group

``` js [webpack.config.js]
module.exports = {
  // ...
  module: {
    rules: [
      {
        test: /\.svg$/,
        use: ['raw-loader'], // [!code --]
        type: 'asset/source', // [!code ++]
      }
    ]
  }
}
```

:::

è¡¥å……ä¸€ä¸‹ï¼Œå¼•å…¥ `module.rules.type` å¹¶ä¸åªæ˜¯ä¸ºäº†å–ä»£ Loader é‚£ä¹ˆç®€å•ï¼Œæ›´é‡è¦çš„ç›®çš„æ˜¯åœ¨ JavaScript Module ä¹‹å¤–å¢åŠ å¯¹å…¶å®ƒèµ„æº â€”â€” [Asset Module](https://webpack.js.org/guides/asset-modules/) çš„åŸç”Ÿæ”¯æŒï¼Œè®© Webpack æœ‰æœºä¼šä»‹å…¥è¿™äº›å¤šåª’ä½“èµ„æºçš„è§£æã€ç”Ÿæˆè¿‡ç¨‹ï¼Œä»è€Œæœ‰æœºä¼šå®ç°æ›´æ ‡å‡†ã€é«˜æ•ˆçš„èµ„æºå¤„ç†æ¨¡å‹ã€‚

ç›®å‰ [`module.rules.type`](https://webpack.js.org/configuration/module/#ruletype) å·²ç»æ”¯æŒ JSONã€WebAssemblyã€äºŒè¿›åˆ¶ã€æ–‡æœ¬ç­‰èµ„æºç±»å‹ï¼Œç›¸ä¿¡åœ¨ä¸‹ä¸€ä¸ª Webpack ç‰ˆæœ¬ä¸­ï¼Œå¿…ç„¶ä¼šåŸºäº Asset Module å®ç°æ›´ä¸°å¯Œçš„èµ„æºå¤„ç†èƒ½åŠ›ğŸ˜ã€‚



## å›¾åƒä¼˜åŒ–

å‰é¢ä»‹ç»çš„ Loader ä¸ Asset Modules éƒ½åªæ˜¯è§£å†³äº†å›¾åƒèµ„æºåŠ è½½ â€”â€” ä¹Ÿå°±æ˜¯è®© Webpack èƒ½å¤Ÿç†è§£ã€å¤„ç†å›¾åƒèµ„æºï¼Œç°å®ä¸­æˆ‘ä»¬è¿˜éœ€è¦ä¸º Web é¡µé¢ä¸­çš„å›¾ç‰‡åšå„ç§ä¼˜åŒ–ï¼Œæå‡é¡µé¢æ€§èƒ½ï¼Œå¸¸è§çš„ä¼˜åŒ–æ–¹æ³•åŒ…æ‹¬ï¼š

- **å›¾åƒå‹ç¼©**ï¼šå‡å°‘ç½‘ç»œä¸Šéœ€è¦ä¼ è¾“çš„æµé‡ï¼›
- **é›ªç¢§å›¾**ï¼šå‡å°‘ HTTP è¯·æ±‚æ¬¡æ•°ï¼›
- **å“åº”å¼å›¾ç‰‡**ï¼šæ ¹æ®å®¢æˆ·ç«¯è®¾å¤‡æƒ…å†µä¸‹å‘é€‚å½“åˆ†è¾¨ç‡çš„å›¾ç‰‡ï¼Œæœ‰åŠ©äºå‡å°‘ç½‘ç»œæµé‡ï¼›
- **CDN**ï¼šå‡å°‘å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ä¹‹é—´çš„ç‰©ç†é“¾è·¯é•¿åº¦ï¼Œæå‡ä¼ è¾“æ•ˆç‡ï¼›
- ç­‰ç­‰ã€‚

è¿™å…¶ä¸­æœ‰ä¸å°‘å¯ä»¥åœ¨å¼€å‘ã€æ„å»ºé˜¶æ®µå€ŸåŠ© Webpack æ­å»ºè‡ªåŠ¨ä¼˜åŒ–å·¥ä½œæµï¼Œä¾‹å¦‚ï¼šå›¾åƒå‹ç¼©ã€‚



### å›¾åƒå‹ç¼©

åœ¨ Webpack ç”Ÿæ€ä¸­æœ‰ä¸å°‘ä¼˜ç§€çš„å›¾åƒå‹ç¼©ç»„ä»¶ï¼ŒåŒ…æ‹¬ï¼š[image-webpack-loader](https://github.com/tcoopman/image-webpack-loader)ã€[imagemin-webpack-plugin](https://www.npmjs.com/package/imagemin-webpack-plugin)ã€[image-minimizer-webpack-plugin](https://github.com/webpack-contrib/image-minimizer-webpack-plugin) ç­‰ï¼Œä»¥æˆ‘çš„ä½¿ç”¨ç»éªŒæ¥çœ‹ï¼Œ[image-webpack-loader](https://github.com/tcoopman/image-webpack-loader) ç»„ä»¶åŠŸèƒ½é½å…¨ä¸”ç”¨æ³•ç®€å•ï¼Œæ›´æ¨èä½¿ç”¨ã€‚åŸºæœ¬ç”¨æ³•é¦–å…ˆå®‰è£…ä¾èµ–ï¼š

```bash
pnpm i -D image-webpack-loader
```

ä¹‹åé…ç½® Loaderï¼š

::: code-group

``` js [webpack.config.js]
module.exports = {
  // ...
  module: {
    rules: [
      {
        test: /\.(gif|png|jpe?g|svg)$/i,
        // ğŸš€ type å±æ€§é€‚ç”¨äº Webpack5ï¼Œæ—§ç‰ˆæœ¬å¯ä½¿ç”¨ file-loader
        type: 'asset/resource',
        use: [{
          loader: 'image-webpack-loader',
          options: {
            // jpegå‹ç¼©é…ç½®
            mozjpeg: {
              quality: 80
            }
          }
        }]
      }
    ]
  }
}
```

:::

[image-webpack-loader](https://github.com/tcoopman/image-webpack-loader) åº•å±‚ä¾èµ–äº [imagemin](https://github.com/imagemin/imagemin) åŠä¸€ç³»åˆ—çš„å›¾åƒä¼˜åŒ–å·¥å…·ï¼š

- [mozjpeg](https://github.com/imagemin/imagemin-mozjpeg)ï¼šç”¨äºå‹ç¼© JPG(JPEG) å›¾ç‰‡ï¼›
- [optipng](https://github.com/kevva/imagemin-optipng)ï¼šç”¨äºå‹ç¼© PNG å›¾ç‰‡ï¼›
- [pngquant](https://github.com/imagemin/imagemin-pngquant)ï¼šåŒæ ·ç”¨äºå‹ç¼© PNG å›¾ç‰‡ï¼›
- [svgo](https://github.com/kevva/imagemin-svgo)ï¼šç”¨äºå‹ç¼© SVG å›¾ç‰‡ï¼›
- [gifsicle](https://github.com/kevva/imagemin-gifsicle)ï¼šç”¨äºå‹ç¼© Gif å›¾ï¼›
- [webp](https://github.com/imagemin/imagemin-webp)ï¼šç”¨äºå°† JPG/PNG å›¾å‹ç¼©å¹¶è½¬åŒ–ä¸º WebP å›¾ç‰‡æ ¼å¼ã€‚

åŸºæœ¬ä¸Šå·²ç»è¦†ç›– Web é¡µé¢å¸¸ç”¨çš„å›¾ç‰‡æ ¼å¼ï¼Œå…·ä½“ç”¨æ³•å¯ç‚¹å‡»ä¸Šè¿°é“¾æ¥æŸ¥é˜…ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚æœ€åè¡¥å……ä¸€ç‚¹ï¼Œå›¾åƒå‹ç¼©æ˜¯ä¸€ç§éå¸¸è€—æ—¶çš„æ“ä½œï¼Œå»ºè®®åªåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹å¼€å¯ï¼š



::: code-group

``` js [webpack.config.js]
module.exports = {
  // ...
  module: {
    rules: [
      {
        test: /\.(gif|png|jpe?g|svg)$/i,
        // ğŸš€ type å±æ€§é€‚ç”¨äº Webpack5ï¼Œæ—§ç‰ˆæœ¬å¯ä½¿ç”¨ file-loader
        type: 'asset/resource',
        use: [{
          loader: 'image-webpack-loader',
          options: {
            disable: process.env.NODE_ENV === 'development', // [!code ++]
            // jpegå‹ç¼©é…ç½®
            mozjpeg: {
              quality: 80
            }
          }
        }]
      }
    ]
  }
}
```

:::



### é›ªç¢§å›¾

åœ¨ `HTTP 2` ä¹‹å‰ï¼ŒHTTP è¯·æ±‚-å“åº”æ˜¯ä¸€ç§æ€§èƒ½ä½ä¸‹çš„é€šè®¯æ¨¡å‹ï¼Œå³ä½¿æ˜¯ä¸ºäº†è¯·æ±‚ä¸€ä¸ªéå¸¸å°‘çš„æ•°æ®ï¼Œä¹Ÿå¯èƒ½éœ€è¦å®Œæ•´ç»å†ï¼šå»ºç«‹ TCP è¿æ¥ => å‘é€ HTTP è¯·æ±‚ => æœåŠ¡ç«¯å¤„ç† => è¿”å›å“åº”æ•°æ®æ•´ä¸ªè¿‡ç¨‹ï¼ŒåŠ ä¹‹ HTTP åè®®çš„**é˜Ÿé¦–é˜»å¡ã€æµè§ˆå™¨å¹¶å‘è¯·æ±‚æ•°é™åˆ¶**ç­‰åŸå› ï¼Œè¿«ä½¿æˆ‘ä»¬å¿…é¡»å°½é‡å‡å°‘ HTTP è¯·æ±‚æ•°ä»¥æå‡ç½‘ç»œé€šè®¯æ•ˆç‡ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†è®¸å¤šç»†å°çš„å›¾ç‰‡åˆå¹¶æˆä¸€å¼ å¤§å›¾ â€”â€” ä»è€Œå°†å¤æ•°æ¬¡è¯·æ±‚åˆå¹¶ä¸ºä¸€æ¬¡è¯·æ±‚ï¼Œä¹‹åé…åˆ CSS çš„ `background-position` æ§åˆ¶å›¾ç‰‡çš„å¯è§†åŒºåŸŸï¼Œè¿™ç§æŠ€æœ¯è¢«ç§°ä½œâ€œ**é›ªç¢§å›¾**â€ã€‚åœ¨ Webpack ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [webpack-spritesmith](https://www.npmjs.com/package/webpack-spritesmith) æ’ä»¶è‡ªåŠ¨å®ç°é›ªç¢§å›¾æ•ˆæœï¼Œé¦–å…ˆå®‰è£…ä¾èµ–ï¼š

```bash
pnpm i -D webpack-spritesmith
```

ä¹‹åæ·»åŠ é…ç½®ï¼š

::: code-group

``` js [webpack.config.js]
module.exports = {
  // ...
  resolve: {
    modules: ['node_modules', 'assets']
  },
  plugins: [
    new SpritesmithPlugin({
      // éœ€è¦
      src: {
        cwd: path.resolve(__dirname, 'src/icon'),
        glob: '*.png'
      },
      target: {
        image: path.resolve(__dirname, 'src/assets/spite.png'),
        css: path.resolve(__dirname, 'src/assets/sprite.less')
      }
    })
  ]
}
```

:::

å…³é”®åœ¨äºï¼Œ[webpack-spritesmith](https://www.npmjs.com/package/webpack-spritesmith) æ’ä»¶ä¼šå°† `src.cwd` ç›®å½•å†…æ‰€æœ‰åŒ¹é… `src.glob` è§„åˆ™çš„å›¾ç‰‡åˆå¹¶æˆä¸€å¼ å¤§å›¾å¹¶ä¿å­˜åˆ° `target.image` æŒ‡å®šçš„æ–‡ä»¶è·¯å¾„ï¼ŒåŒæ—¶ç”Ÿæˆå…¼å®¹ SASS/LESS/Stylus é¢„å¤„ç†å™¨çš„ mixins ä»£ç ï¼Œä¾‹å¦‚å¯¹äºä¸‹é¢æ–‡ä»¶ç»“æ„ï¼š

```bash
load-img
â”œâ”€ src
â”‚  â”œâ”€ icons
â”‚  â”‚  â”œâ”€ grunt.png
â”‚  â”‚  â”œâ”€ gulp-js.png
â”‚  â”‚  â””â”€ webpack.png
â”‚  â””â”€ index.js
â”œâ”€ webpack.config.js
â””â”€ package.json
```

æŒ‰ç…§ä¸Šè¿°é…ç½®è¿è¡Œåä¼šç”Ÿæˆå¦‚ä¸‹äº§ç‰©ï¼š

`src/assets/sprite.png`

![sprite](./imgs/10-4.webp)

`src/assets/sprite.less`

```less
/* ... */
.sprite(@sprite) {
  .sprite-image(@sprite);
  .sprite-position(@sprite);
  .sprite-width(@sprite);
  .sprite-height(@sprite);
}
/* ... */
```

ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ `sprite.less` æä¾›çš„ `.sprite` mixin æ·»åŠ èƒŒæ™¯å›¾ï¼š

```less
@import (less) "./assets/sprite.less";

#main {
  // å‚æ•°ä¸ºåŸå§‹å›¾ç‰‡æ–‡ä»¶å
  .sprite(@webpack);
}
```

::: warning

é›ªç¢§å›¾æ›¾ç»æ˜¯ä¸€ç§ä½¿ç”¨å¹¿æ³›çš„æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯ï¼Œä½† HTTP2 å®ç° TCP å¤šè·¯å¤ç”¨ä¹‹åï¼Œé›ªç¢§å›¾çš„ä¼˜åŒ–æ•ˆæœå·²ç»å¾®ä¹å…¶å¾® â€”â€” ç”šè‡³æ˜¯åä¼˜åŒ–ï¼Œå¯ä»¥é¢„è§éš HTTP2 æ™®åŠç‡çš„æå‡ï¼Œæœªæ¥é›ªç¢§å›¾çš„å¿…è¦æ€§ä¼šè¶Šæ¥è¶Šä½ï¼Œå› æ­¤å»ºè®®è¯»è€…ä»¬äº†è§£ä½œç”¨ä¸åŸºæœ¬åŸç†å³å¯ï¼Œä¸å¿…æ·±ç©¶ã€‚

:::



### å“åº”å¼å›¾ç‰‡

ç§»åŠ¨äº’è”ç½‘æ—¶ä»£ï¼Œæˆ‘ä»¬éœ€è¦é¢å¯¹çš„å®¢æˆ·ç«¯è®¾å¤‡è¶Šæ¥è¶Šå¤šæ ·å¤æ‚ï¼Œåˆ†è¾¨ç‡ä» PC åˆ°å¹³æ¿ç”µè„‘å†åˆ°ç§»åŠ¨ç»ˆç«¯è·¨åº¦æå¤§ï¼š

![responsive images](./imgs/10-5.webp)

è¿™ä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šåŒä¸€å¼ å›¾ç‰‡(ä¸»è¦æ˜¯ä½å›¾)åœ¨ä¸åŒè®¾å¤‡ä¸­ï¼Œå¦‚æœæ˜¾ç¤ºå°ºå¯¸å¤§äºåŸå§‹å°ºå¯¸ï¼Œæœ€ç»ˆæ•ˆæœä¼šæœ‰æ˜æ˜¾é¢—ç²’æ„Ÿï¼›è€Œå¦‚æœæ˜¾ç¤ºå°ºå¯¸å°äºåŸå§‹å°ºå¯¸ï¼Œåˆä¼šé€ æˆå¸¦å®½æµªè´¹ã€‚ç†æƒ³çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¸ºä¸åŒè®¾å¤‡æä¾›ä¸åŒçš„åˆ†è¾¨ç‡ã€ä¸åŒå°ºå¯¸çš„å›¾ç‰‡ â€”â€” ä¹Ÿå°±æ˜¯æ‰€è°“çš„[å“åº”å¼å›¾ç‰‡](https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images)ã€‚

Webpack ä¸­æœ‰ä¸å°‘èƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆå“åº”å¼å›¾ç‰‡çš„ç»„ä»¶ï¼Œä¾‹å¦‚ï¼š [resize-image-loader](https://www.npmjs.com/package/resize-image-loader)ã€[html-loader-srcset](https://www.npmjs.com/package/html-loader-srcset)ã€[responsive-loader](https://www.npmjs.com/package/responsive-loader) ç­‰ï¼Œä»¥ [responsive-loader](https://www.npmjs.com/package/responsive-loader) ä¸ºä¾‹ï¼Œé¦–å…ˆå®‰è£…ä¾èµ–ï¼š

```bash
pnpm i -D responsive-loader sharp
```

ä¹‹åï¼Œä¿®æ”¹é…ç½®ï¼š

::: code-group

``` js [webpack.config.js]
module.exports = {
  // ...
  module: {
    rules: [
      {
        test: /\.(png|jpe?g)$/,
        oneOf: [
          {
            type: 'javascript/auto',
            resourceQuery: /sizes?/,
            use: [
              {
                loader: 'responsive-loader',
                options: {
                  adapter: require('responsive-loader/sharp')
                }
              },
              type: 'asset/resource',
            ]
          }
        ]
      }
    ]
  }
}
```

:::

ğŸš¨æ³¨æ„ï¼Œå®è·µä¸­æˆ‘ä»¬é€šå¸¸æ²¡å¿…è¦å¯¹é¡¹ç›®é‡Œæ‰€æœ‰å›¾ç‰‡éƒ½æ–½åŠ å“åº”å¼ç‰¹æ€§ï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨ `resourceQuery` è¿‡æ»¤å‡ºå¸¦ `size/sizes` å‚æ•°çš„å›¾ç‰‡å¼•ç”¨ï¼Œä½¿ç”¨æ–¹æ³•ï¼š

```jsx {2}
// å¼•ç”¨å›¾ç‰‡ï¼Œå¹¶è®¾ç½®å“åº”å¼å‚æ•°
import responsiveImage from './webpack.jpg?sizes[]=300,sizes[]=600,sizes[]=1024';

const Picture = function () {
  return (
    <img
      srcSet={responsiveImage.srcSet}
      src={responsiveImage.src}
      sizes="(min-width: 1024px) 1024px, 100vw"
      loading="lazy"
    />
  );
};
```

ä¸Šä¾‹çš„å¼•ç”¨å‚æ•° `'./webpack.jpg?sizes[]=300,sizes[]=600,sizes[]=1024';` æœ€ç»ˆå°†ç”Ÿæˆå®½åº¦åˆ†åˆ«ä¸º 300ã€600ã€1024 ä¸‰å¼ å›¾ç‰‡ï¼Œä¹‹åè®¾ç½® `img` æ ‡ç­¾çš„ [srcset](https://www.w3schools.com/tags/att_source_srcset.asp) å±æ€§å³å¯å®ç°å›¾ç‰‡å“åº”å¼åŠŸèƒ½ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½ç®€å•åœ°é€šè¿‡ `size` å‚æ•°ç²¾ç¡®æ§åˆ¶ä¸åŒæ¡ä»¶ä¸‹çš„å›¾åƒå°ºå¯¸ï¼š

```css
.foo {
  background: url('./webpack.jpg?size=1024');
}

@media (max-width: 480px) {
  .foo {
    background: url('./webpack.jpg?size=300');
  }
}
```

- é™¤æœ¬æ–‡æåŠçš„åŸºæœ¬åŠŸèƒ½å¤–ï¼Œ[responsive-loader](https://www.npmjs.com/package/responsive-loader) è¿˜æä¾›äº†è®¸å¤šç”¨äºæ§åˆ¶äº§ç‰©ã€å‹ç¼©æ¯”ç­‰ç‰¹æ€§çš„é…ç½®é¡¹ï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯åˆ° [å®˜ç½‘](https://www.npmjs.com/package/responsive-loader) å±•å¼€é˜…è¯»ã€‚



## æ€»ç»“

åœ¨ Webpack 5 ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ `file-loader`ã€`url-loader` ç­‰ Loader åŠ è½½å›¾ç‰‡æˆ–å…¶å®ƒå¤šåª’ä½“èµ„æºæ–‡ä»¶ï¼Œè¿™äº›åŠ è½½å™¨å„æœ‰ä¾§é‡ç‚¹ï¼Œéœ€è¦æ ¹æ®å®é™…åœºæ™¯æ‹©ä¼˜é€‰ç”¨ï¼›è€Œ Webpack 5 ä¹‹åå¼•å…¥äº† [Asset Module](https://webpack.js.org/guides/asset-modules/) æ¨¡å‹ï¼Œè‡ªæ­¤æˆ‘ä»¬åªéœ€è¦è®¾ç½®é€‚å½“çš„ `module.rules.type` é…ç½®å³å¯ï¼Œä¸éœ€è¦ä¸ºå¤šåª’ä½“èµ„æºä¸“é—¨å¼•å…¥ Loaderã€‚

åœ¨åŠ è½½ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å€ŸåŠ© Webpack ç”Ÿæ€ä¸€ç³»åˆ—ç»„ä»¶ä½æˆæœ¬å®ç°å›¾åƒå‹ç¼©ã€é›ªç¢§å›¾ã€å“åº”å¼å›¾ç‰‡ç­‰ä¼˜åŒ–æªæ–½ï¼Œç›¸å…³æ ·ä¾‹å®ç°å·²æ±‡æ€»åˆ° [å°å†Œä»“åº“](https://github1s.com/Tecvan-fe/webpack-book-samples/blob/HEAD/load-img/webpack.config.js)ï¼Œå»ºè®®æ‹‰ä¸‹æ¥ä½“éªŒè¿è¡Œæ•ˆæœã€‚



## æ€è€ƒé¢˜

é™¤äº†æ–‡ç« æåŠçš„å„é¡¹ä¼˜åŒ–æªæ–½å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½å€ŸåŠ© Webpack å®ç°å“ªäº›å›¾åƒä¼˜åŒ–ï¼Ÿ



::: details chatgptç­”æ¡ˆ

é™¤äº†ä¹‹å‰æåˆ°çš„å›¾ç‰‡å‹ç¼©å’Œç”Ÿæˆ webp æ ¼å¼çš„å›¾ç‰‡ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¼˜åŒ–å›¾åƒï¼š

1. ä½¿ç”¨ image-loader åŠ è½½å›¾ç‰‡æ—¶ï¼Œå¯¹å›¾ç‰‡è¿›è¡Œè‡ªåŠ¨åŒ–çš„å‹ç¼©ã€ç¼©æ”¾ã€å‰ªè£ç­‰æ“ä½œï¼Œä»¥å‡å°‘ç½‘ç»œä¼ è¾“é‡å’Œé¡µé¢åŠ è½½æ—¶é—´ã€‚

2. é‡‡ç”¨æ‡’åŠ è½½æŠ€æœ¯ï¼Œå½“é¡µé¢æ»šåŠ¨åˆ°éœ€è¦æ˜¾ç¤ºå›¾ç‰‡æ—¶å†åŠ è½½ï¼Œå‡å°‘èµ·å§‹é¡µé¢åŠ è½½æ—¶é—´å’Œ HTTP è¯·æ±‚æ¬¡æ•°ã€‚

3. ä½¿ç”¨ CSS3 çš„ background-size å±æ€§å’Œ content å±æ€§è®¾ç½® base64 ç¼–ç çš„å›¾ç‰‡ï¼Œå¯ä»¥å‡å°‘å›¾ç‰‡çš„ HTTP è¯·æ±‚æ¬¡æ•°ï¼Œæé«˜é¡µé¢åŠ è½½é€Ÿåº¦ã€‚

4. ä½¿ç”¨ APP Shell æŠ€æœ¯å°†å¸¸ç”¨çš„å›¾ç‰‡é¢„å…ˆä¸‹è½½å¹¶ç¼“å­˜åˆ°æœ¬åœ°ï¼Œæé«˜ç”¨æˆ·ä½“éªŒå’Œå‡å°‘æµé‡æ¶ˆè€—ã€‚

:::



2023å¹´04æœˆ10æ—¥16:41:08
