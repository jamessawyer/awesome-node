import{_ as s,c as a,o as n,V as l}from"./chunks/framework.92797c73.js";const p="/awesome-node/assets/6-1.dee53f77.webp",d=JSON.parse('{"title":"","description":"","frontmatter":{"0":"J","1":"S","2":" ","3":"P","4":"a","5":"r","6":"s","7":"e","8":"r","9":"å†","10":"å²"},"headers":[],"relativePath":"book/babel/6.md","lastUpdated":1681888359000}'),o={name:"book/babel/6.md"},e=l('<p>å‰é¢æˆ‘ä»¬å­¦ä¹ äº† babel çš„ parser å’Œ ASTï¼Œbabel çš„ parser æ˜¯åŸºäº <code>acorn</code> æ‰©å±•è€Œæ¥çš„ï¼Œè€Œ acorn ä¹Ÿä¸æ˜¯æœ€æ—©çš„ js parserï¼Œjs parser çš„å†å²æ˜¯æ€æ ·çš„ï¼Ÿ å„ç§ parser ä¹‹é—´çš„å…³ç³»æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿè¿™èŠ‚æˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹ã€‚</p><h2 id="spidermonkey-å’Œ-estree-æ ‡å‡†" tabindex="-1">SpiderMonkey å’Œ estree æ ‡å‡† <a class="header-anchor" href="#spidermonkey-å’Œ-estree-æ ‡å‡†" aria-label="Permalink to &quot;SpiderMonkey å’Œ estree æ ‡å‡†&quot;">â€‹</a></h2><p>åœ¨ nodejs å‡ºç°ä¹‹åï¼Œå‰ç«¯å¯ä»¥ç”¨ nodejs æ¥åšä¸€äº›å·¥ç¨‹åŒ–çš„äº‹æƒ…ï¼Œä¹Ÿå°±æœ‰äº†å¯¹ js parser çš„éœ€æ±‚ï¼Œå½“æ—¶ Mozilla åœ¨ MDN ä¸Šå…¬å¸ƒäº† SpiderMonkeyï¼ˆc++ å†™çš„ js å¼•æ“ï¼‰çš„ parser api å’Œ AST æ ‡å‡†ï¼Œæ‰€ä»¥å½“æ—¶æœ€æ—©çš„ JS parser ---- <a href="https://github.com/jquery/esprima" target="_blank" rel="noreferrer">esprima</a> å°±æ˜¯åŸºäº SpiderMonkey çš„ AST æ ‡å‡†æ¥å®ç°çš„ï¼Œåæ¥å½¢æˆäº† <a href="https://github.com/estree/estree" target="_blank" rel="noreferrer">estree æ ‡å‡†</a>ã€‚ å½“æ—¶å¾ˆå¤šçš„å‰ç«¯é¢†åŸŸçš„å·¥å…·éƒ½åŸºäº esprimaã€‚</p><p>ä½†æ˜¯åˆ°äº† 2015 å¹´ä¹‹åï¼Œes æ ‡å‡†ä¸€å¹´ä¸€ä¸ªç‰ˆæœ¬ï¼Œè€Œ esprima çš„æ›´æ–°é€Ÿåº¦è·Ÿä¸ä¸Šï¼Œå®ƒè·Ÿä¸ä¸Šä¹Ÿå°±å¯¼è‡´äº†ä¾èµ–å®ƒçš„ä¸€ç³»åˆ—å·¥å…·éƒ½è·Ÿä¸ä¸Šï¼Œæ‰€ä»¥ eslint å°± fork äº†ä¸€ä»½ esprimaï¼Œåšäº†ä¸€äº›æ‰©å±•ï¼Œæ¥è‡ªå·±å®ç°æ–°è¯­æ³•çš„ parseï¼Œè¿™å°±æ˜¯ espreeï¼Œå®ƒä¾ç„¶æ˜¯ estree æ ‡å‡†çš„ã€‚</p><h2 id="acorn" tabindex="-1">acorn <a class="header-anchor" href="#acorn" aria-label="Permalink to &quot;acorn&quot;">â€‹</a></h2><p>åé¢å‡ºç°äº† acornï¼Œä¹Ÿæ˜¯ <code>estree</code> æ ‡å‡†çš„å®ç°ï¼Œä½†æ˜¯ä»–çš„é€Ÿåº¦æ¯” esprima å¿«ï¼Œè€Œä¸”æ”¯æŒæ’ä»¶ï¼Œå¯ä»¥é€šè¿‡æ’ä»¶æ‰©å±•è¯­æ³•æ”¯æŒã€‚æ­£æ˜¯é€Ÿåº¦å¿«åŠ ä¸Šæ”¯æŒæ’ä»¶è®©å¾ˆå¤šå·¥å…·éƒ½è½¬è€Œä½¿ç”¨ acornã€‚</p><p>eslint çš„ parser ---- espree æœ¬æ¥æ˜¯ fork è‡ª esprimaï¼Œä½†åæ¥ espree 2.0 åŸºäº acorn é‡æ–°å®ç°äº†ï¼Œä¹Ÿä½¿ç”¨ acorn çš„æ’ä»¶æœºåˆ¶æ¥æ‰©å±•è¯­æ³•ã€‚</p><p><code>babel parser</code>(babylon) ä¹Ÿæ˜¯åŸºäº acornï¼Œå¹¶ä¸”å¯¹ AST èŠ‚ç‚¹å’Œå±æ€§éƒ½åšäº†æ‰©å±•ï¼Œä¹Ÿæä¾›äº†ä¸€äº›æ”¯æŒ typescriptã€jsxã€flow çš„<strong>æ’ä»¶</strong>ï¼ˆå°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨ @babel/parser çš„ plugins é‡Œé¢æŒ‡å®šçš„é‚£äº›ï¼‰ã€‚</p><h2 id="js-parserä¹‹é—´çš„å…³ç³»" tabindex="-1">JS Parserä¹‹é—´çš„å…³ç³» <a class="header-anchor" href="#js-parserä¹‹é—´çš„å…³ç³»" aria-label="Permalink to &quot;JS Parserä¹‹é—´çš„å…³ç³»&quot;">â€‹</a></h2><p><img src="'+p+`" alt="JS Parsers"></p><p>å®ƒä»¬çš„å…³ç³»å¦‚å›¾æ‰€ç¤ºï¼Œestree æ ‡å‡†æ˜¯åŸºäº SpiderMonkey çš„ AST æ ‡å‡†æ‰©å±•çš„ï¼Œå®ƒçš„å®ç°æœ‰ esprimaã€acorn ç­‰ï¼Œç°åœ¨ espreeã€babel parser éƒ½æ˜¯åŸºäºacornåšçš„æ‰©å±•ï¼Œå› ä¸º acorn æä¾›äº†æ’ä»¶æœºåˆ¶ã€‚</p><p>å½“ç„¶ä¹Ÿä¸æ˜¯æ‰€æœ‰çš„ js parser éƒ½æ˜¯ estree æ ‡å‡†çš„ï¼Œæ¯”å¦‚ terserã€typescript ç­‰éƒ½æœ‰è‡ªå·±çš„ AST æ ‡å‡†ã€‚</p><h2 id="babel-parserå¯¹estree-astçš„æ‰©å±•" tabindex="-1">babel parserå¯¹estree ASTçš„æ‰©å±• <a class="header-anchor" href="#babel-parserå¯¹estree-astçš„æ‰©å±•" aria-label="Permalink to &quot;babel parserå¯¹estree ASTçš„æ‰©å±•&quot;">â€‹</a></h2><p><code>babel</code> åŸºäº <strong>acorn æ’ä»¶</strong>å¯¹ estree AST åšäº†å¦‚ä¸‹æ‰©å±•:</p><ol><li>æŠŠ <code>Literal</code> æ›¿æ¢æˆäº† <code>StringLiteralã€NumericLiteralã€ BigIntLiteralã€ BooleanLiteralã€ NullLiteralã€ RegExpLiteral</code></li><li>æŠŠ <code>Property</code> æ›¿æ¢æˆäº† <code>ObjectProperty</code> å’Œ <code>ObjectMethod</code></li><li>æŠŠ <code>MethodDefinition</code> æ›¿æ¢æˆäº† <code>ClassMethod</code></li><li>Program å’Œ BlockStatement æ”¯æŒäº† <code>directives</code> å±æ€§ï¼Œä¹Ÿå°±æ˜¯ &#39;use strict&#39; ç­‰æŒ‡ä»¤çš„è§£æï¼Œå¯¹åº”çš„ ast æ˜¯ Directive å’Œ DirectiveLiteral</li><li>ChainExpression æ›¿æ¢ä¸ºäº† ObjectMemberExpression å’Œ OptionalCallExpression</li><li>ImportExpression æ›¿æ¢ä¸ºäº† CallExpression å¹¶ä¸” callee å±æ€§è®¾ç½®ä¸º Import</li></ol><p>è¿™äº›å¯ä»¥åœ¨ <a href="https://babeljs.io/docs/en/babel-parser#output" target="_blank" rel="noreferrer">babel parser çš„æ–‡æ¡£</a>é‡Œçœ‹åˆ°ã€‚</p><h2 id="acornæ’ä»¶" tabindex="-1">acornæ’ä»¶ <a class="header-anchor" href="#acornæ’ä»¶" aria-label="Permalink to &quot;acornæ’ä»¶&quot;">â€‹</a></h2><p>babel parser åŸºäº acorn æ‰©å±•äº†ä¸€äº›è¯­æ³•ï¼Œé‚£å®ƒæ˜¯æ€ä¹ˆæ‰©å±•çš„å‘¢ï¼Ÿ æˆ‘ä»¬å†™ä¸€ä¸ª acorn æ’ä»¶æ¥æ„Ÿå—ä¸€ä¸‹ã€‚</p><p>acorn ä¸»è¦æ˜¯ä¸€ä¸ª <code>Parser</code> ç±»ï¼Œä¸åŒçš„æ–¹æ³•å®ç°äº†ä¸åŒçš„é€»è¾‘ï¼Œæ’ä»¶æ‰©å±•å°±æ˜¯<strong>ç»§æ‰¿</strong>è¿™ä¸ª Parserï¼Œé‡å†™ä¸€äº›æ–¹æ³•ã€‚</p><p>acorn çš„ api å¦‚ä¸‹ï¼Œå…¶ä¸­ <code>acorn-jsx</code>ã€<code>acorn-bigint</code> å°±æ˜¯ acorn æ’ä»¶</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">type</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#FFCB6B;font-style:italic;">import(&#39;acorn&#39;)</span><span style="color:#89DDFF;font-style:italic;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> Parser </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">acorn</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> MyParser </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Parser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">extend</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">acorn-jsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">acorn-bigint</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(MyParser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">// Some bigint + JSX code</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span></span></code></pre></div><details class="details custom-block"><summary>å®‰è£…ä¾èµ–</summary><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-D</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">acorn</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">acorn-jsx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">acorn-bigint</span></span></code></pre></div></details><p><strong>æ’ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶ä¹‹å‰çš„ Parserï¼Œè¿”å›æ‰©å±•ä»¥åçš„ Parser</strong></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">noisyReadToken</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">Parser</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">class</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">extends</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Parser</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    readToken</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">code</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Reading a token!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readToken</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>æ¥ä¸‹æ¥æˆ‘ä»¬å†™ä¸€ä¸ªacornæ’ä»¶ï¼š<strong>ç»™ javascript ä¸€ä¸ªå…³é”®å­— <code>guang</code>ï¼Œå¯ä»¥ä½œä¸º <code>statement</code> å•ç‹¬ä½¿ç”¨</strong></p><p>ğŸ’¡æˆ‘ä»¬çŸ¥é“ parse çš„è¿‡ç¨‹å…¶å®å°±æ˜¯<code>åˆ†è¯</code> + <code>ç»„è£… AST</code>è¿™ä¸¤æ­¥ï¼ˆä¸€èˆ¬å«è¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æï¼‰ï¼Œæˆ‘ä»¬åªè¦å®ç°è¿™ä¸¤æ­¥å°±å¯ä»¥äº†ã€‚</p><h3 id="åˆ†è¯-è¯æ³•åˆ†æ" tabindex="-1">åˆ†è¯ï¼ˆè¯æ³•åˆ†æï¼‰ <a class="header-anchor" href="#åˆ†è¯-è¯æ³•åˆ†æ" aria-label="Permalink to &quot;åˆ†è¯ï¼ˆè¯æ³•åˆ†æï¼‰&quot;">â€‹</a></h3><p>æˆ‘ä»¬æ˜¯æƒ³å¢åŠ ä¸€ä¸ª<code>å…³é”®å­—</code>ï¼Œacorn æœ‰ <code>keywords</code> å±æ€§ï¼Œæ˜¯ä¸€ä¸ª<strong>æ­£åˆ™è¡¨è¾¾å¼</strong>ï¼Œç”¨æ¥åšå…³é”®å­—æ‹†åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡å†™ keywords å±æ€§å°±å¯ä»¥ã€‚å¹¶ä¸”è¿˜è¦ä¸ºæ–°çš„å…³é”®å­—æ³¨å†Œä¸€ä¸ª <code>token</code> ç±»å‹ã€‚</p><p>acorn Parser çš„å…¥å£æ–¹æ³•æ˜¯ parseï¼Œæˆ‘ä»¬è¦åœ¨ parse æ–¹æ³•é‡Œé¢è®¾ç½® keywordsã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">(program) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newKeywords</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this const class extends export import super</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newKeywords</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">// å¢åŠ ä¸€ä¸ªå…³é”®å­—</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">keywords</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">RegExp</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">^(?:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newKeywords</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">g</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">)$</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">program</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ç„¶åæ³¨å†Œä¸€ä¸ªæ–°çš„ token ç±»å‹æ¥æ ‡è¯†å®ƒ</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">Parser</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">acorn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">keywordTypes[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">TokenType</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">keyword</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>è¿™æ · acorn å°±ä¼šåœ¨ parse çš„æ—¶å€™åˆ†å‡º <code>guang</code> è¿™ä¸ªå…³é”®å­—</p><h3 id="ç»„è£…ast-è¯­æ³•åˆ†æ" tabindex="-1">ç»„è£…ASTï¼ˆè¯­æ³•åˆ†æï¼‰ <a class="header-anchor" href="#ç»„è£…ast-è¯­æ³•åˆ†æ" aria-label="Permalink to &quot;ç»„è£…ASTï¼ˆè¯­æ³•åˆ†æï¼‰&quot;">â€‹</a></h3><p>å…‰åˆ†å‡º token æ˜¯æ²¡æ„ä¹‰çš„ï¼Œè¦ç»„è£…åˆ° AST ä¸­ã€‚</p><p>acorn åœ¨ parse åˆ°ä¸åŒç±»å‹çš„èŠ‚ç‚¹ä¼šè°ƒç”¨ä¸åŒçš„ parseXxx æ–¹æ³•ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯åœ¨ statement é‡Œé¢ç”¨ï¼Œé‚£ä¹ˆå°±è¦é‡å†™ <code>parseStatement</code> æ–¹æ³•ï¼Œåœ¨é‡Œé¢ç»„è£…æ–°çš„ statement èŠ‚ç‚¹ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">parseStatement</span><span style="color:#A6ACCD;">(context</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> topLevel</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">exports</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tokenType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">tokenType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Parser</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">acorn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">keywordTypes</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">startNode</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">finishNode</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">},</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GuangStatement</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parseStatement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">topLevel</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">exports</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><ul><li><code>this.type</code> æ˜¯å½“å‰å¤„ç†åˆ°çš„ token çš„ç±»å‹ï¼Œ <code>this.next</code> æ˜¯æ¶ˆè´¹è¿™ä¸ª tokenï¼Œæˆ‘ä»¬è¯†åˆ«å‡º token çš„ç±»å‹ä¸º <code>guang</code> çš„æ—¶å€™ï¼Œå°±ç»„è£…æˆä¸€ä¸ª ASTã€‚</li><li>é€šè¿‡ <code>this.startNode()</code> åˆ›å»ºä¸€ä¸ªæ–°çš„ASTèŠ‚ç‚¹ï¼Œç„¶å <code>this.next()</code> æ¶ˆè´¹æ‰è¿™ä¸ª tokenï¼Œä¹‹åè¿”å›æ–°çš„ AST èŠ‚ç‚¹ã€‚</li><li>å¦‚æœä¸æ˜¯æˆ‘ä»¬æ‰©å±•çš„ tokenï¼Œåˆ™è°ƒç”¨çˆ¶ç±»çš„ <code>parseStatement</code> å¤„ç†ã€‚</li><li>è¿™æ ·èƒ½æˆåŠŸåˆ†å‡ºtokenï¼Œä½†æ˜¯æœ€å¥½æŠŠå®ƒç‹¬ç«‹æˆä¸€ä¸ªæ–¹æ³•ï¼Œè¿™æ ·å­ç±»å¯ä»¥è¦†ç›–è¿™ä¸ªæ–¹æ³•æ¥å¯¹ parse é€»è¾‘åšä¿®æ”¹ã€‚</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">parseStatement</span><span style="color:#A6ACCD;">(context</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> topLevel</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">exports</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tokenType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">tokenType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Parser</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">acorn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">keywordTypes</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">startNode</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">parseGuangStatement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parseStatement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">topLevel</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">exports</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">parseGuangStatement</span><span style="color:#A6ACCD;">(node) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">finishNode</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GuangStatement</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">type</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#FFCB6B;font-style:italic;">import(&#39;acorn&#39;)</span><span style="color:#89DDFF;font-style:italic;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> Parser</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> TokenType </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">acorn</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Parser</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">acorn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">keywordTypes[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">TokenType</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">keyword</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">wordsRegexp</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">words</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">RegExp</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">^(?:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">words</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">g</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">)$</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#FFCB6B;font-style:italic;">Parser</span><span style="color:#89DDFF;font-style:italic;">}</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">Parser</span><span style="color:#676E95;font-style:italic;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> guangKeywordPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">Parser</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">class</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">extends</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Parser</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    parse</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">program</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newKeywords</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this const class extends export import super</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">newKeywords</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">keywords</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">RegExp</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">^(?:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newKeywords</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">g</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">)$</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// this.keywords = wordsRegexp(newKeywords)</span></span>
<span class="line"><span style="color:#F07178;">      </span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ğŸš¨æ³¨æ„è¿™é‡Œçš„ \`return\` æ˜¯ä¸€ä¸ªå‡½æ•°</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">program</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    parseStatement</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">context</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">topLevel</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">exports</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">startType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">type</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">startType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Parser</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">acorn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">keywordTypes</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">startNode</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">parseGuangState</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parseStatement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">topLevel</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">exports</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    parseGuangState</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">node</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">finishNode</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> value</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GuangStatement</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> newParser </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Parser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">extend</span><span style="color:#A6ACCD;">(guangKeywordPlugin)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> program </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">    guang</span></span>
<span class="line"><span style="color:#C3E88D;">    const a = 1</span></span>
<span class="line"><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ä¸ºäº†é¿å…è­¦å‘Šï¼Œæ·»åŠ  \`{ ecmaVersion: 2020 }\` options</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Since Acorn 8.0.0, options.ecmaVersion is required.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Defaulting to 2020, but this will stop working in the future.</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> ast </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> newParser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">(program</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">ecmaVersion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2020</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(ast)</span></span></code></pre></div><p>æˆ‘ä»¬æ‰§è¡Œä¸‹è¯•ä¸‹æ•ˆæœï¼Œäº§ç”Ÿçš„ASTå¦‚ä¸‹ï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">Node</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">type</span><span style="color:#FFCB6B;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Program</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">start:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#C3E88D;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  end: </span><span style="color:#F78C6C;">27</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">body:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    { value: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, type: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GuangStatement</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, end: </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;"> },</span></span>
<span class="line"><span style="color:#A6ACCD;">    Node {</span></span>
<span class="line"><span style="color:#A6ACCD;">      type: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">VariableDeclaration</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      start: </span><span style="color:#F78C6C;">15</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      end: </span><span style="color:#F78C6C;">26</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      declarations: </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">Array</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      kind: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">const</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">sourceType:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">script</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><p>å°±è¿™æ ·æˆ‘ä»¬å®ç°äº†æ–°çš„ AST èŠ‚ç‚¹ğŸ‰ã€‚</p><p>é€šè¿‡è¿™ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬èƒ½å¤§æ¦‚ç†è§£ babel æ˜¯æ€ä¹ˆåŸºäº acorn å®ç° typescriptã€jsxã€flow è¯­æ³•è§£æçš„äº†ã€‚</p><p>ğŸŒ°æ¯”å¦‚ Literal æ‰©å±•äº† StringLiteralã€NumericLiteral ç­‰è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå·±å®ç°ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">parseLiteral</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">args) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parseLiteral</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">args</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">switch</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">number</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">NumericLiteral</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">break</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">StringLiteral</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">break</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="æ€»ç»“" tabindex="-1">æ€»ç»“ <a class="header-anchor" href="#æ€»ç»“" aria-label="Permalink to &quot;æ€»ç»“&quot;">â€‹</a></h2><p>è¿™ä¸€èŠ‚æˆ‘ä»¬äº†è§£äº† js parser çš„å†å²ï¼Œä» SpiderMonkey çš„ AST æ ‡å‡†å¼€å§‹ï¼Œæ‰©å±•åˆ° espree çš„æ ‡å‡†ï¼Œæœ€æ—©çš„ estree æ ‡å‡†çš„å®ç°æ˜¯ esprimaï¼Œä½†æ˜¯éšç€ es2015 å¼€å§‹ä¸€å¹´ä¸€ä¸ªç‰ˆæœ¬ï¼Œesprima çš„è¿­ä»£é€Ÿåº¦é€æ¸è·Ÿä¸ä¸Šäº†ï¼Œè¿™æ—¶å€™ <code>acorn</code> æµè¡Œèµ·æ¥ï¼Œå› ä¸ºé€Ÿåº¦æ›´å¿«ï¼Œè€Œä¸”æ”¯æŒæ’ä»¶æ‰©å±•ï¼Œäºæ˜¯ espreeã€babel parser(babylon) ç­‰éƒ½åŸºäº acorn æ¥å®ç°å„è‡ªçš„ parserã€‚è™½ç„¶ estree ç³»åˆ—çš„ js parser æŒºå¤šçš„ï¼Œä½†ä¹Ÿä¸æ˜¯å…¨éƒ¨ï¼Œterserã€typescript ç­‰éƒ½æ˜¯ç”¨è‡ªå·±çš„ASTã€‚</p><p>å­¦å®Œè¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬æ›´å…¨é¢çš„äº†è§£äº† js parser çš„å†å²ï¼Œå¯¹å„ç§å·¥å…·æ‰€ç”¨çš„ parser ä¹‹é—´çš„å…³ç³»æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œå¹¶ä¸”è¿˜çŸ¥é“äº† acorn çš„è¯­æ³•æ’ä»¶è¯¥æ€ä¹ˆå†™ã€‚</p><p>æºç åœ°å€ï¼š</p><ul><li><a href="https://github.com/QuarkGluonPlasma/babel-plugin-exercize" target="_blank" rel="noreferrer">babel-plugin-exercise - @github</a> å»ºè®® git clone ä¸‹æ¥é€šè¿‡ node è·‘ä¸€ä¸‹</li></ul><p>2023å¹´04æœˆ06æ—¥11:18:23</p>`,53),t=[e];function r(c,y,F,D,i,A){return n(),a("div",null,t)}const u=s(o,[["render",r]]);export{d as __pageData,u as default};
