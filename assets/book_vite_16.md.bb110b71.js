import{_ as n,c as a,o as l,b as p}from"./app.ccfa5d92.js";const o="/awesome-node/assets/16-1.d8509c8b.webp",e="/awesome-node/assets/16-2.2d780522.webp",s="/awesome-node/assets/16-3.5ce92950.webp",t="/awesome-node/assets/16-4.2e9d7c1d.webp",c="/awesome-node/assets/16-5.391adb85.webp",r="/awesome-node/assets/16-6.12fb5d04.webp",y="/awesome-node/assets/16-7.03c460f2.webp",F="/awesome-node/assets/16-8.859dd497.webp",D="/awesome-node/assets/16-9.3060cd71.webp",i="/awesome-node/assets/16-10.76a8b1f0.webp",b=JSON.parse('{"title":"Vite SSR","description":"","frontmatter":{"title":"Vite SSR"},"headers":[{"level":2,"title":"SSR åŸºæœ¬æ¦‚å¿µ","slug":"ssr-åŸºæœ¬æ¦‚å¿µ","link":"#ssr-åŸºæœ¬æ¦‚å¿µ","children":[]},{"level":2,"title":"SSR ç”Ÿå‘½å‘¨æœŸåˆ†æ","slug":"ssr-ç”Ÿå‘½å‘¨æœŸåˆ†æ","link":"#ssr-ç”Ÿå‘½å‘¨æœŸåˆ†æ","children":[]},{"level":2,"title":"åŸºäº Vite æ­å»º SSR é¡¹ç›®","slug":"åŸºäº-vite-æ­å»º-ssr-é¡¹ç›®","link":"#åŸºäº-vite-æ­å»º-ssr-é¡¹ç›®","children":[{"level":3,"title":"1. SSR æ„å»º API","slug":"_1-ssr-æ„å»º-api","link":"#_1-ssr-æ„å»º-api","children":[]},{"level":3,"title":"2. é¡¹ç›®éª¨æ¶æ­å»º","slug":"_2-é¡¹ç›®éª¨æ¶æ­å»º","link":"#_2-é¡¹ç›®éª¨æ¶æ­å»º","children":[]},{"level":3,"title":"3. SSR è¿è¡Œæ—¶å®ç°","slug":"_3-ssr-è¿è¡Œæ—¶å®ç°","link":"#_3-ssr-è¿è¡Œæ—¶å®ç°","children":[]},{"level":3,"title":"4. ç”Ÿäº§ç¯å¢ƒçš„ CSR èµ„æºå¤„ç†","slug":"_4-ç”Ÿäº§ç¯å¢ƒçš„-csr-èµ„æºå¤„ç†","link":"#_4-ç”Ÿäº§ç¯å¢ƒçš„-csr-èµ„æºå¤„ç†","children":[]}]},{"level":2,"title":"å·¥ç¨‹åŒ–é—®é¢˜","slug":"å·¥ç¨‹åŒ–é—®é¢˜","link":"#å·¥ç¨‹åŒ–é—®é¢˜","children":[{"level":3,"title":"1. è·¯ç”±ç®¡ç†","slug":"_1-è·¯ç”±ç®¡ç†","link":"#_1-è·¯ç”±ç®¡ç†","children":[]},{"level":3,"title":"2. å…¨å±€çŠ¶æ€ç®¡ç†","slug":"_2-å…¨å±€çŠ¶æ€ç®¡ç†","link":"#_2-å…¨å±€çŠ¶æ€ç®¡ç†","children":[]},{"level":3,"title":"3. CSR é™çº§","slug":"_3-csr-é™çº§","link":"#_3-csr-é™çº§","children":[]},{"level":3,"title":"4. æµè§ˆå™¨ API å…¼å®¹","slug":"_4-æµè§ˆå™¨-api-å…¼å®¹","link":"#_4-æµè§ˆå™¨-api-å…¼å®¹","children":[]},{"level":3,"title":"5. è‡ªå®šä¹‰ Head","slug":"_5-è‡ªå®šä¹‰-head","link":"#_5-è‡ªå®šä¹‰-head","children":[]},{"level":3,"title":"6. æµå¼æ¸²æŸ“","slug":"_6-æµå¼æ¸²æŸ“","link":"#_6-æµå¼æ¸²æŸ“","children":[]},{"level":3,"title":"7. SSR ç¼“å­˜","slug":"_7-ssr-ç¼“å­˜","link":"#_7-ssr-ç¼“å­˜","children":[]},{"level":3,"title":"8. æ€§èƒ½ç›‘æ§","slug":"_8-æ€§èƒ½ç›‘æ§","link":"#_8-æ€§èƒ½ç›‘æ§","children":[]},{"level":3,"title":"9. SSG/ISR/SPR","slug":"_9-ssg-isr-spr","link":"#_9-ssg-isr-spr","children":[]}]},{"level":2,"title":"å°ç»“","slug":"å°ç»“","link":"#å°ç»“","children":[]}],"relativePath":"book/vite/16.md","lastUpdated":1677478874000}'),C={name:"book/vite/16.md"},A=p(`<p>åœ¨éå¸¸æ—©æœŸçš„ Web æŠ€æœ¯ä¸­ï¼Œå¤§å®¶è¿˜æ˜¯ä½¿ç”¨ JSP è¿™ç§å¤è€çš„æ¨¡æ¿è¯­æ³•æ¥ç¼–å†™å‰ç«¯çš„é¡µé¢ï¼Œç„¶åç›´æ¥å°† JSP æ–‡ä»¶æ”¾åˆ°æœåŠ¡ç«¯ï¼Œåœ¨æœåŠ¡ç«¯å¡«å…¥æ•°æ®å¹¶æ¸²æŸ“å‡ºå®Œæ•´çš„é¡µé¢å†…å®¹ï¼Œå¯ä»¥è¯´é‚£ä¸ªæ—¶ä»£çš„åšæ³•æ˜¯å¤©ç„¶çš„æœåŠ¡ç«¯æ¸²æŸ“ã€‚ä½†éšç€ AJAX æŠ€æœ¯çš„æˆç†Ÿä»¥åŠå„ç§å‰ç«¯æ¡†æ¶(å¦‚ Vueã€React)çš„å…´èµ·ï¼Œå‰åç«¯åˆ†ç¦»çš„å¼€å‘æ¨¡å¼é€æ¸æˆä¸ºå¸¸æ€ï¼Œå‰ç«¯åªè´Ÿè´£é¡µé¢ UI åŠé€»è¾‘çš„å¼€å‘ï¼Œè€ŒæœåŠ¡ç«¯åªè´Ÿè´£æä¾›æ•°æ®æ¥å£ï¼Œè¿™ç§å¼€å‘æ–¹å¼ä¸‹çš„é¡µé¢æ¸²æŸ“ä¹Ÿå«<code>å®¢æˆ·ç«¯æ¸²æŸ“</code>(Client Side Renderï¼Œç®€ç§° CSR)ã€‚</p><p>ä½†å®¢æˆ·ç«¯æ¸²æŸ“ä¹Ÿå­˜åœ¨ç€ä¸€å®šçš„é—®é¢˜ï¼Œä¾‹å¦‚é¦–å±åŠ è½½æ¯”è¾ƒæ…¢ã€å¯¹ SEO ä¸å¤ªå‹å¥½ï¼Œå› æ­¤ SSR (Server Side Render)å³æœåŠ¡ç«¯æ¸²æŸ“æŠ€æœ¯åº”è¿è€Œç”Ÿï¼Œå®ƒåœ¨ä¿ç•™ CSR æŠ€æœ¯æ ˆçš„åŒæ—¶ï¼Œä¹Ÿèƒ½è§£å†³ CSR çš„å„ç§é—®é¢˜ã€‚</p><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥èŠèŠSSRï¼Œè¯´è¯´å®ƒçš„åŸºæœ¬åŸç†ï¼Œä»¥åŠå¦‚ä½•å€ŸåŠ© Vite çš„å„é¡¹æ„å»ºèƒ½åŠ›å®ç° SSRï¼Œè®©ä½ ä½“ä¼šåˆ° SSR çš„å„ä¸ªç”Ÿå‘½å‘¨æœŸæ˜¯å¦‚ä½•ä¸²è”èµ·æ¥çš„ã€‚</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæœ¬èŠ‚æœ€ç»ˆçš„ç›®çš„å¹¶ä¸æ˜¯è®©å¤§å®¶å­¦ä¹ æŸä¸ªç°æœ‰çš„ SSR è§£å†³æ–¹æ¡ˆ(å¦‚ Nuxt)ï¼Œæˆ–è€…ç®€å•äº†è§£ä¸€ä¸‹å®ç°åŸç†ï¼Œè€Œæ˜¯æ•™å¤§å®¶å¦‚ä½•ä»åº•å±‚å¼€å§‹æ‰‹åŠ¨æ­å»ºä¸€ä¸ªå¯ä»¥æ·±åº¦å®šåˆ¶çš„ SSR é¡¹ç›®ï¼Œå¹¶ä¸”è§£å†³å„ç§ SSR ä¸­çš„å·¥ç¨‹åŒ–é—®é¢˜ã€‚</p></div><h2 id="ssr-åŸºæœ¬æ¦‚å¿µ" tabindex="-1">SSR åŸºæœ¬æ¦‚å¿µ <a class="header-anchor" href="#ssr-åŸºæœ¬æ¦‚å¿µ" aria-hidden="true">#</a></h2><p>é¦–å…ˆæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ CSR çš„é—®é¢˜ï¼Œå®ƒçš„ HTML äº§ç‰©ä¸€èˆ¬æ˜¯å¦‚ä¸‹çš„ç»“æ„:</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">link</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">rel</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">stylesheet</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xxx.css</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">&lt;!-- ä¸€å¼€å§‹æ²¡æœ‰é¡µé¢å†…å®¹ --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">&lt;!-- é€šè¿‡ JS æ‰§è¡Œæ¥æ¸²æŸ“é¡µé¢ --&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">  &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xxx.chunk.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>é¡ºä¾¿æˆ‘ä»¬ä¹Ÿå›é¡¾ä¸€ä¸‹æµè§ˆå™¨çš„æ¸²æŸ“æµç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="`+o+'" alt="browseræ¸²æŸ“æµç¨‹"></p><p>å½“æµè§ˆå™¨æ‹¿åˆ°å¦‚ä¸Šçš„ HTML å†…å®¹ä¹‹åï¼Œå…¶å®å¹¶ä¸èƒ½æ¸²æŸ“å®Œæ•´çš„é¡µé¢å†…å®¹ï¼Œå› ä¸ºæ­¤æ—¶çš„ body ä¸­åŸºæœ¬åªæœ‰ä¸€ä¸ªç©ºçš„ div èŠ‚ç‚¹ï¼Œå¹¶æ²¡æœ‰å¡«å…¥çœŸæ­£çš„é¡µé¢å†…å®¹ã€‚è€Œæ¥ä¸‹æ¥æµè§ˆå™¨å¼€å§‹ä¸‹è½½å¹¶æ‰§è¡Œ JS ä»£ç ï¼Œç»å†äº†æ¡†æ¶åˆå§‹åŒ–ã€æ•°æ®è¯·æ±‚ã€DOM æ’å…¥ç­‰æ“ä½œä¹‹åæ‰èƒ½æ¸²æŸ“å‡ºå®Œæ•´çš„é¡µé¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ CSR ä¸­å®Œæ•´çš„é¡µé¢å†…å®¹æœ¬è´¨ä¸Šé€šè¿‡ JS ä»£ç æ‰§è¡Œä¹‹åæ‰èƒ½å¤Ÿæ¸²æŸ“ã€‚è¿™ä¸»è¦ä¼šå¯¼è‡´ä¸¤ä¸ªæ–¹é¢çš„é—®é¢˜:</p><ol><li><strong>é¦–å±åŠ è½½é€Ÿåº¦æ¯”è¾ƒæ…¢</strong>ã€‚é¦–å±åŠ è½½éœ€è¦ä¾èµ– JS çš„æ‰§è¡Œï¼Œä¸‹è½½å’Œæ‰§è¡Œ JS éƒ½å¯èƒ½æ˜¯éå¸¸è€—æ—¶çš„æ“ä½œï¼Œå°¤å…¶æ˜¯åœ¨ä¸€äº›ç½‘ç»œä¸ä½³çš„åœºæ™¯ï¼Œæˆ–è€…æ€§èƒ½æ•æ„Ÿçš„ä½ç«¯æœºä¸‹ã€‚</li><li><strong>å¯¹ SEO(æœç´¢å¼•æ“ä¼˜åŒ–) ä¸å‹å¥½</strong>ã€‚é¡µé¢ HTML æ²¡æœ‰å…·ä½“çš„é¡µé¢å†…å®¹ï¼Œå¯¼è‡´æœç´¢å¼•æ“çˆ¬è™«æ— æ³•è·å–å…³é”®è¯ä¿¡æ¯ï¼Œå¯¼è‡´ç½‘ç«™æ’åå—åˆ°å½±å“ã€‚</li></ol><p>é‚£ä¹ˆ SSR æ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜çš„å‘¢ï¼Ÿ</p><p>åœ¨ SSR çš„åœºæ™¯ä¸‹ï¼ŒæœåŠ¡ç«¯ç”Ÿæˆå¥½<strong>å®Œæ•´çš„ HTML å†…å®¹</strong>ï¼Œç›´æ¥è¿”å›ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨èƒ½å¤Ÿæ ¹æ® HTML æ¸²æŸ“å‡ºå®Œæ•´çš„é¦–å±å†…å®¹ï¼Œè€Œä¸éœ€è¦ä¾èµ– JS çš„åŠ è½½ï¼Œè¿™æ ·ä¸€æ–¹é¢èƒ½å¤Ÿé™ä½é¦–å±æ¸²æŸ“çš„æ—¶é—´ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿèƒ½å°†å®Œæ•´çš„é¡µé¢å†…å®¹å±•ç°ç»™æœç´¢å¼•æ“çš„çˆ¬è™«ï¼Œåˆ©äº SEOã€‚</p><p>å½“ç„¶ï¼ŒSSR ä¸­åªèƒ½ç”Ÿæˆé¡µé¢çš„å†…å®¹å’Œç»“æ„ï¼Œå¹¶ä¸èƒ½å®Œæˆäº‹ä»¶ç»‘å®šğŸ“šï¼Œå› æ­¤éœ€è¦åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œ CSR çš„ JS è„šæœ¬ï¼Œå®Œæˆäº‹ä»¶ç»‘å®šï¼Œè®©é¡µé¢æ‹¥æœ‰äº¤äº’çš„èƒ½åŠ›ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä½œ<code>hydrate</code>(ç¿»è¯‘ä¸º<code>æ³¨æ°´</code>æˆ–è€…<code>æ¿€æ´»</code>)ã€‚åŒæ—¶ï¼Œåƒè¿™æ ·æœåŠ¡ç«¯æ¸²æŸ“ + å®¢æˆ·ç«¯ hydrate çš„åº”ç”¨ä¹Ÿè¢«ç§°ä¸º<code>åŒæ„åº”ç”¨</code>ã€‚</p><h2 id="ssr-ç”Ÿå‘½å‘¨æœŸåˆ†æ" tabindex="-1">SSR ç”Ÿå‘½å‘¨æœŸåˆ†æ <a class="header-anchor" href="#ssr-ç”Ÿå‘½å‘¨æœŸåˆ†æ" aria-hidden="true">#</a></h2><p>å‰é¢æˆ‘ä»¬æåˆ°äº† SSR ä¼šåœ¨æœåŠ¡ç«¯(è¿™é‡Œä¸»è¦æŒ‡ Node.js ç«¯)æå‰æ¸²æŸ“å‡ºå®Œæ•´çš„ HTML å†…å®¹ï¼Œé‚£è¿™æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿ</p><p>é¦–å…ˆéœ€è¦ä¿è¯å‰ç«¯çš„ä»£ç ç»è¿‡ç¼–è¯‘åæ”¾åˆ°æœåŠ¡ç«¯ä¸­èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œï¼Œå…¶æ¬¡åœ¨æœåŠ¡ç«¯æ¸²æŸ“å‰ç«¯ç»„ä»¶ï¼Œç”Ÿæˆå¹¶ç»„è£…åº”ç”¨çš„ HTMLã€‚è¿™å°±æ¶‰åŠåˆ° SSR åº”ç”¨çš„ä¸¤å¤§ç”Ÿå‘½å‘¨æœŸ: <code>æ„å»ºæ—¶</code>å’Œ<code>è¿è¡Œæ—¶</code>ï¼Œæˆ‘ä»¬ä¸å¦¨æ¥ä»”ç»†æ¢³ç†ä¸€ä¸‹ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<code>æ„å»ºæ—¶</code>éœ€è¦åšå“ªäº›äº‹æƒ…:</p><ol><li><p><strong>è§£å†³æ¨¡å—åŠ è½½é—®é¢˜</strong>ã€‚åœ¨åŸæœ‰çš„æ„å»ºè¿‡ç¨‹ä¹‹å¤–ï¼Œéœ€è¦åŠ å…¥<code>SSR æ„å»º</code>çš„è¿‡ç¨‹ ï¼Œå…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦å¦å¤–ç”Ÿæˆä¸€ä»½ <code>CommonJS</code> æ ¼å¼çš„äº§ç‰©ï¼Œä½¿ä¹‹èƒ½åœ¨ Node.js æ­£å¸¸åŠ è½½ã€‚å½“ç„¶ï¼Œéšç€ Node.js æœ¬èº«å¯¹ ESM çš„æ”¯æŒè¶Šæ¥è¶Šæˆç†Ÿï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¤ç”¨å‰ç«¯ ESM æ ¼å¼çš„ä»£ç ï¼ŒVite åœ¨å¼€å‘é˜¶æ®µè¿›è¡Œ SSR æ„å»ºä¹Ÿæ˜¯è¿™æ ·çš„æ€è·¯ã€‚</p><p><img src="'+e+`" alt="SSRæ„å»ºæµç¨‹"></p></li><li><p><strong>ç§»é™¤æ ·å¼ä»£ç çš„å¼•å…¥</strong>ã€‚ç›´æ¥å¼•å…¥ä¸€è¡Œ css åœ¨æœåŠ¡ç«¯å…¶å®æ˜¯æ— æ³•æ‰§è¡Œçš„ï¼Œå› ä¸º Node.js å¹¶ä¸èƒ½è§£æ CSS çš„å†…å®¹ã€‚ä½† <code>CSS Modules</code> çš„æƒ…å†µé™¤å¤–ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> styles </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.module.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è¿™é‡Œçš„ styles æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚{ &quot;container&quot;: &quot;xxx&quot; }ï¼Œè€Œä¸æ˜¯ CSS ä»£ç </span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(styles)</span></span>
<span class="line"></span></code></pre></div></li><li><p><strong>ä¾èµ–å¤–éƒ¨åŒ–(external)</strong>ã€‚å¯¹äºæŸäº›ç¬¬ä¸‰æ–¹ä¾èµ–æˆ‘ä»¬å¹¶ä¸éœ€è¦ä½¿ç”¨æ„å»ºåçš„ç‰ˆæœ¬ï¼Œè€Œæ˜¯ç›´æ¥ä» <code>node_modules</code> ä¸­è¯»å–ï¼Œæ¯”å¦‚ <code>react-dom</code>ï¼Œè¿™æ ·åœ¨ <code>SSR æ„å»º</code>çš„è¿‡ç¨‹ä¸­å°†ä¸ä¼šæ„å»ºè¿™äº›ä¾èµ–ï¼Œä»è€Œæå¤§ç¨‹åº¦ä¸ŠåŠ é€Ÿ SSR çš„æ„å»ºã€‚</p></li></ol><p>å¯¹äº SSR çš„è¿è¡Œæ—¶ï¼Œä¸€èˆ¬å¯ä»¥æ‹†åˆ†ä¸ºæ¯”è¾ƒå›ºå®šçš„ç”Ÿå‘½å‘¨æœŸé˜¶æ®µï¼Œç®€å•æ¥è®²å¯ä»¥æ•´ç†ä¸ºä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒçš„é˜¶æ®µ:</p><p><img src="`+s+`" alt="SSR4å¤§ç”Ÿå‘½å‘¨æœŸ"></p><ol><li><strong>åŠ è½½ SSR å…¥å£æ¨¡å—</strong>ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®š SSR æ„å»ºäº§ç‰©çš„å…¥å£ï¼Œå³ç»„ä»¶çš„å…¥å£åœ¨å“ªé‡Œï¼Œå¹¶åŠ è½½å¯¹åº”çš„æ¨¡å—ã€‚</li><li><strong>è¿›è¡Œæ•°æ®é¢„å–</strong>ã€‚è¿™æ—¶å€™ Node ä¾§ä¼šé€šè¿‡æŸ¥è¯¢æ•°æ®åº“æˆ–è€…ç½‘ç»œè¯·æ±‚æ¥è·å–åº”ç”¨æ‰€éœ€çš„æ•°æ®ã€‚</li><li><strong>æ¸²æŸ“ç»„ä»¶</strong>ã€‚è¿™ä¸ªé˜¶æ®µä¸º SSR çš„æ ¸å¿ƒï¼Œä¸»è¦å°†ç¬¬ <code>1</code> æ­¥ä¸­åŠ è½½çš„ç»„ä»¶æ¸²æŸ“æˆ HTML å­—ç¬¦ä¸²æˆ–è€… Stream æµã€‚</li><li><strong>HTML æ‹¼æ¥</strong>ã€‚åœ¨ç»„ä»¶æ¸²æŸ“å®Œæˆä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ‹¼æ¥å®Œæ•´çš„ HTML å­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶ä½œä¸ºå“åº”è¿”å›ç»™æµè§ˆå™¨ã€‚</li></ol><p>ä»ä¸Šé¢çš„åˆ†æä¸­ä½ å¯ä»¥å‘ç°ï¼ŒSSR å…¶å®æ˜¯<code>æ„å»º</code>å’Œ<code>è¿è¡Œæ—¶</code>äº’ç›¸é…åˆæ‰èƒ½å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»…é æ„å»ºå·¥å…·æ˜¯ä¸å¤Ÿçš„ï¼Œå†™ä¸€ä¸ª Vite æ’ä»¶ä¸¥æ ¼æ„ä¹‰ä¸Šæ— æ³•å®ç° SSR çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ Vite çš„æ„å»ºæµç¨‹åšä¸€äº›æ•´ä½“çš„è°ƒæ•´ï¼Œå¹¶ä¸”åŠ å…¥ä¸€äº›æœåŠ¡ç«¯è¿è¡Œæ—¶çš„é€»è¾‘æ‰èƒ½å®ç°ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»¥å…·ä½“çš„ä»£ç ç¤ºä¾‹æ¥è®²è§£å¦‚ä½•åœ¨ Vite ä¸­å®Œæˆ SSR å·¥ç¨‹çš„æ­å»ºã€‚</p><h2 id="åŸºäº-vite-æ­å»º-ssr-é¡¹ç›®" tabindex="-1">åŸºäº Vite æ­å»º SSR é¡¹ç›® <a class="header-anchor" href="#åŸºäº-vite-æ­å»º-ssr-é¡¹ç›®" aria-hidden="true">#</a></h2><h3 id="_1-ssr-æ„å»º-api" tabindex="-1">1. SSR æ„å»º API <a class="header-anchor" href="#_1-ssr-æ„å»º-api" aria-hidden="true">#</a></h3><p>é¦–å…ˆ Vite ä½œä¸ºä¸€ä¸ªæ„å»ºå·¥å…·ï¼Œæ˜¯å¦‚ä½•æ”¯æŒ SSR æ„å»ºçš„å‘¢ï¼Ÿæ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯å¦‚ä½•è®©å‰ç«¯çš„ä»£ç ä¹Ÿèƒ½é¡ºåˆ©åœ¨ Node.js ä¸­æˆåŠŸè·‘èµ·æ¥çš„å‘¢ï¼Ÿ</p><p>å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼ŒVite ä¾ç„¶ç§‰æ‰¿ ESM æ¨¡å—æŒ‰éœ€åŠ è½½å³ <code>no-bundle</code>çš„ç†å¿µï¼Œå¯¹å¤–æä¾›äº†<code>ssrLoadModule</code> APIï¼Œä½ å¯ä»¥æ— éœ€æ‰“åŒ…é¡¹ç›®ï¼Œå°†å…¥å£æ–‡ä»¶çš„è·¯å¾„ä¼ å…¥<code>ssrLoadModule</code> å³å¯:</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// åŠ è½½æœåŠ¡ç«¯å…¥å£æ¨¡å—</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> xxx </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> vite</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ssrLoadModule</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/src/entry-server.tsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>è€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼ŒVite ä¼šé»˜è®¤è¿›è¡Œæ‰“åŒ…ï¼Œå¯¹äº SSR æ„å»ºè¾“å‡º CommonJS æ ¼å¼çš„äº§ç‰©ã€‚æˆ‘ä»¬å¯ä»¥åœ¨<code>package.json</code>ä¸­åŠ å…¥è¿™æ ·ç±»ä¼¼çš„æ„å»ºæŒ‡ä»¤:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">build:ssr</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite build --ssr æœåŠ¡ç«¯å…¥å£è·¯å¾„</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>è¿™æ · Vite ä¼šä¸“é—¨ä¸º SSR æ‰“åŒ…å‡ºä¸€ä»½æ„å»ºäº§ç‰©ã€‚å› æ­¤ä½ å¯ä»¥çœ‹åˆ°ï¼Œå¤§éƒ¨åˆ† SSR æ„å»ºæ—¶çš„äº‹æƒ…ï¼ŒVite å·²ç»å¸®æˆ‘ä»¬æä¾›äº†å¼€ç®±å³ç”¨çš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬åç»­ç›´æ¥ä½¿ç”¨å³å¯ã€‚</p><h3 id="_2-é¡¹ç›®éª¨æ¶æ­å»º" tabindex="-1">2. é¡¹ç›®éª¨æ¶æ­å»º <a class="header-anchor" href="#_2-é¡¹ç›®éª¨æ¶æ­å»º" aria-hidden="true">#</a></h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ­£å¼å¼€å§‹ SSR é¡¹ç›®çš„æ­å»ºï¼Œä½ å¯ä»¥é€šè¿‡è„šæ‰‹æ¶åˆå§‹åŒ–ä¸€ä¸ª<code>react+ts</code>çš„é¡¹ç›®:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vite@latest</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vite-react-ssr</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--template</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">react-ts</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vite-react-ssr</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span></span>
<span class="line"></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>æ­¤å¤„ä½¿ç”¨çš„æ˜¯React <code>v18+</code>ï¼ŒåŸå°å†Œä½¿ç”¨çš„ <code>v17+</code> ç‰ˆæœ¬ï¼Œç¨æœ‰ä¸åŒã€‚</p></div><p>åˆ é™¤é¡¹ç›®è‡ªå¸¦çš„<code>src/main.ts</code>ï¼Œç„¶ååœ¨ src ç›®å½•ä¸‹æ–°å»º<code>entry-client.tsx</code>å’Œ<code>entry-server.tsx</code>ä¸¤ä¸ªå…¥å£æ–‡ä»¶:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-upndj" id="tab-vXWI5yv" checked="checked"><label for="tab-vXWI5yv">entry-client.tsx</label><input type="radio" name="group-upndj" id="tab-2o-0UtK"><label for="tab-2o-0UtK">entry-server.tsx</label></div><div class="blocks"><div class="language-typescript active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// å®¢æˆ·ç«¯å…¥å£æ–‡ä»¶</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">hydrateRoot</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react-dom/client</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> App </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./App</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">hydrateRoot</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">!,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">App </span><span style="color:#89DDFF;">/&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> App </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./App</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ServerEntry</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">props</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">App</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">/&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ServerEntry</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div></div><p>æˆ‘ä»¬ä»¥ Express æ¡†æ¶ä¸ºä¾‹æ¥å®ç° Node åç«¯æœåŠ¡ï¼Œåç»­çš„ SSR é€»è¾‘ä¼šæ¥å…¥åˆ°è¿™ä¸ªæœåŠ¡ä¸­ã€‚å½“ç„¶ä½ éœ€è¦å®‰è£…ä»¥ä¸‹çš„ä¾èµ–:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">express</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-S</span></span>
<span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@types/express</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-D</span></span>
<span class="line"></span></code></pre></div><p>æ¥ç€æ–°å»º<code>src/ssr-server/index.ts</code>:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// src/ssr-server/index.ts</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// åç«¯æœåŠ¡</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createServer</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">express</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">3000</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Node æœåŠ¡å™¨å·²å¯åŠ¨~</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://localhost:3000</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">createServer</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>ç„¶åä½ å¯ä»¥åœ¨<code>package.json</code>ä¸­æ·»åŠ å¦‚ä¸‹çš„ <code>scripts</code>:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-yKLCn" id="tab-zzBkFdz" checked="checked"><label for="tab-zzBkFdz">package.json</label></div><div class="blocks"><div class="language-json active"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">// å¼€å‘é˜¶æ®µå¯åŠ¨ SSR çš„åç«¯æœåŠ¡</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">dev</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nodemon --watch src/ssr-server --exec &#39;tsx src/ssr-server/index.ts&#39;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">// æ‰“åŒ…å®¢æˆ·ç«¯äº§ç‰©å’Œ SSR äº§ç‰©</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pnpm run build:client &amp;&amp; pnpm run build:server</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">build:client</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite build --outDir dist/client</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">build:server</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite build --ssr src/entry-server.tsx --outDir dist/server</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">// ç”Ÿäº§ç¯å¢ƒé¢„è§ˆ SSR æ•ˆæœ</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">preview</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">NODE_ENV=production tsx src/ssr-server/index.ts</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div></div><p>å…¶ä¸­è®¾è®¡åˆ°ä¸¤ä¸ªé¢å¤–çš„å·¥å…·ï¼Œç»™å¤§å®¶è§£é‡Šä¸€ä¸‹:</p><ol><li><code>nodemon</code>: ä¸€ä¸ªç›‘å¬æ–‡ä»¶å˜åŒ–è‡ªåŠ¨é‡å¯ Node æœåŠ¡çš„å·¥å…·ã€‚</li><li><a href="https://github.com/esbuild-kit/tsx" target="_blank" rel="noreferrer">tsx</a>: ç±»ä¼¼ <code>ts-node</code> çš„å·¥å…·ï¼Œç”¨æ¥æ‰§è¡Œ ts æ–‡ä»¶ï¼Œåº•å±‚åŸºäº Esbuild å®ç°ã€‚</li></ol><p>åŒæ—¶ä½ ä¹Ÿéœ€è¦å®‰è£…è¿™ä¸¤ä¸ªä¾èµ–:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-D</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nodemon</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tsx</span></span>
<span class="line"></span></code></pre></div><p>OKï¼Œç°åœ¨æˆ‘ä»¬å°±åŸºæœ¬ä¸Šæ­å»ºå¥½äº†åŸºæœ¬çš„é¡¹ç›®éª¨æ¶ï¼Œæ¥ä¸‹é‡Œæˆ‘ä»¬ä¸“æ³¨äº SSR è¿è¡Œæ—¶çš„å®ç°é€»è¾‘å³å¯ã€‚</p><h3 id="_3-ssr-è¿è¡Œæ—¶å®ç°" tabindex="-1">3. SSR è¿è¡Œæ—¶å®ç° <a class="header-anchor" href="#_3-ssr-è¿è¡Œæ—¶å®ç°" aria-hidden="true">#</a></h3><p>SSR ä½œä¸ºä¸€ç§ç‰¹æ®Šçš„åç«¯æœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å°è£…æˆä¸€ä¸ªä¸­é—´ä»¶çš„å½¢å¼ï¼Œå¦‚ä»¥ä¸‹çš„ä»£ç æ‰€ç¤º:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-_kUL4" id="tab-yQafcJV" checked="checked"><label for="tab-yQafcJV">ssr-server/index.ts</label></div><div class="blocks"><div class="language-typescript active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> express</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">RequestHandler</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Express</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">ViteDevServer</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">createServer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createViteServer</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> isProd </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> process</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">NODE_ENV </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">production</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> cwd </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cwd</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createSsrMiddleware</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Express</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">RequestHandler</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">vite</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">ViteDevServer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">isProd</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ğŸ“š</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// https://cn.vitejs.dev/config/server-options.html#server-middlewaremode</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">vite</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">createViteServer</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      root</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cwd</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      server</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        middlewareMode</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      appType</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">custom</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ä¸å¼•å…¥ Vite é»˜è®¤çš„ HTML å¤„ç†ä¸­é—´ä»¶</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å°† vite çš„ connect å®ä¾‹ä½œä¸­é—´ä»¶ä½¿ç”¨</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ³¨å†Œ Vite Middlewares</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ä¸»è¦ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯èµ„æº</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">vite</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">middlewares</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// SSR çš„é€»è¾‘</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 1. åŠ è½½æœåŠ¡ç«¯å…¥å£æ¨¡å—</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 2. æ•°æ®é¢„å–</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 3. ã€Œæ ¸å¿ƒã€æ¸²æŸ“ç»„ä»¶</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 4. æ‹¼æ¥ HTMLï¼Œè¿”å›å“åº”</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createServer</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">express</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åŠ å…¥ Vite SSR ä¸­é—´ä»¶</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">createSsrMiddleware</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">3000</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Node æœåŠ¡å™¨å·²å¯åŠ¨~</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://localhost:3000</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">createServer</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div></div></div><p>æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠç„¦ç‚¹æ”¾åœ¨ä¸­é—´ä»¶å†… SSR çš„é€»è¾‘å®ç°ä¸Šï¼Œé¦–å…ˆå®ç°ç¬¬ä¸€æ­¥å³<code>åŠ è½½æœåŠ¡ç«¯å…¥å£æ¨¡å—</code>:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-KmPR-" id="tab-aaj31-_" checked="checked"><label for="tab-aaj31-_">ssr-server/index.ts</label></div><div class="blocks"><div class="language-typescript active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> path </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node:path</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// çœç•¥å…¶ä½™éƒ¨åˆ†...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 1. åŠ è½½æœåŠ¡ç«¯å…¥å£æ¨¡å—</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">loadSsrEntryModule</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">vite</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ViteDevServer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">isProd</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">  </span><span style="color:#676E95;font-style:italic;">// ç”Ÿäº§æ¨¡å¼ä¸‹ç›´æ¥ require æ‰“åŒ…åçš„äº§ç‰©</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entryPath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">cwd</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist/server/entry-server.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">import</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">entryPath</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å¼€å‘ç¯å¢ƒä¸‹é€šè¿‡ no-bundle æ–¹å¼åŠ è½½</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entryPath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">cwd</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/entry-server.tsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">vite</span><span style="color:#89DDFF;">!.</span><span style="color:#82AAFF;">ssrLoadModule</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">entryPath</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div></div><p>ä¸­é—´ä»¶å†…çš„é€»è¾‘å¦‚ä¸‹:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-1Bqqb" id="tab-yDuVZes" checked="checked"><label for="tab-yDuVZes">ssr-server/index.ts</label></div><div class="blocks"><div class="language-typescript active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createSsrMiddleware</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Express</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">RequestHandler</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// çœç•¥å‰é¢çš„ä»£ç </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalUrl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 1. æœåŠ¡ç«¯å…¥å£åŠ è½½</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ServerEntry</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">loadSsrEntryModule</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">vite</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div></div><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç°æœåŠ¡ç«¯çš„æ•°æ®é¢„å–æ“ä½œï¼Œä½ å¯ä»¥åœ¨<code>entry-server.tsx</code>ä¸­æ·»åŠ ä¸€ä¸ªç®€å•çš„è·å–æ•°æ®çš„å‡½æ•°:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-EAIZW" id="tab-CzhL5jQ" checked="checked"><label for="tab-CzhL5jQ">entry-server.tsx</label></div><div class="blocks"><div class="language-typescript active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight has-diff" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> App </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./App</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fetchData</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span></span>
<span class="line diff add"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> user</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span></span>
<span class="line diff add"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ServerEntry</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">props</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">App</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">/&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ServerEntry</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div></div><p>ç„¶ååœ¨ SSR ä¸­é—´ä»¶ä¸­å®Œæˆæ•°æ®é¢„å–çš„æ“ä½œ:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-GfAi6" id="tab-41bNGKd" checked="checked"><label for="tab-41bNGKd">ssr-server/index.ts</label></div><div class="blocks"><div class="language-typescript active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight has-diff" tabindex="0"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createSsrMiddleware</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Express</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">RequestHandler</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// çœç•¥å‰é¢çš„ä»£ç </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalUrl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 1. æœåŠ¡ç«¯å…¥å£åŠ è½½</span></span>
<span class="line diff remove"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ServerEntry</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">loadSsrEntryModule</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">vite</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span></span>
<span class="line diff add"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ServerEntry</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fetchData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">loadSsrEntryModule</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">vite</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 2. é¢„å–æ•°æ®</span></span>
<span class="line diff add"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetchData</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div></div><p>æ¥ç€æˆ‘ä»¬è¿›å…¥åˆ°æ ¸å¿ƒçš„ç»„ä»¶æ¸²æŸ“é˜¶æ®µ:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-Cm_sp" id="tab-LX941Vi" checked="checked"><label for="tab-LX941Vi">ssr-server/index.ts</label></div><div class="blocks"><div class="language-typescript active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">renderToString</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react-dom/server</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createSsrMiddleware</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Express</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">RequestHandler</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// çœç•¥å‰é¢çš„ä»£ç </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalUrl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 1. æœåŠ¡ç«¯å…¥å£åŠ è½½</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ServerEntry</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fetchData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">loadSsrEntryModule</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">vite</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 2. é¢„å–æ•°æ®</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetchData</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 3. ã€Œæ ¸å¿ƒã€æ¸²æŸ“ç»„ä»¶ - ç»„ä»¶æ¸²æŸ“ -&gt; å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appHtml</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">renderToString</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">React</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createElement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ServerEntry</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div></div><p>ç”±äºåœ¨ç¬¬ä¸€æ­¥ä¹‹åæˆ‘ä»¬æ‹¿åˆ°äº†å…¥å£ç»„ä»¶ï¼Œç°åœ¨å¯ä»¥è°ƒç”¨å‰ç«¯æ¡†æ¶çš„<code>renderToString</code>API å°†ç»„ä»¶æ¸²æŸ“ä¸ºå­—ç¬¦ä¸²ï¼Œç»„ä»¶çš„å…·ä½“å†…å®¹ä¾¿å°±æ­¤ç”Ÿæˆäº†ã€‚</p><p>OKï¼Œç›®å‰æˆ‘ä»¬å·²ç»æ‹¿åˆ°äº†ç»„ä»¶çš„ HTML ä»¥åŠé¢„å–çš„æ•°æ®ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åœ¨æ ¹ç›®å½•ä¸‹çš„ HTML ä¸­æä¾›ç›¸åº”çš„æ’æ§½ï¼Œæ–¹ä¾¿å†…å®¹çš„æ›¿æ¢:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-qhfJh" id="tab-blzDnau" checked="checked"><label for="tab-blzDnau">index.html</label></div><div class="blocks"><div class="language-html active"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">en</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UTF-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">link</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">rel</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">icon</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">image/svg+xml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/favicon.svg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">viewport</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width=device-width, initial-scale=1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Vite App</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#676E95;font-style:italic;">&lt;!-- SSR_APP --&gt;</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">    &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/entry-client.tsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!-- SSR_DATA --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div></div></div><p>ç´§æ¥ç€æˆ‘ä»¬åœ¨ SSR ä¸­é—´ä»¶ä¸­è¡¥å…… HTML æ‹¼æ¥çš„é€»è¾‘:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-plzRk" id="tab-Gtx8ot8" checked="checked"><label for="tab-Gtx8ot8">ssr-server/index.ts</label></div><div class="blocks"><div class="language-typescript active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node:fs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">resolveTemplatePath</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isProd</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">cwd</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist/client/index.html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">cwd</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">index.html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createSsrMiddleware</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Express</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">RequestHandler</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// çœç•¥å‰é¢çš„ä»£ç </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalUrl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 1. æœåŠ¡ç«¯å…¥å£åŠ è½½</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ServerEntry</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fetchData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">loadSsrEntryModule</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">vite</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 2. é¢„å–æ•°æ®</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetchData</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 3. ã€Œæ ¸å¿ƒã€æ¸²æŸ“ç»„ä»¶ - ç»„ä»¶æ¸²æŸ“ -&gt; å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appHtml</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">renderToString</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">React</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createElement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ServerEntry</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 4. æ‹¼æ¥ HTMLï¼Œè¿”å›å“åº”</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">templatePath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">resolveTemplatePath</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">template</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">templatePath</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¼€å‘æ¨¡å¼ä¸‹éœ€è¦æ³¨å…¥ HMRã€ç¯å¢ƒå˜é‡ç›¸å…³çš„ä»£ç ï¼Œå› æ­¤éœ€è¦è°ƒç”¨ vite.transformIndexHtml</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">isProd</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">vite</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">template</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">vite</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">transformIndexHtml</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">template</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">html</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">template</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&lt;!-- SSR_APP --&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appHtml</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æ³¨å…¥æ•°æ®æ ‡ç­¾ï¼Œç”¨äºå®¢æˆ·ç«¯ hydrate</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&lt;!-- SSR_DATA --&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">&lt;script&gt;window.__SSR_DATA__=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(data)</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&lt;/script&gt;</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#F07178;">      )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">status</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">200</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setHeader</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Content-Type</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">text/html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">end</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">html</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div></div><p>åœ¨æ‹¼æ¥ HTML çš„é€»è¾‘ä¸­ï¼Œé™¤äº†æ·»åŠ é¡µé¢çš„å…·ä½“å†…å®¹ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿæ³¨å…¥äº†ä¸€ä¸ªæŒ‚è½½å…¨å±€æ•°æ®çš„<code>script</code>æ ‡ç­¾ï¼Œè¿™æ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„å‘¢ï¼Ÿ</p><p>åœ¨ SSR çš„åŸºæœ¬æ¦‚å¿µä¸­æˆ‘ä»¬å°±æåˆ°è¿‡ï¼Œä¸ºäº†æ¿€æ´»é¡µé¢çš„äº¤äº’åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œ CSR çš„ JavaScript ä»£ç æ¥è¿›è¡Œ hydrate æ“ä½œï¼Œè€Œå®¢æˆ·ç«¯ hydrate çš„æ—¶å€™éœ€è¦å’ŒæœåŠ¡ç«¯<code>åŒæ­¥é¢„å–åçš„æ•°æ®</code>ï¼Œä¿è¯é¡µé¢æ¸²æŸ“çš„ç»“æœå’ŒæœåŠ¡ç«¯æ¸²æŸ“ä¸€è‡´ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åˆšåˆšæ³¨å…¥çš„æ•°æ® script æ ‡ç­¾ä¾¿æ´¾ä¸Šç”¨åœºäº†ã€‚ç”±äºå…¨å±€çš„ window ä¸ŠæŒ‚è½½æœåŠ¡ç«¯é¢„å–çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>entry-client.tsx</code>ä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯æ¸²æŸ“å…¥å£ä¸­æ‹¿åˆ°è¿™ä»½æ•°æ®ï¼Œå¹¶è¿›è¡Œ hydrate:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-qQ1f-" id="tab-WxIwkAM" checked="checked"><label for="tab-WxIwkAM">src/entry-client.tsx</label></div><div class="blocks"><div class="language-tsx active"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">hydrateRoot</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react-dom/client</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> App </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./App</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// @ts-ignore</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__SSR_DATA__</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">hydrateRoot</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">!,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">React.StrictMode</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">App</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">data</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">} /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#FFCB6B;">React.StrictMode</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>ä¸Šé¢çš„ <code>@ts-ignore</code> è®©æˆ‘ä»¬å¿½ç•¥windowä¸Šçš„å˜é‡ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å†tsconfig.jsonä¸­å£°æ˜è¯¥ç±»å‹</p><ol><li><p>æ–°å»º <code>types/global.d.ts</code></p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">declare</span><span style="color:#A6ACCD;"> global </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">interface</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Window</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    __SSR_DATA__</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span></code></pre></div></li><li><p>åœ¨ <code>tsconfig.json</code> ä¸­åŒ…å«è¯¥ç±»å‹</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight has-diff" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line diff remove"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">include</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> </span></span>
<span class="line diff add"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">include</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">types/**/*.d.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">],</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></li></ol><p>è¿™æ ·ä¾¿å¯ä»¥å»æ‰ä¸Šé¢çš„ <code>@ts-ignore</code> äº†</p></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬åŸºæœ¬å¼€å‘å®Œäº† SSR æ ¸å¿ƒçš„é€»è¾‘ï¼Œæ‰§è¡Œ<code>pnpm run dev</code>å¯åŠ¨é¡¹ç›®:</p><p><img src="`+t+'" alt="start ssr server"></p><p>æ‰“å¼€æµè§ˆå™¨åæŸ¥çœ‹é¡µé¢æºç ï¼Œä½ å¯ä»¥å‘ç° SSR ç”Ÿæˆçš„ HTML å·²ç»é¡ºåˆ©è¿”å›äº†:</p><p><img src="'+c+'" alt="SSRæºç "></p><h3 id="_4-ç”Ÿäº§ç¯å¢ƒçš„-csr-èµ„æºå¤„ç†" tabindex="-1">4. ç”Ÿäº§ç¯å¢ƒçš„ CSR èµ„æºå¤„ç† <a class="header-anchor" href="#_4-ç”Ÿäº§ç¯å¢ƒçš„-csr-èµ„æºå¤„ç†" aria-hidden="true">#</a></h3><p>å¦‚æœä½ ç°åœ¨æ‰§è¡Œ<code>pnpm run build</code>åŠ<code>pnpm run preview</code>è¿›è¡Œç”Ÿäº§ç¯å¢ƒçš„é¢„è§ˆï¼Œä¼šå‘ç° SSR å¯ä»¥æ­£å¸¸è¿”å›å†…å®¹ï¼Œä½†æ‰€æœ‰çš„é™æ€èµ„æºåŠ CSR çš„ä»£ç éƒ½å¤±æ•ˆäº†:</p><p><img src="'+r+`" alt="ç”Ÿæˆç¯å¢ƒCSRèµ„æºæ‰¾ä¸åˆ°"></p><p>ä¸è¿‡å¼€å‘é˜¶æ®µå¹¶æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºå¯¹äºå¼€å‘é˜¶æ®µçš„é™æ€èµ„æº Vite Dev Server çš„ä¸­é—´ä»¶å·²ç»å¸®æˆ‘ä»¬å¤„ç†äº†ï¼Œè€Œç”Ÿäº§ç¯å¢ƒæ‰€æœ‰çš„èµ„æºéƒ½å·²ç»æ‰“åŒ…å®Œæˆï¼Œæˆ‘ä»¬éœ€è¦å¯ç”¨å•ç‹¬çš„é™æ€èµ„æºæœåŠ¡æ¥æ‰¿è½½è¿™äº›èµ„æºã€‚è¿™é‡Œä½ å¯ä»¥<code>serve-static</code>ä¸­é—´ä»¶æ¥å®Œæˆè¿™ä¸ªæœåŠ¡ï¼Œé¦–å…ˆå®‰è£…å¯¹åº”ç¬¬ä¸‰æ–¹åŒ…:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">serve-static</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-S</span></span>
<span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@types/serve-static</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-D</span></span>
<span class="line"></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬åˆ° server ç«¯æ³¨å†Œ:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-e1VXY" id="tab-_qy-PkJ" checked="checked"><label for="tab-_qy-PkJ">ssr-server/index.ts</label></div><div class="blocks"><div class="language-typescript active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> serve </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">serve-static</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è¿‡æ»¤å‡ºé¡µé¢è¯·æ±‚</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">matchPageUrl</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createSsrMiddleware</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Express</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">RequestHandler</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalUrl</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#82AAFF;">matchPageUrl</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// èµ°é™æ€èµ„æºçš„å¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// SSR çš„é€»è¾‘çœç•¥</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">vite</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">ssrFixStacktrace</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">error</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">status</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">500</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">end</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">message</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createServer</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">express</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åŠ å…¥ Vite SSR ä¸­é—´ä»¶</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">createSsrMiddleware</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ³¨å†Œä¸­é—´ä»¶ï¼Œç”Ÿäº§ç¯å¢ƒç«¯å¤„ç†å®¢æˆ·ç«¯èµ„æº</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">isProd</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">serve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">cwd</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist/client</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)))</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// çœç•¥å…¶å®ƒä»£ç </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div></div><p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±è§£å†³äº†ç”Ÿäº§ç¯å¢ƒä¸‹é™æ€èµ„æºå¤±æ•ˆçš„é—®é¢˜ã€‚ä¸è¿‡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå°†é™æ€èµ„æºéƒ¨ä¸Šä¼ åˆ° CDN ä¸Šï¼Œå¹¶ä¸”å°† Vite çš„ <code>base</code> é…ç½®ä¸ºåŸŸåå‰ç¼€ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥é€šè¿‡ CDN ç›´æ¥è®¿é—®åˆ°é™æ€èµ„æºï¼Œè€Œä¸éœ€è¦åŠ ä¸ŠæœåŠ¡ç«¯çš„å¤„ç†ã€‚ä¸è¿‡ä½œä¸ºæœ¬åœ°çš„ç”Ÿäº§ç¯å¢ƒé¢„è§ˆè€Œè¨€ï¼Œ<code>serve-static</code>è¿˜æ˜¯ä¸€ä¸ªä¸é”™çš„é™æ€èµ„æºå¤„ç†æ‰‹æ®µã€‚</p><details class="details custom-block"><summary>é¡¹ç›®å®Œæ•´ä»£ç </summary><p>é¡¹ç›®åˆå§‹åŒ–ï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vite@latest</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vite-ssr</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--template</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">react-ts</span></span>
<span class="line"></span></code></pre></div><p>ç›®å½•ç»“æ„</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">.</span></span>
<span class="line"><span style="color:#FFCB6B;">â”œâ”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">public</span></span>
<span class="line"><span style="color:#FFCB6B;">â”‚</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">â””â”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vite.svg</span></span>
<span class="line"><span style="color:#FFCB6B;">â”œâ”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">src</span></span>
<span class="line"><span style="color:#FFCB6B;">â”‚</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">â”œâ”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">App.css</span></span>
<span class="line"><span style="color:#FFCB6B;">â”‚</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">â”œâ”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">App.tsx</span></span>
<span class="line"><span style="color:#FFCB6B;">â”‚</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">â”œâ”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">assets</span></span>
<span class="line"><span style="color:#FFCB6B;">â”‚</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">â”‚</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">â””â”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">react.svg</span></span>
<span class="line"><span style="color:#FFCB6B;">â”‚</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">â”œâ”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">entry-client.tsx</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># å®¢æˆ·ç«¯ç»„ä»¶å…¥å£</span></span>
<span class="line"><span style="color:#FFCB6B;">â”‚</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">â”œâ”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">entry-server.tsx</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># æœåŠ¡ç«¯ç»„ä»¶å…¥å£</span></span>
<span class="line"><span style="color:#FFCB6B;">â”‚</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">â”œâ”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">index.css</span></span>
<span class="line"><span style="color:#FFCB6B;">â”‚</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">â”œâ”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ssr-server</span></span>
<span class="line"><span style="color:#FFCB6B;">â”‚</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">â”‚</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">â””â”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">index.ts</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># æœåŠ¡ç«¯æ¸²æŸ“ä¸»é€»è¾‘</span></span>
<span class="line"><span style="color:#FFCB6B;">â”‚</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">â””â”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vite-env.d.ts</span></span>
<span class="line"><span style="color:#FFCB6B;">â”œâ”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">index.html</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># å…¥å£HTML</span></span>
<span class="line"><span style="color:#FFCB6B;">â”œâ”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">package.json</span></span>
<span class="line"><span style="color:#FFCB6B;">â”œâ”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pnpm-lock.yaml</span></span>
<span class="line"><span style="color:#FFCB6B;">â”œâ”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tsconfig.json</span></span>
<span class="line"><span style="color:#FFCB6B;">â”œâ”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tsconfig.node.json</span></span>
<span class="line"><span style="color:#FFCB6B;">â”œâ”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">types</span></span>
<span class="line"><span style="color:#FFCB6B;">â”‚</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">â””â”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">global.d.ts</span></span>
<span class="line"><span style="color:#FFCB6B;">â””â”€â”€</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vite.config.ts</span></span>
<span class="line"></span></code></pre></div><p>ä¾èµ–å®‰è£…ï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">express</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">serve-static</span></span>
<span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-D</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@types/express</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@types/serve-static</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nodemon</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tsx</span></span>
<span class="line"></span></code></pre></div><p><code>package.json</code></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">dev</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nodemon --watch src/ssr-server --exec &#39;tsx src/ssr-server/index.ts&#39;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pnpm run build:client &amp;&amp; pnpm run build:server</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">build:client</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite build --outDir dist/client</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">build:server</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite build --ssr src/entry-server.tsx --outDir dist/server</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">preview</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">NODE_ENV=production tsx src/ssr-server/index.ts</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>index.html</code>ï¼š</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">en</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UTF-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">link</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">rel</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">icon</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">image/svg+xml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/favicon.svg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">viewport</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width=device-width, initial-scale=1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Vite App</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#676E95;font-style:italic;">&lt;!-- SSR_APP --&gt;</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">    &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/src/entry-client.tsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!-- SSR_DATA --&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p><code>src/entry-client.tsx</code>:</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">hydrateRoot</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react-dom/client</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> App </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./App</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__SSR_DATA__</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">hydrateRoot</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">!,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">React.StrictMode</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">App</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">data</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">} /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#FFCB6B;">React.StrictMode</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p><code>src/entry-server.tsx</code>:</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> App </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./App</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fetchData</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> user</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ServerEntry</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">props</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">App</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ServerEntry</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>src/ssr-server/index.ts</code>ï¼š</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> express</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Express</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">RequestHandler</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> serve </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">serve-static</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ViteDevServer</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createServer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createViteServer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">renderToString</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react-dom/server</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> path </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node:path</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node:fs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> isProd </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> process</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">NODE_ENV </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">production</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> cwd </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cwd</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">matchPageUrl</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createSsrMiddleware</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Express</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">RequestHandler</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">vite</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">ViteDevServer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">isProd</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// https://cn.vitejs.dev/config/server-options.html#server-middlewaremode</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">vite</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">createViteServer</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      root</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cwd</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      server</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        middlewareMode</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      appType</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">custom</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ä¸å¼•å…¥ Vite é»˜è®¤çš„ HTML å¤„ç†ä¸­é—´ä»¶</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å°† vite çš„ connect å®ä¾‹ä½œä¸­é—´ä»¶ä½¿ç”¨</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ³¨å†Œ Vite Middlewares</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ä¸»è¦ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯èµ„æº</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">vite</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">middlewares</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">originalUrl</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#82AAFF;">matchPageUrl</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// èµ°é™æ€èµ„æºçš„å¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// SSR çš„é€»è¾‘</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 1. åŠ è½½æœåŠ¡ç«¯å…¥å£æ¨¡å—</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ServerEntry</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fetchData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">loadSsrEntryModule</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">vite</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 2. æ•°æ®é¢„å–</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetchData</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 3. ã€Œæ ¸å¿ƒã€æ¸²æŸ“ç»„ä»¶ - ç»„ä»¶æ¸²æŸ“ -&gt; å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appHtml</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">renderToString</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">React</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createElement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ServerEntry</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 4. æ‹¼æ¥ HTMLï¼Œè¿”å›å“åº”</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">templatePath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">resolveTemplatePath</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">template</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">templatePath</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å¼€å‘æ¨¡å¼ä¸‹éœ€è¦æ³¨å…¥ HMRã€ç¯å¢ƒå˜é‡ç›¸å…³çš„ä»£ç ï¼Œå› æ­¤éœ€è¦è°ƒç”¨ vite.transformIndexHtml</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">isProd</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">vite</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">template</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">vite</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">transformIndexHtml</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">template</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">html</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">template</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&lt;!-- SSR_APP --&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appHtml</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;">// æ³¨å…¥æ•°æ®æ ‡ç­¾ï¼Œç”¨äºå®¢æˆ·ç«¯ hydrate</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&lt;!-- SSR_DATA --&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">&lt;script&gt;window.__SSR_DATA__=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(data)</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&lt;/script&gt;</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#F07178;">          )</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">status</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">200</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setHeader</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Content-Type</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">text/html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">end</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">html</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">vite</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">ssrFixStacktrace</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">error</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">status</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">500</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">end</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">message</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 1. åŠ è½½æœåŠ¡ç«¯å…¥å£æ¨¡å—</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">loadSsrEntryModule</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">vite</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ViteDevServer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">isProd</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">  </span><span style="color:#676E95;font-style:italic;">// ç”Ÿäº§æ¨¡å¼ä¸‹ç›´æ¥ require æ‰“åŒ…åçš„äº§ç‰©</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entryPath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">cwd</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist/server/entry-server.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">import</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">entryPath</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å¼€å‘ç¯å¢ƒä¸‹é€šè¿‡ no-bundle æ–¹å¼åŠ è½½</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entryPath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">cwd</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/entry-server.tsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">vite</span><span style="color:#89DDFF;">!.</span><span style="color:#82AAFF;">ssrLoadModule</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">entryPath</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">resolveTemplatePath</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isProd</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">cwd</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist/client/index.html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">cwd</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">index.html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createServer</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">express</span><span style="color:#F07178;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">createSsrMiddleware</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">app</span><span style="color:#F07178;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">isProd</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">serve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">cwd</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist/client</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)))</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">3333</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">NodeæœåŠ¡å™¨å·²å¯åŠ¨</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">http://localhost:3333</span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">createServer</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span></code></pre></div></details><h2 id="å·¥ç¨‹åŒ–é—®é¢˜" tabindex="-1">å·¥ç¨‹åŒ–é—®é¢˜ <a class="header-anchor" href="#å·¥ç¨‹åŒ–é—®é¢˜" aria-hidden="true">#</a></h2><p>ä»¥ä¸Šæˆ‘ä»¬åŸºæœ¬å®ç°äº† SSR æ ¸å¿ƒçš„<code>æ„å»º</code>å’Œ<code>è¿è¡Œæ—¶</code>åŠŸèƒ½ï¼Œå¯ä»¥åˆæ­¥è¿è¡Œä¸€ä¸ªåŸºäº Vite çš„ SSR é¡¹ç›®ï¼Œä½†åœ¨å®é™…çš„åœºæ™¯ä¸­ä»ç„¶æ˜¯æœ‰ä¸å°‘çš„å·¥ç¨‹åŒ–é—®é¢˜éœ€è¦æˆ‘ä»¬æ³¨æ„ã€‚ä¸‹é¢æˆ‘å°±å’Œä½ ä¸€èµ·æ¢³ç†ä¸€ä¸‹åˆ°åº•éœ€è¦è€ƒè™‘å“ªäº›é—®é¢˜ï¼Œä»¥åŠç›¸åº”çš„è§£å†³æ€è·¯æ˜¯å¦‚ä½•çš„ï¼ŒåŒæ—¶æˆ‘ä¹Ÿä¼šæ¨èä¸€äº›æ¯”è¾ƒæˆç†Ÿçš„è§£å†³æ–¹æ¡ˆã€‚</p><h3 id="_1-è·¯ç”±ç®¡ç†" tabindex="-1">1. è·¯ç”±ç®¡ç† <a class="header-anchor" href="#_1-è·¯ç”±ç®¡ç†" aria-hidden="true">#</a></h3><p>åœ¨ SPA åœºæ™¯ä¸‹ï¼Œå¯¹äºä¸åŒçš„å‰ç«¯æ¡†æ¶ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸åŒçš„è·¯ç”±ç®¡ç†æ–¹æ¡ˆï¼Œå¦‚ Vue ä¸­çš„ <code>vue-router</code>ã€React çš„<code>react-router</code>ã€‚ä¸è¿‡å½’æ ¹ç»“åº•ï¼Œè·¯ç”±æ–¹æ¡ˆåœ¨ SSR è¿‡ç¨‹ä¸­æ‰€å®Œæˆçš„åŠŸèƒ½éƒ½æ˜¯å·®ä¸å¤šçš„:</p><ol><li>å‘Šè¯‰æ¡†æ¶ç°åœ¨æ¸²æŸ“å“ªä¸ªè·¯ç”±ã€‚åœ¨ Vue ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>router.push</code> ç¡®å®šå³å°†æ¸²æŸ“çš„è·¯ç”±ï¼ŒReact ä¸­åˆ™é€šè¿‡ <code>StaticRouter</code> é…åˆ<code>location</code>å‚æ•°æ¥å®Œæˆã€‚</li><li>è®¾ç½® <code>base</code> å‰ç¼€ã€‚è§„å®šè·¯å¾„çš„å‰ç¼€ï¼Œå¦‚<code>vue-router</code> ä¸­ <a href="https://router.vuejs.org/zh/guide/migration/#%E7%A7%BB%E5%8A%A8%E4%BA%86-base-%E9%85%8D%E7%BD%AE" target="_blank" rel="noreferrer">base å‚æ•°</a>ã€<code>react-router</code>ä¸­<code>StaticRouter</code>ç»„ä»¶çš„ <a href="https://reactrouter.com/en/main/router-components/static-router" target="_blank" rel="noreferrer">basename</a>ã€‚</li></ol><h3 id="_2-å…¨å±€çŠ¶æ€ç®¡ç†" tabindex="-1">2. å…¨å±€çŠ¶æ€ç®¡ç† <a class="header-anchor" href="#_2-å…¨å±€çŠ¶æ€ç®¡ç†" aria-hidden="true">#</a></h3><p>å¯¹äºå…¨å±€çš„çŠ¶æ€ç®¡ç†è€Œè¨€ï¼Œå¯¹äºä¸åŒçš„æ¡†æ¶ä¹Ÿæœ‰ä¸åŒçš„ç”Ÿæ€å’Œæ–¹æ¡ˆï¼Œæ¯”å¦‚ Vue ä¸­çš„ <a href="https://vuex.vuejs.org/" target="_blank" rel="noreferrer">Vuex</a>ã€<a href="https://pinia.vuejs.org/" target="_blank" rel="noreferrer">Pinia</a>ï¼ŒReact ä¸­çš„ <a href="https://redux.js.org/introduction/getting-started" target="_blank" rel="noreferrer">Redux</a>ã€<a href="https://recoiljs.org/zh-hans/" target="_blank" rel="noreferrer">Recoil</a>ã€‚å„ä¸ªçŠ¶æ€ç®¡ç†å·¥å…·çš„ç”¨æ³•å¹¶ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œæ¥å…¥ SSR çš„æ€è·¯ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåœ¨<code>é¢„å–æ•°æ®</code>é˜¶æ®µåˆå§‹åŒ–æœåŠ¡ç«¯çš„ <code>store</code> ï¼Œå°†å¼‚æ­¥è·å–çš„æ•°æ®å­˜å…¥ <code>store</code> ä¸­ï¼Œç„¶ååœ¨ <code>æ‹¼æ¥ HTML</code>é˜¶æ®µå°†æ•°æ®ä» store ä¸­å–å‡ºæ”¾åˆ°æ•°æ® script æ ‡ç­¾ä¸­ï¼Œæœ€ååœ¨å®¢æˆ·ç«¯ hydrate çš„æ—¶å€™é€šè¿‡ window å³å¯è®¿é—®åˆ°é¢„å–æ•°æ®ã€‚</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>éœ€è¦æ³¨æ„çš„æœåŠ¡ç«¯å¤„ç†è®¸å¤šä¸åŒçš„è¯·æ±‚ï¼Œå¯¹äºæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦<strong>åˆ†åˆ«</strong>åˆå§‹åŒ– storeï¼Œå³ä¸€ä¸ªè¯·æ±‚ä¸€ä¸ª storeï¼Œä¸ç„¶ä¼šé€ æˆå…¨å±€çŠ¶æ€æ±¡æŸ“çš„é—®é¢˜ã€‚</p></div><h3 id="_3-csr-é™çº§" tabindex="-1">3. CSR é™çº§ <a class="header-anchor" href="#_3-csr-é™çº§" aria-hidden="true">#</a></h3><p>åœ¨æŸäº›æ¯”è¾ƒæç«¯çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦é™çº§åˆ° CSRï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯æ¸²æŸ“ã€‚ä¸€èˆ¬è€Œè¨€åŒ…æ‹¬å¦‚ä¸‹çš„é™çº§åœºæ™¯:</p><ol><li>æœåŠ¡å™¨ç«¯<strong>é¢„å–æ•°æ®</strong>å¤±è´¥ï¼Œéœ€è¦é™çº§åˆ°å®¢æˆ·ç«¯è·å–æ•°æ®ã€‚</li><li>æœåŠ¡å™¨å‡ºç°å¼‚å¸¸ï¼Œéœ€è¦è¿”å›<strong>å…œåº•çš„ CSR æ¨¡æ¿</strong>ï¼Œå®Œå…¨é™çº§ä¸º CSRã€‚</li><li>æœ¬åœ°<strong>å¼€å‘è°ƒè¯•</strong>ï¼Œæœ‰æ—¶éœ€è¦è·³è¿‡ SSRï¼Œä»…è¿›è¡Œ CSRã€‚</li></ol><p>å¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œåœ¨å®¢æˆ·ç«¯å…¥å£æ–‡ä»¶ä¸­éœ€è¦æœ‰é‡æ–°è·å–æ•°æ®çš„é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œè¿™æ ·çš„è¡¥å……:</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">hydrateRoot</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react-dom/client</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> App </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./App</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fetchData</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å®¢æˆ·ç«¯è·å–æ•°æ®</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">hydrate</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__SSR_DATA__</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__SSR_DATA__</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// é™çº§é€»è¾‘ </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetchData</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ä¹Ÿå¯ç®€åŒ–ä¸º const data = window.__SSR_DATA__ ?? await fetchData();</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">hydrateRoot</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">!,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">React.StrictMode</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">App</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">data</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">} /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#FFCB6B;">React.StrictMode</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>å¯¹äºç¬¬äºŒç§åœºæ™¯ï¼Œå³<code>æœåŠ¡å™¨æ‰§è¡Œå‡ºé”™</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¹‹å‰çš„ SSR ä¸­é—´ä»¶é€»è¾‘è¿½åŠ  catch é€»è¾‘:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createSsrMiddleware</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Express</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">RequestHandler</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// SSR çš„é€»è¾‘çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">vite</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">ssrFixStacktrace</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">error</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// åœ¨è¿™é‡Œè¿”å›æµè§ˆå™¨ CSR æ¨¡æ¿å†…å®¹</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>å¯¹äºç¬¬ä¸‰ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é€šè¿‡ <code>?csr</code> çš„ url query å‚æ•°æ¥å¼ºåˆ¶è·³è¿‡ SSRï¼Œåœ¨ SSR ä¸­é—´ä»¶æ·»åŠ å¦‚ä¸‹é€»è¾‘:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createSsrMiddleware</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">app</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Express</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">RequestHandler</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">query</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">csr</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// å“åº” CSR æ¨¡æ¿å†…å®¹</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// SSR çš„é€»è¾‘çœç•¥</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">vite</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">ssrFixStacktrace</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">error</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_4-æµè§ˆå™¨-api-å…¼å®¹" tabindex="-1">4. æµè§ˆå™¨ API å…¼å®¹ <a class="header-anchor" href="#_4-æµè§ˆå™¨-api-å…¼å®¹" aria-hidden="true">#</a></h3><p>ç”±äº Node.js ä¸­ä¸èƒ½ä½¿ç”¨æµè§ˆå™¨é‡Œé¢è¯¸å¦‚ <code>window</code>ã€<code>document</code>ä¹‹ç±»çš„ APIï¼Œå› æ­¤ä¸€æ—¦åœ¨æœåŠ¡ç«¯æ‰§è¡Œåˆ°è¿™æ ·çš„ API ä¼šæŠ¥å¦‚ä¸‹çš„é”™è¯¯ï¼š</p><p><img src="`+y+`" alt="Nodeç¯å¢ƒä½¿ç”¨æµè§ˆå™¨APIsæŠ¥é”™"></p><p>é‚£ä¹ˆå¦‚ä½•æ¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>i<wbr>mport.meta.env.SSR</code>è¿™ä¸ª Vite å†…ç½®çš„ç¯å¢ƒå˜é‡æ¥åˆ¤æ–­æ˜¯å¦å¤„äº SSR ç¯å¢ƒï¼Œä»¥æ­¤æ¥è§„é¿ä¸šåŠ¡ä»£ç åœ¨æœåŠ¡ç«¯å‡ºç°æµè§ˆå™¨çš„ API:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SSR) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æœåŠ¡ç«¯æ‰§è¡Œçš„é€»è¾‘</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åœ¨æ­¤å¯ä»¥è®¿é—®æµè§ˆå™¨çš„ API</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ polyfill çš„æ–¹å¼ï¼Œåœ¨ Node ä¸­æ³¨å…¥æµè§ˆå™¨çš„ APIï¼Œä½¿è¿™äº› API èƒ½å¤Ÿæ­£å¸¸è¿è¡Œèµ·æ¥ï¼Œè§£å†³å¦‚ä¸Šçš„é—®é¢˜ã€‚æˆ‘æ¨èä½¿ç”¨ä¸€ä¸ªæ¯”è¾ƒæˆç†Ÿçš„ polyfill åº“ <code>jsdom</code>ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> jsdom </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jsdom</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> window </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">JSDOM</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">&lt;!DOCTYPE html&gt;&lt;p&gt;Hello world&lt;/p&gt;</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> document </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> window</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æŒ‚è½½åˆ° node å…¨å±€</span></span>
<span class="line"><span style="color:#A6ACCD;">global</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">window </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> window</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">global</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">document </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> document</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="_5-è‡ªå®šä¹‰-head" tabindex="-1">5. è‡ªå®šä¹‰ Head <a class="header-anchor" href="#_5-è‡ªå®šä¹‰-head" aria-hidden="true">#</a></h3><p>åœ¨ SSR çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è™½ç„¶å¯ä»¥åœ¨å†³å®šç»„ä»¶çš„å†…å®¹ï¼Œå³<code>&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</code>è¿™ä¸ªå®¹å™¨ div ä¸­çš„å†…å®¹ï¼Œä½†å¯¹äº HTML ä¸­<code>head</code>çš„å†…å®¹æˆ‘ä»¬æ— æ³•æ ¹æ®<strong>ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€</strong>æ¥å†³å®šï¼Œæ¯”å¦‚å¯¹äºä¸€ä¸ªç›´æ’­é—´çš„é¡µé¢ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡ç«¯æ¸²æŸ“å‡º title æ ‡ç­¾ï¼Œtitle çš„å†…å®¹æ˜¯ä¸åŒä¸»æ’­çš„ç›´æ’­é—´åç§°ï¼Œä¸èƒ½åœ¨ä»£ç ä¸­å†™æ­»ï¼Œè¿™ç§æƒ…å†µæ€ä¹ˆåŠï¼Ÿ</p><p>React ç”Ÿæ€ä¸­çš„ <a href="https://github.com/nfl/react-helmet" target="_blank" rel="noreferrer">react-helmet</a> ä»¥åŠ Vue ç”Ÿæ€ä¸­çš„ <a href="https://github.com/nuxt/vue-meta" target="_blank" rel="noreferrer">vue-meta</a> åº“å°±æ˜¯ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ç»„ä»¶ä¸­å†™ä¸€äº› Head æ ‡ç­¾ï¼Œç„¶ååœ¨æœåŠ¡ç«¯èƒ½å¤Ÿæ‹¿åˆ°ç»„ä»¶å†…éƒ¨çš„çŠ¶æ€ã€‚è¿™é‡Œæˆ‘ä»¥ä¸€ä¸ª<code>react-helmet</code>ä¾‹å­æ¥è¯´æ˜:</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// å‰ç«¯ç»„ä»¶é€»è¾‘</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Helmet</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">react-helmet</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">App</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">props</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">props</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    &lt;div&gt;</span></span>
<span class="line"><span style="color:#F07178;">       &lt;Helmet&gt;</span></span>
<span class="line"><span style="color:#F07178;">        &lt;title&gt;{ data.</span><span style="color:#A6ACCD;">user</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">çš„é¡µé¢</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#A6ACCD;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">link</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">rel</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">canonical</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://mysite.com/example</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#A6ACCD;">Helmet</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#A6ACCD;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æœåŠ¡ç«¯é€»è¾‘</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Helmet </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react-helmet</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// renderToString æ‰§è¡Œä¹‹å</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> helmet </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Helmet</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">renderStatic</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">title å†…å®¹: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> helmet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">title</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#A6ACCD;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">link å†…å®¹: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> helmet</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">link</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#A6ACCD;">())</span></span>
<span class="line"></span></code></pre></div><p>å¯åŠ¨æœåŠ¡åè®¿é—®é¡µé¢ï¼Œå¯ä»¥å‘ç°ç»ˆç«¯èƒ½æ‰“å°å‡ºå¦‚ä¸‹çš„ä¿¡æ¯:</p><p><img src="`+F+`" alt="meta SEO"></p><p>å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬å°±èƒ½æ ¹æ®ç»„ä»¶çš„çŠ¶æ€ç¡®å®š Head å†…å®¹ï¼Œç„¶ååœ¨<code>æ‹¼æ¥ HTML</code>é˜¶æ®µå°†è¿™äº›å†…å®¹æ’å…¥åˆ°æ¨¡æ¿ä¸­ã€‚</p><h3 id="_6-æµå¼æ¸²æŸ“" tabindex="-1">6. æµå¼æ¸²æŸ“ <a class="header-anchor" href="#_6-æµå¼æ¸²æŸ“" aria-hidden="true">#</a></h3><p>åœ¨ä¸åŒå‰ç«¯æ¡†æ¶çš„åº•å±‚éƒ½å®ç°äº†æµå¼æ¸²æŸ“çš„èƒ½åŠ›ï¼Œå³è¾¹æ¸²æŸ“è¾¹å“åº”ï¼Œè€Œä¸æ˜¯ç­‰æ•´ä¸ªç»„ä»¶æ ‘æ¸²æŸ“å®Œæ¯•ä¹‹åå†å“åº”ï¼Œè¿™ä¹ˆåšå¯ä»¥è®©å“åº”æå‰åˆ°è¾¾æµè§ˆå™¨ï¼Œæå‡é¦–å±çš„åŠ è½½æ€§èƒ½ã€‚Vue ä¸­çš„ <a href="https://www.npmjs.com/package/@vue/server-renderer" target="_blank" rel="noreferrer">renderToNodeStream</a> å’Œ React ä¸­çš„ <a href="https://reactjs.org/docs/react-dom-server.html#rendertonodestream" target="_blank" rel="noreferrer">renderToNodeStream</a> éƒ½å®ç°äº†æµå¼æ¸²æŸ“çš„èƒ½åŠ›, å¤§è‡´çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹:</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">renderToNodeStream</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react-dom/server</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è¿”å›ä¸€ä¸ª Nodejs çš„ Stream å¯¹è±¡</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> stream </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">renderToNodeStream</span><span style="color:#A6ACCD;">(element)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> html </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">stream</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">html</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å‘é€å“åº”</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">stream</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">end</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">html</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// æ¸²æŸ“å®Œæˆ</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å‘é€å“åº”</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">stream</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">err</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// é”™è¯¯å¤„ç†</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>ä¸è¿‡ï¼Œæµå¼æ¸²æŸ“åœ¨æˆ‘ä»¬å¸¦æ¥é¦–å±æ€§èƒ½æå‡çš„åŒæ—¶ï¼Œä¹Ÿç»™æˆ‘ä»¬å¸¦æ¥äº†ä¸€äº›é™åˆ¶: <strong>å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨ HTML ä¸­å¡«å…¥ä¸€äº›ä¸ç»„ä»¶çŠ¶æ€ç›¸å…³çš„å†…å®¹ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨æµå¼æ¸²æŸ“</strong>ã€‚æ¯”å¦‚<code>react-helmet</code>ä¸­è‡ªå®šä¹‰çš„ head å†…å®¹ï¼Œå³ä¾¿åœ¨æ¸²æŸ“ç»„ä»¶çš„æ—¶å€™æ”¶é›†åˆ°äº† head ä¿¡æ¯ï¼Œä½†åœ¨æµå¼æ¸²æŸ“ä¸­ï¼Œæ­¤æ—¶ HTML çš„ head éƒ¨åˆ†å·²ç»å‘é€ç»™æµè§ˆå™¨äº†ï¼Œè€Œè¿™éƒ¨åˆ†å“åº”å†…å®¹å·²ç»æ— æ³•æ›´æ”¹ï¼Œå› æ­¤ <code>react-helmet</code> åœ¨ SSR è¿‡ç¨‹ä¸­å°†ä¼šå¤±æ•ˆã€‚</p><h3 id="_7-ssr-ç¼“å­˜" tabindex="-1">7. SSR ç¼“å­˜ <a class="header-anchor" href="#_7-ssr-ç¼“å­˜" aria-hidden="true">#</a></h3><p>SSR æ˜¯ä¸€ç§å…¸å‹çš„ CPU å¯†é›†å‹æ“ä½œï¼Œä¸ºäº†å°½å¯èƒ½é™ä½çº¿ä¸Šæœºå™¨çš„è´Ÿè½½ï¼Œè®¾ç½®ç¼“å­˜æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ç¯èŠ‚ã€‚åœ¨ SSR è¿è¡Œæ—¶ï¼Œç¼“å­˜çš„å†…å®¹å¯ä»¥åˆ†ä¸ºè¿™ä¹ˆå‡ ä¸ªéƒ¨åˆ†:</p><ol><li><p><code>æ–‡ä»¶è¯»å–ç¼“å­˜</code>ã€‚å°½å¯èƒ½é¿å…å¤šæ¬¡é‡å¤è¯»ç£ç›˜çš„æ“ä½œï¼Œæ¯æ¬¡ç£ç›˜ IO å°½å¯èƒ½åœ°å¤ç”¨ç¼“å­˜ç»“æœã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤º:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createMemoryFsRead</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fileContentMap</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Map</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">filePath</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cacheResult</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fileContentMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filePath</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">cacheResult</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cacheResult</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fileContent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filePath</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">fileContentMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filePath</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fileContent</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fileContent</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> memoryFsRead </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createMemoryFsRead</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">memoryFsRead</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">file1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ç›´æ¥å¤ç”¨ç¼“å­˜</span></span>
<span class="line"><span style="color:#82AAFF;">memoryFsRead</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">file1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div></li><li><p><code>é¢„å–æ•°æ®ç¼“å­˜</code>ã€‚å¯¹äºæŸäº›å®æ—¶æ€§ä¸é«˜çš„æ¥å£æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–ç¼“å­˜çš„ç­–ç•¥ï¼Œåœ¨ä¸‹æ¬¡ç›¸åŒçš„è¯·æ±‚è¿›æ¥æ—¶å¤ç”¨ä¹‹å‰é¢„å–æ•°æ®çš„ç»“æœï¼Œè¿™æ ·é¢„å–æ•°æ®è¿‡ç¨‹çš„å„ç§ IO æ¶ˆè€—ï¼Œä¹Ÿå¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘é¦–å±æ—¶é—´ã€‚</p></li><li><p><code>HTML æ¸²æŸ“ç¼“å­˜</code>ã€‚æ‹¼æ¥å®Œæˆçš„<code>HTML</code>å†…å®¹æ˜¯ç¼“å­˜çš„é‡ç‚¹ï¼Œå¦‚æœèƒ½å°†è¿™éƒ¨åˆ†è¿›è¡Œç¼“å­˜ï¼Œé‚£ä¹ˆä¸‹æ¬¡å‘½ä¸­ç¼“å­˜ä¹‹åï¼Œå°†å¯ä»¥èŠ‚çœ <code>renderToString</code>ã€<code>HTML æ‹¼æ¥</code>ç­‰ä¸€ç³»åˆ—çš„æ¶ˆè€—ï¼ŒæœåŠ¡ç«¯çš„æ€§èƒ½æ”¶ç›Šä¼šæ¯”è¾ƒæ˜æ˜¾ã€‚</p></li></ol><p>å¯¹äºä»¥ä¸Šçš„ç¼“å­˜å†…å®¹ï¼Œå…·ä½“çš„ç¼“å­˜ä½ç½®å¯ä»¥æ˜¯ï¼š</p><ul><li><code>æœåŠ¡å™¨å†…å­˜</code>ã€‚å¦‚æœæ˜¯æ”¾åˆ°å†…å­˜ä¸­ï¼Œéœ€è¦è€ƒè™‘ç¼“å­˜æ·˜æ±°æœºåˆ¶ï¼Œé˜²æ­¢å†…å­˜è¿‡å¤§å¯¼è‡´æœåŠ¡å®•æœºï¼Œä¸€ä¸ªå…¸å‹çš„ç¼“å­˜æ·˜æ±°æ–¹æ¡ˆæ˜¯ <a href="https://github.com/isaacs/node-lru-cache" target="_blank" rel="noreferrer">lru-cache</a> (åŸºäº LRU ç®—æ³•)ã€‚</li><li><a href="https://github.com/redis/node-redis" target="_blank" rel="noreferrer">Redis æ•°æ®åº“</a>ï¼Œç›¸å½“äºä»¥ä¼ ç»Ÿåç«¯æœåŠ¡å™¨çš„è®¾è®¡æ€è·¯æ¥å¤„ç†ç¼“å­˜ã€‚</li><li>CDN æœåŠ¡ã€‚æˆ‘ä»¬å¯ä»¥å°†é¡µé¢å†…å®¹ç¼“å­˜åˆ° CDN æœåŠ¡ä¸Šï¼Œåœ¨ä¸‹ä¸€æ¬¡ç›¸åŒçš„è¯·æ±‚è¿›æ¥æ—¶ï¼Œä½¿ç”¨ CDN ä¸Šçš„ç¼“å­˜å†…å®¹ï¼Œè€Œä¸ç”¨æ¶ˆè´¹æºæœåŠ¡å™¨çš„èµ„æºã€‚å¯¹äº CDN ä¸Šçš„ SSR ç¼“å­˜ï¼Œå¤§å®¶å¯ä»¥é€šè¿‡é˜…è¯»<a href="https://juejin.cn/post/6887884087915184141#heading-8" target="_blank" rel="noreferrer">è¿™ç¯‡æ–‡ç« </a>æ·±å…¥äº†è§£ã€‚</li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>éœ€è¦è¡¥å……çš„æ˜¯ï¼ŒVue ä¸­å¦å¤–å®ç°äº†<a href="https://ssr.vuejs.org/zh/guide/caching.html#%E7%BB%84%E4%BB%B6%E7%BA%A7%E5%88%AB%E7%BC%93%E5%AD%98-component-level-caching" target="_blank" rel="noreferrer">ç»„ä»¶çº§åˆ«çš„ç¼“å­˜</a>ï¼Œè¿™éƒ¨åˆ†ç¼“å­˜ä¸€èˆ¬æ”¾åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥å®ç°æ›´ç»†ç²’åº¦çš„ SSR ç¼“å­˜ã€‚</p></div><h3 id="_8-æ€§èƒ½ç›‘æ§" tabindex="-1">8. æ€§èƒ½ç›‘æ§ <a class="header-anchor" href="#_8-æ€§èƒ½ç›‘æ§" aria-hidden="true">#</a></h3><p>åœ¨å®é™…çš„ SSR é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬æ—¶å¸¸ä¼šé‡åˆ°ä¸€äº› SSR çº¿ä¸Šæ€§èƒ½é—®é¢˜ï¼Œå¦‚æœæ²¡æœ‰ä¸€ä¸ªå®Œæ•´çš„æ€§èƒ½ç›‘æ§æœºåˆ¶ï¼Œé‚£ä¹ˆå°†å¾ˆéš¾å‘ç°å’Œæ’æŸ¥é—®é¢˜ã€‚å¯¹äº SSR æ€§èƒ½æ•°æ®ï¼Œæœ‰ä¸€äº›æ¯”è¾ƒé€šç”¨çš„æŒ‡æ ‡:</p><ul><li>SSR äº§ç‰©åŠ è½½æ—¶é—´</li><li>æ•°æ®é¢„å–çš„æ—¶é—´</li><li>ç»„ä»¶æ¸²æŸ“çš„æ—¶é—´</li><li>æœåŠ¡ç«¯æ¥å—è¯·æ±‚åˆ°å“åº”çš„å®Œæ•´æ—¶é—´</li><li>SSR ç¼“å­˜å‘½ä¸­æƒ…å†µ</li><li>SSR æˆåŠŸç‡ã€é”™è¯¯æ—¥å¿—</li></ul><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>perf_hooks</code>æ¥å®Œæˆæ•°æ®çš„é‡‡é›†ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">performance</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">PerformanceObserver</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">perf_hooks</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// åˆå§‹åŒ–ç›‘å¬å™¨é€»è¾‘</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> perfObserver </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PerformanceObserver</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">items</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">items</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getEntries</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">entry</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">[performance]</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">duration</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toFixed</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ms</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">performance</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clearMarks</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">perfObserver</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">observe</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">entryTypes</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">measure</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ SSR è¿›è¡Œæ‰“ç‚¹</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ä»¥ renderToString  ä¸ºä¾‹</span></span>
<span class="line"><span style="color:#A6ACCD;">performance</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">mark</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">render-start</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// renderToString ä»£ç çœç•¥</span></span>
<span class="line"><span style="color:#A6ACCD;">performance</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">mark</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">render-end</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">performance</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">measure</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">renderToString</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">render-start</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">render-end</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬å¯åŠ¨æœåŠ¡åè®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„æ‰“ç‚¹æ—¥å¿—ä¿¡æ¯:</p><p><img src="`+D+'" alt="perf monitor"></p><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å®ƒé˜¶æ®µçš„æŒ‡æ ‡é€šè¿‡ä¸Šè¿°çš„æ–¹å¼æ”¶é›†èµ·æ¥ï¼Œä½œä¸ºæ€§èƒ½æ—¥å¿—ï¼›å¦ä¸€æ–¹é¢ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬éœ€è¦ç»“åˆå…·ä½“çš„æ€§èƒ½ç›‘æ§å¹³å°ï¼Œå¯¹ä¸Šè¿°çš„å„é¡¹æŒ‡æ ‡è¿›è¡Œæ‰“ç‚¹ä¸ŠæŠ¥ï¼Œå®Œæˆçº¿ä¸Šçš„ SSR æ€§èƒ½ç›‘æ§æœåŠ¡ã€‚</p><h3 id="_9-ssg-isr-spr" tabindex="-1">9. SSG/ISR/SPR <a class="header-anchor" href="#_9-ssg-isr-spr" aria-hidden="true">#</a></h3><p>æœ‰æ—¶å€™å¯¹äºä¸€äº›é™æ€ç«™ç‚¹(å¦‚åšå®¢ã€æ–‡æ¡£)ï¼Œä¸æ¶‰åŠåˆ°åŠ¨æ€å˜åŒ–çš„æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬å¹¶ä¸éœ€è¦ç”¨ä¸ŠæœåŠ¡ç«¯æ¸²æŸ“ã€‚æ­¤æ—¶åªéœ€è¦åœ¨æ„å»ºé˜¶æ®µäº§å‡ºå®Œæ•´çš„ HTML è¿›è¡Œéƒ¨ç½²å³å¯ï¼Œè¿™ç§æ„å»ºé˜¶æ®µç”Ÿæˆ HTML çš„åšæ³•ä¹Ÿå«<code>SSG</code>(Static Site Generationï¼Œé™æ€ç«™ç‚¹ç”Ÿæˆ)ã€‚</p><p>SSG ä¸ SSR æœ€å¤§çš„åŒºåˆ«å°±æ˜¯äº§å‡º HTML çš„æ—¶é—´ç‚¹ä» SSR <code>è¿è¡Œæ—¶</code>å˜æˆäº†<code>æ„å»ºæ—¶</code>ï¼Œä½†æ ¸å¿ƒçš„ç”Ÿå‘½å‘¨æœŸæµç¨‹å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–:</p><p><img src="'+s+`" alt="SSR Flow"></p><p>è¿™é‡Œç»™ä¸€æ®µç®€å•çš„å®ç°ä»£ç :</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// scripts/ssg.ts</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ä»¥ä¸‹çš„å·¥å…·å‡½æ•°å‡å¯ä»¥ä» SSR æµç¨‹å¤ç”¨</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ssg</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 1. åŠ è½½æœåŠ¡ç«¯å…¥å£</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ServerEntry</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fetchData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">loadSsrEntryModule</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">null</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 2. æ•°æ®é¢„å–</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetchData</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 3. ç»„ä»¶æ¸²æŸ“</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appHtml</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">renderToString</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">React</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createElement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ServerEntry</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 4. HTML æ‹¼æ¥</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">template</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">resolveTemplatePath</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">templateHtml</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">template</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">html</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">templateHtml</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&lt;!-- SSR_APP --&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appHtml</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&lt;!-- SSR_DATA --&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">&lt;script&gt;window.__SSR_DATA__=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(data)</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&lt;/script&gt;</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#F07178;">  )</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æœ€åï¼Œæˆ‘ä»¬éœ€è¦å°† HTML çš„å†…å®¹å†™åˆ°ç£ç›˜ä¸­ï¼Œå°†å…¶ä½œä¸ºæ„å»ºäº§ç‰©</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">mkdirSync</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dist/client</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> recursive</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">writeFileSync</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dist/client/index.html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">html</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">ssg</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>æ¥ç€ä½ å¯ä»¥åœ¨<code>package.json</code>ä¸­åŠ å…¥è¿™æ ·ä¸€æ®µ npm scripts:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">build:ssg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">npm run build &amp;&amp; NODE_ENV=production tsx scripts/ssg.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>è¿™æ ·æˆ‘ä»¬ä¾¿åˆæ­¥å®ç°äº† SSG çš„é€»è¾‘ã€‚å½“ç„¶ï¼Œé™¤äº† SSGï¼Œä¸šç•Œè¿˜æµä¼ ç€ä¸€äº›å…¶å®ƒçš„æ¸²æŸ“æ¨¡å¼ï¼Œè¯¸å¦‚<code>SPR</code>ã€<code>ISR</code>ï¼Œå¬èµ·æ¥æ¯”è¾ƒé«˜å¤§ä¸Šï¼Œä½†å®é™…ä¸Šåªæ˜¯ SSR å’Œ SSG æ‰€è¡ç”Ÿå‡ºæ¥çš„æ–°åŠŸèƒ½ç½¢äº†ï¼Œè¿™é‡Œç®€å•ç»™å¤§å®¶è§£é‡Šä¸€ä¸‹:</p><ul><li><code>SPR</code>å³<code>Serverless Pre Render</code>ï¼Œå³æŠŠ SSR çš„æœåŠ¡éƒ¨ç½²åˆ° Serverless(FaaS) ç¯å¢ƒä¸­ï¼Œå®ç°æœåŠ¡å™¨å®ä¾‹çš„è‡ªåŠ¨æ‰©ç¼©å®¹ï¼Œé™ä½æœåŠ¡å™¨è¿ç»´çš„æˆæœ¬ã€‚</li><li><code>ISR</code>å³<code>Incremental Site Rendering</code>ï¼Œå³å¢é‡ç«™ç‚¹æ¸²æŸ“ï¼Œå°†ä¸€éƒ¨åˆ†çš„ SSG é€»è¾‘ä»æ„å»ºæ—¶æ¬åˆ°äº† <code>SSR</code> è¿è¡Œæ—¶ï¼Œè§£å†³çš„æ˜¯å¤§é‡é¡µé¢ SSG æ„å»ºè€—æ—¶é•¿çš„é—®é¢˜ã€‚</li></ul><h2 id="å°ç»“" tabindex="-1">å°ç»“ <a class="header-anchor" href="#å°ç»“" aria-hidden="true">#</a></h2><p>æ­å–œä½ ï¼Œå­¦ä¹ å®Œäº† <code>Vite SSR</code> å°èŠ‚çš„å†…å®¹ã€‚åœ¨æœ¬å°èŠ‚ä¸­ï¼Œä½ éœ€è¦é‡ç‚¹æŒæ¡ <strong>Vite ä¸­ SSR é¡¹ç›®çš„æ­å»º</strong>å’Œ <strong>SSR å·¥ç¨‹åŒ–é—®é¢˜åŠå…¶å¯¹åº”çš„è§£å†³æ–¹æ¡ˆ</strong>ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ç»™ä½ ä»‹ç»äº† SSR çš„åŸºæœ¬æ¦‚å¿µï¼Œå…ˆåˆ†æä¼ ç»Ÿçš„ CSR åˆ°åº•å­˜åœ¨å“ªäº›é—®é¢˜ï¼Œç„¶åä»‹ç» SSR æ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜çš„ã€‚æ¥ç€æˆ‘ç»™ä½ åˆ†æäº† SSR åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸»è¦åŒ…å«<code>æ„å»ºæ—¶</code>å’Œ<code>è¿è¡Œæ—¶</code>ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå¸¦ä½ ä»å®è§‚ä¸Šäº†è§£äº†è¦å®ç° SSR ç©¶ç«Ÿéœ€è¦åšå“ªäº›äº‹æƒ…ã€‚å½“ç„¶ï¼Œå…‰ä»‹ç»æ¦‚å¿µæ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œåœ¨æ¥ä¸‹æ¥çš„æ—¶é—´ï¼Œæˆ‘ç”¨å…·ä½“çš„é¡¹ç›®ç¤ºä¾‹å¸¦ä½ ä¸€æ­¥æ­¥æ­å»ºèµ·äº†ä¸€ä¸ªç®€å•çš„ SSR å·¥ç¨‹ï¼Œå€ŸåŠ© <code>Vite</code>å®ç°äº†<code>å®¢æˆ·ç«¯äº§ç‰©</code>ä¸<code>SSR äº§ç‰©</code>çš„æ„å»ºï¼Œç„¶åé€šè¿‡ SSR ä¸­é—´ä»¶çš„å¼€å‘å®ç°äº† SSR è¿è¡Œæ—¶çš„é€»è¾‘ï¼ŒåŒ…æ‹¬<code>åŠ è½½æœåŠ¡ç«¯å…¥å£</code>ã€<code>æ•°æ®é¢„å–</code>ã€<code>ç»„ä»¶æ¸²æŸ“</code>å’Œ<code>HTML æ‹¼æ¥</code>è¿™å››ä¸ªæ ¸å¿ƒçš„æ­¥éª¤ã€‚</p><p>è™½ç„¶è¯´åŸºäºç¤ºä¾‹ä»£ç æˆ‘ä»¬å¯ä»¥æ­å»º Vite çš„ SSR é¡¹ç›®ï¼Œä½†é¢å¯¹å®é™…çš„å¼€å‘åœºæ™¯ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦è€ƒè™‘è¯¸å¤šçš„å·¥ç¨‹åŒ–é—®é¢˜ï¼Œä½ å¯ä»¥å‚è€ƒä¸‹é¢è¿™å¼ å›¾:</p><p><img src="`+i+'" alt="SSRå·¥ç¨‹åŒ–éœ€è¦è§£å†³çš„é—®é¢˜"></p><p>å…¶ä¸­åŒ…æ‹¬<code>è·¯ç”±ç®¡ç†</code>ã€<code>çŠ¶æ€ç®¡ç†</code>ã€<code>CSR é™çº§</code>ã€<code>æµè§ˆå™¨ API çš„ SSR å…¼å®¹</code>ã€<code>è‡ªå®šä¹‰ Head</code>ã€<code>æµå¼æ¸²æŸ“</code>ã€<code>SSR ç¼“å­˜</code>ã€<code>æ€§èƒ½ç›‘æ§</code>ä»¥åŠæ›´å¤šçš„é¢„æ¸²æŸ“æ¨¡å¼<code>SSG/SPR/ISR</code>ã€‚åœ¨åé¢çš„ç¯‡å¹…ï¼Œæˆ‘å¸¦ä½ è¯¦ç»†æ¢³ç†äº†è¿™äº›é—®é¢˜ï¼Œåˆ†æå„ä¸ªé—®é¢˜çš„å‡ºç°åœºæ™¯ï¼Œå¹¶ç»™å‡ºä¸€äº›æ¯”è¾ƒé€šç”¨çš„è§£å†³æ€è·¯å’Œè§£å†³æ–¹æ¡ˆã€‚ç›¸ä¿¡é€šè¿‡è¿™éƒ¨åˆ†çš„å­¦ä¹ ï¼Œä½ ä¹Ÿèƒ½é©¾é©­æ›´åŠ å¤æ‚çš„ SSR å¼€å‘åœºæ™¯äº†ã€‚</p><p>OKï¼Œæœ¬æ–‡çš„å†…å®¹åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œå¸Œæœ›èƒ½å¯¹ä½ æœ‰æ‰€å¯å‘ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè‡ªå·±çš„å­¦ä¹ å¿ƒå¾—å’Œæ”¶è·æ‰“åœ¨è¯„è®ºåŒºï¼Œæˆ‘ä»¬ä¸‹ä¸€èŠ‚å†è§ğŸ‘‹ğŸ»ã€‚</p><p>ä»£ç åœ°å€ï¼š</p><ul><li><a href="https://github.com/jamessawyer/vite-ssr" target="_blank" rel="noreferrer">vite-ssr - @github</a></li></ul><details class="details custom-block"><summary>è¯„è®ºåŒºå…³äºæœ¬èŠ‚çš„æ€è€ƒ</summary><p>å¹²è´§æ»¡æ»¡ï¼ŒæŠŠä»£ç cloneä¸‹æ¥ï¼Œç»“åˆä½œè€…è€å¸ˆçš„ä»£ç çœ‹ï¼Œå¾ˆæœ‰æ”¶è·ï¼Œä¸ä½†å·¥ç¨‹ä¸Šæœ‰å¸®åŠ©ï¼Œé¢è¯•ä¸Šä¹Ÿæœ‰å¸®åŠ©ï¼Œæé«˜äº†å¯¹SSRçš„ç†è§£~å­¦å®Œæœ¬æ–‡ï¼Œå¯ä»¥è‡³å°‘ä¼šå›ç­”ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li>CSRå­˜åœ¨çš„é—®é¢˜?</li><li>SSRä¸ºä»€ä¹ˆèƒ½åŠ å¿«é¦–å±åŠ è½½é€Ÿåº¦å’Œæœ‰åˆ©äºSEOï¼Ÿ</li><li>SSRåº”ç”¨çš„ä¸¤å¤§ç”Ÿå‘½å‘¨æœŸæ˜¯ä»€ä¹ˆï¼Ÿ</li><li>SSRåœ¨â€œæ„å»ºæ—¶â€éœ€è¦åšå“ªäº›äº‹æƒ…ï¼Ÿ</li><li>SSRåœ¨â€è¿è¡Œæ—¶â€éƒ½éœ€è¦åšå“ªäº›äº‹ï¼Ÿ</li><li>ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦ç”±SSRé™çº§åˆ°CSR?</li><li>SSRä¸­ä¸èƒ½ä½¿ç”¨windowï¼Œdocumentä¹‹ç±»çš„APIå¦‚ä½•è§£å†³ï¼Ÿ</li><li>SSRä¸­å¦‚ä½•è‡ªå®šä¹‰Head?</li><li>SSRä¸­ä½¿ç”¨æµå¼æ¸²æŸ“æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿæœ‰ä»€ä¹ˆé™åˆ¶ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆå³è¾¹è¦åœ¨SSRä¸­ä½¿ç”¨ç¼“å­˜ï¼Ÿéƒ½ç¼“å­˜ä»€ä¹ˆå†…å®¹ï¼Ÿ</li><li>SSRæ€§èƒ½ç›‘æ§éƒ½å…³æ³¨å“ªäº›æŒ‡æ ‡ï¼Ÿ</li></ol></details><p>ğŸš€ å…³äºVite SSR å¯ä»¥å‚è€ƒï¼š</p><ul><li><a href="https://cn.vite-plugin-ssr.com/" target="_blank" rel="noreferrer">Vite-plugin-SSR</a> æ’ä»¶é¡¹ç›®ğŸ‘</li><li><a href="https://cn.vitejs.dev/guide/ssr.html" target="_blank" rel="noreferrer">Vite SSR - Vite Doc</a></li><li><a href="https://cn.vitejs.dev/config/server-options.html#server-middlewaremode" target="_blank" rel="noreferrer">Vite Server Options - Vite Doc</a></li></ul><p>2023å¹´02æœˆ27æ—¥14:03:00</p>',156),d=[A];function u(f,E,h,g,m,S){return l(),a("div",null,d)}const R=n(C,[["render",u]]);export{b as __pageData,R as default};
