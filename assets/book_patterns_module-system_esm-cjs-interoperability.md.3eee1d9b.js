import{_ as s,c as a,o as n,b as l}from"./app.48b3db48.js";const A=JSON.parse('{"title":"äº’æ“æ€§","description":"","frontmatter":{"title":"äº’æ“æ€§"},"headers":[{"level":2,"title":"ESMé»˜è®¤ä¸¥æ ¼æ¨¡å¼","slug":"esmé»˜è®¤ä¸¥æ ¼æ¨¡å¼","link":"#esmé»˜è®¤ä¸¥æ ¼æ¨¡å¼","children":[]},{"level":2,"title":"â­ ESMä¸­ç¼ºå°‘çš„å¼•ç”¨","slug":"â­-esmä¸­ç¼ºå°‘çš„å¼•ç”¨","link":"#â­-esmä¸­ç¼ºå°‘çš„å¼•ç”¨","children":[]},{"level":2,"title":"â­ äº’æ“æ€§","slug":"â­-äº’æ“æ€§","link":"#â­-äº’æ“æ€§","children":[]},{"level":2,"title":"fileURLToPath & pathToFileURL","slug":"fileurltopath-pathtofileurl","link":"#fileurltopath-pathtofileurl","children":[]}],"relativePath":"book/patterns/module-system/esm-cjs-interoperability.md","lastUpdated":1676544939000}'),o={name:"book/patterns/module-system/esm-cjs-interoperability.md"},e=l(`<nav class="table-of-contents"><ul><li><a href="#esmé»˜è®¤ä¸¥æ ¼æ¨¡å¼">ESMé»˜è®¤ä¸¥æ ¼æ¨¡å¼</a></li><li><a href="#â­-esmä¸­ç¼ºå°‘çš„å¼•ç”¨">â­ ESMä¸­ç¼ºå°‘çš„å¼•ç”¨</a></li><li><a href="#â­-äº’æ“æ€§">â­ äº’æ“æ€§</a></li><li><a href="#fileurltopath-pathtofileurl">fileURLToPath &amp; pathToFileURL</a></li></ul></nav><p>ä¹‹å‰å·²ç»æåˆ°äº†ESMå’ŒCommonJSæ¨¡å—ç³»ç»Ÿçš„å‡ ä¸ªé‡è¦å·®å¼‚ï¼Œæ¯”å¦‚ï¼ŒESMå¯¼å…¥æ—¶å¿…é¡»æ˜¾å¼çš„å¸¦ä¸Šæ–‡ä»¶æ‰©å±•åï¼Œè€ŒCJSçš„ <code>require()</code> æ–‡ä»¶æ‰©å±•åå®Œå…¨æ˜¯å¯é€‰çš„ã€‚ ä¸‹é¢æ¥ç€è®¨è®ºä¸€ä¸‹ESMå’ŒCJSçš„å…¶å®ƒé‡è¦å·®å¼‚ä»¥åŠ2ä¸ªæ¨¡å—ç³»ç»Ÿä¹‹é—´åœ¨å¿…è¦æ—¶å¦‚ä½•ç»“åˆä½¿ç”¨ã€‚</p><h2 id="esmé»˜è®¤ä¸¥æ ¼æ¨¡å¼" tabindex="-1">ESMé»˜è®¤ä¸¥æ ¼æ¨¡å¼ <a class="header-anchor" href="#esmé»˜è®¤ä¸¥æ ¼æ¨¡å¼" aria-hidden="true">#</a></h2><p>ESMéšå¼çš„è¿è¡Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¸å¿…åœ¨æ–‡ä»¶çš„æœ€å¼€å¤´æ·»åŠ  <code>&quot;use strict;&quot;</code> è¯­å¥ã€‚å¹¶ä¸”ESMä¸¥æ ¼æ¨¡å¼æ˜¯ä¸èƒ½è¢«ç¦ç”¨çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨æœªå£°æ˜çš„å˜é‡ï¼Œæˆ–è€… <code>with</code> è¯­å¥ï¼Œæˆ–å…¶å®ƒåªèƒ½åœ¨éä¸¥æ ¼æ¨¡å¼æ‰å…è®¸çš„åŠŸèƒ½ï¼Œè¿™ç»å¯¹æ˜¯ä¸€ä»¶å¥½äº‹ï¼Œå› ä¸ºä¸¥æ ¼æ¨¡å¼æ›´åŠ çš„å®‰å…¨ã€‚</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Strict_mode" target="_blank" rel="noreferrer">strict mode -MDN</a></li></ul><h2 id="â­-esmä¸­ç¼ºå°‘çš„å¼•ç”¨" tabindex="-1">â­ ESMä¸­ç¼ºå°‘çš„å¼•ç”¨ <a class="header-anchor" href="#â­-esmä¸­ç¼ºå°‘çš„å¼•ç”¨" aria-hidden="true">#</a></h2><p>åœ¨ESMä¸­ï¼Œä¸€äº›CommonJSä¸­æ¯”è¾ƒé‡è¦çš„å¼•ç”¨æ˜¯ä¸å­˜åœ¨çš„ğŸ˜…ã€‚</p><ul><li>æ¯”å¦‚ <code>require</code> &amp; <code>exports</code> &amp; <code>module.exports</code> &amp; <code>__dirname</code> &amp; <code>__filename</code></li><li>å› ä¸ºESMè¿è¡Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå¦‚æœä½ ç›´æ¥ä½¿ç”¨è¿™äº›ä¸å­˜åœ¨å˜é‡ï¼Œä¼šç›´æ¥æŠ›å‡º <code>ReferenceError</code></li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// âŒ ReferenceError: exports is not defined in ES module scope</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">exports</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// âŒ ReferenceError: module is not defined in ES module scope</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">module</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// âŒ ReferenceError: __filename is not defined in ES module scope</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(__filename)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// âŒ ReferenceError: __dirname is not defined in ES module scope</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(__dirname)</span></span>
<span class="line"></span></code></pre></div><p>å¯¹CommonJSä¸­çš„ <code>exports</code> å’Œ <code>module</code> æˆ‘ä»¬å·²ç»<a href="./commonjs-modules.html#ğŸš€-module-exports-vs-exports">è®¨è®º</a>å¾ˆå¤šäº†; <code>__filename</code> å’Œ <code>__dirname</code> è¡¨ç¤ºç›¸å¯¹äºå½“å‰æ¨¡å—æ–‡ä»¶çš„ç»å¯¹è·¯å¾„å’Œç›¸å¯¹äºçˆ¶æ–‡ä»¶å¤¹çš„ç»å¯¹è·¯å¾„ã€‚å½“æˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªç›¸å¯¹å½“å‰æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„æ—¶ï¼Œè¿™2ä¸ªç‰¹æ®Šçš„å˜é‡ä¼šéå¸¸çš„æœ‰ç”¨ã€‚</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>åœ¨ESMä¸­ï¼Œå¯ä»¥é€šè¿‡ç‰¹æ®Šçš„ <strong><code>i<wbr>mport.meta</code></strong> å¯¹è±¡æ¥è·å–å½“å‰æ–‡ä»¶URLçš„å¼•ç”¨ã€‚å…·ä½“æ¥è®²ï¼Œ<code>i<wbr>mport.meta.url</code> æ˜¯å¯¹å½“å‰æ¨¡å—æ–‡ä»¶çš„å¼•ç”¨ï¼Œæ ¼å¼ç±»ä¼¼æ˜¯ <code>file:///path/to/current_module.js</code>ã€‚é€šè¿‡è¿™ä¸ªå€¼æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»å¯¹è·¯å¾„çš„æ–¹å¼é‡å»º <code>__filename</code> &amp; <code>__dirname</code> åŠŸèƒ½ğŸ‰ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fileURLToPath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dirname</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> __filename </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fileURLToPath</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">url)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> __dirname </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">dirname</span><span style="color:#A6ACCD;">(__filename)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(__filename)</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(__dirname)</span></span>
<span class="line"></span></code></pre></div><p>åŒæ ·å¯ä»¥é€šè¿‡ä¸‹é¢æ–¹å¼é‡å»º <code>require()</code> å‡½æ•°ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createRequire</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> require </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createRequire</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">url)</span></span>
<span class="line"></span></code></pre></div><p>ğŸŒ° <code>./cjs/math.js</code> æ˜¯ä¸€ä¸ª <code>CommonJS</code> æ¨¡å—ï¼Œæ³¨æ„ <code>cjs</code> æ–‡ä»¶å¤¹ä¸­çš„ <code>package.json</code> çš„ <code>type</code> å­—æ®µä¸è¦å£°æ˜ä¸º <code>&quot;module&quot;</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">b</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">b</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>åœ¨ESMä¸­å¯¼å…¥CommonJSæ¨¡å—ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createRequire</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> require </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createRequire</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">url)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ä½¿ç”¨å®šä¹‰çš„ requireå¯¼å…¥CJSæ¨¡å—</span></span>
<span class="line highlighted"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> add </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./cjs/math</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">add</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">))</span></span>
<span class="line"></span></code></pre></div></div><p>å¦ä¸€ä¸ªå·®å¼‚å°±æ˜¯ï¼ŒESMä¸­çš„ <code>this</code> å…³é”®è¯ï¼š</p><ul><li>å› ä¸ºESMæ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œ <code>this</code> è¡¨ç¤º <code>undefined</code></li><li>è€ŒCJSä¸­ï¼Œ<code>this</code> è¡¨ç¤ºå¯¹ <code>exports</code> çš„å¼•ç”¨</li></ul><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// this.js - ESM</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">this</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;font-style:italic;">// undefined</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// this.js - CJS</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">this</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">exports</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;font-style:italic;">// true</span></span>
<span class="line"></span></code></pre></div><h2 id="â­-äº’æ“æ€§" tabindex="-1">â­ äº’æ“æ€§ <a class="header-anchor" href="#â­-äº’æ“æ€§" aria-hidden="true">#</a></h2><p>ä¸Šé¢æˆ‘ä»¬å·²ç»è®¨è®ºäº†ï¼Œå¦‚æœé€šè¿‡ <code>module.createRequire</code> å‡½æ•°åœ¨ESMä¸­å¯¼å…¥CJSæ¨¡å—ã€‚<strong>é™¤äº†ä¸Šé¢é‚£ç§æ–¹å¼å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ <code>import</code> è¯­æ³•å¯¼å…¥CJSæ¨¡å—ï¼Œä½†ä»…é™äº <code>é»˜è®¤å¯¼å‡º</code>ğŸ˜</strong>ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// âœ… å¯¼å…¥CJSä¸­çš„é»˜è®¤å¯¼å‡º</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> packageMain </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">commonjs-package</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// âŒ å¯¼å…¥CJSä¸­çš„æœ‰åå¯¼å‡º</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">method</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">commonjs-package</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><p>å› æ­¤ä¸Šé¢çš„ä¾‹å­å¯ä»¥å†™ä¸ºï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> add </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./cjs/math.js</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">add</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">))</span></span>
<span class="line"></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>ğŸš¨ ä¸èƒ½åœ¨CommonJSæ¨¡å—ä¸­å¯¼å…¥ESMæ¨¡å—</p></div><p>å¦å¤–ï¼ŒESMä¸èƒ½ç›´æ¥ä»¥æ¨¡å—å½¢å¼å¯¼å…¥JSONæ–‡ä»¶ï¼Œè¿™åœ¨CommonJSä¸­æ˜¯ç”¨å¾—å¾ˆå¤šä¸€ä¸ªåŠŸèƒ½ã€‚ä¸‹é¢ <code>import</code> è¯­å¥å°†å¤±è´¥ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// âŒ TypeError [ERR_UNKNOWN_FILE_EXTENSION]: Unknown file extension &quot;.json&quot; for</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> data </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./data.json</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><p>ä¸ºäº†çªç ´è¿™ä¸ªé™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡ä½¿ç”¨ <code>module.createRequire()</code> å·¥å…·ğŸ’¡ï¼š</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createRequire</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> require </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createRequire</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">url)</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./data.json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(data)</span></span>
<span class="line"></span></code></pre></div><p>ESMåŸç”Ÿæ”¯æŒJSONæ¨¡å—çš„èƒ½åŠ›è¿˜åœ¨å¼€å‘ä¸­ï¼Œå› æ­¤ï¼Œåœ¨æœªæ¥æˆ‘ä»¬å¯èƒ½å¯ä»¥ä¸éœ€è¦ä¾èµ– <code>createRequire()</code>çš„å¸®åŠ©ï¼Œå°±å¯ä»¥ç›´æ¥å¯¼å…¥JSONæ¨¡å—äº†ğŸ˜ã€‚</p><h2 id="fileurltopath-pathtofileurl" tabindex="-1">fileURLToPath &amp; pathToFileURL <a class="header-anchor" href="#fileurltopath-pathtofileurl" aria-hidden="true">#</a></h2><p>è¯‘è€…è¡¥å……ï¼šå…³äºESMä¸­çš„ <code>fileURLToPath</code> &amp; <code>pathToFileURL</code> å®šä¹‰å’Œç”¨æ³•ï¼š</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * This function ensures the correct decodings of percent-encoded characters as</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * well as ensuring a cross-platform valid absolute path string.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * \`\`\`js</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * import { fileURLToPath } from &#39;url&#39;;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * const __filename = fileURLToPath(i<wbr>mport.meta.url);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * new URL(&#39;file:///C:/path/&#39;).pathname;      // Incorrect: /C:/path/</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * fileURLToPath(&#39;file:///C:/path/&#39;);         // Correct:   C:\\path\\ (Windows)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * new URL(&#39;file://nas/foo.txt&#39;).pathname;    // Incorrect: /foo.txt</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * fileURLToPath(&#39;file://nas/foo.txt&#39;);       // Correct:   \\\\nas\\foo.txt (Windows)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * new URL(&#39;file:///ä½ å¥½.txt&#39;).pathname;      // Incorrect: /%E4%BD%A0%E5%A5%BD.txt</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * fileURLToPath(&#39;file:///ä½ å¥½.txt&#39;);         // Correct:   /ä½ å¥½.txt (POSIX)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * new URL(&#39;file:///hello world&#39;).pathname;   // Incorrect: /hello%20world</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * fileURLToPath(&#39;file:///hello world&#39;);      // Correct:   /hello world (POSIX)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * \`\`\`</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">since</span><span style="color:#676E95;font-style:italic;"> v10.12.0</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#676E95;font-style:italic;"> The file URL string or URL object to convert to a path.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">return</span><span style="color:#676E95;font-style:italic;"> The fully-resolved platform-specific Node.js file path.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fileURLToPath</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">URL</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * This function ensures that \`path\` is resolved absolutely, and that the URL</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * control characters are correctly encoded when converting into a File URL.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * \`\`\`js</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * import { pathToFileURL } from &#39;url&#39;;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * new URL(&#39;/foo#1&#39;, &#39;file:&#39;);           // Incorrect: file:///foo#1</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * pathToFileURL(&#39;/foo#1&#39;);              // Correct:   file:///foo%231 (POSIX)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * new URL(&#39;/some/path%.c&#39;, &#39;file:&#39;);    // Incorrect: file:///some/path%.c</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * pathToFileURL(&#39;/some/path%.c&#39;);       // Correct:   file:///some/path%25.c (POSIX)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * \`\`\`</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">since</span><span style="color:#676E95;font-style:italic;"> v10.12.0</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">path</span><span style="color:#676E95;font-style:italic;"> The path to convert to a File URL.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">return</span><span style="color:#676E95;font-style:italic;"> The file URL object.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">pathToFileURL</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">URL</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>2022å¹´10æœˆ22æ—¥21:26:20</p>`,29),p=[e];function t(c,r,i,y,D,C){return n(),a("div",null,p)}const d=s(o,[["render",t]]);export{A as __pageData,d as default};
