import{_ as s}from"./chunks/8-1.5dd53b82.js";import{_ as n,c as a,o as l,b as p}from"./app.1032310a.js";const o="/awesome-node/assets/12-2.f9143ecc.webp",e="/awesome-node/assets/12-3.b3ca8235.webp",t="/awesome-node/assets/12-4.5acd63d4.webp",c="/awesome-node/assets/12-5.69a1233c.webp",r="/awesome-node/assets/12-6.a7e2b657.webp",F="/awesome-node/assets/12-7.cb1cd6a9.webp",y="/awesome-node/assets/12-8.7f887a3d.webp",D="/awesome-node/assets/12-9.488ec72c.webp",i="/awesome-node/assets/12-10.6831006b.webp",k=JSON.parse('{"title":"Viteæ’ä»¶å¼€å‘","description":"","frontmatter":{"title":"Viteæ’ä»¶å¼€å‘"},"headers":[{"level":2,"title":"ä¸€ä¸ªç®€å•çš„æ’ä»¶ç¤ºä¾‹","slug":"ä¸€ä¸ªç®€å•çš„æ’ä»¶ç¤ºä¾‹","link":"#ä¸€ä¸ªç®€å•çš„æ’ä»¶ç¤ºä¾‹","children":[]},{"level":2,"title":"1. é€šç”¨ Hook","slug":"_1-é€šç”¨-hook","link":"#_1-é€šç”¨-hook","children":[]},{"level":2,"title":"2. ç‹¬æœ‰ Hook","slug":"_2-ç‹¬æœ‰-hook","link":"#_2-ç‹¬æœ‰-hook","children":[{"level":3,"title":"2.1 ç»™é…ç½®å†åŠ ç‚¹æ–™: config","slug":"_2-1-ç»™é…ç½®å†åŠ ç‚¹æ–™-config","link":"#_2-1-ç»™é…ç½®å†åŠ ç‚¹æ–™-config","children":[]},{"level":3,"title":"2.2 è®°å½•æœ€ç»ˆé…ç½®: configResolved","slug":"_2-2-è®°å½•æœ€ç»ˆé…ç½®-configresolved","link":"#_2-2-è®°å½•æœ€ç»ˆé…ç½®-configresolved","children":[]},{"level":3,"title":"2.3 è·å– Dev Server å®ä¾‹: configureServer","slug":"_2-3-è·å–-dev-server-å®ä¾‹-configureserver","link":"#_2-3-è·å–-dev-server-å®ä¾‹-configureserver","children":[]},{"level":3,"title":"2.4 è½¬æ¢ HTML å†…å®¹: transformIndexHtml","slug":"_2-4-è½¬æ¢-html-å†…å®¹-transformindexhtml","link":"#_2-4-è½¬æ¢-html-å†…å®¹-transformindexhtml","children":[]},{"level":3,"title":"2.5 çƒ­æ›´æ–°å¤„ç†: handleHotUpdate","slug":"_2-5-çƒ­æ›´æ–°å¤„ç†-handlehotupdate","link":"#_2-5-çƒ­æ›´æ–°å¤„ç†-handlehotupdate","children":[]}]},{"level":2,"title":"3. æ’ä»¶ Hook æ‰§è¡Œé¡ºåº","slug":"_3-æ’ä»¶-hook-æ‰§è¡Œé¡ºåº","link":"#_3-æ’ä»¶-hook-æ‰§è¡Œé¡ºåº","children":[]},{"level":2,"title":"æ’ä»¶åº”ç”¨ä½ç½®","slug":"æ’ä»¶åº”ç”¨ä½ç½®","link":"#æ’ä»¶åº”ç”¨ä½ç½®","children":[]},{"level":2,"title":"æ’ä»¶å¼€å‘å®æˆ˜","slug":"æ’ä»¶å¼€å‘å®æˆ˜","link":"#æ’ä»¶å¼€å‘å®æˆ˜","children":[{"level":3,"title":"å®æˆ˜æ¡ˆä¾‹ 1: è™šæ‹Ÿæ¨¡å—åŠ è½½","slug":"å®æˆ˜æ¡ˆä¾‹-1-è™šæ‹Ÿæ¨¡å—åŠ è½½","link":"#å®æˆ˜æ¡ˆä¾‹-1-è™šæ‹Ÿæ¨¡å—åŠ è½½","children":[]},{"level":3,"title":"å®æˆ˜æ¡ˆä¾‹ 2: Svg ç»„ä»¶å½¢å¼åŠ è½½","slug":"å®æˆ˜æ¡ˆä¾‹-2-svg-ç»„ä»¶å½¢å¼åŠ è½½","link":"#å®æˆ˜æ¡ˆä¾‹-2-svg-ç»„ä»¶å½¢å¼åŠ è½½","children":[]}]},{"level":2,"title":"è°ƒè¯•æŠ€å·§","slug":"è°ƒè¯•æŠ€å·§","link":"#è°ƒè¯•æŠ€å·§","children":[]},{"level":2,"title":"å°ç»“","slug":"å°ç»“","link":"#å°ç»“","children":[]}],"relativePath":"book/vite/12.md","lastUpdated":1676867557000}'),C={name:"book/vite/12.md"},A=p(`<p>å‰é¢çš„å‡ ä¸ªå°èŠ‚ï¼Œæˆ‘ä»¬ä» Vite åŒå¼•æ“çš„è§’åº¦äº†è§£äº† Vite çš„æ•´ä½“æ¶æ„ï¼Œä¹Ÿç³»ç»Ÿå­¦äº†åŒå¼•æ“æœ¬èº«çš„åŸºç¡€çŸ¥è¯†ã€‚ä»æœ¬å°èŠ‚å¼€å§‹ï¼Œæˆ‘ä»¬æ­£å¼å­¦ä¹  <strong>Vite é«˜çº§åº”ç”¨</strong>ã€‚</p><p>è¿™ä¸€æ¨¡å—ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥åº”ç”¨ Vite çš„å„é¡¹é«˜çº§èƒ½åŠ›ï¼Œé‡åˆ°æ›´å¤šæœ‰æŒ‘æˆ˜çš„å¼€å‘åœºæ™¯ã€‚ä½ ä¸ä»…èƒ½å­¦ä¼šä¸€ç³»åˆ—æœ‰éš¾åº¦çš„<strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼Œç›´æ¥è¿ç”¨åˆ°å®é™…é¡¹ç›®ä¸­ï¼Œè¿˜èƒ½ç³»ç»Ÿæé«˜è‡ªå·±çš„<strong>çŸ¥è¯†æ·±åº¦</strong>ï¼Œä½“ä¼šå¤æ‚é¡¹ç›®åœºæ™¯ä¸­æ„å»ºå·¥å…·å¦‚ä½•æä¾›é«˜åº¦è‡ªå®šä¹‰çš„èƒ½åŠ›ï¼Œä»¥åŠå¦‚ä½•å¯¹é¡¹ç›®è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚</p><p>è¯´åˆ°è‡ªå®šä¹‰çš„èƒ½åŠ›ï¼Œä½ è‚¯å®šå¾ˆå®¹æ˜“æƒ³åˆ°<code>æ’ä»¶æœºåˆ¶</code>ï¼Œåˆ©ç”¨ä¸€ä¸ªä¸ªæ’ä»¶æ¥æ‰©å±•æ„å»ºå·¥å…·è‡ªèº«çš„èƒ½åŠ›ã€‚æ²¡é”™ï¼Œè¿™ä¸€èŠ‚ä¸­æˆ‘ä»¬å°†ç³»ç»Ÿå­¦ä¹  Vite çš„æ’ä»¶æœºåˆ¶ï¼Œå¸¦ä½ æŒæ¡ Vite æ’ä»¶å¼€å‘çš„åŸºæœ¬çŸ¥è¯†ä»¥åŠå®æˆ˜å¼€å‘æŠ€å·§ã€‚</p><p>è™½ç„¶ Vite çš„æ’ä»¶æœºåˆ¶æ˜¯åŸºäº Rollup æ¥è®¾è®¡çš„ï¼Œå¹¶ä¸”ä¸Šä¸€å°èŠ‚æˆ‘ä»¬ä¹Ÿå·²ç»å¯¹ Rollup çš„æ’ä»¶æœºåˆ¶è¿›è¡Œäº†è¯¦ç»†çš„è§£è¯»ï¼Œä½†å®é™…ä¸Š Vite çš„æ’ä»¶æœºåˆ¶ä¹ŸåŒ…å«äº†è‡ªå·±ç‹¬æœ‰çš„ä¸€éƒ¨åˆ†ï¼Œä¸ Rollup çš„å„ä¸ªæ’ä»¶ Hook å¹¶éå®Œå…¨å…¼å®¹ï¼Œå› æ­¤æœ¬èŠ‚æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨ Vite ç‹¬æœ‰çš„éƒ¨åˆ†ä»¥åŠå’Œ Rollup æ‰€åŒºåˆ«çš„éƒ¨åˆ†ï¼Œè€Œå¯¹äº Vite å’Œ Rollup ä¸­ç›¸åŒçš„ Hook (å¦‚<code>resolveId</code>ã€<code>load</code>ã€<code>transform</code>)åªæ˜¯ç¨å¾®æåŠï¼Œå°±ä¸å†å±•å¼€èµ˜è¿°äº†ã€‚</p><p>è®©æˆ‘ä»¬å…ˆä»ä¸€ä¸ªç®€å•çš„ä¾‹å­å…¥æ‰‹å§ï¼</p><h2 id="ä¸€ä¸ªç®€å•çš„æ’ä»¶ç¤ºä¾‹" tabindex="-1">ä¸€ä¸ªç®€å•çš„æ’ä»¶ç¤ºä¾‹ <a class="header-anchor" href="#ä¸€ä¸ªç®€å•çš„æ’ä»¶ç¤ºä¾‹" aria-hidden="true">#</a></h2><p>Vite æ’ä»¶ä¸ Rollup æ’ä»¶ç»“æ„ç±»ä¼¼ï¼Œä¸ºä¸€ä¸ª<code>name</code>å’Œå„ç§æ’ä»¶ Hook çš„å¯¹è±¡:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ’ä»¶å</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">load</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// é’©å­é€»è¾‘</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>å¦‚æœæ’ä»¶æ˜¯ä¸€ä¸ª npm åŒ…ï¼Œåœ¨<code>package.json</code>ä¸­çš„åŒ…å‘½åä¹Ÿæ¨èä»¥<code>vite-plugin</code>å¼€å¤´</p></div><p>ä¸€èˆ¬æƒ…å†µä¸‹å› ä¸ºè¦è€ƒè™‘åˆ°å¤–éƒ¨ä¼ å‚ï¼Œæˆ‘ä»¬ä¸ä¼šç›´æ¥å†™ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ˜¯å®ç°ä¸€ä¸ªè¿”å›æ’ä»¶å¯¹è±¡çš„<code>å·¥å‚å‡½æ•°</code>ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// myPlugin.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">myVitePlugin</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">options</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    load</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// åœ¨é’©å­é€»è¾‘ä¸­å¯ä»¥é€šè¿‡é—­åŒ…è®¿é—®å¤–éƒ¨çš„ options ä¼ å‚</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ä½¿ç”¨æ–¹å¼</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">myVitePlugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./myVitePlugin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">myVitePlugin</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">/* ç»™æ’ä»¶ä¼ å‚ */</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h1 id="æ’ä»¶-hook-ä»‹ç»" tabindex="-1">æ’ä»¶ Hook ä»‹ç» <a class="header-anchor" href="#æ’ä»¶-hook-ä»‹ç»" aria-hidden="true">#</a></h1><h2 id="_1-é€šç”¨-hook" tabindex="-1">1. é€šç”¨ Hook <a class="header-anchor" href="#_1-é€šç”¨-hook" aria-hidden="true">#</a></h2><p>åœ¨<a href="./8.html">åŒå¼•æ“æ¶æ„</a>è¿™ä¸€èŠ‚ä¸­ä»‹ç»è¿‡ï¼ŒVite <strong>å¼€å‘é˜¶æ®µ</strong>ä¼šæ¨¡æ‹Ÿ Rollup çš„è¡Œä¸º:</p><p><img src="`+s+`" alt="Vite architecture"></p><p>å…¶ä¸­ Vite ä¼šè°ƒç”¨ä¸€ç³»åˆ—ä¸ Rollup å…¼å®¹çš„é’©å­ï¼Œè¿™ä¸ªé’©å­ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ:</p><ol><li><strong>æœåŠ¡å™¨å¯åŠ¨é˜¶æ®µ</strong>: <code>options</code>å’Œ<code>buildStart</code>é’©å­ä¼šåœ¨æœåŠ¡å¯åŠ¨æ—¶è¢«è°ƒç”¨ã€‚</li><li><strong>è¯·æ±‚å“åº”é˜¶æ®µ</strong>: å½“æµè§ˆå™¨å‘èµ·è¯·æ±‚æ—¶ï¼ŒVite å†…éƒ¨ä¾æ¬¡è°ƒç”¨<code>resolveId</code>ã€<code>load</code>å’Œ<code>transform</code>é’©å­ã€‚</li><li><strong>æœåŠ¡å™¨å…³é—­é˜¶æ®µ</strong>: Vite ä¼šä¾æ¬¡æ‰§è¡Œ<code>buildEnd</code>å’Œ<code>closeBundle</code>é’©å­ã€‚</li></ol><p>é™¤äº†ä»¥ä¸Šé’©å­ï¼Œå…¶ä»– Rollup æ’ä»¶é’©å­(å¦‚<code>moduleParsed</code>ã€<code>renderChunk</code>)å‡ä¸ä¼šåœ¨ Vite <strong>å¼€å‘é˜¶æ®µ</strong>è°ƒç”¨ã€‚è€Œç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œç”±äº Vite ç›´æ¥ä½¿ç”¨ Rollupï¼ŒVite æ’ä»¶ä¸­æ‰€æœ‰ Rollup çš„æ’ä»¶é’©å­éƒ½ä¼šç”Ÿæ•ˆã€‚</p><h2 id="_2-ç‹¬æœ‰-hook" tabindex="-1">2. ç‹¬æœ‰ Hook <a class="header-anchor" href="#_2-ç‹¬æœ‰-hook" aria-hidden="true">#</a></h2><p>æ¥ä¸‹æ¥ç»™å¤§å®¶ä»‹ç» Vite ä¸­ç‰¹æœ‰çš„ä¸€äº› Hookï¼Œè¿™äº› Hook åªä¼šåœ¨ Vite å†…éƒ¨è°ƒç”¨ï¼Œè€Œæ”¾åˆ° Rollup ä¸­ä¼šè¢«ç›´æ¥å¿½ç•¥ã€‚</p><h3 id="_2-1-ç»™é…ç½®å†åŠ ç‚¹æ–™-config" tabindex="-1">2.1 ç»™é…ç½®å†åŠ ç‚¹æ–™: config <a class="header-anchor" href="#_2-1-ç»™é…ç½®å†åŠ ç‚¹æ–™-config" aria-hidden="true">#</a></h3><p>Vite åœ¨è¯»å–å®Œé…ç½®æ–‡ä»¶ï¼ˆå³<code>vite.config.ts</code>ï¼‰ä¹‹åï¼Œä¼šæ‹¿åˆ°ç”¨æˆ·å¯¼å‡ºçš„é…ç½®å¯¹è±¡ï¼Œç„¶åæ‰§è¡Œ <code>config</code> é’©å­ã€‚åœ¨è¿™ä¸ªé’©å­é‡Œé¢ï¼Œä½ å¯ä»¥å¯¹é…ç½®æ–‡ä»¶å¯¼å‡ºçš„å¯¹è±¡è¿›è¡Œè‡ªå®šä¹‰çš„æ“ä½œï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// è¿”å›éƒ¨åˆ†é…ç½®ï¼ˆæ¨èï¼‰</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> editConfigPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-modify-config</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">config</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">alias</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">react</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> require</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>å®˜æ–¹æ¨èçš„å§¿åŠ¿æ˜¯åœ¨ config é’©å­ä¸­è¿”å›ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œè¿™ä¸ªé…ç½®å¯¹è±¡ä¼šå’Œ Vite å·²æœ‰çš„é…ç½®è¿›è¡Œæ·±åº¦çš„åˆå¹¶ã€‚ä¸è¿‡ä½ ä¹Ÿå¯ä»¥é€šè¿‡é’©å­çš„å…¥å‚æ‹¿åˆ° config å¯¹è±¡è¿›è¡Œè‡ªå®šä¹‰çš„ä¿®æ”¹ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> mutateConfigPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mutate-config</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ğŸ’¡command ä¸º \`serve\`(å¼€å‘ç¯å¢ƒ) æˆ–è€… \`build\`(ç”Ÿäº§ç¯å¢ƒ)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">config</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">config</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">command</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">})</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ç”Ÿäº§ç¯å¢ƒä¸­ä¿®æ”¹ root å‚æ•°</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">command</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">build</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">root</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">__dirname</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>åœ¨ä¸€äº›æ¯”è¾ƒæ·±å±‚çš„å¯¹è±¡é…ç½®ä¸­ï¼Œè¿™ç§ç›´æ¥ä¿®æ”¹é…ç½®çš„æ–¹å¼ä¼šæ˜¾å¾—æ¯”è¾ƒéº»çƒ¦ï¼Œå¦‚ <code>optimizeDeps.esbuildOptions.plugins</code>ï¼Œéœ€è¦å†™å¾ˆå¤šçš„æ ·æ¿ä»£ç ï¼Œç±»ä¼¼ä¸‹é¢è¿™æ ·:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// é˜²æ­¢å‡ºç° undefined çš„æƒ…å†µ</span></span>
<span class="line"><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">esbuildOptions </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">esbuildOptions </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">esbuildOptions</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">plugins </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">esbuildOptions</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">plugins </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> []</span></span>
<span class="line"></span></code></pre></div><p>å› æ­¤è¿™ç§æƒ…å†µä¸‹ï¼Œå»ºè®®ç›´æ¥è¿”å›ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œè¿™æ ·ä¼šæ–¹ä¾¿å¾ˆå¤š:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">config</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    optimizeDeps</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      esbuildOptions</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-2-è®°å½•æœ€ç»ˆé…ç½®-configresolved" tabindex="-1">2.2 è®°å½•æœ€ç»ˆé…ç½®: configResolved <a class="header-anchor" href="#_2-2-è®°å½•æœ€ç»ˆé…ç½®-configresolved" aria-hidden="true">#</a></h3><p>Vite åœ¨è§£æå®Œé…ç½®ä¹‹åä¼šè°ƒç”¨<code>configResolved</code>é’©å­ï¼Œè¿™ä¸ªé’©å­ä¸€èˆ¬ç”¨æ¥è®°å½•æœ€ç»ˆçš„é…ç½®ä¿¡æ¯ï¼Œè€Œä¸å»ºè®®å†ä¿®æ”¹é…ç½®ï¼Œç”¨æ³•å¦‚ä¸‹å›¾æ‰€ç¤º:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> examplePlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">read-config</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    configResolved</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolvedConfig</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// è®°å½•æœ€ç»ˆé…ç½®</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">config</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolvedConfig</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// åœ¨å…¶ä»–é’©å­ä¸­å¯ä»¥è®¿é—®åˆ°é…ç½® ğŸ˜</span></span>
<span class="line"><span style="color:#F07178;">    transform</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">config</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-3-è·å–-dev-server-å®ä¾‹-configureserver" tabindex="-1">2.3 è·å– Dev Server å®ä¾‹: configureServer <a class="header-anchor" href="#_2-3-è·å–-dev-server-å®ä¾‹-configureserver" aria-hidden="true">#</a></h3><p>è¿™ä¸ªé’©å­ä»…åœ¨ <code>å¼€å‘é˜¶æ®µ</code> ä¼šè¢«è°ƒç”¨ï¼Œç”¨äºæ‰©å±• Vite çš„ Dev Serverï¼Œä¸€èˆ¬ç”¨äºå¢åŠ è‡ªå®šä¹‰ server ä¸­é—´ä»¶ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> myPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">configure-server</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">configureServer</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">server</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å§¿åŠ¿ 1: åœ¨ Vite å†…ç½®ä¸­é—´ä»¶ä¹‹å‰æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">middlewares</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// è‡ªå®šä¹‰è¯·æ±‚å¤„ç†é€»è¾‘</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å§¿åŠ¿ 2: åœ¨ Vite å†…ç½®ä¸­é—´ä»¶ä¹‹åæ‰§è¡Œ </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">middlewares</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// è‡ªå®šä¹‰è¯·æ±‚å¤„ç†é€»è¾‘</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-4-è½¬æ¢-html-å†…å®¹-transformindexhtml" tabindex="-1">2.4 è½¬æ¢ HTML å†…å®¹: transformIndexHtml <a class="header-anchor" href="#_2-4-è½¬æ¢-html-å†…å®¹-transformindexhtml" aria-hidden="true">#</a></h3><p>è¿™ä¸ªé’©å­ç”¨æ¥çµæ´»æ§åˆ¶ HTML çš„å†…å®¹ï¼Œä½ å¯ä»¥æ‹¿åˆ°åŸå§‹çš„ html å†…å®¹åè¿›è¡Œä»»æ„çš„è½¬æ¢:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> htmlPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">html-transform</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#F07178;">    transformIndexHtml</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">html</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">&lt;title&gt;</span><span style="color:#89DDFF;">(</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">*?)</span><span style="color:#C3E88D;">&lt;</span><span style="color:#A6ACCD;">\\/</span><span style="color:#C3E88D;">title&gt;</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">&lt;title&gt;æ¢äº†ä¸ªæ ‡é¢˜&lt;/title&gt;</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#F07178;">      )</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ä¹Ÿå¯ä»¥è¿”å›å¦‚ä¸‹çš„å¯¹è±¡ç»“æ„ï¼Œä¸€èˆ¬ç”¨äºæ·»åŠ æŸäº›æ ‡ç­¾</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> htmlPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">html-transform</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    transformIndexHtml</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">html</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">html</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// æ³¨å…¥æ ‡ç­¾</span></span>
<span class="line"><span style="color:#F07178;">        tags</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// æ”¾åˆ° body æœ«å°¾ï¼Œå¯å–å€¼è¿˜æœ‰\`head\`|\`head-prepend\`|\`body-prepend\`ï¼Œé¡¾åæ€ä¹‰</span></span>
<span class="line"><span style="color:#F07178;">            injectTo</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">body</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// æ ‡ç­¾å±æ€§å®šä¹‰</span></span>
<span class="line"><span style="color:#F07178;">            attrs</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> type</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> src</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.ts</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// æ ‡ç­¾å</span></span>
<span class="line"><span style="color:#F07178;">            tag</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">script</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        ]</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-5-çƒ­æ›´æ–°å¤„ç†-handlehotupdate" tabindex="-1">2.5 çƒ­æ›´æ–°å¤„ç†: handleHotUpdate <a class="header-anchor" href="#_2-5-çƒ­æ›´æ–°å¤„ç†-handlehotupdate" aria-hidden="true">#</a></h3><div class="info custom-block"><p class="custom-block-title">INFO</p><p>å…³äºçƒ­æ›´æ–°çš„æ¦‚å¿µå’ŒåŸç†ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€èŠ‚å…·ä½“è®²è§£ã€‚</p></div><p>è¿™ä¸ªé’©å­ä¼šåœ¨ Vite æœåŠ¡ç«¯å¤„ç†çƒ­æ›´æ–°æ—¶è¢«è°ƒç”¨ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ªé’©å­ä¸­æ‹¿åˆ°çƒ­æ›´æ–°ç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè¿›è¡Œçƒ­æ›´æ¨¡å—çš„è¿‡æ»¤ï¼Œæˆ–è€…è¿›è¡Œè‡ªå®šä¹‰çš„çƒ­æ›´å¤„ç†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> handleHmrPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> handleHotUpdate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">ctx</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// éœ€è¦çƒ­æ›´çš„æ–‡ä»¶</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">file</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// éœ€è¦çƒ­æ›´çš„æ¨¡å—ï¼Œå¦‚ä¸€ä¸ª Vue å•æ–‡ä»¶ä¼šæ¶‰åŠå¤šä¸ªæ¨¡å—</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">modules</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æ—¶é—´æˆ³</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">timestamp</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// Vite Dev Server å®ä¾‹</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">server</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// è¯»å–æœ€æ–°çš„æ–‡ä»¶å†…å®¹</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">read</span><span style="color:#F07178;">())</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// è‡ªè¡Œå¤„ç† HMR äº‹ä»¶</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ws</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        type</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">custom</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        event</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">special-update</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        data</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> a</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// å‰ç«¯ä»£ç ä¸­åŠ å…¥</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">special-update</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ‰§è¡Œè‡ªå®šä¹‰æ›´æ–°</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// { a: 1 }</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">location</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">reload</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">ğŸ‘©â€ğŸ«</p><p>ä»¥ä¸Šå°±æ˜¯ Vite ç‹¬æœ‰çš„äº”ä¸ªé’©å­ï¼Œæˆ‘ä»¬æ¥é‡æ–°æ¢³ç†ä¸€ä¸‹:</p><ol><li><code>config</code>: ç”¨æ¥è¿›ä¸€æ­¥ä¿®æ”¹é…ç½®ã€‚</li><li><code>configResolved</code>: ç”¨æ¥è®°å½•æœ€ç»ˆçš„é…ç½®ä¿¡æ¯ã€‚</li><li><code>configureServer</code>: ç”¨æ¥è·å– Vite Dev Server å®ä¾‹ï¼Œæ·»åŠ ä¸­é—´ä»¶ã€‚</li><li><code>transformIndexHtml</code>: ç”¨æ¥è½¬æ¢ HTML çš„å†…å®¹ã€‚</li><li><code>handleHotUpdate</code>: ç”¨æ¥è¿›è¡Œçƒ­æ›´æ–°æ¨¡å—çš„è¿‡æ»¤ï¼Œæˆ–è€…è¿›è¡Œè‡ªå®šä¹‰çš„çƒ­æ›´æ–°å¤„ç†ã€‚</li></ol></div><h2 id="_3-æ’ä»¶-hook-æ‰§è¡Œé¡ºåº" tabindex="-1">3. æ’ä»¶ Hook æ‰§è¡Œé¡ºåº <a class="header-anchor" href="#_3-æ’ä»¶-hook-æ‰§è¡Œé¡ºåº" aria-hidden="true">#</a></h2><p>å¥½ï¼Œç°åœ¨æˆ‘ä»¬å­¦ä¹ åˆ°äº† Vite çš„é€šç”¨é’©å­å’Œç‹¬æœ‰é’©å­ï¼Œä¼°è®¡ä½ ç°åœ¨è„‘å­é‡Œé¢ä¸€ç‚¹ä¹±: è¿™ä¹ˆå¤šçš„é’©å­ï¼Œåˆ°åº•è°å…ˆæ‰§è¡Œã€è°åæ‰§è¡Œå‘¢ï¼Ÿ</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¥å¤ç›˜ä¸€ä¸‹ä¸Šè¿°çš„ä¸¤ç±»é’©å­ï¼Œå¹¶ä¸”é€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä»£ç ç¤ºä¾‹æ¥æ±‡æ€»ä¸€ä¸‹æ‰€æœ‰çš„é’©å­ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ Vite çš„è„šæ‰‹æ¶å·¥ç¨‹ä¸­æ–°å»º <code>test-hooks-plugin.ts</code>:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-nc50x" id="tab-Ynn5Zpb" checked="checked"><label for="tab-Ynn5Zpb">test-hooks-plugin.ts</label><input type="radio" name="group-nc50x" id="tab-pzbx8S4"><label for="tab-pzbx8S4">vite.config.js</label></div><div class="blocks"><div class="language-typescript active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// æ³¨: è¯·æ±‚å“åº”é˜¶æ®µçš„é’©å­</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å¦‚ resolveId, load, transform, transformIndexHtmlåœ¨ä¸‹æ–‡ä»‹ç»</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ä»¥ä¸‹ä¸ºæœåŠ¡å¯åŠ¨å’Œå…³é—­çš„é’©å­</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">testHookPlugin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">test-hooks-plugin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Vite ç‹¬æœ‰é’©å­</span></span>
<span class="line"><span style="color:#F07178;">    config</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">config</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">config</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Vite ç‹¬æœ‰é’©å­</span></span>
<span class="line"><span style="color:#F07178;">    configResolved</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolvedCofnig</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">configResolved</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// é€šç”¨é’©å­</span></span>
<span class="line"><span style="color:#F07178;">    options</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">opts</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">options</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">opts</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Vite ç‹¬æœ‰é’©å­</span></span>
<span class="line"><span style="color:#F07178;">    configureServer</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">server</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">configureServer</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// æ‰‹åŠ¨é€€å‡ºè¿›ç¨‹</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">kill</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pid</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">SIGTERM</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">3000</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// é€šç”¨é’©å­</span></span>
<span class="line"><span style="color:#F07178;">    buildStart</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">buildStart</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// é€šç”¨é’©å­</span></span>
<span class="line"><span style="color:#F07178;">    buildEnd</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">buildEnd</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// é€šç”¨é’©å­</span></span>
<span class="line"><span style="color:#F07178;">    closeBundle</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">closeBundle</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defineConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> testHooksPlugin </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./test-hooks-plugin.js</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#82AAFF;">testHooksPlugin</span><span style="color:#A6ACCD;">()]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div></div></div><p>å°†æ’ä»¶åŠ å…¥åˆ° Vite é…ç½®æ–‡ä»¶ä¸­ï¼Œç„¶åå¯åŠ¨ï¼Œä½ å¯ä»¥è§‚å¯Ÿåˆ°å„ä¸ª Hook çš„æ‰§è¡Œé¡ºåº:</p><p><img src="`+o+'" alt="vite hooksæ‰§è¡Œé¡ºåº"></p><p>ç”±æ­¤æˆ‘ä»¬å¯ä»¥æ¢³ç†å‡º Vite æ’ä»¶çš„æ‰§è¡Œé¡ºåº:</p><p><img src="'+e+`" alt="viteæ’ä»¶æ‰§è¡Œé¡ºåº"></p><ol><li>æœåŠ¡å¯åŠ¨é˜¶æ®µ: <code>config</code>ã€<code>configResolved</code>ã€<code>options</code>ã€<code>configureServer</code>ã€<code>buildStart</code></li><li>è¯·æ±‚å“åº”é˜¶æ®µ: å¦‚æœæ˜¯ <code>html</code> æ–‡ä»¶ï¼Œä»…æ‰§è¡Œ<code>transformIndexHtml</code>é’©å­ï¼›å¯¹äºé HTML æ–‡ä»¶ï¼Œåˆ™ä¾æ¬¡æ‰§è¡Œ<code>resolveId</code>ã€<code>load</code>å’Œ<code>transform</code>é’©å­ã€‚ç›¸ä¿¡å¤§å®¶å­¦è¿‡ Rollup çš„æ’ä»¶æœºåˆ¶ï¼Œå·²ç»å¯¹è¿™ä¸‰ä¸ªé’©å­æ¯”è¾ƒç†Ÿæ‚‰äº†ã€‚</li><li>çƒ­æ›´æ–°é˜¶æ®µ: æ‰§è¡Œ<code>handleHotUpdate</code>é’©å­ã€‚</li><li>æœåŠ¡å…³é—­é˜¶æ®µ: ä¾æ¬¡æ‰§è¡Œ<code>buildEnd</code>å’Œ<code>closeBundle</code>é’©å­ã€‚</li></ol><h2 id="æ’ä»¶åº”ç”¨ä½ç½®" tabindex="-1">æ’ä»¶åº”ç”¨ä½ç½® <a class="header-anchor" href="#æ’ä»¶åº”ç”¨ä½ç½®" aria-hidden="true">#</a></h2><p>æ¢³ç†å®Œ Vite çš„å„ä¸ªé’©å­å‡½æ•°ä¹‹åï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ Vite æ’ä»¶çš„<strong>åº”ç”¨æƒ…æ™¯</strong>å’Œ<strong>åº”ç”¨é¡ºåº</strong>ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ Vite æ’ä»¶åŒæ—¶è¢«ç”¨äºå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒï¼Œä½ å¯ä»¥é€šè¿‡ <a href="https://cn.vitejs.dev/guide/api-plugin.html#conditional-application" target="_blank" rel="noreferrer">apply</a> å±æ€§æ¥å†³å®šåº”ç”¨åœºæ™¯:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ğŸ“š &#39;serve&#39; è¡¨ç¤ºä»…ç”¨äºå¼€å‘ç¯å¢ƒï¼Œ&#39;build&#39;è¡¨ç¤ºä»…ç”¨äºç”Ÿäº§ç¯å¢ƒ</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">apply</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">serve</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>apply</code>å‚æ•°è¿˜å¯ä»¥é…ç½®æˆä¸€ä¸ªå‡½æ•°ï¼Œè¿›è¡Œæ›´çµæ´»çš„æ§åˆ¶:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">apply</span><span style="color:#A6ACCD;">(config</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> command </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åªç”¨äºé SSR æƒ…å†µä¸‹çš„ç”Ÿäº§ç¯å¢ƒæ„å»º</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">command</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">build</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ssr</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>åŒæ—¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ <a href="https://cn.vitejs.dev/guide/api-plugin.html#plugin-ordering" target="_blank" rel="noreferrer">enforce</a> å±æ€§æ¥æŒ‡å®šæ’ä»¶çš„æ‰§è¡Œé¡ºåº:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// é»˜è®¤ä¸º\`normal\`ï¼Œå¯å–å€¼è¿˜æœ‰\`pre\`å’Œ\`post\`</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">enforce</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pre</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>Vite ä¸­æ’ä»¶çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="`+t+`" alt="Viteæ’ä»¶æ‰§è¡Œé¡ºåº"></p><p>Vite ä¼šä¾æ¬¡æ‰§è¡Œå¦‚ä¸‹çš„æ’ä»¶:</p><ol><li>Alias (è·¯å¾„åˆ«å)ç›¸å…³çš„æ’ä»¶ã€‚</li><li>â­ï¸ å¸¦æœ‰ <code>enforce: &#39;pre&#39;</code> çš„ç”¨æˆ·æ’ä»¶ã€‚</li><li>Vite æ ¸å¿ƒæ’ä»¶ã€‚</li><li>â­ï¸ æ²¡æœ‰ enforce å€¼çš„ç”¨æˆ·æ’ä»¶ï¼Œä¹Ÿå«<code>æ™®é€šæ’ä»¶</code>ã€‚</li><li>Vite ç”Ÿäº§ç¯å¢ƒæ„å»ºç”¨çš„æ’ä»¶ã€‚</li><li>â­ï¸ å¸¦æœ‰ <code>enforce: &#39;post&#39;</code> çš„ç”¨æˆ·æ’ä»¶ã€‚</li><li>Vite åç½®æ„å»ºæ’ä»¶(å¦‚å‹ç¼©æ’ä»¶)ã€‚</li></ol><h2 id="æ’ä»¶å¼€å‘å®æˆ˜" tabindex="-1">æ’ä»¶å¼€å‘å®æˆ˜ <a class="header-anchor" href="#æ’ä»¶å¼€å‘å®æˆ˜" aria-hidden="true">#</a></h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿›å…¥æ’ä»¶å¼€å‘çš„å®æˆ˜ç¯èŠ‚ä¸­ï¼Œåœ¨è¿™ä¸ªéƒ¨åˆ†æˆ‘ä»¬å°†ä¸€èµ·ç¼–å†™ä¸¤ä¸ª Vite æ’ä»¶ï¼Œåˆ†åˆ«æ˜¯<code>è™šæ‹Ÿæ¨¡å—åŠ è½½æ’ä»¶</code>å’Œ<code>Svgr æ’ä»¶</code>ï¼Œä½ å°†å­¦ä¼šä»æ’ä»¶å¼€å‘çš„å¸¸è§å¥—è·¯å’Œå„ç§å¼€å‘æŠ€å·§ã€‚è¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬ç°åœ¨å¼€å§‹å®æˆ˜å§ã€‚</p><h3 id="å®æˆ˜æ¡ˆä¾‹-1-è™šæ‹Ÿæ¨¡å—åŠ è½½" tabindex="-1">å®æˆ˜æ¡ˆä¾‹ 1: è™šæ‹Ÿæ¨¡å—åŠ è½½ <a class="header-anchor" href="#å®æˆ˜æ¡ˆä¾‹-1-è™šæ‹Ÿæ¨¡å—åŠ è½½" aria-hidden="true">#</a></h3><p>é¦–å…ˆæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªè™šæ‹Ÿæ¨¡å—çš„åŠ è½½æ’ä»¶ï¼Œå¯èƒ½ä½ ä¼šæœ‰ç–‘é—®: ä»€ä¹ˆæ˜¯è™šæ‹Ÿæ¨¡å—å‘¢ï¼Ÿ</p><p>ä½œä¸ºæ„å»ºå·¥å…·ï¼Œä¸€èˆ¬éœ€è¦å¤„ç†ä¸¤ç§å½¢å¼çš„æ¨¡å—ï¼Œä¸€ç§å­˜åœ¨äºçœŸå®çš„ç£ç›˜æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå¦ä¸€ç§å¹¶ä¸åœ¨ç£ç›˜è€Œåœ¨å†…å­˜å½“ä¸­ï¼Œä¹Ÿå°±æ˜¯<code>è™šæ‹Ÿæ¨¡å—</code>ã€‚é€šè¿‡è™šæ‹Ÿæ¨¡å—ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥æŠŠè‡ªå·±æ‰‹å†™çš„ä¸€äº›ä»£ç å­—ç¬¦ä¸²ä½œä¸ºå•ç‹¬çš„æ¨¡å—å†…å®¹ï¼Œåˆå¯ä»¥å°†å†…å­˜ä¸­æŸäº›ç»è¿‡è®¡ç®—å¾—å‡ºçš„<strong>å˜é‡</strong>ä½œä¸ºæ¨¡å—å†…å®¹è¿›è¡ŒåŠ è½½ï¼Œéå¸¸çµæ´»å’Œæ–¹ä¾¿ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›å…·ä½“çš„ä¾‹å­æ¥å®æ“ä¸€ä¸‹ï¼Œé¦–å…ˆé€šè¿‡è„šæ‰‹æ¶å‘½ä»¤åˆå§‹åŒ–ä¸€ä¸ª<code>react + ts</code>é¡¹ç›®:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-H2RJy" id="tab-IYET_lj" checked="checked"><label for="tab-IYET_lj">plugins/virtual-module.ts</label></div><div class="blocks"><div class="language-typescript active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Plugin</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ResolvedConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è™šæ‹Ÿæ¨¡å—åç§°</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> virtualFibModuleId </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">virtual:fib</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Vite ä¸­çº¦å®šå¯¹äºè™šæ‹Ÿæ¨¡å—ï¼Œè§£æåçš„è·¯å¾„éœ€è¦åŠ ä¸Š\`\\0\`å‰ç¼€</span></span>
<span class="line highlighted"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> resolvedFibVirtualModuleId </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">\\0</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> virtualFibModuleId</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">virtualFibModulePlugin</span><span style="color:#89DDFF;">():</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Plugin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">ResolvedConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-virtual-module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    resolveId</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">virtualFibModuleId</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolvedFibVirtualModuleId</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    load</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// åŠ è½½è™šæ‹Ÿæ¨¡å—</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolvedFibVirtualModuleId</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">export default function fib(n) { return n &lt;= 1 ? n : fib(n - 1) + fib(n - 2); }</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div></div><p>æ¥ç€æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æ¥ä½¿ç”¨è¿™ä¸ªæ’ä»¶:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> virtual </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./plugins/virtual-module.ts</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// é…ç½®æ’ä»¶</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#82AAFF;">react</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">virtual</span><span style="color:#F07178;">()]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>ç„¶ååœ¨<code>main.tsx</code>ä¸­åŠ å…¥å¦‚ä¸‹çš„ä»£ç :</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line highlighted"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> fib </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">virtual:fib</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">alert</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">ç»“æœ: </span><span style="color:#89DDFF;">\${</span><span style="color:#82AAFF;">fib</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">}\`</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† <code>virtual:fib</code> è¿™ä¸ªè™šæ‹Ÿæ¨¡å—ï¼Œè™½ç„¶è¿™ä¸ªæ¨¡å—ä¸å­˜åœ¨çœŸå®çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä½†ä½ æ‰“å¼€æµè§ˆå™¨åå¯ä»¥å‘ç°è¿™ä¸ªæ¨¡å—å¯¼å‡ºçš„å‡½æ•°æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„:</p><p><img src="`+c+`" alt="è‡ªå®šä¹‰è™šæ‹Ÿæ¨¡å—æ’ä»¶"></p><p>æ¥ç€æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹å¦‚ä½•é€šè¿‡è™šæ‹Ÿæ¨¡å—æ¥è¯»å–å†…å­˜ä¸­çš„å˜é‡ï¼Œåœ¨<code>virtual-module.ts</code>ä¸­å¢åŠ å¦‚ä¸‹ä»£ç :</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-QxcqH" id="tab-97FGDAU" checked="checked"><label for="tab-97FGDAU">plugins/virtual-module.ts</label></div><div class="blocks"><div class="language-typescript active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight has-diff" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Plugin</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ResolvedConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> virtualFibModuleId </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">virtual:fib</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> resolvedFibVirtualModuleId </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">\\0</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> virtualFibModuleId</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> virtualEnvModuleId </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">virtual:env</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line diff add"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> resolvedEnvVirtualModuleId </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">\\0</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> virtualEnvModuleId </span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">virtualFibModulePlugin</span><span style="color:#89DDFF;">():</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Plugin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">ResolvedConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">null</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-virtual-module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line diff add"><span style="color:#F07178;">    configResolved</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">c</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">ResolvedConfig</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span></span>
<span class="line diff add"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">config</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">c</span><span style="color:#F07178;"> </span></span>
<span class="line diff add"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">    resolveId</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">virtualFibModuleId</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolvedFibVirtualModuleId</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line diff add"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">virtualEnvModuleId</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span></span>
<span class="line diff add"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolvedEnvVirtualModuleId</span><span style="color:#F07178;"> </span></span>
<span class="line diff add"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    load</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolvedFibVirtualModuleId</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">export default function fib(n) { return n &lt;= 1 ? n : fib(n - 1) + fib(n - 2);}</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line diff add"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolvedEnvVirtualModuleId</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span></span>
<span class="line diff add"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">export default </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(config</span><span style="color:#89DDFF;">!.</span><span style="color:#A6ACCD;">env)</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;"> </span></span>
<span class="line diff add"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div></div><p>åœ¨æ–°å¢çš„è¿™äº›ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ³¨å†Œäº†ä¸€ä¸ªæ–°çš„è™šæ‹Ÿæ¨¡å—<code>virtual:env</code>ï¼Œç´§æ¥ç€æˆ‘ä»¬å»é¡¹ç›®å»ä½¿ç”¨:</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// main.tsx</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> env </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">virtual:env</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(env)</span></span>
<span class="line"></span></code></pre></div><p><code>virtual:env</code>ä¸€èˆ¬æƒ…å†µä¸‹ä¼šæœ‰ç±»å‹é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ ä¸€ä¸ªç±»å‹å£°æ˜æ–‡ä»¶æ¥å£°æ˜è¿™ä¸ªæ¨¡å—:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// types/shim.d.ts</span></span>
<span class="line"><span style="color:#C792EA;">declare</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">module</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">virtual:*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">any</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>å¹¶åœ¨ <code>tsconfig.json</code> ä¸­æ·»åŠ  <code>types</code>:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">include</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">types/*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>è¿™æ ·å°±è§£å†³äº†ç±»å‹æŠ¥é”™çš„é—®é¢˜ã€‚æ¥ç€ä½ å¯ä»¥å»æµè§ˆå™¨è§‚å¯Ÿä¸€ä¸‹è¾“å‡ºçš„æƒ…å†µ:</p><p><img src="`+r+`" alt="envè™šæ‹Ÿæ¨¡å—"></p><p>Vite ç¯å¢ƒå˜é‡èƒ½æ­£ç¡®åœ°åœ¨æµè§ˆå™¨ä¸­æ‰“å°å‡ºæ¥ï¼Œè¯´æ˜åœ¨å†…å­˜ä¸­è®¡ç®—å‡ºæ¥çš„<code>virtual:env</code>æ¨¡å—çš„ç¡®è¢«æˆåŠŸåœ°åŠ è½½äº†ã€‚ä»ä¸­ä½ å¯ä»¥çœ‹åˆ°ï¼Œè™šæ‹Ÿæ¨¡å—çš„å†…å®¹å®Œå…¨èƒ½å¤Ÿè¢«åŠ¨æ€è®¡ç®—å‡ºæ¥ï¼Œå› æ­¤å®ƒçš„çµæ´»æ€§å’Œå¯å®šåˆ¶ç¨‹åº¦éå¸¸é«˜ï¼Œå®ç”¨æ€§ä¹Ÿå¾ˆå¼ºï¼Œåœ¨ Vite å†…éƒ¨çš„æ’ä»¶è¢«æ·±åº¦åœ°ä½¿ç”¨ï¼Œç¤¾åŒºå½“ä¸­ä¹Ÿæœ‰ä¸å°‘çŸ¥åçš„æ’ä»¶(å¦‚ <code>vite-plugin-windicss</code>ã€<code>vite-plugin-svg-icons</code>ç­‰)ä¹Ÿä½¿ç”¨äº†è™šæ‹Ÿæ¨¡å—çš„æŠ€æœ¯ã€‚</p><h3 id="å®æˆ˜æ¡ˆä¾‹-2-svg-ç»„ä»¶å½¢å¼åŠ è½½" tabindex="-1">å®æˆ˜æ¡ˆä¾‹ 2: Svg ç»„ä»¶å½¢å¼åŠ è½½ <a class="header-anchor" href="#å®æˆ˜æ¡ˆä¾‹-2-svg-ç»„ä»¶å½¢å¼åŠ è½½" aria-hidden="true">#</a></h3><p>åœ¨ä¸€èˆ¬çš„é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™å¸Œæœ›èƒ½å°† svg å½“åšä¸€ä¸ªç»„ä»¶æ¥å¼•å…¥ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¿®æ”¹ svg çš„å„ç§å±æ€§ï¼Œç›¸æ¯”äº<code>img</code>æ ‡ç­¾çš„å¼•å…¥æ–¹å¼ä¹Ÿæ›´åŠ ä¼˜é›…ã€‚ä½† Vite æœ¬èº«å¹¶ä¸æ”¯æŒå°† svg è½¬æ¢ä¸ºç»„ä»¶çš„ä»£ç ï¼Œéœ€è¦æˆ‘ä»¬é€šè¿‡æ’ä»¶æ¥å®ç°ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å†™ä¸€ä¸ª Vite æ’ä»¶ï¼Œå®ç°åœ¨ React é¡¹ç›®èƒ½å¤Ÿé€šè¿‡ç»„ä»¶æ–¹å¼æ¥ä½¿ç”¨ svg èµ„æºã€‚é¦–å…ˆå®‰è£…ä¸€ä¸‹éœ€è¦çš„ä¾èµ–:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">resolve</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@svgr/core</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-D</span></span>
<span class="line"></span></code></pre></div><p>æ¥ç€åœ¨<code>plugins</code>ç›®å½•æ–°å»º <code>svgr.ts</code>:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-jHkAI" id="tab-fi1ycnf" checked="checked"><label for="tab-fi1ycnf">plugins/svgr.ts</label></div><div class="blocks"><div class="language-typescript active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Plugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> resolve </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">resolve</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SvgrOptions</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// svg èµ„æºæ¨¡å—é»˜è®¤å¯¼å‡ºï¼Œurl æˆ–è€…ç»„ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">defaultExport</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">component</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">viteSvgrPlugin</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">options</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SvgrOptions</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defaultExport</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-svgr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> transform</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">code</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// è½¬æ¢é€»è¾‘: svg -&gt; React ç»„ä»¶</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div></div><p>è®©æˆ‘ä»¬å…ˆæ¥æ¢³ç†ä¸€ä¸‹å¼€å‘éœ€æ±‚ï¼Œç”¨æˆ·é€šè¿‡ä¼ å…¥<code>defaultExport</code>å¯ä»¥æ§åˆ¶ svg èµ„æºçš„é»˜è®¤å¯¼å‡º:</p><ol><li><p>å½“ <code>defaultExport</code>ä¸º <code>component</code>ï¼Œé»˜è®¤å½“åšç»„ä»¶æ¥ä½¿ç”¨ï¼Œå³:</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Logo </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./Logo.svg</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// åœ¨ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Logo</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"></span></code></pre></div></li><li><p>å½“<code>defaultExports</code>ä¸º<code>url</code>ï¼Œé»˜è®¤å½“åš url ä½¿ç”¨ï¼Œå¦‚æœéœ€è¦ç”¨ä½œç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡<code>å…·åå¯¼å…¥</code>çš„æ–¹å¼æ¥æ”¯æŒ:</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> logoUrl</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ReactComponent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Logo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./logo.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// url ä½¿ç”¨</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">img</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">={</span><span style="color:#A6ACCD;">logoUrl</span><span style="color:#89DDFF;">} /&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ç»„ä»¶æ–¹å¼ä½¿ç”¨</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Logo</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"></span></code></pre></div></li></ol><p>æ˜ç¡®äº†éœ€æ±‚ä¹‹åï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬æ¥æ•´ç†ä¸€ä¸‹æ’ä»¶å¼€å‘çš„æ•´ä½“æ€è·¯ï¼Œä¸»è¦é€»è¾‘åœ¨ <code>transform</code>é’©å­ä¸­å®Œæˆï¼Œæµç¨‹å¦‚ä¸‹:</p><ol><li>æ ¹æ® <code>id</code> å…¥å‚è¿‡æ»¤å‡º svg èµ„æºï¼›</li><li>è¯»å– svg æ–‡ä»¶å†…å®¹ï¼›</li><li>åˆ©ç”¨ <code>@svgr/core</code> å°† svg è½¬æ¢ä¸º React ç»„ä»¶ä»£ç ;</li><li>å¤„ç†é»˜è®¤å¯¼å‡ºä¸º url çš„æƒ…å†µï¼›</li><li>å°†ç»„ä»¶çš„ jsx ä»£ç è½¬è¯‘ä¸ºæµè§ˆå™¨å¯è¿è¡Œçš„ä»£ç ã€‚</li></ol><p>ä¸‹é¢æ˜¯æ’ä»¶çš„å®Œæ•´çš„ä»£ç ï¼Œä½ å¯ä»¥å‚è€ƒå­¦ä¹ :</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-IfyPI" id="tab-WO1JC-F" checked="checked"><label for="tab-WO1JC-F">plugins/svgr.ts</label></div><div class="blocks"><div class="language-typescript active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Plugin</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node:fs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> resolveSync </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">resolve/sync</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">transform</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">svgrTransform</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@svgr/core</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">createRequire</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">node:module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ¨¡æ‹Ÿcommonjs require</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> require </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createRequire</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">url)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SvgrOptions</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">defaultExport</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">component</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">viteSvgrPlugin</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">options</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SvgrOptions</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Plugin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defaultExport</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">component</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">options</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-svgr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> transform</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 1. æ ¹æ® id å…¥å‚è¿‡æ»¤å‡º svg èµ„æºï¼›</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">endsWith</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.svg</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// const svgrTransform = require(&#39;@svgr/core&#39;).transform</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// è§£æ esbuild çš„è·¯å¾„ï¼Œåç»­è½¬è¯‘ jsx ä¼šç”¨åˆ°ï¼Œæˆ‘ä»¬è¿™é‡Œç›´æ¥æ‹¿ vite ä¸­çš„ esbuild å³å¯</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// requrie.resolve() è¡¨ç¤ºä½¿ç”¨commonjs resolveç®—æ³•</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">esbuildPackagePath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">resolveSync</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">esbuild</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> basedir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">require</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">esbuild</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">require</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">esbuildPackagePath</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 2. è¯»å– svg æ–‡ä»¶å†…å®¹ï¼›</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">svg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">promises</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 3. åˆ©ç”¨ \`@svgr/core\` å°† svg è½¬æ¢ä¸º React ç»„ä»¶ä»£ç </span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">svgrResult</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">svgrTransform</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">svg</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{},</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> componentName</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ReactComponent</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 4. å¤„ç†é»˜è®¤å¯¼å‡ºä¸º url çš„æƒ…å†µ</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">componentCode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">svgrResult</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">defaultExport</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// åŠ ä¸Š Vite é»˜è®¤çš„ \`export default èµ„æºè·¯å¾„\`</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">componentCode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">componentCode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">svgrResult</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">export default ReactComponent</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">export { ReactComponent }</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 5. åˆ©ç”¨ esbuildï¼Œå°†ç»„ä»¶ä¸­çš„ jsx ä»£ç è½¬è¯‘ä¸ºæµè§ˆå™¨å¯è¿è¡Œçš„ä»£ç ;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">esbuild</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">transform</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">componentCode</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        loader</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jsx</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        map</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// TODO</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>ä¸Šé¢ä»£ç å’ŒåŸå°å†Œä»£ç æœ‰æ‰€ä¸åŒï¼ŒåŸä»£ç åœ¨esmæ¨¡å—ä¸‹æ— æ³•è¿è¡Œ</p></div><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸ªæ’ä»¶:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> svgr </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./plugins/svgr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è¿”å›çš„é…ç½®</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// çœç•¥å…¶å®ƒæ’ä»¶</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">svgr</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ç”¨ç»„ä»¶çš„æ–¹å¼å¼•å…¥ svg:</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Logo </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./assets/react.svg</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">App</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&lt;&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Logo</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/&gt;</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> App</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>æ‰“å¼€æµè§ˆå™¨ï¼Œå¯ä»¥çœ‹åˆ°ç»„ä»¶å·²ç»æ­£å¸¸æ˜¾ç¤º:</p><p><img src="`+F+`" alt="SVGRæ’ä»¶å¤„ç†svg"></p><h2 id="è°ƒè¯•æŠ€å·§" tabindex="-1">è°ƒè¯•æŠ€å·§ <a class="header-anchor" href="#è°ƒè¯•æŠ€å·§" aria-hidden="true">#</a></h2><p>å¦å¤–ï¼Œåœ¨å¼€å‘è°ƒè¯•æ’ä»¶çš„è¿‡ç¨‹ï¼Œæˆ‘æ¨èå¤§å®¶åœ¨æœ¬åœ°è£…ä¸Š <a href="https://github.com/antfu/vite-plugin-inspect" target="_blank" rel="noreferrer">vite-plugin-inspect</a> æ’ä»¶ï¼Œå¹¶åœ¨ Vite ä¸­ä½¿ç”¨å®ƒ:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> inspect </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-inspect</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è¿”å›çš„é…ç½®</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// çœç•¥å…¶å®ƒæ’ä»¶</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">inspect</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>è¿™æ ·å½“ä½ å†æ¬¡å¯åŠ¨é¡¹ç›®æ—¶ï¼Œä¼šå‘ç°å¤šå‡ºä¸€ä¸ªè°ƒè¯•åœ°å€:</p><p><img src="`+y+'" alt="vite-plugin-inspectæ’ä»¶"></p><p>ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªåœ°å€æ¥æŸ¥çœ‹é¡¹ç›®ä¸­å„ä¸ªæ¨¡å—çš„ç¼–è¯‘ç»“æœï¼š</p><p><img src="'+D+'" alt="inspect"></p><p>ç‚¹å‡»ç‰¹å®šçš„æ–‡ä»¶åï¼Œä½ å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ¨¡å—ç»è¿‡å„ä¸ªæ’ä»¶å¤„ç†åçš„ä¸­é—´ç»“æœï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="'+i+'" alt="inspece svgræ’ä»¶"></p><p>é€šè¿‡è¿™ä¸ªé¢æ¿ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹åˆ°ç›¸åº”æ¨¡å—ç»è¿‡æ’ä»¶å¤„ç†åå˜æˆäº†ä»€ä¹ˆæ ·å­ï¼Œè®©æ’ä»¶çš„è°ƒè¯•æ›´åŠ æ–¹ä¾¿ã€‚</p><h2 id="å°ç»“" tabindex="-1">å°ç»“ <a class="header-anchor" href="#å°ç»“" aria-hidden="true">#</a></h2><p>å¥½ï¼Œæœ¬èŠ‚çš„å†…å®¹åˆ°è¿™é‡Œå°±æ¥è¿‘å°¾å£°äº†ã€‚æœ¬èŠ‚ä½ éœ€è¦é‡ç‚¹æŒæ¡ Vite <strong>æ’ä»¶é’©å­çš„å«ä¹‰</strong>ã€<strong>ä½œç”¨é¡ºåº</strong>ä»¥åŠ<strong>æ’ä»¶çš„å®æˆ˜å¼€å‘</strong>ã€‚</p><p>é¦–å…ˆæˆ‘é€šè¿‡ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹è®©ä½ å¯¹ Vite æ’ä»¶çš„ç»“æ„æœ‰äº†åˆæ­¥çš„å°è±¡ï¼Œç„¶åå¯¹ Vite ä¸­çš„å„ç§é’©å­å‡½æ•°è¿›è¡Œäº†ä»‹ç»ï¼Œä¸»è¦åŒ…æ‹¬<code>é€šç”¨é’©å­</code>å’Œ<code>ç‹¬æœ‰é’©å­</code>ï¼Œé€šç”¨é’©å­ä¸ Rollup å…¼å®¹ï¼Œè€Œç‹¬æœ‰é’©å­åœ¨ Rollup ä¸­ä¼šè¢«å¿½ç•¥ã€‚è€Œç”±äºä¸Šä¸€èŠ‚å·²ç»è¯¦ç»†ä»‹ç»äº† Rollup çš„æ’ä»¶æœºåˆ¶ï¼Œå¯¹äºé€šç”¨é’©å­æˆ‘ä»¬æ²¡æœ‰ç»§ç»­å±•å¼€ï¼Œè€Œæ˜¯è¯¦ç»†ä»‹ç»äº† 5 ä¸ªç‹¬æœ‰é’©å­ï¼Œåˆ†åˆ«æ˜¯: <code>config</code>ã€<code>configResolved</code>ã€<code>configureServer</code>ã€<code>transformIndexHtml</code>å’Œ<code>handleHotUpdate</code>ã€‚ä¸ä»…å¦‚æ­¤ï¼Œæˆ‘è¿˜ç»™ä½ ä»å®è§‚è§’åº¦åˆ†æäº† Vite æ’ä»¶çš„ä½œç”¨åœºæ™¯å’Œä½œç”¨é¡ºåºï¼Œä½ å¯ä»¥åˆ†åˆ«é€šè¿‡<code>apply</code>å’Œ<code>enforce</code>ä¸¤ä¸ªå‚æ•°æ¥è¿›è¡Œæ‰‹åŠ¨çš„æ§åˆ¶ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ­£å¼è¿›å…¥æ’ä»¶å¼€å‘å®æˆ˜çš„ç¯èŠ‚ï¼Œå®ç°äº†<code>è™šæ‹Ÿæ¨¡å—åŠ è½½æ’ä»¶</code>å’Œ<code>Svg ç»„ä»¶åŠ è½½æ’ä»¶</code>ï¼Œç›¸ä¿¡ä½ å·²ç»å¯¹è™šæ‹Ÿæ¨¡å—çš„æ¦‚å¿µå’Œä½¿ç”¨æœ‰äº†ç›´è§‚çš„äº†è§£ï¼Œä¹Ÿèƒ½é€šè¿‡åè€…çš„å¼€å‘è¿‡ç¨‹äº†è§£åˆ°å¦‚ä½•åœ¨ Vite ä¸­é›†æˆå…¶å®ƒçš„å‰ç«¯ç¼–è¯‘å·¥å…·ã€‚æ€»ä½“æ¥è¯´ï¼ŒVite æ’ä»¶çš„è®¾è®¡ç§‰æ‰¿äº† Rollup çš„æ’ä»¶è®¾è®¡ç†å¿µï¼Œé€šè¿‡ä¸€ä¸ªä¸ªè¯­ä¹‰åŒ–çš„ Hook æ¥ç»„ç»‡ï¼Œååˆ†ç®€æ´å’Œçµæ´»ï¼Œä¸Šæ‰‹éš¾åº¦å¹¶ä¸å¤§ï¼Œä½†çœŸæ­£éš¾çš„åœ°æ–¹åœ¨äºå¦‚ä½•åˆ©ç”¨ Vite æ’ä»¶å»è§£å†³å®é™…å¼€å‘è¿‡ç¨‹çš„é—®é¢˜ï¼Œç”±äºç¯‡å¹…æ‰€é™ï¼Œæœ¬æ–‡çš„ç¤ºä¾‹å¹¶ä¸èƒ½è¦†ç›–æ‰€æœ‰çš„å¼€å‘åœºæ™¯ï¼Œä½ ä¹Ÿä¸å¿…ç€æ€¥ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢çš„å‡ ä¸ªå°èŠ‚ä¸­æ¥è§¦åˆ°æ›´åŠ é«˜çº§çš„å¼€å‘åœºæ™¯ï¼Œä½ ä¹Ÿå°†æ¥è§¦è¿‡è¶Šæ¥è¶Šå¤šçš„æ’ä»¶ï¼Œå½“ç„¶ï¼Œä½ çš„æ’ä»¶å¼€å‘æŠ€èƒ½ä¹Ÿèƒ½è¶Šæ¥è¶Šçº¯ç†Ÿã€‚å¤§å®¶ç»§ç»­åŠ æ²¹ğŸ’ªğŸ»ï¼</p><p>ç›¸å…³é“¾æ¥ï¼š</p><ul><li><a href="https://cn.vitejs.dev/guide/api-plugin.html" target="_blank" rel="noreferrer">Viteå®˜ç½‘æ’ä»¶API</a></li><li><a href="https://github.com/vitejs/awesome-vite#plugins" target="_blank" rel="noreferrer">awesome-viteæ’ä»¶</a></li></ul><p>2023å¹´02æœˆ17æ—¥12:43:17</p>',123),d=[A];function g(f,u,h,v,m,E){return l(),a("div",null,d)}const _=n(C,[["render",g]]);export{k as __pageData,_ as default};
