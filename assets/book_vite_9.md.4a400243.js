import{_ as s,c as n,o as a,N as l}from"./chunks/framework.7812daa2.js";const p="/awesome-node/assets/9-1.466f0880.webp",o="/awesome-node/assets/9-2.297203e9.webp",e="data:image/webp;base64,UklGRvYNAABXRUJQVlA4IOoNAAAQTACdASp2An4APlEokUajoqGhITLpaHAKCWdu4XVRC/2qH7wfGRUp5qfGP+z+1X3V/6r9APgb5gH6fecd6gPMB/JP6Z/zv8l7sH9N9RXoAfqh6FfsN+gf+wvpTfth8IP7gftf7QX/p1lfwp/Ve1n/BeG/hk8t/ov7a+ltkf6Z9Sn4/9Yv2f9f81f83/PPG/3kagX4//LP8J+YH9d4cXRv7L6AXqn82/1X9u8ZrUd7pewB/E/7B/z/Tn/VeEz5J+s3wAf0b/NerB/L/+//N+cr88/yf7M/AT/Kv7J1fv3Z9l39txCfjCG9yM8iuNJp6n+iJCRaAZC+TPaKl74QVKsr9y1cFdfNkuFhISybWrRuNsPbLymzqklo3G2HpEPW6OQxEieEtRT3Qr2QZ7eLwB4i7ppfsXphXjB6Rag8ps6pJaNxth7ZeU2dUkwUfwZRPe3Rxf4Hc6pJaNxth7ZeU2dUjOqj1MIoB5kbYwXKaQVqJWqD1xlcdqYrgT+xQqc0Dy6WWq9tjYcDudUktG42w9svKbOqSSWCdMZkH4wFsUvkl7Une/K+HEm4FPjn1UUJ323xUVhrHvCK4qHWy8ps6pJaNxth7ZeUzWCUJiRX5kRvRVf38LjbD2y8ps6pJaNxth7ZcTJsC69CQhcdPfyZU3+BCFI/yopErX754Bi/J96LeD8uXqyTVwg2qpiKAd8Us8r+RXqrCP0ZpJsqje7A9R3aWMPbRpkGtUhu1eWWcz5SrF5TZ1SS0bjbD2y8oW6Sd6evhFew4Sd9lQzO48T9ov3SAgvzMAJ5SI8fG9cwHssPbLymzqklo3GMAAD+/6FF9uWIVLX2gYK2oGsucO3k1R1GUzNjH5Xsw6CeEiBSXjm82hHOKlfnogDE1qvOFs4tMDyCmynUlQcJXWr9PcKg+EkTWaHWHeXskGLMrCYZkYGKlJzGLP5EG9HI9yTx1iqSgMIKvwC6JCS8u/aDvhdX7n6vD/ymc/5lw3XxC8zVheUbfnFR78VDDSAd5iqTm3kNS6H6eXMNOqeT5sJbWkSJAwnh/61RKbQk4NKwB+lgcH/A7K7q218hhOARFdOHejDjYIu5qjyZzVosqas9h4o8/LCITSnjmoPQv5oZcqJ5WJYs/6GnQvGSQASWZt8QPuqHfI0DF9wVQM2tJHThOl/Xtrt3S+Nkx6GeFTL8AQjKxMrYmQKhbR0sFGXlQegEBx8W+PJwQN+ATBcvwYToYqeaMY6Ls01mdS7huMdfGVPgdh0JKID3djg8FoJJfBupsrQ4ABXYTiGZOCixvvvwQI7A15g9UGe77galzQyaahWushqD3SqKCDK6p8JhWEBhcld89yNfSRaNrAp9H7Qkkm2fEACHBY3fVb78w3J5pv9Uj9DhAZk/HvjuY+1hOYeneKU6hFliy4EUQL2dRdYkr86tvboW9opcWCHSQxerDGSEPLM71ZYWIulfmdUNoSTt+0uk3v5WKPNuJawPwtTcVYXBjNTc5pTw067+xBIbu4G6KhCFyiz5X7sXwq1ZInTtfROzgAsp1M1VbtJaK9hjNpcfprQR4ElZtCY/6pJ3O7ERELFtCtIG6zU39iuDKY2+nvkQM7yKj1A1PdyPcpyR9qcoQj1C9PkxiKmnKQfL/7e5qqEXeIOWQSuHSPRxDifUV3mUUr9Z/BV5xteLg3BJYR0d1nmyRxWO4Djn42aEsABJ4m7qHr6XZ/kKZ841d7gY4YWokAo4vkUMXn7fSh1ZfH3NQvjrC7FLus7TpYwtshqKk/tMWFwUAAku6zGBpLcTY7VmZcc890pUU6tbwYK5gOGwXXH45wgzI2hc+0lYdZwAD57WG1FDP766BavPgAtNnvM/dRZgtd2rRpfCJbttSn+xH5mJcz5O+QOf08sLvFTHSnG5eMcbv+LEctjf/SYvbIlwgzMKVrwRmPNAZSTX8n/0BtXzLp1nSQfkmXPfQNmP9QZ/ezN1eTjbBhoivHmQkPprGAk77yFmLtTXOvjl9c6GLjna07XKSZb5j+9a4op3nofqfk+KzULlusWTHh+2vAILf6/VW2RSYuWK1iFiVaEUlWYEs62lsac/YBLET8Cs+rL1QxVOYcFdYDxSbD+UhMeH3Nx4ZCxUENgU6RdfpIOucC9mLnCnhvlhDjcnTBysBfT0hxwdENLRH2yqM8ZQISDxpzxmWhoogKv1N9TLAWWO7CPyysqMpZD5KUOPNLpydCjDo/NECqOoSo6Xtav93R7iESrqpHtBY6pXeT9WSw6/A/wrO8PYUC9BXBcl9LEiqQxatWj+ww+qi9F/zn4S1Oi9CUVBXPhXJTRWRYD7UZ/834+3qAqlUmdIZZ5fa7Fd5GepOeW1/iDFkOGZOaMpnfZV2I7MZHOO46ZH2wrHwcz7Nj+QgUJOdhTVITH3MduAjMI8Ka1f20HRhONOCGG1GRBiqsXpzqp0Jhcp1X1Qxy+N1PJxa5IR6Cv/zGhAA3dbGxIMJUU5k/XtaaBh2DrnvQ1ZqbIJNlhI3E5kr4/fy60e/TK+MT6a1+tsK4abKA2SOuDoBtQdlN5g2rXwnzdUbNosv/u3fTF6FaUzjSL/6mARhUOCgOVmaqXGyEBUsf8Wv6/qwwom+9aurroBeaSuQ9++LUfDtZxtsVEVOlgYPOTPFk2rsW+tuNbmfJvaVOjcsJH89Vtf6NFpA6GZvxmTRXR17xg1s7jXILxw0t+KYBmkbEWTpviyuTerMlHO9cTFfOJoGqebsYf7LvrShjRtBOUhLlhxmW3LUtt6oujafMfsCMuHv5bCfAhPA0w2mp1sHoB2Zdt/O4HiKlk66YaggyIYDxUqBGiL6T1UOAuQDTMVtkki8plzkzvTmyno6E4pUfKBBRNywmn/OEKGiIL8vyHb3ms2PVtoKylTZ5qdXHocWrLLyCm0HCF1nl9j42BHks/NiJ1quXFclmqcne3cjVf3jrgCf6WMr3KD773WKioU6gxwz8JjfsWHhBEnWQMAppSoaUt9z/D7iAKI8zDSP/AIfgPQTDStImWPSGb/6n1iknqcL8OKu//t3XiV8F/BA/kskTAOZ5C/o539hVPbbmR0dumhv///uGtPhoPP//S3f//xYf8QFpXq+XCE1KUaShn86gA5ziNSr//fD/rrx5ipO6DsZBxU0o8GFEx7635lToMlUACicg+8S1rKLlMMSotrvjBYLWeFmT+yGKw6jaAA6ix7LIRIWHBBK+oif+VKRj5mKlghQ521Fw/PipUfE4m5lT7S+Vj5nuH59yw4JlCf9/As4XwI0hrljTThCMPZPiYpquq10Luh3rYuIyJv4RoLKy9zTajEobhzBJlWJ5DUu0VpvPGhTxnFRE3JK6DP7vSORHCe715fLGQorJUP/R2oHR3N7aUoNc3x1Mh09G0hqqtrG+E6D77u2x3Yy7c3/vvL42Qy+s79q2F5j/VSRmnox436gjAnSyAU58r9NHcEy2seQHMi8TLGILWiPSbYk3dEVOxCzcbSMilixwSGKMCU5dAKm38LxRtX62k/XNQe18p9qf/JicLNGXSPneizkc88ac8aEVCPzvAP2EttE2K4cvc+g1sRfAJ2jI/XjAZ132FLDwbEvOdES86Wyjwn1vbRW0kROUce3QULqZ26aA77LkRIyMlQghUQwy7sxwpOPl/KvsLqsFwFr6eTw/GOpfHpFUiy3L8oKhK6Nmgyh/wP4ldLsn1NxV+7wzOIV+AeV+RysktrCjMm56ZwD9jXmb0orlg5f2xT/cuYbnQW7itVQEcYEXIpPP+WY8TiUEwIe1Tjx6S7A/6tefWqjAEQq6oBEz8AtFpefujbmWn7trq+yn7GDoMjXmeaIELEJkebAV0lyhhuNv2BQyR7aRFclYAt/b7350qr8+ARmLNWbpApKezfYbn4oIRcnm+7mzH3PeDP/yHb3ms2PVtoUr1a58ov34FPdUc0j/cSEAUcgLftxtZ+tRLu4N/q/JMy4Sg9cHEE3K0qw4wKjNhU/tZ7i8pW3fUCJX6MvBwMj9oFnj3vzpWdNUQIyGlN24H+dS9Ru9KZv/CJw/H20EkHrSodbvuDiFQ/nbe9PsWhDmng55C8J3GBfjHEEenT0Us/gblvuAoerFWa2sW6ucGKf4dRnh+ZOsW9wY6+yWD/4F6zc/8yDJ30uQpkabHadObpuOmsG+gzda0CPe1v/g9r5I4+srfReaZ35CtZQ99kuOU6Un+861CrBlLDyi+lZuRbRLaKvRx/+D7YIFplzfPoUGnvLPTVPRbwiwp9jAK6B03+dLotj+6rYh7yyVgKrNQ64YUiqfXtOe7NpkGGPOUT2R+Pb4ra43O4x1k3OvH3h+MXGrEUjvY8fraL7hK+J+JpfMR6Ip+BaefaKL6Ex6V/zIJBlyzFWsId5JDNa8ggEeB42UIc/lylriMYuJIDzEcf/+jzeTxJTMu/b93+hqOfPsA0BtD10Y2MZ8keI7V1YOIZy3x3tinTDu8rvN2Rt/n2ECKOveMNZ6/PFzKrMuJJ0krV49uTwlG/LaFFbLUenYH1lOFob+YChwXWqKUm6SbFM/+989vYlq8bPjQdBEFg40/QI0sE65bn0ylHht8Ul4Q9TlHtLvFiEPk58hWJTpQHQW12XmlWyrrrNSs3ZDGg9D5EwwJd2oDAps1NIS4G+0s+t78sUhNTdFmpshykV26yipKEsxdbYoKoGqfZZynfCnM6A/ewPaFyUiDPy60QGhBbB/u6Etqb+P7Ft/Z90NklP8wOCGMBiachjELCAAAA",t="/awesome-node/assets/9-4.c022b8cb.webp",c="/awesome-node/assets/9-5.832150fa.webp",r="/awesome-node/assets/9-6.6cb909f2.webp",F="/awesome-node/assets/9-7.98a4a068.webp",y="/awesome-node/assets/9-8.4577380a.webp",D="/awesome-node/assets/9-9.32ff92cb.webp",i="/awesome-node/assets/9-10.4c4508bc.webp",C="/awesome-node/assets/9-11.252a2ab4.webp",j=JSON.parse('{"title":"EsbuildåŠŸèƒ½å’Œæ’ä»¶","description":"","frontmatter":{"title":"EsbuildåŠŸèƒ½å’Œæ’ä»¶"},"headers":[],"relativePath":"book/vite/9.md","lastUpdated":1680857505000}'),A={name:"book/vite/9.md"},d=l(`<p>ä¸Šä¸€å°èŠ‚ï¼Œæˆ‘ä»¬ä»‹ç»äº† Vite çš„åŒå¼•æ“æ¶æ„ã€‚ä¸å¯å¦è®¤ï¼Œä½œä¸º Vite çš„åŒå¼•æ“ä¹‹ä¸€ï¼ŒEsbuild åœ¨å¾ˆå¤šå…³é”®çš„æ„å»ºé˜¶æ®µ(å¦‚<code>ä¾èµ–é¢„ç¼–è¯‘</code>ã€<code>TS è¯­æ³•è½¬è¯‘</code>ã€<code>ä»£ç å‹ç¼©</code>)è®© Vite è·å¾—äº†ç›¸å½“ä¼˜å¼‚çš„æ€§èƒ½ï¼Œæ˜¯ Vite é«˜æ€§èƒ½çš„å¾—åŠ›åŠ©æ‰‹ã€‚æ— è®ºæ˜¯åœ¨ Vite çš„é…ç½®é¡¹è¿˜æ˜¯æºç å®ç°ä¸­ï¼Œéƒ½åŒ…å«äº†ä¸å°‘ Esbuild æœ¬èº«çš„åŸºæœ¬æ¦‚å¿µå’Œé«˜é˜¶ç”¨æ³•ã€‚å› æ­¤ï¼Œè¦æ·±å…¥æŒæ¡ Viteï¼Œå­¦ä¹  Esbuild å¿…ä¸å¯å°‘ã€‚</p><p>æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬å°†ä¸“æ³¨äº Esbuild æœ¬èº«ï¼Œä¸€èµ·å­¦ä¹ å®ƒçš„åŸºæœ¬æ¦‚å¿µå’ŒåŠŸèƒ½ä½¿ç”¨ï¼ŒåŒæ—¶å®æˆ˜å¼€å‘ä¸€ä¸ªå®Œæ•´çš„ Esbuild æ’ä»¶ã€‚</p><h2 id="ä¸ºä»€ä¹ˆ-esbuild-æ€§èƒ½æé«˜" tabindex="-1">ä¸ºä»€ä¹ˆ Esbuild æ€§èƒ½æé«˜ï¼Ÿ <a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-esbuild-æ€§èƒ½æé«˜" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆ Esbuild æ€§èƒ½æé«˜ï¼Ÿ&quot;">â€‹</a></h2><p><a href="https://esbuild.github.io/" target="_blank" rel="noreferrer">Esbuild</a> æ˜¯ç”± Figma çš„ CTO ã€ŒEvan Wallaceã€åŸºäº Golang å¼€å‘çš„ä¸€æ¬¾æ‰“åŒ…å·¥å…·ï¼Œç›¸æ¯”ä¼ ç»Ÿçš„æ‰“åŒ…å·¥å…·ï¼Œä¸»æ‰“æ€§èƒ½ä¼˜åŠ¿ï¼Œåœ¨æ„å»ºé€Ÿåº¦ä¸Šå¯ä»¥æ¯”ä¼ ç»Ÿå·¥å…·å¿« <code>10~100</code> å€ã€‚é‚£ä¹ˆï¼Œå®ƒæ˜¯å¦‚ä½•è¾¾åˆ°è¿™æ ·è¶…é«˜çš„æ„å»ºæ€§èƒ½çš„å‘¢ï¼Ÿä¸»è¦åŸå› å¯ä»¥æ¦‚æ‹¬ä¸º 4 ç‚¹:</p><ol><li><strong>ä½¿ç”¨ Golang å¼€å‘</strong>ï¼Œæ„å»ºé€»è¾‘ä»£ç ç›´æ¥è¢«ç¼–è¯‘ä¸ºåŸç”Ÿæœºå™¨ç ï¼Œè€Œä¸ç”¨åƒ JS ä¸€æ ·å…ˆä»£ç è§£æä¸ºå­—èŠ‚ç ï¼Œç„¶åè½¬æ¢ä¸ºæœºå™¨ç ï¼Œå¤§å¤§èŠ‚çœäº†ç¨‹åºè¿è¡Œæ—¶é—´ã€‚</li><li><strong>å¤šæ ¸å¹¶è¡Œ</strong>ã€‚å†…éƒ¨æ‰“åŒ…ç®—æ³•å……åˆ†åˆ©ç”¨å¤šæ ¸ CPU ä¼˜åŠ¿ï¼Œæ‰€æœ‰çš„æ­¥éª¤å°½å¯èƒ½å¹¶è¡Œï¼Œè¿™ä¹Ÿæ˜¯å¾—ç›Šäº Go å½“ä¸­å¤šçº¿ç¨‹å…±äº«å†…å­˜çš„ä¼˜åŠ¿ã€‚</li><li><strong>ä»é›¶é€ è½®å­</strong>ã€‚ å‡ ä¹æ²¡æœ‰ä½¿ç”¨ä»»ä½•ç¬¬ä¸‰æ–¹åº“ï¼Œæ‰€æœ‰é€»è¾‘è‡ªå·±ç¼–å†™ï¼Œå¤§åˆ° AST è§£æï¼Œå°åˆ°å­—ç¬¦ä¸²çš„æ“ä½œï¼Œä¿è¯æè‡´çš„ä»£ç æ€§èƒ½ã€‚</li><li><strong>é«˜æ•ˆçš„å†…å­˜åˆ©ç”¨</strong>ã€‚Esbuild ä¸­ä»å¤´åˆ°å°¾å°½å¯èƒ½åœ°å¤ç”¨ä¸€ä»½ AST èŠ‚ç‚¹æ•°æ®ï¼Œè€Œä¸ç”¨åƒ JS æ‰“åŒ…å·¥å…·ä¸­é¢‘ç¹åœ°è§£æå’Œä¼ é€’ AST æ•°æ®ï¼ˆå¦‚ string -&gt; TS -&gt; JS -&gt; string)ï¼Œé€ æˆå†…å­˜çš„å¤§é‡æµªè´¹ã€‚</li></ol><h2 id="esbuild-åŠŸèƒ½ä½¿ç”¨" tabindex="-1">Esbuild åŠŸèƒ½ä½¿ç”¨ <a class="header-anchor" href="#esbuild-åŠŸèƒ½ä½¿ç”¨" aria-label="Permalink to &quot;Esbuild åŠŸèƒ½ä½¿ç”¨&quot;">â€‹</a></h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ­£å¼å­¦ä¹  Esbuild çš„åŠŸèƒ½ä½¿ç”¨ã€‚é¦–å…ˆæˆ‘ä»¬æ‰§è¡Œ<code>pnpm init -y</code>æ–°å»ºä¸€ä¸ªé¡¹ç›®, ç„¶åé€šè¿‡å¦‚ä¸‹çš„å‘½ä»¤å®Œæˆ Esbuild çš„å®‰è£…:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">esbuild</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-D</span></span></code></pre></div><p>ä½¿ç”¨ Esbuild æœ‰ 2 ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ <strong>å‘½ä»¤è¡Œè°ƒç”¨</strong>å’Œ<strong>ä»£ç è°ƒç”¨</strong>ã€‚</p><h2 id="_1-å‘½ä»¤è¡Œè°ƒç”¨" tabindex="-1">1. å‘½ä»¤è¡Œè°ƒç”¨ <a class="header-anchor" href="#_1-å‘½ä»¤è¡Œè°ƒç”¨" aria-label="Permalink to &quot;1. å‘½ä»¤è¡Œè°ƒç”¨&quot;">â€‹</a></h2><p>å‘½ä»¤è¡Œæ–¹å¼è°ƒç”¨ä¹Ÿæ˜¯æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼ã€‚æˆ‘ä»¬å…ˆæ¥å†™ä¸€äº›ç¤ºä¾‹ä»£ç ï¼Œæ–°å»º<code>src/index.jsx</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:</p><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// src/index.jsx</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Server </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">react-dom/server</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> Greet </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Hello, juejin!</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(Server</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">renderToString</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Greet</span><span style="color:#89DDFF;"> /&gt;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>æ³¨æ„å®‰è£…ä¸€ä¸‹æ‰€éœ€çš„ä¾èµ–ï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œå¦‚ä¸‹çš„å‘½ä»¤:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">react</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">react-dom</span></span></code></pre></div><p>æ¥ç€åˆ°<code>package.json</code>ä¸­æ·»åŠ <code>build</code>è„šæœ¬:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esbuild src/index.jsx --bundle --outfile=dist/out.js</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">,</span></span></code></pre></div><p>ç°åœ¨ï¼Œä½ å¯ä»¥åœ¨ç»ˆç«¯æ‰§è¡Œ<code>pnpm run build</code>ï¼Œå¯ä»¥å‘ç°å¦‚ä¸‹çš„æ—¥å¿—ä¿¡æ¯:</p><p><img src="`+p+`" alt="esbuild bundle"></p><p>è¯´æ˜æˆ‘ä»¬å·²ç»æˆåŠŸé€šè¿‡å‘½ä»¤è¡Œå®Œæˆäº† Esbuild æ‰“åŒ…ï¼ä½†å‘½ä»¤è¡Œçš„ä½¿ç”¨æ–¹å¼ä¸å¤Ÿçµæ´»ï¼Œåªèƒ½ä¼ å…¥ä¸€äº›ç®€å•çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œç¨å¾®å¤æ‚çš„åœºæ™¯å°±ä¸é€‚ç”¨äº†ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬è¿˜æ˜¯ä¼šç”¨ä»£ç è°ƒç”¨çš„æ–¹å¼ã€‚</p><h2 id="_2-ä»£ç è°ƒç”¨" tabindex="-1">2. ä»£ç è°ƒç”¨ <a class="header-anchor" href="#_2-ä»£ç è°ƒç”¨" aria-label="Permalink to &quot;2. ä»£ç è°ƒç”¨&quot;">â€‹</a></h2><p>Esbuild å¯¹å¤–æš´éœ²äº†ä¸€ç³»åˆ—çš„ APIï¼Œä¸»è¦åŒ…æ‹¬ä¸¤ç±»: <code>Build API</code>å’Œ<code>Transform API</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Nodejs ä»£ç ä¸­é€šè¿‡è°ƒç”¨è¿™äº› API æ¥ä½¿ç”¨ Esbuild çš„å„ç§åŠŸèƒ½ã€‚</p><h3 id="é¡¹ç›®æ‰“åŒ…â€”â€”build-api" tabindex="-1">é¡¹ç›®æ‰“åŒ…â€”â€”Build API <a class="header-anchor" href="#é¡¹ç›®æ‰“åŒ…â€”â€”build-api" aria-label="Permalink to &quot;é¡¹ç›®æ‰“åŒ…â€”â€”Build API&quot;">â€‹</a></h3><p><code>Build API</code>ä¸»è¦ç”¨æ¥è¿›è¡Œé¡¹ç›®æ‰“åŒ…ï¼ŒåŒ…æ‹¬<code>build</code>ã€<code>buildSync</code>å’Œ<code>serve</code>ä¸‰ä¸ªæ–¹æ³•ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬æ¥è¯•ç€åœ¨ Node.js ä¸­ä½¿ç”¨<code>build</code> æ–¹æ³•ã€‚ä½ å¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»º<code>build.js</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> build</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> buildSync </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esbuild</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">runBuild</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å¼‚æ­¥æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª Promise</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">build</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ----  å¦‚ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„é…ç½®  --- </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å½“å‰é¡¹ç›®æ ¹ç›®å½•</span></span>
<span class="line"><span style="color:#F07178;">    absWorkingDir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cwd</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å…¥å£æ–‡ä»¶åˆ—è¡¨ï¼Œä¸ºä¸€ä¸ªæ•°ç»„</span></span>
<span class="line"><span style="color:#F07178;">    entryPoints</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./src/index.jsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ‰“åŒ…äº§ç‰©ç›®å½•</span></span>
<span class="line"><span style="color:#F07178;">    outdir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ˜¯å¦éœ€è¦æ‰“åŒ…ï¼Œä¸€èˆ¬è®¾ä¸º true</span></span>
<span class="line"><span style="color:#F07178;">    bundle</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ¨¡å—æ ¼å¼ï¼ŒåŒ…æ‹¬\`esm\`ã€\`commonjs\`å’Œ\`iife\`</span></span>
<span class="line"><span style="color:#F07178;">    format</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// éœ€è¦æ’é™¤æ‰“åŒ…çš„ä¾èµ–åˆ—è¡¨</span></span>
<span class="line"><span style="color:#F07178;">    external</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ˜¯å¦å¼€å¯è‡ªåŠ¨æ‹†åŒ…</span></span>
<span class="line"><span style="color:#F07178;">    splitting</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ˜¯å¦ç”Ÿæˆ SourceMap æ–‡ä»¶</span></span>
<span class="line"><span style="color:#F07178;">    sourcemap</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ˜¯å¦ç”Ÿæˆæ‰“åŒ…çš„å…ƒä¿¡æ¯æ–‡ä»¶</span></span>
<span class="line"><span style="color:#F07178;">    metafile</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ˜¯å¦è¿›è¡Œä»£ç å‹ç¼©</span></span>
<span class="line"><span style="color:#F07178;">    minify</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ˜¯å¦å¼€å¯ watch æ¨¡å¼ï¼Œåœ¨ watch æ¨¡å¼ä¸‹ä»£ç å˜åŠ¨åˆ™ä¼šè§¦å‘é‡æ–°æ‰“åŒ…</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ğŸš¨ åŸå°å†Œä¸­æ˜¯æœ‰è¿™ä¸ªé…ç½®çš„ï¼Œä½†å½“å‰esbuild v0.17.6 ç‰ˆæœ¬å·²ç§»é™¤è¯¥é…ç½®é¡¹</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// watch: false,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ˜¯å¦å°†äº§ç‰©å†™å…¥ç£ç›˜</span></span>
<span class="line"><span style="color:#F07178;">    write</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Esbuild å†…ç½®äº†ä¸€ç³»åˆ—çš„ loaderï¼ŒåŒ…æ‹¬ base64ã€binaryã€cssã€dataurlã€fileã€js(x)ã€ts(x)ã€textã€json</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// é’ˆå¯¹ä¸€äº›ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œè°ƒç”¨ä¸åŒçš„ loader è¿›è¡ŒåŠ è½½</span></span>
<span class="line"><span style="color:#F07178;">    loader</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">.png</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">base64</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">runBuild</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>éšåï¼Œä½ åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ<code>node build.js</code>ï¼Œå°±èƒ½åœ¨æ§åˆ¶å°å‘ç°å¦‚ä¸‹æ—¥å¿—ä¿¡æ¯:</p><p><img src="`+o+'" alt="esbuild bundle"></p><p>ä»¥ä¸Šå°±æ˜¯ Esbuild æ‰“åŒ…çš„å…ƒä¿¡æ¯ï¼Œè¿™å¯¹æˆ‘ä»¬ç¼–å†™æ’ä»¶æ‰©å±• Esbuild èƒ½åŠ›éå¸¸æœ‰ç”¨ã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬å†è§‚å¯Ÿä¸€ä¸‹ dist ç›®å½•ï¼Œå‘ç°æ‰“åŒ…äº§ç‰©å’Œç›¸åº”çš„ SourceMap æ–‡ä»¶ä¹Ÿå·²ç»æˆåŠŸå†™å…¥ç£ç›˜:</p><p><img src="'+e+`" alt="esbuild bundle artefact"></p><p>å…¶å®<code>buildSync</code>æ–¹æ³•çš„ä½¿ç”¨å‡ ä¹ç›¸åŒï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">runBuild</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åŒæ­¥æ–¹æ³•</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">buildSync</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// çœç•¥ä¸€ç³»åˆ—çš„é…ç½®</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">runBuild</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>ä½†æˆ‘å¹¶ä¸æ¨èå¤§å®¶ä½¿ç”¨ <code>buildSync</code> è¿™ç§åŒæ­¥çš„ APIï¼Œå®ƒä»¬ä¼šå¯¼è‡´ä¸¤æ–¹é¢ä¸è‰¯åæœã€‚ä¸€æ–¹é¢å®¹æ˜“ä½¿ Esbuild åœ¨å½“å‰çº¿ç¨‹é˜»å¡ï¼Œä¸§å¤±<code>å¹¶å‘ä»»åŠ¡å¤„ç†</code>çš„ä¼˜åŠ¿ã€‚å¦ä¸€æ–¹é¢ï¼ŒEsbuild æ‰€æœ‰æ’ä»¶ä¸­éƒ½ä¸èƒ½ä½¿ç”¨ä»»ä½•å¼‚æ­¥æ“ä½œï¼Œè¿™ç»™<code>æ’ä»¶å¼€å‘</code>å¢åŠ äº†é™åˆ¶ã€‚</p><p>å› æ­¤æˆ‘æ›´æ¨èå¤§å®¶ä½¿ç”¨<code>build</code>è¿™ä¸ªå¼‚æ­¥ APIï¼Œå®ƒå¯ä»¥å¾ˆå¥½åœ°é¿å…ä¸Šè¿°é—®é¢˜ã€‚</p><p>åœ¨é¡¹ç›®æ‰“åŒ…æ–¹é¢ï¼Œé™¤äº†<code>build</code>å’Œ<code>buildSync</code>ï¼ŒEsbuild è¿˜æä¾›äº†å¦å¤–ä¸€ä¸ªæ¯”è¾ƒå¼ºå¤§çš„ APIâ€”â€”<code>serve</code>ã€‚è¿™ä¸ª APIæœ‰3ä¸ªç‰¹ç‚¹:</p><ol><li>å¼€å¯ serve æ¨¡å¼åï¼Œå°†åœ¨æŒ‡å®šçš„ç«¯å£å’Œç›®å½•ä¸Šæ­å»ºä¸€ä¸ª<code>é™æ€æ–‡ä»¶æœåŠ¡</code>ï¼Œè¿™ä¸ªæœåŠ¡å™¨ç”¨åŸç”Ÿ Go è¯­è¨€å®ç°ï¼Œæ€§èƒ½æ¯” Nodejs æ›´é«˜ã€‚</li><li>ç±»ä¼¼ webpack-dev-serverï¼Œæ‰€æœ‰çš„äº§ç‰©æ–‡ä»¶éƒ½é»˜è®¤ä¸ä¼šå†™åˆ°ç£ç›˜ï¼Œè€Œæ˜¯æ”¾åœ¨å†…å­˜ä¸­ï¼Œé€šè¿‡è¯·æ±‚æœåŠ¡æ¥è®¿é—®</li><li><strong>æ¯æ¬¡è¯·æ±‚</strong>åˆ°æ¥æ—¶ï¼Œéƒ½ä¼šè¿›è¡Œé‡æ–°æ„å»º(<code>rebuild</code>)ï¼Œæ°¸è¿œè¿”å›æ–°çš„äº§ç‰©ã€‚</li></ol><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè§¦å‘ rebuild çš„æ¡ä»¶å¹¶ä¸æ˜¯ä»£ç æ”¹åŠ¨ï¼Œè€Œæ˜¯æ–°çš„è¯·æ±‚åˆ°æ¥ã€‚</p></div><p>ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“ä¾‹å­æ¥æ„Ÿå—ä¸€ä¸‹, å¯å‚è€ƒ <a href="https://esbuild.github.io/api/#serve" target="_blank" rel="noreferrer">esbuild#serve</a>ã€‚</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-1MkFB" id="tab-THLfUix" checked="checked"><label for="tab-THLfUix">build.mjs</label><input type="radio" name="group-1MkFB" id="tab-4bOkq-t"><label for="tab-4bOkq-t">src/index.jsx</label></div><div class="blocks"><div class="language-js active"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> esbuild </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">esbuild</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> ctx </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> esbuild</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">context</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">entryPoints</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/index.jsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">bundle</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">outdir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> ctx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">serve</span><span style="color:#A6ACCD;">()</span></span></code></pre></div><div class="language-jsx"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">render</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react-dom</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> Greet </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Hello, juejin!</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Greet</span><span style="color:#89DDFF;"> /&gt;,</span><span style="color:#A6ACCD;"> document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">))</span></span></code></pre></div></div></div><details class="details custom-block"><summary>å°å†ŒåŸå†™æ³•ï¼Œå·²åºŸå¼ƒ</summary><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ğŸš¨ Esbuild v0.17.6ç‰ˆæœ¬ä¸­å·²ç»ä¸å­˜åœ¨ \`serve\` æ¥å£äº†ï¼Œä¸‹é¢ä»£ç ä¸ºä¹‹å‰0.14ç‰ˆæœ¬ç¤ºä¾‹ã€‚</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// build.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> build</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> buildSync</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> serve </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esbuild</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">runBuild</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">serve</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      port</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">8000</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// é™æ€èµ„æºç›®å½•</span></span>
<span class="line"><span style="color:#F07178;">      servedir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dist</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      absWorkingDir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cwd</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      entryPoints</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./src/index.jsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      bundle</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      format</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      splitting</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      sourcemap</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      ignoreAnnotations</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      metafile</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  )</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">server</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">HTTP Server starts at port</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">server</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">port</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">runBuild</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span></code></pre></div></details><p>è¿è¡Œ <code>node build.mjs</code>ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨è®¿é—®<code>localhost:8000/index.js</code>å¯ä»¥çœ‹åˆ° Esbuild æœåŠ¡å™¨è¿”å›çš„ç¼–è¯‘äº§ç‰©å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="`+t+`" alt="esbuild serve"></p><p>åç»­æ¯æ¬¡åœ¨æµè§ˆå™¨è¯·æ±‚éƒ½ä¼šè§¦å‘ Esbuild é‡æ–°æ„å»ºï¼Œè€Œæ¯æ¬¡é‡æ–°æ„å»ºéƒ½æ˜¯ä¸€ä¸ªå¢é‡æ„å»ºçš„è¿‡ç¨‹ï¼Œè€—æ—¶ä¹Ÿä¼šæ¯”é¦–æ¬¡æ„å»ºå°‘å¾ˆå¤š(ä¸€èˆ¬èƒ½å‡å°‘ 70% å·¦å³)ã€‚</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Serve API åªé€‚åˆåœ¨å¼€å‘é˜¶æ®µä½¿ç”¨ï¼Œä¸é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚</p></div><h3 id="å•æ–‡ä»¶è½¬è¯‘â€”â€”transform-api" tabindex="-1">å•æ–‡ä»¶è½¬è¯‘â€”â€”Transform API <a class="header-anchor" href="#å•æ–‡ä»¶è½¬è¯‘â€”â€”transform-api" aria-label="Permalink to &quot;å•æ–‡ä»¶è½¬è¯‘â€”â€”Transform API&quot;">â€‹</a></h3><p>é™¤äº†é¡¹ç›®çš„æ‰“åŒ…åŠŸèƒ½ä¹‹åï¼ŒEsbuild è¿˜ä¸“é—¨æä¾›äº†å•æ–‡ä»¶ç¼–è¯‘çš„èƒ½åŠ›ï¼Œå³<code>Transform API</code>ï¼Œä¸ <code>Build API</code> ç±»ä¼¼ï¼Œå®ƒä¹ŸåŒ…å«äº†åŒæ­¥å’Œå¼‚æ­¥çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯<code>transformSync</code>å’Œ<code>transform</code>ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å…·ä½“ä½¿ç”¨ä¸‹è¿™äº›æ–¹æ³•ã€‚</p><p>é¦–å…ˆï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»º<code>transform.js</code>ï¼Œå†…å®¹å¦‚ä¸‹:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-Egcl-" id="tab-6-EhPLc" checked="checked"><label for="tab-6-EhPLc">transform.js</label></div><div class="blocks"><div class="language-js active"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> transform</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> transformSync </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esbuild</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">runTransform</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä»£ç å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç¼–è¯‘é…ç½®</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">transform</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">const isNull = (str: string): boolean =&gt; str.length &gt; 0;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      sourcemap</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      loader</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">runTransform</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span></code></pre></div></div></div><p>è¿è¡Œ <code>node transform.js</code>ï¼Œæ‰“å°ï¼š</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">warnings:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">code:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">const isNull = (str) =&gt; str.length &gt; 0;\\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">map:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{\\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">&#39;</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> +</span></span>
<span class="line"><span style="color:#C3E88D;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sources</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">&lt;stdin&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">,\\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> +</span></span>
<span class="line"><span style="color:#C3E88D;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sourcesContent</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">const isNull = (str: string): boolean =&gt; str.length &gt; 0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">,\\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> +</span></span>
<span class="line"><span style="color:#C3E88D;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mappings</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">AAAA,MAAM,SAAS,CAAC,QAAyB,IAAI,SAAS;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> +</span></span>
<span class="line"><span style="color:#C3E88D;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">names</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> +</span></span>
<span class="line"><span style="color:#C3E88D;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">,</span></span>
<span class="line"><span style="color:#C3E88D;">  mangleCache: undefined,</span></span>
<span class="line"><span style="color:#C3E88D;">  legalComments: undefined</span></span>
<span class="line"><span style="color:#C3E88D;">}</span></span></code></pre></div><p><code>transformSync</code> çš„ç”¨æ³•ç±»ä¼¼ï¼Œæ¢æˆåŒæ­¥çš„è°ƒç”¨æ–¹å¼å³å¯ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">runTransform</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">transformSync</span><span style="color:#F07178;">(</span><span style="color:#676E95;font-style:italic;">/* å‚æ•°å’Œ transform ç›¸åŒ */</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ä¸è¿‡ç”±äºåŒæ­¥çš„ API ä¼šä½¿ Esbuild ä¸§å¤±<code>å¹¶å‘ä»»åŠ¡å¤„ç†</code>çš„ä¼˜åŠ¿ï¼ˆ<code>Build API</code>çš„éƒ¨åˆ†å·²ç»åˆ†æè¿‡ï¼‰ï¼Œæˆ‘åŒæ ·ä¹Ÿä¸æ¨èå¤§å®¶ä½¿ç”¨<code>transformSync</code>ã€‚å‡ºäºæ€§èƒ½è€ƒè™‘ï¼ŒVite çš„åº•å±‚å®ç°ä¹Ÿæ˜¯é‡‡ç”¨ <code>transform</code>è¿™ä¸ªå¼‚æ­¥çš„ API è¿›è¡Œ TS åŠ JSX çš„å•æ–‡ä»¶è½¬è¯‘çš„ã€‚</p><h2 id="esbuild-æ’ä»¶å¼€å‘" tabindex="-1">Esbuild æ’ä»¶å¼€å‘ <a class="header-anchor" href="#esbuild-æ’ä»¶å¼€å‘" aria-label="Permalink to &quot;Esbuild æ’ä»¶å¼€å‘&quot;">â€‹</a></h2><p>æˆ‘ä»¬åœ¨ä½¿ç”¨ Esbuild çš„æ—¶å€™éš¾å…ä¼šé‡åˆ°ä¸€äº›éœ€è¦åŠ ä¸Šè‡ªå®šä¹‰æ’ä»¶çš„åœºæ™¯ï¼Œå¹¶ä¸” Vite ä¾èµ–é¢„ç¼–è¯‘çš„å®ç°ä¸­å¤§é‡åº”ç”¨äº† Esbuild æ’ä»¶çš„é€»è¾‘ã€‚å› æ­¤ï¼Œæ’ä»¶å¼€å‘æ˜¯ Esbuild ä¸­éå¸¸é‡è¦çš„å†…å®¹ï¼Œ</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä¸€èµ·æ¥å®Œæˆ Esbuild çš„æ’ä»¶å¼€å‘ï¼Œå¸¦ä½ æŒæ¡è‹¥å¹²ä¸ªå…³é”®çš„é’©å­ä½¿ç”¨ã€‚</p><h3 id="åŸºæœ¬æ¦‚å¿µ" tabindex="-1">åŸºæœ¬æ¦‚å¿µ <a class="header-anchor" href="#åŸºæœ¬æ¦‚å¿µ" aria-label="Permalink to &quot;åŸºæœ¬æ¦‚å¿µ&quot;">â€‹</a></h3><p>æ’ä»¶å¼€å‘å…¶å®å°±æ˜¯åŸºäºåŸæœ‰çš„ä½“ç³»ç»“æ„ä¸­è¿›è¡Œ<code>æ‰©å±•</code>å’Œ<code>è‡ªå®šä¹‰</code>ã€‚ <a href="https://esbuild.github.io/plugins/#using-plugins" target="_blank" rel="noreferrer">Esbuildæ’ä»¶</a>ä¹Ÿä¸ä¾‹å¤–ï¼Œé€šè¿‡ Esbuild æ’ä»¶æˆ‘ä»¬å¯ä»¥æ‰©å±• Esbuild åŸæœ‰çš„è·¯å¾„è§£æã€æ¨¡å—åŠ è½½ç­‰æ–¹é¢çš„èƒ½åŠ›ï¼Œå¹¶åœ¨ Esbuild çš„æ„å»ºè¿‡ç¨‹ä¸­æ‰§è¡Œä¸€ç³»åˆ—è‡ªå®šä¹‰çš„é€»è¾‘ã€‚</p><p><code>Esbuild</code> æ’ä»¶ç»“æ„è¢«è®¾è®¡ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œé‡Œé¢æœ‰<code>name</code>å’Œ<code>setup</code>ä¸¤ä¸ªå±æ€§ï¼Œ<code>name</code>æ˜¯æ’ä»¶çš„åç§°ï¼Œ<code>setup</code>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä¸­å…¥å‚æ˜¯ä¸€ä¸ª <code>build</code> å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸ŠæŒ‚è½½äº†ä¸€äº›é’©å­å¯ä¾›æˆ‘ä»¬è‡ªå®šä¹‰ä¸€äº›é’©å­å‡½æ•°é€»è¾‘ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„<code>Esbuild</code>æ’ä»¶ç¤ºä¾‹:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> envPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">setup</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">build</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#C3E88D;">env</span><span style="color:#89DDFF;font-style:italic;">$</span><span style="color:#89DDFF;">/</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      namespace</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env-ns</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onLoad</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">*/</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> namespace</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env-ns</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      contents</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">env</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      loader</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">esbuild</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">build</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">entryPoints</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/index.jsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">bundle</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">outfile</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">out.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åº”ç”¨æ’ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [envPlugin]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exit</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">))</span></span></code></pre></div><p>ä½¿ç”¨æ’ä»¶åæ•ˆæœå¦‚ä¸‹:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// åº”ç”¨äº† env æ’ä»¶åï¼Œæ„å»ºæ—¶å°†ä¼šè¢«æ›¿æ¢æˆ p<wbr>rocess.env å¯¹è±¡</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">PATH</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">PATH is </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">PATH</span><span style="color:#89DDFF;">}\`</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>é‚£ä¹ˆï¼Œ<code>build</code>å¯¹è±¡ä¸Šçš„å„ç§é’©å­å‡½æ•°æ˜¯å¦‚ä½•ä½¿ç”¨çš„å‘¢ï¼Ÿ</p><h2 id="é’©å­å‡½æ•°çš„ä½¿ç”¨" tabindex="-1">é’©å­å‡½æ•°çš„ä½¿ç”¨ <a class="header-anchor" href="#é’©å­å‡½æ•°çš„ä½¿ç”¨" aria-label="Permalink to &quot;é’©å­å‡½æ•°çš„ä½¿ç”¨&quot;">â€‹</a></h2><h3 id="_1-onresolve-é’©å­-å’Œ-onloadé’©å­" tabindex="-1">1. <code>onResolve</code> é’©å­ å’Œ <code>onLoad</code>é’©å­ <a class="header-anchor" href="#_1-onresolve-é’©å­-å’Œ-onloadé’©å­" aria-label="Permalink to &quot;1. \`onResolve\` é’©å­ å’Œ \`onLoad\`é’©å­&quot;">â€‹</a></h3><p>åœ¨ Esbuild æ’ä»¶ä¸­ï¼Œ<a href="https://esbuild.github.io/plugins/#on-resolve" target="_blank" rel="noreferrer">onResolve</a> å’Œ <a href="https://esbuild.github.io/plugins/#on-load" target="_blank" rel="noreferrer">onLoad </a>æ˜¯ä¸¤ä¸ªéå¸¸é‡è¦çš„é’©å­ï¼Œåˆ†åˆ«æ§åˆ¶è·¯å¾„è§£æå’Œæ¨¡å—å†…å®¹åŠ è½½çš„è¿‡ç¨‹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥è¯´è¯´ä¸Šé¢æ’ä»¶ç¤ºä¾‹ä¸­çš„ä¸¤ä¸ªé’©å­è¯¥å¦‚ä½•ä½¿ç”¨ã€‚</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#C3E88D;">env</span><span style="color:#89DDFF;font-style:italic;">$</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env-ns</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onLoad</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">*/</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env-ns</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">contents</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(process</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">env)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">loader</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>å¯ä»¥å‘ç°è¿™ä¸¤ä¸ªé’©å­å‡½æ•°ä¸­éƒ½éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°: <code>Options</code> å’Œ <code>Callback</code>ã€‚</p><p>å…ˆè¯´è¯´<code>Options</code>ã€‚å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹äº<code>onResolve</code> å’Œ <code>onload</code> éƒ½ä¸€æ ·ï¼ŒåŒ…å«<code>filter</code>å’Œ<code>namespace</code>ä¸¤ä¸ªå±æ€§ï¼Œç±»å‹å®šä¹‰å¦‚ä¸‹:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Options</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">RegExp</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><code>filter</code> ä¸ºå¿…ä¼ å‚æ•°ï¼Œæ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œå®ƒå†³å®šäº†è¦è¿‡æ»¤å‡ºçš„ç‰¹å¾æ–‡ä»¶ã€‚</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>ğŸ“¢ æ³¨æ„: æ’ä»¶ä¸­çš„ <code>filter</code> æ­£åˆ™æ˜¯ä½¿ç”¨ Go åŸç”Ÿæ­£åˆ™å®ç°çš„ï¼Œä¸ºäº†ä¸ä½¿æ€§èƒ½è¿‡äºåŠ£åŒ–ï¼Œè§„åˆ™åº”è¯¥å°½å¯èƒ½ä¸¥æ ¼ã€‚åŒæ—¶å®ƒæœ¬èº«å’Œ JS çš„æ­£åˆ™ä¹Ÿæœ‰æ‰€åŒºåˆ«ï¼Œä¸æ”¯æŒå‰ç»(?&lt;=)ã€åé¡¾(?=)å’Œåå‘å¼•ç”¨(\\1)è¿™ä¸‰ç§è§„åˆ™ã€‚</p></div><p><code>namespace</code> ä¸ºé€‰å¡«å‚æ•°ï¼Œä¸€èˆ¬åœ¨ <code>onResolve</code> é’©å­ä¸­çš„å›è°ƒå‚æ•°è¿”å›<code>namespace</code>å±æ€§ä½œä¸ºæ ‡è¯†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>onLoad</code>é’©å­ä¸­é€šè¿‡ <code>namespace</code> å°†æ¨¡å—è¿‡æ»¤å‡ºæ¥ã€‚å¦‚ä¸Šè¿°æ’ä»¶ç¤ºä¾‹å°±åœ¨<code>onLoad</code>é’©å­é€šè¿‡<code>env-ns</code>è¿™ä¸ª namespace æ ‡è¯†è¿‡æ»¤å‡ºäº†è¦å¤„ç†çš„<code>env</code>æ¨¡å—ã€‚</p><p>é™¤äº† Options å‚æ•°ï¼Œè¿˜æœ‰ä¸€ä¸ªå›è°ƒå‚æ•° <code>Callback</code>ï¼Œå®ƒçš„ç±»å‹æ ¹æ®ä¸åŒçš„é’©å­ä¼šæœ‰æ‰€ä¸åŒã€‚ç›¸æ¯”äº Optionsï¼ŒCallback å‡½æ•°å…¥å‚å’Œè¿”å›å€¼çš„ç»“æ„å¤æ‚å¾—å¤šï¼Œæ¶‰åŠå¾ˆå¤šå±æ€§ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦çœ‹æ‡‚æ¯ä¸ªå±æ€§çš„ç»†èŠ‚ï¼Œå…ˆäº†è§£ä¸€éå³å¯ï¼Œå¸¸ç”¨çš„ä¸€äº›å±æ€§ä¼šåœ¨æ’ä»¶å®æˆ˜éƒ¨åˆ†è®²è§£æ¥è®²ã€‚</p><p>åœ¨ <code>onResolve</code> é’©å­ä¸­å‡½æ•°å‚æ•°å’Œè¿”å›å€¼æ¢³ç†å¦‚ä¸‹:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#C3E88D;">env</span><span style="color:#89DDFF;font-style:italic;">$</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">onResolveArgs</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">onResolveResult</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ¨¡å—è·¯å¾„</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// çˆ¶æ¨¡å—è·¯å¾„</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">importer</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// namespace æ ‡è¯†</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">namespace</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åŸºå‡†è·¯å¾„</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">resolveDir</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å¯¼å…¥æ–¹å¼ï¼Œå¦‚ importã€require</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">kind</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// é¢å¤–ç»‘å®šçš„æ’ä»¶æ•°æ®</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pluginData</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// é”™è¯¯ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F07178;">      errors</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æ˜¯å¦éœ€è¦ external</span></span>
<span class="line"><span style="color:#F07178;">      external</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// namespace æ ‡è¯†</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">namespace</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env-ns</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æ¨¡å—è·¯å¾„</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;">: </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// é¢å¤–ç»‘å®šçš„æ’ä»¶æ•°æ®</span></span>
<span class="line"><span style="color:#F07178;">      pluginData</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æ’ä»¶åç§°</span></span>
<span class="line"><span style="color:#F07178;">      pluginName</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// è®¾ç½®ä¸º falseï¼Œå¦‚æœæ¨¡å—æ²¡æœ‰è¢«ç”¨åˆ°ï¼Œæ¨¡å—ä»£ç å°†ä¼šåœ¨äº§ç‰©ä¸­ä¼šåˆ é™¤ã€‚å¦åˆ™ä¸ä¼šè¿™ä¹ˆåš</span></span>
<span class="line"><span style="color:#F07178;">      sideEffects</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æ·»åŠ ä¸€äº›è·¯å¾„åç¼€ï¼Œå¦‚\`?xxx\`</span></span>
<span class="line"><span style="color:#F07178;">      suffix</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">?xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// è­¦å‘Šä¿¡æ¯</span></span>
<span class="line"><span style="color:#F07178;">      warnings</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ä»…ä»…åœ¨ Esbuild å¼€å¯ watch æ¨¡å¼ä¸‹ç”Ÿæ•ˆ</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å‘Šè¯‰ Esbuild éœ€è¦é¢å¤–ç›‘å¬å“ªäº›æ–‡ä»¶/ç›®å½•çš„å˜åŒ–</span></span>
<span class="line"><span style="color:#F07178;">      watchDirs</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      watchFiles</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>åœ¨ <code>onLoad</code> é’©å­ä¸­å‡½æ•°å‚æ•°å’Œè¿”å›å€¼æ¢³ç†å¦‚ä¸‹:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onLoad</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">*/</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">env-ns</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">OnLoadArgs</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">OnLoadResult</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ¨¡å—è·¯å¾„</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// namespace æ ‡è¯†</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">namespace</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åç¼€ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">suffix</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// é¢å¤–çš„æ’ä»¶æ•°æ®</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pluginData</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æ¨¡å—å…·ä½“å†…å®¹</span></span>
<span class="line"><span style="color:#F07178;">      contents</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">çœç•¥å†…å®¹</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// é”™è¯¯ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F07178;">      errors</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æŒ‡å®š loaderï¼Œå¦‚\`js\`ã€\`ts\`ã€\`jsx\`ã€\`tsx\`ã€\`json\`ç­‰ç­‰</span></span>
<span class="line"><span style="color:#F07178;">      loader</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// é¢å¤–çš„æ’ä»¶æ•°æ®</span></span>
<span class="line"><span style="color:#F07178;">      pluginData</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æ’ä»¶åç§°</span></span>
<span class="line"><span style="color:#F07178;">      pluginName</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// åŸºå‡†è·¯å¾„</span></span>
<span class="line"><span style="color:#F07178;">      resolveDir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dir</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// è­¦å‘Šä¿¡æ¯</span></span>
<span class="line"><span style="color:#F07178;">      warnings</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// åŒä¸Š</span></span>
<span class="line"><span style="color:#F07178;">      watchDirs</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      watchFiles</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h3 id="_2-å…¶ä»–é’©å­" tabindex="-1">2. å…¶ä»–é’©å­ <a class="header-anchor" href="#_2-å…¶ä»–é’©å­" aria-label="Permalink to &quot;2. å…¶ä»–é’©å­&quot;">â€‹</a></h3><p>åœ¨ build å¯¹è±¡ä¸­ï¼Œé™¤äº†<code>onResolve</code>å’Œ<code>onLoad</code>ï¼Œè¿˜æœ‰<code>onStart</code>å’Œ<code>onEnd</code>ä¸¤ä¸ªé’©å­ç”¨æ¥åœ¨æ„å»ºå¼€å¯å’Œç»“æŸæ—¶æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰çš„é€»è¾‘ï¼Œä½¿ç”¨ä¸Šæ¯”è¾ƒç®€å•ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤º:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> examplePlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">example</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">setup</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">build</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onStart</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">build started</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onEnd</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">buildResult</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">buildResult</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">errors</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æ„å»ºå…ƒä¿¡æ¯</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// è·å–å…ƒä¿¡æ¯ååšä¸€äº›è‡ªå®šä¹‰çš„äº‹æƒ…ï¼Œæ¯”å¦‚ç”Ÿæˆ HTML</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">buildResult</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">metafile</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>åœ¨ä½¿ç”¨è¿™äº›é’©å­çš„æ—¶å€™ï¼Œæœ‰ 2 ç‚¹éœ€è¦æ³¨æ„:</p><ol><li>onStart çš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨æ¯æ¬¡ build çš„æ—¶å€™ï¼ŒåŒ…æ‹¬è§¦å‘ <code>watch</code> æˆ–è€… <code>serve</code>æ¨¡å¼ä¸‹çš„é‡æ–°æ„å»º</li><li>onEnd é’©å­ä¸­å¦‚æœè¦æ‹¿åˆ° <code>metafile</code>ï¼Œå¿…é¡»å°† Esbuild çš„æ„å»ºé…ç½®ä¸­<code>metafile</code>å±æ€§è®¾ä¸º <code>true</code></li></ol><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿›å…¥æ’ä»¶å®æˆ˜ï¼Œé€šè¿‡ç¼–å†™ä¸€äº›ç‰¹å®šåŠŸèƒ½çš„æ’ä»¶æ¥ç†Ÿæ‚‰ Esbuild æ’ä»¶çš„å¼€å‘æµç¨‹å’ŒæŠ€å·§ã€‚</p><h2 id="å®æˆ˜-1-cdn-ä¾èµ–æ‹‰å–æ’ä»¶" tabindex="-1">å®æˆ˜ 1: CDN ä¾èµ–æ‹‰å–æ’ä»¶ <a class="header-anchor" href="#å®æˆ˜-1-cdn-ä¾èµ–æ‹‰å–æ’ä»¶" aria-label="Permalink to &quot;å®æˆ˜ 1: CDN ä¾èµ–æ‹‰å–æ’ä»¶&quot;">â€‹</a></h2><p>Esbuild åŸç”Ÿä¸æ”¯æŒé€šè¿‡ HTTP ä» CDN æœåŠ¡ä¸Šæ‹‰å–å¯¹åº”çš„ç¬¬ä¸‰æ–¹ä¾èµ–èµ„æºï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// src/index.jsx</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// react-dom çš„å†…å®¹å…¨éƒ¨ä» CDN æ‹‰å–</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è¿™æ®µä»£ç ç›®å‰æ˜¯æ— æ³•è¿è¡Œçš„</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">render</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://cdn.skypack.dev/react-dom</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://cdn.skypack.dev/react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> Greet </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Hello, juejin!</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">h1</span><span style="color:#89DDFF;">&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Greet</span><span style="color:#89DDFF;"> /&gt;,</span><span style="color:#A6ACCD;"> document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>ç¤ºä¾‹ä»£ç ä¸­æˆ‘ä»¬ç”¨åˆ°äº† <code>Skypack</code> è¿™ä¸ªæä¾› npm ç¬¬ä¸‰æ–¹åŒ… ESM äº§ç‰©çš„ <code>CDN æœåŠ¡</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ url è®¿é—®ç¬¬ä¸‰æ–¹åŒ…çš„èµ„æºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="`+c+`" alt="CDN"></p><p>ç°åœ¨æˆ‘ä»¬éœ€è¦é€šè¿‡ Esbuild æ’ä»¶æ¥è¯†åˆ«è¿™æ ·çš„ url è·¯å¾„ï¼Œç„¶åä»ç½‘ç»œè·å–æ¨¡å—å†…å®¹å¹¶è®© Esbuild è¿›è¡ŒåŠ è½½ï¼Œç”šè‡³ä¸å†éœ€è¦<code>npm install</code>å®‰è£…ä¾èµ–äº†ï¼Œè¿™çœ‹ä¸Šå»æ˜¯ä¸æ˜¯å¾ˆé…·å‘¢ï¼Ÿ</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>é¡ºä¾¿æä¸€å¥ï¼ŒESM CDN ä½œä¸ºé¢å‘æœªæ¥çš„å‰ç«¯åŸºç¡€è®¾æ–½ï¼Œå¯¹ Vite çš„å½±å“ä¹Ÿè‡³å…³é‡å¤§ï¼Œå¯ä»¥æå¤§æå‡ Vite åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹çš„æ„å»ºæ€§èƒ½ã€‚è¿™éƒ¨åˆ†å†…å®¹æˆ‘ä»¬å°†åœ¨<strong>é«˜çº§åº”ç”¨</strong>è¿™ä¸€ç« å±•å¼€ä»‹ç»ã€‚</p></div><p>æˆ‘ä»¬å…ˆä»æœ€ç®€å•çš„ç‰ˆæœ¬å¼€å§‹å†™èµ·:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// http-import-plugin.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esbuild:http</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">setup</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">build</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">https</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">require</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">http</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">require</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 1. æ‹¦æˆª CDN è¯·æ±‚</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#C3E88D;">https</span><span style="color:#89DDFF;">?</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;">\\/\\/</span><span style="color:#89DDFF;">/</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      namespace</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http-url</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 2. é€šè¿‡ fetch è¯·æ±‚åŠ è½½ CDN èµ„æº</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onLoad</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">*/</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> namespace</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http-url</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">contents</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Downloading: </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lib</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">startsWith</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">https</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">http</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">req</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lib</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> ([</span><span style="color:#F78C6C;">301</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">302</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">307</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">includes</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">statusCode</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// é‡å®šå‘</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">URL</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">headers</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">location</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">abort</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">statusCode</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">200</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// å“åº”æˆåŠŸ</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">chunks</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">data</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">chunk</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">chunks</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">chunk</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">end</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Buffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">concat</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">chunks</span><span style="color:#F07178;">)))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">                  </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">GET </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> failed: status </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">statusCode</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">                )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">contents</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>ç„¶åæˆ‘ä»¬æ–°å»º<code>build.js</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> build </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esbuild</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> httpImport </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./http-import-plugin</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">runBuild</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">build</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    absWorkingDir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cwd</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    entryPoints</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./src/index.jsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    outdir</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    bundle</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    format</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    splitting</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    sourcemap</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    metafile</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#82AAFF;">httpImport</span><span style="color:#F07178;">()]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ğŸš€ Build Finished!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">runBuild</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>é€šè¿‡<code>node build.js</code>æ‰§è¡Œæ‰“åŒ…è„šæœ¬ï¼Œå‘ç°æ’ä»¶ä¸èƒ½ workï¼ŒæŠ›å‡ºäº†è¿™æ ·ä¸€ä¸ªé”™è¯¯:</p><p><img src="`+r+`" alt="esbuild cdn plugin"></p><p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä½ å¯ä»¥å›è¿‡å¤´è§‚å¯Ÿä¸€ä¸‹ç¬¬ä¸‰æ–¹åŒ…çš„å“åº”å†…å®¹:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> from </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/-/react-dom@v17.0.1-oZ1BXZ5opQ1DbTh7nu9r/dist=es2019,mode=imports/optimized/react-dom.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">default</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> from </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/-/react-dom@v17.0.1-oZ1BXZ5opQ1DbTh7nu9r/dist=es2019,mode=imports/optimized/react-dom.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>è¿›ä¸€æ­¥æŸ¥çœ‹è¿˜æœ‰æ›´å¤šçš„æ¨¡å—å†…å®¹:</p><p><img src="`+F+`" alt="esbuild cdn plugin"></p><p>å› æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šé™¤äº†è¦è§£æ react-dom è¿™ç§ç›´æ¥ä¾èµ–çš„è·¯å¾„ï¼Œè¿˜è¦è§£æå®ƒä¾èµ–çš„è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯é—´æ¥ä¾èµ–çš„è·¯å¾„ã€‚</p><p>é‚£å¦‚ä½•æ¥å®ç°è¿™ä¸ªæ•ˆæœå‘¢ï¼Ÿæˆ‘ä»¬ä¸å¦¨åŠ å…¥è¿™æ ·ä¸€æ®µ<code>onResolve</code>é’©å­é€»è¾‘:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// æ‹¦æˆªé—´æ¥ä¾èµ–çš„è·¯å¾„ï¼Œå¹¶é‡å†™è·¯å¾„</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// tip: é—´æ¥ä¾èµ–åŒæ ·ä¼šè¢«è‡ªåŠ¨å¸¦ä¸Š \`http-url\`çš„ namespace</span></span>
<span class="line"><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">*/</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http-url</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// é‡å†™è·¯å¾„</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">URL</span><span style="color:#A6ACCD;">(args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">importer)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http-url</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>åŠ äº†è¿™æ®µé€»è¾‘åï¼ŒEsbuild è·¯å¾„è§£æçš„æµç¨‹å¦‚ä¸‹:</p><p><img src="`+y+'" alt="esbuildè·¯å¾„è§£æ"></p><p>ç°åœ¨æˆ‘ä»¬å†æ¬¡æ‰§è¡Œ<code>node build.js</code>ï¼Œå‘ç°ä¾èµ–å·²ç»æˆåŠŸä¸‹è½½å¹¶æ‰“åŒ…äº†ã€‚</p><p><img src="'+D+`" alt="esbuild build"></p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>ğŸš¨å®é™…æ“ä½œå‘ç°ä¸€ç›´æŠ¥é”™ï¼Œéœ€è¦è¿›ä¸€æ­¥ç ”ç©¶ğŸ˜…ã€‚</p></div><h2 id="å®æˆ˜-2-å®ç°-html-æ„å»ºæ’ä»¶" tabindex="-1">å®æˆ˜ 2: å®ç° HTML æ„å»ºæ’ä»¶ <a class="header-anchor" href="#å®æˆ˜-2-å®ç°-html-æ„å»ºæ’ä»¶" aria-label="Permalink to &quot;å®æˆ˜ 2: å®ç° HTML æ„å»ºæ’ä»¶&quot;">â€‹</a></h2><p>Esbuild ä½œä¸ºä¸€ä¸ªå‰ç«¯æ‰“åŒ…å·¥å…·ï¼Œæœ¬èº«å¹¶ä¸å…·å¤‡ HTML çš„æ„å»ºèƒ½åŠ›ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å®ƒæŠŠ js/css äº§ç‰©æ‰“åŒ…å‡ºæ¥çš„æ—¶å€™ï¼Œå¹¶ä¸æ„å‘³ç€å‰ç«¯çš„é¡¹ç›®å¯ä»¥ç›´æ¥è¿è¡Œäº†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä»½å¯¹åº”çš„å…¥å£ HTML æ–‡ä»¶ã€‚è€Œè¿™ä»½ HTML æ–‡ä»¶å½“ç„¶å¯ä»¥æ‰‹å†™ä¸€ä¸ªï¼Œä½†æ‰‹å†™æ˜¾å¾—æ¯”è¾ƒéº»çƒ¦ï¼Œå°¤å…¶æ˜¯äº§ç‰©åç§°å¸¦å“ˆå¸Œå€¼çš„æ—¶å€™ï¼Œæ¯æ¬¡æ‰“åŒ…å®Œéƒ½è¦æ›¿æ¢è·¯å¾„ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½é€šè¿‡ Esbuild æ’ä»¶çš„æ–¹å¼æ¥è‡ªåŠ¨åŒ–åœ°ç”Ÿæˆ HTML å‘¢ï¼Ÿ</p><p>åˆšæ‰æˆ‘ä»¬è¯´äº†ï¼Œåœ¨ Esbuild æ’ä»¶çš„ <code>onEnd</code> é’©å­ä¸­å¯ä»¥æ‹¿åˆ° <code>metafile</code> å¯¹è±¡çš„ä¿¡æ¯ã€‚é‚£ä¹ˆï¼Œè¿™ä¸ªå¯¹è±¡ç©¶ç«Ÿä»€ä¹ˆæ ·å‘¢ï¼Ÿ</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">inputs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">/* çœç•¥å†…å®¹ */</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">output</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">dist/index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      imports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      exports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      entryPoint</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/index.jsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      inputs</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">http-url:https://cdn.skypack.dev/-/object-assign@v4.1.1-LbCnB3r2y2yFmhmiCfPn/dist=es2019,mode=imports/optimized/object-assign.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> bytesInOutput</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1792</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">http-url:https://cdn.skypack.dev/-/react@v17.0.1-yH0aYV1FOvoIPeKBbHxg/dist=es2019,mode=imports/optimized/react.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> bytesInOutput</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">10396</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">http-url:https://cdn.skypack.dev/-/scheduler@v0.20.2-PAU9F1YosUNPKr7V4s0j/dist=es2019,mode=imports/optimized/scheduler.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> bytesInOutput</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">9084</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">http-url:https://cdn.skypack.dev/-/react-dom@v17.0.1-oZ1BXZ5opQ1DbTh7nu9r/dist=es2019,mode=imports/optimized/react-dom.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> bytesInOutput</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">183229</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">http-url:https://cdn.skypack.dev/react-dom</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> bytesInOutput</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">src/index.jsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> bytesInOutput</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">178</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      bytes</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">205284</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">dist/index.js.map</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">/* çœç•¥å†…å®¹ */</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ä»<code>outputs</code>å±æ€§ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°äº§ç‰©çš„è·¯å¾„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨æ’ä»¶ä¸­æ‹¿åˆ°æ‰€æœ‰ js å’Œ css äº§ç‰©ï¼Œç„¶åè‡ªå·±ç»„è£…ã€ç”Ÿæˆä¸€ä¸ª HTMLï¼Œå®ç°è‡ªåŠ¨åŒ–ç”Ÿæˆ HTML çš„æ•ˆæœã€‚</p><p>æˆ‘ä»¬æ¥ç€æ¥å®ç°ä¸€ä¸‹è¿™ä¸ªæ’ä»¶çš„é€»è¾‘ï¼Œé¦–å…ˆæ–°å»º<code>html-plugin.js</code>ï¼Œå†…å®¹å¦‚ä¸‹:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-LNa_9" id="tab-SFdyhcz" checked="checked"><label for="tab-SFdyhcz">html-plugin.js</label><input type="radio" name="group-LNa_9" id="tab-QI_3UZw"><label for="tab-QI_3UZw">util.js</label></div><div class="blocks"><div class="language-js active"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">fs/promises</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> path </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> createScript</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> createLink</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> generateHTML </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./util</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esbuild:html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    setup</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">build</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onEnd</span><span style="color:#F07178;">(</span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">buildResult</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">buildResult</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">errors</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">metafile</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buildResult</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 1. æ‹¿åˆ° metafile åè·å–æ‰€æœ‰çš„ js å’Œ css äº§ç‰©è·¯å¾„</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">scripts</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">links</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">metafile</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">outputs</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">metafile</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">assets</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">keys</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">outputs</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">assets</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">asset</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">asset</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">endsWith</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#A6ACCD;">scripts</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">createScript</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">asset</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">asset</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">endsWith</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.css</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#A6ACCD;">links</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">createLink</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">asset</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 2. æ‹¼æ¥ HTML å†…å®¹</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">templateContent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">generateHTML</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">scripts</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">links</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 3. HTML å†™å…¥ç£ç›˜</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">templatePath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cwd</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">index.html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">writeFile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">templatePath</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">templateContent</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ä¸€äº›å·¥å…·å‡½æ•°çš„å®ç°</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> createScript </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">src</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">&lt;script type=&quot;module&quot; src=&quot;http://www.lilnong.top/urlTrans?group=juejin&amp;url=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&quot;&gt;&lt;/script&gt;</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> createLink </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">src</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">&lt;link rel=&quot;stylesheet&quot; href=&quot;</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&quot;&gt;&lt;/link&gt;</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> generateHTML </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">scripts</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">links</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">&lt;!DOCTYPE html&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">&lt;html lang=&quot;en&quot;&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">&lt;head&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">  &lt;meta charset=&quot;UTF-8&quot; /&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">  &lt;title&gt;Esbuild App&lt;/title&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">links</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C3E88D;">&lt;/head&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">&lt;body&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">  &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">scripts</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C3E88D;">&lt;/body&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">&lt;/html&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> createLink</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> createScript</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> generateHTML </span><span style="color:#89DDFF;">};</span></span></code></pre></div></div></div><p>ç°åœ¨æˆ‘ä»¬åœ¨ <code>build.js</code> ä¸­å¼•å…¥ html æ’ä»¶:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> html </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./html-plugin</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// esbuild é…ç½®</span></span>
<span class="line"><span style="color:#FFCB6B;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// çœç•¥å…¶å®ƒæ’ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">html</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span></code></pre></div><p>ç„¶åæ‰§è¡Œ<code>node build.js</code>å¯¹é¡¹ç›®è¿›è¡Œæ‰“åŒ…ï¼Œä½ å°±å¯ä»¥çœ‹åˆ° <code>index.html</code> å·²ç»æˆåŠŸè¾“å‡ºåˆ°æ ¹ç›®å½•ã€‚æ¥ç€ï¼Œæˆ‘ä»¬é€šè¿‡ <code>serve</code> èµ·ä¸€ä¸ªæœ¬åœ°é™æ€æ–‡ä»¶æœåŠ¡å™¨:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">å…¨å±€å®‰è£…</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">serve</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-g</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">serve</span></span>
<span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2.</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#FFCB6B;">serve</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„ç•Œé¢:</p><p><img src="`+i+'" alt="serve"></p><p>å†è®¿é—®<code>localhost:3000</code>ï¼Œä¼šé»˜è®¤è®¿é—®åˆ° index.html çš„å†…å®¹ï¼š</p><p><img src="'+C+'" alt="serve success"></p><p>è¿™æ ·ä¸€æ¥ï¼Œåº”ç”¨çš„å†…å®¹å°±æˆåŠŸæ˜¾ç¤ºäº†ï¼Œä¹Ÿè¯´æ˜ HTML æ’ä»¶æ­£å¸¸ç”Ÿæ•ˆäº†ã€‚å½“ç„¶ï¼Œå¦‚æœè¦åšä¸€ä¸ªè¶³å¤Ÿé€šç”¨çš„ HTML æ’ä»¶ï¼Œè¿˜éœ€è¦è€ƒè™‘è¯¸å¤šçš„å› ç´ ï¼Œæ¯”å¦‚<code>è‡ªå®šä¹‰ HTML å†…å®¹</code>ã€<code>è‡ªå®šä¹‰å…¬å…±å‰ç¼€(publicPath)</code>ã€<code>è‡ªå®šä¹‰ script æ ‡ç­¾ç±»å‹</code>ä»¥åŠ <code>å¤šå…¥å£æ‰“åŒ…</code>ç­‰ç­‰ï¼Œå¤§å®¶æ„Ÿå…´è¶£çš„è¯å¯ä»¥è‡ªè¡Œæ‰©å±•ã€‚(å¯å‚è€ƒ<a href="https://github.com/sanyuan0704/ewas/blob/main/packages/esbuild-plugin-html/src/index.ts" target="_blank" rel="noreferrer">è¿™ä¸ªå¼€æºæ’ä»¶</a>)</p><h2 id="å°ç»“" tabindex="-1">å°ç»“ <a class="header-anchor" href="#å°ç»“" aria-label="Permalink to &quot;å°ç»“&quot;">â€‹</a></h2><p>æ­å–œä½ ï¼Œå­¦ä¹ å®Œäº†æœ¬èŠ‚çš„å†…å®¹ï¼è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬è¦é‡ç‚¹æŒæ¡ Esbuild çš„åŸºç¡€ä½¿ç”¨å’Œæ’ä»¶å¼€å‘ã€‚</p><p>é¦–å…ˆä½ å¯ä»¥é€šè¿‡<code>å‘½ä»¤è¡Œæ–¹å¼</code>å’Œ<code>ä»£ç è°ƒç”¨æ–¹å¼</code>ä¸¤ç§æ–¹å¼æ¥ä½¿ç”¨ Esbuildã€‚å¯¹åè€…è€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ° Esbuild ä¸­ä¸¤ä¸ªé‡è¦çš„ APIï¼Œåˆ†åˆ«æ˜¯<code>Build API</code>å’Œ<code>Transform API</code>ï¼Œä¸ºäº†é¿å…åŒæ­¥æ–¹æ³•æ‰€å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼Œæˆ‘æ¨èä½ ä½¿ç”¨å¼‚æ­¥æ–¹å¼è¿›è¡Œè°ƒç”¨ã€‚</p><p>å…¶æ¬¡ï¼Œæˆ‘ç”¨ä¸€ä¸ªç®€å•çš„<code>env</code>æ’ä»¶ç¤ºä¾‹å¸¦ä½ å­¦ä¹ äº† Esbuild æ’ä»¶çš„ä»£ç ç»“æ„å’ŒåŸºæœ¬æ¦‚å¿µï¼Œå¹¶è¿›è¡Œäº†æ’ä»¶å¼€å‘å®æˆ˜ï¼Œå¼€å‘äº†ä¸¤ä¸ªå¤æ‚åº¦æ¯”è¾ƒé«˜çš„æ’ä»¶ï¼Œåˆ†åˆ«æ˜¯ <code>CDN ä¾èµ–æ‹‰å–æ’ä»¶</code>å’Œ<code>HTML æ„å»ºæ’ä»¶</code>ã€‚å¸Œæœ›ä½ èƒ½é€šè¿‡è¿™äº›ç»å…¸çš„ä¾‹å­å¥½å¥½ä½“ä¼šæ’ä»¶çš„ç¼–å†™æ–¹å¼ï¼Œå¹¶å¤šå¤šå®è·µï¼Œæå‡è‡ªå·±å¯¹ Esbuild çš„ç†è§£ã€‚</p><p>æœ¬æ–‡çš„å†…å®¹åˆ°æ­¤å°±ç»“æŸäº†ï¼Œæ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œæˆ‘ä»¬ä¸‹ä¸€èŠ‚å†è§ï¼</p>',131),u=[d];function E(b,g,h,f,m,v){return a(),n("div",null,u)}const k=s(A,[["render",E]]);export{j as __pageData,k as default};
