import{_ as s,c as l,o as a,N as n}from"./chunks/framework.7812daa2.js";const o="/awesome-node/assets/15-1.44cd2a24.webp",p="/awesome-node/assets/15-2.87d56ad5.webp",e="/awesome-node/assets/15-3.7c57312d.webp",t="/awesome-node/assets/15-4.171e7060.webp",c="/awesome-node/assets/15-5.c2bb34a5.webp",r="/awesome-node/assets/15-6.a7f50dac.webp",y="/awesome-node/assets/15-7.831aeb0b.webp",D="/awesome-node/assets/15-8.43c84c0c.webp",F="/awesome-node/assets/15-9.ce2b67cb.webp",i="/awesome-node/assets/15-10.4100ea54.webp",C="/awesome-node/assets/15-11.e8666e0a.webp",A="/awesome-node/assets/15-12.a80042a2.webp",d="/awesome-node/assets/15-13.b3086a0d.webp",u="/awesome-node/assets/15-14.cf4a56d5.webp",_=JSON.parse('{"title":"Polyfillå’Œè¯­æ³•é™çº§","description":"","frontmatter":{"title":"Polyfillå’Œè¯­æ³•é™çº§"},"headers":[],"relativePath":"book/vite/15.md","lastUpdated":1681457331000}'),b={name:"book/vite/15.md"},g=n('<p>è°ˆåˆ° Viteï¼Œå¯èƒ½å¾ˆå¤šäººéƒ½è§‰å¾—è¿™æ˜¯ä¸€ä¸ªç°ä»£å‰ç«¯æ„å»ºå·¥å…·ï¼Œåº”è¯¥åœ¨ç°ä»£æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼Œæ”¾åˆ°å„ç§è¯­æ³•ç‰¹æ€§éƒ½ç¼ºå¤±çš„ä½ç‰ˆæœ¬æµè§ˆå™¨(å¦‚ <code>ie11</code>)å°±ä¸é€‚ç”¨äº†ã€‚è¿™ç§è§‚å¿µå¯¹ä¸å¯¹å‘¢ï¼Ÿé¦–å…ˆè·Ÿå¤§å®¶æŠ›å‡ºç»“è®º:</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><em>é€šè¿‡ Vite æ„å»ºæˆ‘ä»¬å®Œå…¨å¯ä»¥å…¼å®¹å„ç§ä½ç‰ˆæœ¬æµè§ˆå™¨ï¼Œæ‰“åŒ…å‡ºæ—¢æ”¯æŒç°ä»£(<code>Modern</code>)æµè§ˆå™¨åˆæ”¯æŒæ—§ç‰ˆ(<code>Legacy</code>)æµè§ˆå™¨çš„äº§ç‰©ã€‚</em></p></div><p>æ¥ä¸‹æ¥çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘å°±æ¥ä¸ä½ åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆåœ¨ Vite ä¸­èƒ½å¤Ÿå½»åº•è§£å†³ä½ç‰ˆæœ¬æµè§ˆå™¨çš„å…¼å®¹æ€§é—®é¢˜ï¼Œä»¥åŠé€šè¿‡ä»€ä¹ˆæ‰‹æ®µè§£å†³ï¼Œéœ€è¦å€ŸåŠ©å“ªäº› JS çš„å·¥å…·å’Œç”Ÿæ€ã€‚ä½ ä¼šé¢†ç•¥åˆ°è¯¸å¤šå‰ç«¯ç¼–è¯‘å·¥å…·é“¾åº•å±‚çš„é£å…‰ï¼Œæ¯”å¦‚<code>@babel/preset-env</code>ã€<code>core-js</code>ã€<code>regenerator-runtime</code>ç­‰ç­‰å·¥å…·å’ŒåŸºç¡€åº“æ˜¯å¦‚ä½•å¼ºå¼ºè”åˆçš„ï¼Œå½“ç„¶ï¼Œæˆ‘ä¹Ÿä¼šä»¥å®˜æ–¹çš„ Vite æ’ä»¶<code>@vitejs/plugin-legacy</code>ä¸ºä¾‹å‘Šè¯‰ä½ å¦‚ä½•å°†è¿™äº›åº•å±‚çš„å·¥å…·é“¾æ¥å…¥åˆ° Vite ä¸­ï¼Œå¹¶å®ç°å¼€ç®±å³ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="åœºæ™¯å¤ç°" tabindex="-1">åœºæ™¯å¤ç° <a class="header-anchor" href="#åœºæ™¯å¤ç°" aria-label="Permalink to &quot;åœºæ™¯å¤ç°&quot;">â€‹</a></h2><p>é¦–å…ˆæˆ‘ä»¬æ¥å¤ç°ä¸€ä¸‹é—®é¢˜åœºæ™¯ï¼Œä¸‹é¢ä¸¤å¼ å›¾ä»£è¡¨äº†ä¹‹å‰æˆ‘åœ¨çº¿ä¸Šç¯å¢ƒçœŸå®é‡åˆ°çš„æŠ¥é”™æ¡ˆä¾‹:</p><p><img src="'+o+`" alt="é«˜çº§è¯­è¨€ç‰¹è‰²ä¸æ”¯æŒæŠ¥é”™"></p><p>æŸäº›ä½ç‰ˆæœ¬æµè§ˆå™¨å¹¶æ²¡æœ‰æä¾› <code>Promise</code> è¯­æ³•ç¯å¢ƒä»¥åŠå¯¹è±¡å’Œæ•°ç»„çš„å„ç§ APIï¼Œç”šè‡³ä¸æ”¯æŒç®­å¤´å‡½æ•°è¯­æ³•ï¼Œä»£ç ç›´æ¥æŠ¥é”™ï¼Œä»è€Œå¯¼è‡´çº¿ä¸Šç™½å±äº‹æ•…çš„å‘ç”Ÿï¼Œå°¤å…¶æ˜¯éœ€è¦å…¼å®¹åˆ°<code>IE 11</code>ã€<code>iOS 9</code>ä»¥åŠ<code>Android 4.4</code>çš„åœºæ™¯ä¸­å¾ˆå®¹æ˜“ä¼šé‡åˆ°ã€‚</p><p>ğŸ“šæ—§ç‰ˆæµè§ˆå™¨çš„è¯­æ³•å…¼å®¹é—®é¢˜ä¸»è¦åˆ†ä¸¤ç±»: <strong>è¯­æ³•é™çº§é—®é¢˜</strong>å’Œ <strong>Polyfill ç¼ºå¤±é—®é¢˜</strong>ã€‚å‰è€…æ¯”è¾ƒå¥½ç†è§£ï¼Œæ¯”å¦‚æŸäº›æµè§ˆå™¨ä¸æ”¯æŒç®­å¤´å‡½æ•°ï¼Œæˆ‘ä»¬å°±éœ€è¦å°†å…¶è½¬æ¢ä¸º<code>function(){}</code>è¯­æ³•ï¼›è€Œå¯¹åè€…æ¥è¯´ï¼Œ<code>Polyfill</code>æœ¬èº«å¯ä»¥ç¿»è¯‘ä¸º<code>å«ç‰‡</code>ï¼Œä¹Ÿå°±æ˜¯ä¸ºæµè§ˆå™¨æå‰æ³¨å…¥ä¸€äº› API çš„å®ç°ä»£ç ï¼Œå¦‚<code>Object.entries</code>æ–¹æ³•çš„å®ç°ï¼Œè¿™æ ·å¯ä»¥ä¿è¯äº§ç‰©å¯ä»¥æ­£å¸¸ä½¿ç”¨è¿™äº› APIï¼Œé˜²æ­¢æŠ¥é”™ã€‚</p><p>è¿™ä¸¤ç±»é—®é¢˜æœ¬è´¨ä¸Šæ˜¯é€šè¿‡å‰ç«¯çš„ç¼–è¯‘å·¥å…·é“¾(å¦‚<code>Babel</code>)åŠ JS çš„åŸºç¡€ Polyfill åº“(å¦‚<code>corejs</code>)æ¥è§£å†³çš„ï¼Œä¸ä¼šè·Ÿå…·ä½“çš„æ„å»ºå·¥å…·æ‰€ç»‘å®šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºè¿™äº›æœ¬è´¨çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨å…¶å®ƒçš„æ„å»ºå·¥å…·(å¦‚ Webpack)èƒ½ä½¿ç”¨ï¼Œåœ¨ Vite å½“ä¸­ä¹Ÿå®Œå…¨å¯ä»¥ä½¿ç”¨ã€‚</p><p>æ„å»ºå·¥å…·è€ƒè™‘çš„ä»…ä»…æ˜¯å¦‚ä½•å°†è¿™äº›åº•å±‚åŸºç¡€è®¾æ–½æ¥å…¥åˆ°æ„å»ºè¿‡ç¨‹çš„é—®é¢˜ï¼Œè‡ªå·±å¹¶ä¸éœ€è¦æä¾›åº•å±‚çš„è§£å†³æ–¹æ¡ˆï¼Œæ­£æ‰€è°“<code>æœ¯ä¸šæœ‰ä¸“æ”»</code>ï¼ŒæŠŠä¸“ä¸šçš„äº‹æƒ…äº¤ç»™ä¸“ä¸šçš„å·¥å…·å»åšã€‚æ¥ä¸‹æ¥çš„éƒ¨åˆ†ï¼Œæˆ‘å°±æ¥å¸¦ä½ ç†Ÿæ‚‰ä¸€ä¸‹æ‰€è°“<code>ä¸“ä¸šçš„å·¥å…·</code>åˆ°åº•æœ‰å“ªäº›ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨è¿™äº›å·¥å…·ã€‚</p><h2 id="åº•å±‚å·¥å…·é“¾" tabindex="-1">åº•å±‚å·¥å…·é“¾ <a class="header-anchor" href="#åº•å±‚å·¥å…·é“¾" aria-label="Permalink to &quot;åº•å±‚å·¥å…·é“¾&quot;">â€‹</a></h2><h3 id="_1-å·¥å…·æ¦‚è§ˆ" tabindex="-1">1. å·¥å…·æ¦‚è§ˆ <a class="header-anchor" href="#_1-å·¥å…·æ¦‚è§ˆ" aria-label="Permalink to &quot;1. å·¥å…·æ¦‚è§ˆ&quot;">â€‹</a></h3><p>è§£å†³ä¸Šè¿°æåˆ°çš„ä¸¤ç±»è¯­æ³•å…¼å®¹é—®é¢˜ï¼Œä¸»è¦éœ€è¦ç”¨åˆ°ä¸¤æ–¹é¢çš„å·¥å…·ï¼Œåˆ†åˆ«åŒ…æ‹¬:</p><ul><li><strong>ç¼–è¯‘æ—¶å·¥å…·</strong>ã€‚ä»£è¡¨å·¥å…·æœ‰<code>@babel/preset-env</code>å’Œ<code>@babel/plugin-transform-runtime</code>ã€‚</li><li><strong>è¿è¡Œæ—¶åŸºç¡€åº“</strong>ã€‚ä»£è¡¨åº“åŒ…æ‹¬<code>core-js</code>å’Œ<code>regenerator-runtime</code>ã€‚</li></ul><p><strong>ç¼–è¯‘æ—¶å·¥å…·</strong>çš„ä½œç”¨æ˜¯åœ¨ä»£ç ç¼–è¯‘é˜¶æ®µè¿›è¡Œ<strong>è¯­æ³•é™çº§</strong>åŠ<strong>æ·»åŠ  <code>polyfill</code> ä»£ç çš„å¼•ç”¨è¯­å¥</strong>ï¼Œå¦‚:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">core-js/modules/es6.set.js</span><span style="color:#89DDFF;">&#39;</span></span></code></pre></div><p>ç”±äºè¿™äº›å·¥å…·åªæ˜¯ç¼–è¯‘é˜¶æ®µç”¨åˆ°ï¼Œè¿è¡Œæ—¶å¹¶ä¸éœ€è¦ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ”¾å…¥<code>package.json</code>ä¸­çš„<code>devDependencies</code>ä¸­ã€‚</p><p>è€Œ<strong>è¿è¡Œæ—¶åŸºç¡€åº“</strong>æ˜¯æ ¹æ® <code>ESMAScript</code>å®˜æ–¹è¯­è¨€è§„èŒƒæä¾›å„ç§<code>Polyfill</code>å®ç°ä»£ç ï¼Œä¸»è¦åŒ…æ‹¬<code>core-js</code>å’Œ<code>regenerator-runtime</code>ä¸¤ä¸ªåŸºç¡€åº“ï¼Œä¸è¿‡åœ¨ babel ä¸­ä¹Ÿä¼šæœ‰ä¸€äº›ä¸Šå±‚çš„å°è£…ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><a href="https://babeljs.io/docs/babel-polyfill" target="_blank" rel="noreferrer">@babel/polyfill</a></li><li><a href="https://babeljs.io/docs/babel-runtime" target="_blank" rel="noreferrer">@babel/runtime</a></li><li><a href="https://babeljs.io/docs/babel-runtime-corejs2" target="_blank" rel="noreferrer">@babel/runtime-corejs2</a></li><li><code>@babel/runtime-corejs3</code> çœ‹ä¼¼å„ç§è¿è¡Œæ—¶åº“çœ¼èŠ±ç¼­ä¹±ï¼Œå…¶å®éƒ½æ˜¯<code>core-js</code>å’Œ<code>regenerator-runtime</code>ä¸åŒç‰ˆæœ¬çš„å°è£…ç½¢äº†(<code>@babel/runtime</code>æ˜¯ä¸ªç‰¹ä¾‹ï¼Œä¸åŒ…å« core-js çš„ Polyfill)ã€‚è¿™ç±»åº“æ˜¯é¡¹ç›®è¿è¡Œæ—¶å¿…é¡»è¦ä½¿ç”¨åˆ°çš„ï¼Œå› æ­¤ä¸€å®šè¦æ”¾åˆ°<code>package.json</code>ä¸­çš„<code>dependencies</code>ä¸­ï¼(PS: Babelå®˜ç½‘å¹¶ä¸æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªåŒ…ğŸ˜…)</li></ul><h3 id="_2-å®é™…ä½¿ç”¨" tabindex="-1">2. å®é™…ä½¿ç”¨ <a class="header-anchor" href="#_2-å®é™…ä½¿ç”¨" aria-label="Permalink to &quot;2. å®é™…ä½¿ç”¨&quot;">â€‹</a></h3><p>äº†è§£äº†åŸºæœ¬æ¦‚å¿µåï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥é€šè¿‡ä»£ç å®æ“çš„æ–¹å¼æ¥å­¦ä¹ è¿™äº›å·¥å…·ï¼Œä»£ç æˆ‘ä¹Ÿå·²ç»æ”¾åˆ°äº†<a href="https://github.com/sanyuan0704/juejin-book-vite/tree/main/15-polyfill/babel-test" target="_blank" rel="noreferrer">ä»“åº“</a>ä¸­ï¼Œä½ å¯ä»¥å¯¹ç…§å­¦ä¹ ã€‚</p><p>å¦‚æœä½ æ²¡æ‹‰å–ä»“åº“çš„ä»£ç ï¼Œå¯ä»¥å…ˆæŒ‰ç…§å¦‚ä¸‹çš„å‘½ä»¤åˆå§‹åŒ–é¡¹ç›®:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">babel-test</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">babel-test</span></span>
<span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">init</span></span></code></pre></div><p>ç„¶åå®‰è£…ä¸€äº›å¿…è¦çš„ä¾èµ–:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@babel/cli</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@babel/core</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@babel/preset-env</span></span></code></pre></div><p>æˆ‘è§£é‡Šä¸€ä¸‹å„ä¸ªä¾èµ–çš„ä½œç”¨:</p><ul><li><code>@babel/cli</code>: ä¸º babel å®˜æ–¹çš„è„šæ‰‹æ¶å·¥å…·ï¼Œå¾ˆé€‚åˆæˆ‘ä»¬ç»ƒä¹ ç”¨ã€‚</li><li><code>@babel/core</code>: babel æ ¸å¿ƒç¼–è¯‘åº“ã€‚</li><li><code>@babel/preset-env</code>: babel çš„é¢„è®¾å·¥å…·é›†ï¼ŒåŸºæœ¬ä¸º babel å¿…è£…çš„åº“ã€‚</li></ul><p>æ¥ç€æ–°å»º <code>src</code> ç›®å½•ï¼Œåœ¨ç›®å½•ä¸‹å¢åŠ <code>index.js</code>æ–‡ä»¶:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-dVfbw" id="tab-JYvRWI5" checked="checked"><label for="tab-JYvRWI5">src/index.js</label></div><div class="blocks"><div class="language-js active"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// async å±äºé«˜çº§è¯­æ³•</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> func </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">12123</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Promise.finally() å±äºç°ä»£æµè§ˆå™¨API</span></span>
<span class="line"><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">finally</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span></code></pre></div></div></div><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œç¤ºä¾‹ä»£ç ä¸­æ—¢åŒ…å«äº†<code>é«˜çº§è¯­æ³•</code>ä¹ŸåŒ…å«ç°ä»£æµè§ˆå™¨çš„<code>API</code>ï¼Œæ­£å¥½å¯ä»¥é’ˆå¯¹è¯­æ³•é™çº§å’Œ Polyfill æ³¨å…¥ä¸¤ä¸ªåŠŸèƒ½è¿›è¡Œæµ‹è¯•ã€‚</p><p>æ¥ä¸‹æ¥æ–°å»º<code>.babelrc.json</code>å³ babel çš„é…ç½®æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-IZQIH" id="tab-WM_82Vj" checked="checked"><label for="tab-WM_82Vj">.babelrc.json</label></div><div class="blocks"><div class="language-json active"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">presets</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@babel/preset-env</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// æŒ‡å®šå…¼å®¹çš„æµè§ˆå™¨ç‰ˆæœ¬</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">targets</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">ie</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">11</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// åŸºç¡€åº“ core-js çš„ç‰ˆæœ¬ï¼Œä¸€èˆ¬æŒ‡å®šä¸ºæœ€æ–°çš„å¤§ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">corejs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// Polyfill æ³¨å…¥ç­–ç•¥ï¼Œåæ–‡è¯¦ç»†ä»‹ç»</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">useBuiltIns</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">usage</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// ä¸å°† ES æ¨¡å—è¯­æ³•è½¬æ¢ä¸ºå…¶ä»–æ¨¡å—è¯­æ³•</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">modules</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div></div></div><p>å…¶ä¸­æœ‰ä¸¤ä¸ªæ¯”è¾ƒå…³é”®çš„é…ç½®: <code>targets</code>å’Œ<code>usage</code>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>targets</code> å‚æ•°æŒ‡å®šè¦å…¼å®¹çš„æµè§ˆå™¨ç‰ˆæœ¬ï¼Œä½ æ—¢å¯ä»¥å¡«å¦‚ä¸Šé…ç½®æ‰€ç¤ºçš„ä¸€ä¸ªå¯¹è±¡:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">targets</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">ie</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">11</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ä¹Ÿå¯ä»¥ç”¨ <a href="https://github.com/browserslist/browserslist" target="_blank" rel="noreferrer">Browserslist</a> é…ç½®è¯­æ³•:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">// ie ä¸ä½äº 11 ç‰ˆæœ¬ï¼Œå…¨çƒè¶…è¿‡ 0.5% ä½¿ç”¨ï¼Œä¸”è¿˜åœ¨ç»´æŠ¤æ›´æ–°çš„æµè§ˆå™¨</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">targets</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ie &gt;= 11, &gt; 0.5%, not dead</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>Browserslist æ˜¯ä¸€ä¸ªå¸®åŠ©æˆ‘ä»¬è®¾ç½®ç›®æ ‡æµè§ˆå™¨çš„å·¥å…·ï¼Œä¸å…‰æ˜¯ Babel ç”¨åˆ°ï¼Œå…¶ä»–çš„ç¼–è¯‘å·¥å…·å¦‚<code>postcss-preset-env</code>ã€<code>autoprefix</code>ä¸­éƒ½æœ‰æ‰€åº”ç”¨ã€‚å¯¹äº<code>Browserslist</code>çš„é…ç½®å†…å®¹ï¼Œä½ æ—¢å¯ä»¥æ”¾åˆ° Babel è¿™ç§ç‰¹å®šå·¥å…·å½“ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨<code>package.json</code>ä¸­é€šè¿‡<code>browserslist</code>å£°æ˜:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-o1yh4" id="tab-BqRLkzE" checked="checked"><label for="tab-BqRLkzE">package.json</label></div><div class="blocks"><div class="language-json active"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">browserslist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ie &gt;= 11</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div></div></div><p>æˆ–è€…é€šè¿‡<code>.browserslistrc</code>è¿›è¡Œå£°æ˜:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-KHPiK" id="tab-GPUftkX" checked="checked"><label for="tab-GPUftkX">.browserslistrc</label></div><div class="blocks"><div class="language-txt active"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">// .browserslistrc</span></span>
<span class="line"><span style="color:#A6ACCD;">ie &gt;= 11</span></span></code></pre></div></div></div><p>åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œä¸€èˆ¬æˆ‘ä»¬å¯ä»¥å°†ä½¿ç”¨ä¸‹é¢è¿™äº›<strong>æœ€ä½³å®è·µé›†åˆ</strong>æ¥æè¿°ä¸åŒçš„æµè§ˆå™¨ç±»å‹ï¼Œå‡è½»é…ç½®è´Ÿæ‹…:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ç°ä»£æµè§ˆå™¨</span></span>
<span class="line"><span style="color:#FFCB6B;">last</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">versions</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">since</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2018</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">and</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.5</span><span style="color:#C3E88D;">%</span></span>
<span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">å…¼å®¹ä½ç‰ˆæœ¬</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">PC</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">æµè§ˆå™¨</span></span>
<span class="line"><span style="color:#FFCB6B;">IE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">11</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.5</span><span style="color:#C3E88D;">%,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">not</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dead</span></span>
<span class="line"><span style="color:#FFCB6B;">//</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">å…¼å®¹ä½ç‰ˆæœ¬ç§»åŠ¨ç«¯æµè§ˆå™¨</span></span>
<span class="line"><span style="color:#FFCB6B;">iOS</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">9</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Android</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4.4</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">last</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">versions,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span><span style="color:#C3E88D;">%,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">not</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dead</span></span></code></pre></div><p>å¯¹äºè¿™äº›é…ç½®å¯¹åº”çš„å…·ä½“æµè§ˆå™¨åˆ—è¡¨ï¼Œå¤§å®¶å¯ä»¥å» <a href="https://browserslist.dev/?q=bGFzdCAyIHZlcnNpb25z" target="_blank" rel="noreferrer">browserslist.dev</a> ç«™ç‚¹æŸ¥çœ‹:</p><p><img src="`+p+'" alt="Browserslist"></p><p>å¥½ï¼Œåœ¨è¯´æ˜äº†ç›®æ ‡æµè§ˆå™¨çš„é…ç½®ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹å¦å¤–ä¸€ä¸ªé‡è¦çš„é…ç½®â€”â€”<code>useBuiltIns</code>ï¼Œå®ƒå†³å®šäº†æ·»åŠ  Polyfill ç­–ç•¥ï¼Œé»˜è®¤æ˜¯ <code>false</code>ï¼Œå³ä¸æ·»åŠ ä»»ä½•çš„ Polyfillã€‚ä½ å¯ä»¥æ‰‹åŠ¨å°†<code>useBuiltIns</code>é…ç½®ä¸º<code>entry</code>æˆ–è€…<code>usage</code>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹è¿™ä¸¤ä¸ªé…ç½®ç©¶ç«Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p><p><img src="'+e+`" alt="æ›´æ”¹ä¸ºentry"></p><p>é¦–å…ˆä½ å¯ä»¥å°†è¿™ä¸ªå­—æ®µé…ç½®ä¸º<code>entry</code>ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>entry</code>é…ç½®è§„å®šä½ å¿…é¡»åœ¨å…¥å£æ–‡ä»¶æ‰‹åŠ¨æ·»åŠ ä¸€è¡Œè¿™æ ·çš„ä»£ç :</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-6ATkA" id="tab-Al4p18I" checked="checked"><label for="tab-Al4p18I">src/index.js</label></div><div class="blocks"><div class="language-js active"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line diff add"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">core-js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> func </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">12123</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">finally</span><span style="color:#A6ACCD;">()</span></span></code></pre></div></div></div><p><img src="`+t+'" alt="æ‰‹åŠ¨æ·»åŠ core.js"></p><p>æ¥ç€åœ¨ç»ˆç«¯æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿›è¡Œ Babel ç¼–è¯‘:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">babel</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">src</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--out-dir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dist</span></span></code></pre></div><p>äº§ç‰©è¾“å‡ºåœ¨<code>dist</code>ç›®å½•ä¸­ï¼Œä½ å¯ä»¥å»è§‚å¯Ÿä¸€ä¸‹äº§ç‰©çš„ä»£ç :</p><p><img src="'+c+'" alt="ä½¿ç”¨entryæ–¹å¼çš„äº§ç‰©"></p><p>Babel å·²ç»æ ¹æ®<code>ç›®æ ‡æµè§ˆå™¨</code>çš„é…ç½®ä¸ºæˆ‘ä»¬æ·»åŠ äº†å¤§é‡çš„ Polyfill ä»£ç ï¼Œ<code>index.js</code>æ–‡ä»¶ç®€å•çš„å‡ è¡Œä»£ç è¢«ç¼–è¯‘æˆè¿‘ 300 è¡Œã€‚å®é™…ä¸Šï¼ŒBabel æ‰€åšçš„äº‹æƒ…å°±æ˜¯å°†ä½ çš„<code>import &quot;core-js&quot;</code>ä»£ç æ›¿æ¢æˆäº†äº§ç‰©ä¸­çš„è¿™äº›å…·ä½“æ¨¡å—çš„å¯¼å…¥ä»£ç ã€‚</p><p>ğŸš¨ä½†è¿™ä¸ªé…ç½®æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå³<code>æ— æ³•åšåˆ°æŒ‰éœ€å¯¼å…¥</code>ï¼Œä¸Šé¢çš„äº§ç‰©ä»£ç å…¶å®æœ‰å¤§éƒ¨åˆ†çš„ Polyfill çš„ä»£ç æˆ‘ä»¬å¹¶æ²¡æœ‰ç”¨åˆ°ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¯•è¯•<code>useBuiltIns: usage</code>è¿™ä¸ªæŒ‰éœ€å¯¼å…¥çš„é…ç½®ï¼Œæ”¹åŠ¨é…ç½®åæ‰§è¡Œç¼–è¯‘å‘½ä»¤:</p><p><img src="'+r+'" alt="usage"></p><p>ä½¿ç”¨<code>usage</code>é…ç½®æ—¶ç§»é™¤æ‰‹åŠ¨å¼•å…¥çš„ <code>import &#39;core-js&#39;;</code></p><p><img src="'+y+'" alt="usage"></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">babel</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">src</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--out-dir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dist</span></span></code></pre></div><p>åŒæ ·å¯ä»¥çœ‹åˆ°äº§ç‰©è¾“å‡ºåœ¨äº†<code>dist/index.js</code>ä¸­ï¼Œå†…å®¹å¦‚ä¸‹æ‰€ç¤º:</p><p><img src="'+D+`" alt="usage output"></p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>ğŸ’¡ä¸Šé¢ç¤ºä¾‹å®é™…æµ‹è¯•åï¼Œä½¿ç”¨ <code>entry</code> äº§ç‰©å¤§å°çº¦ <code>29kb</code>ï¼›ä½¿ç”¨ <code>usage</code> äº§ç‰©å¤§å°çº¦ <code>14kb</code>;</p></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Polyfill ä»£ç ä¸»è¦æ¥è‡ª <code>corejs</code> å’Œ <code>regenerator-runtime</code>ï¼Œå› æ­¤å¦‚æœè¦è¿è¡Œèµ·æ¥ï¼Œå¿…é¡»è¦è£…è¿™ä¸¤ä¸ªåº“ã€‚</p></div><p>ğŸ’¡å¯ä»¥å‘ç° Polyfill çš„ä»£ç ç²¾ç®€äº†è®¸å¤šï¼ŒçœŸæ­£åœ°å®ç°äº†æŒ‰éœ€ Polyfill å¯¼å…¥ã€‚å› æ­¤ï¼Œåœ¨å®é™…çš„ä½¿ç”¨å½“ä¸­ï¼Œè¿˜æ˜¯æ¨èå¤§å®¶å°½é‡ä½¿ç”¨<code>useBuiltIns: &quot;usage&quot;</code>ï¼Œè¿›è¡ŒæŒ‰éœ€çš„ Polyfill æ³¨å…¥ã€‚</p><p>æˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹ï¼Œä¸Šé¢æˆ‘ä»¬åˆ©ç”¨<code>@babel/preset-env</code>è¿›è¡Œäº†ç›®æ ‡æµè§ˆå™¨è¯­æ³•çš„é™çº§å’Œ<code>Polyfill</code>æ³¨å…¥ï¼ŒåŒæ—¶ç”¨åˆ°äº†<code>core-js</code>å’Œ<code>regenerator-runtime</code>ä¸¤ä¸ªæ ¸å¿ƒçš„è¿è¡Œæ—¶åº“ã€‚ä½†<code>@babel/preset-env</code> çš„æ–¹æ¡ˆä¹Ÿå­˜åœ¨ä¸€å®šå±€é™æ€§:</p><ol><li>å¦‚æœä½¿ç”¨æ–°ç‰¹æ€§ï¼Œå¾€å¾€æ˜¯é€šè¿‡åŸºç¡€åº“(å¦‚ core-js)å¾€å…¨å±€ç¯å¢ƒæ·»åŠ  Polyfillï¼Œå¦‚æœæ˜¯å¼€å‘åº”ç”¨æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œå¦‚æœæ˜¯å¼€å‘<code>ç¬¬ä¸‰æ–¹å·¥å…·åº“</code>ï¼Œåˆ™å¾ˆå¯èƒ½ä¼šå¯¹<strong>å…¨å±€ç©ºé—´é€ æˆæ±¡æŸ“</strong>ã€‚</li><li>å¾ˆå¤šå·¥å…·å‡½æ•°çš„å®ç°ä»£ç (å¦‚ä¸Šé¢ç¤ºä¾‹ä¸­çš„<code>_defineProperty</code>æ–¹æ³•)ï¼Œä¼šåœ¨è®¸å¤šæ–‡ä»¶ä¸­é‡ç°å‡ºç°ï¼Œé€ æˆ<strong>æ–‡ä»¶ä½“ç§¯å†—ä½™</strong>ã€‚</li></ol><h3 id="_3-æ›´ä¼˜çš„-polyfill-æ³¨å…¥æ–¹æ¡ˆ-transform-runtime" tabindex="-1">3. æ›´ä¼˜çš„ Polyfill æ³¨å…¥æ–¹æ¡ˆ: transform-runtime <a class="header-anchor" href="#_3-æ›´ä¼˜çš„-polyfill-æ³¨å…¥æ–¹æ¡ˆ-transform-runtime" aria-label="Permalink to &quot;3. æ›´ä¼˜çš„ Polyfill æ³¨å…¥æ–¹æ¡ˆ: transform-runtime&quot;">â€‹</a></h3><p>æ¥ä¸‹æ¥è¦ä»‹ç»çš„<code>transform-runtime</code>æ–¹æ¡ˆï¼Œå°±æ˜¯ä¸ºäº†è§£å†³<code>@babel/preset-env</code>çš„ç§ç§å±€é™æ€§ã€‚</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>éœ€è¦æå‰è¯´æ˜çš„æ˜¯ï¼Œ<code>transform-runtime</code>æ–¹æ¡ˆå¯ä»¥ä½œä¸º<code>@babel/preset-env</code>ä¸­<code>useBuiltIns</code>é…ç½®çš„æ›¿ä»£å“ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ä½¿ç”¨<code>transform-runtime</code>æ–¹æ¡ˆï¼Œä½ åº”è¯¥æŠŠ<code>useBuiltIns</code>å±æ€§è®¾ä¸º <code>false</code>ã€‚</p></div><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹è¿™ä¸ªæ–¹æ¡ˆï¼Œé¦–å…ˆå®‰è£…å¿…è¦çš„ä¾èµ–:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@babel/plugin-transform-runtime</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-D</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># æ³¨æ„è¿™é‡Œçš„ @babel/runtime-corejs3 éœ€è¦å®‰è£…åˆ°dependenciesä¸­</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å› ä¸ºå®ƒæ˜¯è¿è¡Œæ—¶æ‰€éœ€è¦çš„</span></span>
<span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@babel/runtime-corejs3</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-S</span></span></code></pre></div><p>æˆ‘è§£é‡Šä¸€ä¸‹è¿™ä¸¤ä¸ªä¾èµ–çš„ä½œç”¨: å‰è€…æ˜¯ç¼–è¯‘æ—¶å·¥å…·ï¼Œç”¨æ¥è½¬æ¢è¯­æ³•å’Œæ·»åŠ  Polyfillï¼Œåè€…æ˜¯è¿è¡Œæ—¶åŸºç¡€åº“ï¼Œå°è£…äº†<code>core-js</code>ã€<code>regenerator-runtime</code>å’Œå„ç§è¯­æ³•è½¬æ¢ç”¨åˆ°çš„<code>å·¥å…·å‡½æ•°</code>ã€‚</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>core-js æœ‰ä¸‰ç§äº§ç‰©ï¼Œåˆ†åˆ«æ˜¯</p><ol><li><p><code>core-js</code> - å®ƒæ˜¯å…¨å±€ Polyfill çš„åšæ³•ï¼Œ@babel/preset-env å°±æ˜¯ç”¨çš„è¿™ç§äº§ç‰©ï¼›</p></li><li><p><code>core-js-pure</code> - å®ƒä¸ä¼šæŠŠ Polyfill æ³¨å…¥åˆ°å…¨å±€ç¯å¢ƒï¼Œå¯ä»¥æŒ‰éœ€å¼•å…¥</p></li><li><p><code>core-js-bundle</code> - æ˜¯æ‰“åŒ…å¥½çš„ç‰ˆæœ¬ï¼ŒåŒ…å«æ‰€æœ‰çš„ Polyfillï¼Œä¸å¤ªå¸¸ç”¨ã€‚</p></li></ol><p><code>@babel/runtime-corejs3</code> ä½¿ç”¨çš„æ˜¯ç¬¬äºŒç§äº§ç‰©ã€‚</p></div><p>æ¥ç€æˆ‘ä»¬å¯¹<code>.babelrc.json</code>ä½œå¦‚ä¸‹çš„é…ç½®:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-AXO_L" id="tab-5efG3tU" checked="checked"><label for="tab-5efG3tU">.babelrc.json</label><input type="radio" name="group-AXO_L" id="tab-cXJ5qz4"><label for="tab-cXJ5qz4">src/index.js</label></div><div class="blocks"><div class="language-json active"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">plugins</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">// æ·»åŠ  transform-runtime æ’ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@babel/plugin-transform-runtime</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">corejs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">presets</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@babel/preset-env</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">targets</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">ie</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">11</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line diff remove"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">corejs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">// å…³é—­ @babel/preset-env é»˜è®¤çš„ Polyfill æ³¨å…¥</span></span>
<span class="line diff remove"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">useBuiltIns</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">usage</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line diff add"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">useBuiltIns</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">modules</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> func </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">12123</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">finally</span><span style="color:#A6ACCD;">()</span></span></code></pre></div></div></div><p>æ‰§è¡Œç»ˆç«¯å‘½ä»¤:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npx</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">babel</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">src</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--out-dir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">dist</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥å¯¹æ¯”ä¸€ä¸‹ <code>@babel/preset-env</code>ä¸‹çš„äº§ç‰©ç»“æœ(æ‰“åŒ…çº¦ <code>461B</code>):</p><p><img src="`+F+`" alt="useBuiltIns vs transform-runtime"></p><p>ç»è¿‡å¯¹æ¯”æˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œ<code>transform-runtime</code> ä¸€æ–¹é¢èƒ½å¤Ÿè®©æˆ‘ä»¬åœ¨ä»£ç ä¸­ä½¿ç”¨<code>éå…¨å±€ç‰ˆæœ¬</code>çš„ Polyfillï¼Œè¿™æ ·å°±é¿å…å…¨å±€ç©ºé—´çš„æ±¡æŸ“ï¼Œè¿™ä¹Ÿå¾—ç›Šäº <code>core-js</code> çš„ pure ç‰ˆæœ¬äº§ç‰©ç‰¹æ€§ï¼›å¦ä¸€æ–¹é¢å¯¹äº<code>asyncToGenerator</code>è¿™ç±»çš„å·¥å…·å‡½æ•°ï¼Œå®ƒä¹Ÿå°†å…¶è½¬æ¢æˆäº†ä¸€æ®µå¼•å…¥è¯­å¥ï¼Œä¸å†å°†å®Œæ•´çš„å®ç°æ”¾åˆ°æ–‡ä»¶ä¸­ï¼ŒèŠ‚çœäº†ç¼–è¯‘åæ–‡ä»¶çš„ä½“ç§¯ã€‚</p><p>å¦å¤–ï¼Œ<code>transform-runtime</code>æ–¹æ¡ˆå¼•ç”¨çš„åŸºç¡€åº“ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œä¸å†æ˜¯ç›´æ¥å¼•å…¥<code>core-js</code>å’Œ<code>regenerator-runtime</code>ï¼Œè€Œæ˜¯å¼•å…¥<code>@babel/runtime-corejs3</code>ã€‚</p><p>å¥½ï¼Œä»‹ç»å®Œäº† Babel è¯­æ³•é™çº§ä¸ Polyfill æ³¨å…¥çš„åº•å±‚æ–¹æ¡ˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•åœ¨ Vite ä¸­åˆ©ç”¨è¿™äº›æ–¹æ¡ˆæ¥è§£å†³ä½ç‰ˆæœ¬æµè§ˆå™¨çš„å…¼å®¹æ€§é—®é¢˜ã€‚</p><h2 id="vite-è¯­æ³•é™çº§ä¸-polyfill-æ³¨å…¥" tabindex="-1">Vite è¯­æ³•é™çº§ä¸ Polyfill æ³¨å…¥ <a class="header-anchor" href="#vite-è¯­æ³•é™çº§ä¸-polyfill-æ³¨å…¥" aria-label="Permalink to &quot;Vite è¯­æ³•é™çº§ä¸ Polyfill æ³¨å…¥&quot;">â€‹</a></h2><p>Vite å®˜æ–¹å·²ç»ä¸ºæˆ‘ä»¬å°è£…å¥½äº†ä¸€ä¸ªå¼€ç®±å³ç”¨çš„æ–¹æ¡ˆ: <code>@vitejs/plugin-legacy</code>ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºå®ƒæ¥è§£å†³é¡¹ç›®è¯­æ³•çš„æµè§ˆå™¨å…¼å®¹é—®é¢˜ã€‚è¿™ä¸ªæ’ä»¶å†…éƒ¨åŒæ ·ä½¿ç”¨ <code>@babel/preset-env</code> ä»¥åŠ <code>core-js</code>ç­‰ä¸€ç³»åˆ—åŸºç¡€åº“æ¥è¿›è¡Œè¯­æ³•é™çº§å’Œ Polyfill æ³¨å…¥ï¼Œå› æ­¤æˆ‘è§‰å¾—å¯¹äºä¸Šæ–‡æ‰€ä»‹ç»çš„åº•å±‚å·¥å…·é“¾çš„æŒæ¡æ˜¯å¿…è¦çš„ï¼Œå¦åˆ™æ— æ³•ç†è§£æ’ä»¶å†…éƒ¨æ‰€åšçš„äº‹æƒ…ï¼ŒçœŸæ­£é‡åˆ°é—®é¢˜æ—¶å¾€å¾€ä¼šä¸çŸ¥æ‰€æªã€‚</p><h3 id="æ’ä»¶ä½¿ç”¨" tabindex="-1">æ’ä»¶ä½¿ç”¨ <a class="header-anchor" href="#æ’ä»¶ä½¿ç”¨" aria-label="Permalink to &quot;æ’ä»¶ä½¿ç”¨&quot;">â€‹</a></h3><p>é¦–å…ˆè®©æˆ‘ä»¬æ¥å®‰è£…ä¸€ä¸‹å®˜æ–¹çš„æ’ä»¶:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">@vitejs/plugin-legacy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-D</span></span></code></pre></div><details class="details custom-block"><summary>ä»¥react-tsæ¨¡æ¿é¡¹ç›®ä¸ºä¾‹</summary><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pnpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vite@latest</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">react-with-legacy</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--template</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">react-ts</span></span></code></pre></div></details><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-uyRWl" id="tab-_GpaYUz" checked="checked"><label for="tab-_GpaYUz">vite.config.ts</label></div><div class="blocks"><div class="language-typescript active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defineConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> react </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vitejs/plugin-react</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> legacy </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@vitejs/plugin-legacy</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// https://vitejs.dev/config/</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">react</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">legacy</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// è®¾ç½®ç›®æ ‡æµè§ˆå™¨ï¼Œbrowserslist é…ç½®è¯­æ³•</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">targets</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ie &gt;= 11</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div></div></div><p>æˆ‘ä»¬åŒæ ·å¯ä»¥é€šè¿‡<code>targets</code>æŒ‡å®šç›®æ ‡æµè§ˆå™¨ï¼Œè¿™ä¸ªå‚æ•°åœ¨æ’ä»¶å†…éƒ¨ä¼šé€ä¼ ç»™<code>@babel/preset-env</code>ã€‚</p><p>åœ¨å¼•å…¥æ’ä»¶åï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æ‰§è¡Œ<code>pnpm run build</code>å¯¹é¡¹ç›®è¿›è¡Œæ‰“åŒ…ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„äº§ç‰©ä¿¡æ¯:</p><p><img src="`+i+`" alt="react with legacy plugin"></p><p>ç›¸æ¯”ä¸€èˆ¬çš„æ‰“åŒ…è¿‡ç¨‹ï¼Œå¤šå‡ºäº†<code>index-legacy.js</code>ã€<code>polyfills-legacy.js</code>ä¸¤ä»½äº§ç‰©æ–‡ä»¶ã€‚è®©æˆ‘ä»¬ç»§ç»­è§‚å¯Ÿä¸€ä¸‹<code>index.html</code>çš„äº§ç‰©å†…å®¹:</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">en</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UTF-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">link</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">rel</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">icon</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">image/svg+xml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/vite.svg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">viewport</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width=device-width, initial-scale=1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">Vite + React + TS</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!-- 1. Modern æ¨¡å¼äº§ç‰© --&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">    &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">crossorigin</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/assets/index-76d1bbb2.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">link</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">rel</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">stylesheet</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/assets/index-3a3b2b63.css</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">    &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">;import</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">g</span><span style="color:#89DDFF;">(){};</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__vite_is_modern_browser</span><span style="color:#89DDFF;">=</span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">    &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;!</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(){</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__vite_is_modern_browser</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">warn</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite: loading legacy chunks, syntax error above and the same error below should be ignored</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite-legacy-polyfill</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">n</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createElement</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">script</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">n</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">n</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onload</span><span style="color:#89DDFF;">=</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(){</span><span style="color:#A6ACCD;">System</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">import</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-legacy-entry</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getAttribute</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data-src</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">appendChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">&lt;!-- 2. Legacy æ¨¡å¼äº§ç‰© --&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">    &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">nomodule</span><span style="color:#89DDFF;">&gt;!</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(){</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createElement</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">script</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">noModule</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">t</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">onbeforeload</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">t</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">{</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">n</span><span style="color:#89DDFF;">=!</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">beforeload</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">){</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;">t</span><span style="color:#F07178;">)</span><span style="color:#A6ACCD;">n</span><span style="color:#89DDFF;">=!</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">target</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">hasAttribute</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nomodule</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">||!</span><span style="color:#A6ACCD;">n</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">preventDefault</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,!</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">head</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">appendChild</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">t</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">remove</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">}}</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">    &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">nomodule</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">crossorigin</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite-legacy-polyfill</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/assets/polyfills-legacy-ddb4f3dd.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">    &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">nomodule</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">crossorigin</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite-legacy-entry</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">data-src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/assets/index-legacy-708a9722.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">System</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">import</span><span style="color:#A6ACCD;">(document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-legacy-entry</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getAttribute</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data-src</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p>é€šè¿‡å®˜æ–¹çš„<code>legacy</code>æ’ä»¶ï¼Œ Vite ä¼šåˆ†åˆ«æ‰“åŒ…å‡º<code>Modern</code>æ¨¡å¼å’Œ<code>Legacy</code>æ¨¡å¼çš„äº§ç‰©ï¼Œç„¶åå°†ä¸¤ç§äº§ç‰©æ’å…¥åŒä¸€ä¸ª HTML é‡Œé¢ï¼Œ<code>Modern</code>äº§ç‰©è¢«æ”¾åˆ° <code>type=&quot;module&quot;</code>çš„ script æ ‡ç­¾ä¸­ï¼Œè€Œ<code>Legacy</code>äº§ç‰©åˆ™è¢«æ”¾åˆ°å¸¦æœ‰ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/script#attr-nomodule" target="_blank" rel="noreferrer">nomodule</a> çš„ script æ ‡ç­¾ä¸­ã€‚æµè§ˆå™¨çš„åŠ è½½ç­–ç•¥å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="`+C+'" alt="module vs nomoduleåŠ è½½ç­–ç•¥"></p><p>è¿™æ ·äº§ç‰©ä¾¿å°±èƒ½å¤ŸåŒæ—¶æ”¾åˆ°ç°ä»£æµè§ˆå™¨å’Œä¸æ”¯æŒ<code>type=&quot;module&quot;</code>çš„ä½ç‰ˆæœ¬æµè§ˆå™¨å½“ä¸­æ‰§è¡Œã€‚å½“ç„¶ï¼Œåœ¨å…·ä½“çš„ä»£ç è¯­æ³•å±‚é¢ï¼Œæ’ä»¶è¿˜éœ€è¦è€ƒè™‘è¯­æ³•é™çº§å’Œ Polyfill æŒ‰éœ€æ³¨å…¥çš„é—®é¢˜ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥åˆ†æä¸€ä¸‹ Vite çš„å®˜æ–¹<code>legacy</code>æ’ä»¶æ˜¯å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜çš„ã€‚</p><h3 id="æ’ä»¶æ‰§è¡ŒåŸç†" tabindex="-1">æ’ä»¶æ‰§è¡ŒåŸç† <a class="header-anchor" href="#æ’ä»¶æ‰§è¡ŒåŸç†" aria-label="Permalink to &quot;æ’ä»¶æ‰§è¡ŒåŸç†&quot;">â€‹</a></h3><p>å®˜æ–¹çš„<code>legacy</code>æ’ä»¶æ˜¯ä¸€ä¸ªç›¸å¯¹å¤æ‚åº¦æ¯”è¾ƒé«˜çš„æ’ä»¶ï¼Œç›´æ¥çœ‹æºç å¯èƒ½ä¼šå¾ˆéš¾ç†è§£ï¼Œè¿™é‡Œæˆ‘æ¢³ç†äº†ç”»äº†ä¸€å¼ ç®€åŒ–åçš„æµç¨‹å›¾ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ ¹æ®è¿™å¼ æµç¨‹å›¾æ¥ä¸€ä¸€æ‹†è§£è¿™ä¸ªæ’ä»¶åœ¨å„ä¸ªé’©å­é˜¶æ®µåˆ°åº•åšäº†äº›ä»€ä¹ˆã€‚</p><p><img src="'+A+`" alt="legacy pluginåŸç†"></p><p>é¦–å…ˆæ˜¯åœ¨<code>configResolved</code>é’©å­ä¸­è°ƒæ•´äº†<code>output</code>å±æ€§ï¼Œè¿™ä¹ˆåšçš„ç›®çš„æ˜¯è®© Vite åº•å±‚ä½¿ç”¨çš„æ‰“åŒ…å¼•æ“ Rollup èƒ½å¦å¤–æ‰“åŒ…å‡ºä¸€ä»½<code>Legacy æ¨¡å¼</code>çš„äº§ç‰©ï¼Œå®ç°ä»£ç å¦‚ä¸‹:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> createLegacyOutput </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">options</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{})</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// system æ ¼å¼äº§ç‰©</span></span>
<span class="line"><span style="color:#F07178;">    format</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">system</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// è½¬æ¢æ•ˆæœ: index.[hash].js -&gt; index-legacy.[hash].js</span></span>
<span class="line"><span style="color:#F07178;">    entryFileNames</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getLegacyOutputFileName</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">entryFileNames</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    chunkFileNames</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getLegacyOutputFileName</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">chunkFileNames</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> rollupOptions </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">build</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> output </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> rollupOptions</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (Array</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isArray</span><span style="color:#A6ACCD;">(output)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">rollupOptions</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">output</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">output</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">createLegacyOutput</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">output</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">rollupOptions</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">output</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#82AAFF;">createLegacyOutput</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">output</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">output</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>æ¥ç€ï¼Œåœ¨<code>renderChunk</code>é˜¶æ®µï¼Œæ’ä»¶ä¼šå¯¹ Legacy æ¨¡å¼äº§ç‰©è¿›è¡Œè¯­æ³•è½¬è¯‘å’Œ Polyfill æ”¶é›†ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œå¹¶ä¸ä¼šçœŸæ­£æ³¨å…¥<code>Polyfill</code>ï¼Œè€Œä»…ä»…åªæ˜¯æ”¶é›†<code>Polyfill</code>:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">renderChunk</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">raw</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">chunk</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">opts</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 1. ä½¿ç”¨ babel + @babel/preset-env è¿›è¡Œè¯­æ³•è½¬æ¢ä¸ Polyfill æ³¨å…¥</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 2. ç”±äºæ­¤æ—¶å·²ç»æ‰“åŒ…åçš„ Chunk å·²ç»ç”Ÿæˆ</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//   è¿™é‡Œéœ€è¦å»æ‰ babel æ³¨å…¥çš„ import è¯­å¥ï¼Œå¹¶è®°å½•æ‰€éœ€çš„ Polyfill</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 3. æœ€åçš„ Polyfill ä»£ç å°†ä¼šåœ¨ generateBundle é˜¶æ®µç”Ÿæˆ</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ç”±äºåœºæ™¯æ˜¯åº”ç”¨æ‰“åŒ…ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨ @babel/preset-env çš„<code>useBuiltIns: &#39;usage&#39;</code>æ¥è¿›è¡Œå…¨å±€ Polyfill çš„æ”¶é›†æ˜¯æ¯”è¾ƒæ ‡å‡†çš„åšæ³•ã€‚</p><p>å›åˆ° Vite æ„å»ºçš„ä¸»æµç¨‹ä¸­ï¼Œæ¥ä¸‹æ¥ä¼šè¿›å…¥<code>generateChunk</code>é’©å­é˜¶æ®µï¼Œç°åœ¨ Vite ä¼šå¯¹ä¹‹å‰æ”¶é›†åˆ°çš„<code>Polyfill</code>è¿›è¡Œç»Ÿä¸€çš„æ‰“åŒ…ï¼Œå®ç°ä¹Ÿæ¯”è¾ƒç²¾å¦™ï¼Œä¸»è¦é€»è¾‘é›†ä¸­åœ¨<code>buildPolyfillChunk</code>å‡½æ•°ä¸­:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// æ‰“åŒ… Polyfill ä»£ç </span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">buildPolyfillChunk</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">imports</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">bundle</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">facadeToChunkMap</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">buildOptions</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;font-style:italic;">externalSystemJS</span></span>
<span class="line"><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">minify</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">assetsDir</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buildOptions</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">minify</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">minify</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">terser</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è°ƒç”¨ Vite çš„ build API è¿›è¡Œæ‰“åŒ…</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">build</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ ¹è·¯å¾„è®¾ç½®ä¸ºæ’ä»¶æ‰€åœ¨ç›®å½•</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ç”±äºæ’ä»¶çš„ä¾èµ–åŒ…å«\`core-js\`ã€\`regenerator-runtime\`è¿™äº›è¿è¡Œæ—¶åŸºç¡€åº“</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å› æ­¤è¿™é‡Œ Vite å¯ä»¥æ­£å¸¸è§£æåˆ°åŸºç¡€ Polyfill åº“çš„è·¯å¾„</span></span>
<span class="line"><span style="color:#F07178;">    root</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">__dirname</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    write</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// è¿™é‡Œçš„æ’ä»¶å®ç°äº†ä¸€ä¸ªè™šæ‹Ÿæ¨¡å—</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Vite å¯¹äº polyfillId ä¼šè¿”å›æ‰€æœ‰ Polyfill çš„å¼•å…¥è¯­å¥</span></span>
<span class="line"><span style="color:#F07178;">    plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#82AAFF;">polyfillsPlugin</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">imports</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">externalSystemJS</span><span style="color:#F07178;">)]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    build</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      rollupOptions</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// è®¿é—® polyfillId</span></span>
<span class="line"><span style="color:#F07178;">        input</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;">// name æš‚å¯è§†ä½œ\`polyfills-legacy\`</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;">// polyfillId ä¸ºä¸€ä¸ªè™šæ‹Ÿæ¨¡å—ï¼Œç»è¿‡æ’ä»¶å¤„ç†åä¼šæ‹¿åˆ°æ‰€æœ‰ Polyfill çš„å¼•å…¥è¯­å¥</span></span>
<span class="line"><span style="color:#F07178;">          [</span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">polyfillId</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ‹¿åˆ° polyfill äº§ç‰© chunk</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_polyfillChunk</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Array</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isArray</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">output</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_polyfillChunk</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">polyfillChunk</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_polyfillChunk</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">output</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åç»­åšä¸¤ä»¶äº‹æƒ…:</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 1. è®°å½• polyfill chunk çš„æ–‡ä»¶åï¼Œæ–¹ä¾¿åç»­æ’å…¥åˆ° Modern æ¨¡å¼äº§ç‰©çš„ HTML ä¸­ï¼›</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 2. åœ¨ bundle å¯¹è±¡ä¸Šæ‰‹åŠ¨æ·»åŠ  polyfill çš„ chunkï¼Œä¿è¯äº§ç‰©å†™åˆ°ç£ç›˜ä¸­</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>å› æ­¤ï¼Œä½ å¯ä»¥ç†è§£ä¸ºè¿™ä¸ªå‡½æ•°çš„ä½œç”¨å³é€šè¿‡ <code>vite build</code> å¯¹<code>renderChunk</code>ä¸­æ”¶é›†åˆ° polyfill ä»£ç è¿›è¡Œæ‰“åŒ…ï¼Œç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„ chunk:</p><p><img src="`+d+`" alt="plugin legacy renderChunk hook"></p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œpolyfill chunk ä¸­é™¤äº†åŒ…å«ä¸€äº› core-js å’Œ regenerator-runtime çš„ç›¸å…³ä»£ç ï¼Œä¹ŸåŒ…å«äº† <code>SystemJS</code> çš„å®ç°ä»£ç ï¼Œä½ å¯ä»¥å°†å…¶ç†è§£ä¸º ESM çš„åŠ è½½å™¨ï¼Œå®ç°äº†åœ¨æ—§ç‰ˆæµè§ˆå™¨ä¸‹çš„æ¨¡å—åŠ è½½èƒ½åŠ›ã€‚</p></div><p>ç°åœ¨æˆ‘ä»¬å·²ç»èƒ½å¤Ÿæ‹¿åˆ° Legacy æ¨¡å¼çš„äº§ç‰©æ–‡ä»¶ååŠ Polyfill Chunk çš„æ–‡ä»¶åï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡<code>transformIndexHtml</code>é’©å­æ¥å°†è¿™äº›äº§ç‰©æ’å…¥åˆ° HTML çš„ç»“æ„ä¸­:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">transformIndexHtml</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">html</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 1. æ’å…¥ Polyfill chunk å¯¹åº”çš„ &lt;script nomodule&gt; æ ‡ç­¾</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 2. æ’å…¥ Legacy äº§ç‰©å…¥å£æ–‡ä»¶å¯¹åº”çš„ &lt;script nomodule&gt; æ ‡ç­¾</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>OKï¼ŒVite å®˜æ–¹çš„ legacy æ’ä»¶çš„ä¸»è¦åŸç†å°±ä»‹ç»åˆ°è¿™é‡Œï¼Œä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œè®²è§£çš„è¿‡ç¨‹ä¸­å¿½ç•¥äº†ä¸€äº›ä¸ä¸»æµç¨‹å…³è”ä¸å¤§çš„ç»†èŠ‚ï¼Œæœ€åç»™å¤§å®¶è¡¥å……ä¸€ä¸‹ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ç»§ç»­æ·±å…¥å­¦ä¹ :</p><ul><li>å½“æ’ä»¶å‚æ•°ä¸­å¼€å¯äº†<code>modernPolyfills</code>é€‰é¡¹æ—¶ï¼ŒVite ä¹Ÿä¼šè‡ªåŠ¨å¯¹ Modern æ¨¡å¼çš„äº§ç‰©è¿›è¡Œ Polyfill æ”¶é›†ï¼Œå¹¶å•ç‹¬æ‰“åŒ…æˆ<code>polyfills-modern.js</code>çš„ chunkï¼ŒåŸç†å’Œ Legacy æ¨¡å¼ä¸‹å¤„ç† Polyfill ä¸€æ ·ã€‚</li><li>Sarari 10.1 ç‰ˆæœ¬ä¸æ”¯æŒ <code>nomodule</code>ï¼Œä¸ºæ­¤éœ€è¦å•ç‹¬å¼•å…¥ä¸€äº›è¡¥ä¸ä»£ç , <a href="https://gist.github.com/samthor/64b114e4a4f539915a95b91ffd340acc" target="_blank" rel="noreferrer">ç‚¹å‡»æŸ¥çœ‹</a></li><li>éƒ¨åˆ†ä½ç‰ˆæœ¬ Edge æµè§ˆå™¨è™½ç„¶æ”¯æŒ type=&quot;module&quot;ï¼Œä½†ä¸æ”¯æŒåŠ¨æ€ importï¼Œä¸ºæ­¤ä¹Ÿéœ€è¦æ’å…¥ä¸€äº›<a href="https://github.com/vitejs/vite/pull/3885" target="_blank" rel="noreferrer">è¡¥ä¸ä»£ç </a>ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µä¸‹é™çº§ä½¿ç”¨ Legacy æ¨¡å¼çš„äº§ç‰©ã€‚</li></ul><h2 id="å°ç»“" tabindex="-1">å°ç»“ <a class="header-anchor" href="#å°ç»“" aria-label="Permalink to &quot;å°ç»“&quot;">â€‹</a></h2><p>æ­å–œä½ ï¼Œå­¦ä¹ å®Œäº†æœ¬èŠ‚çš„å†…å®¹ï¼æœ¬èŠ‚ä¸»è¦è®²è§£äº† Vite ä¸­è¯­æ³•é™çº§ä¸ Polyfill ç›¸å…³çš„å†…å®¹ï¼Œæ¶‰åŠçš„æ¦‚å¿µæ¯”è¾ƒå¤šï¼Œç¯‡å¹…ä¹Ÿæ¯”è¾ƒé•¿ï¼Œä½ éœ€è¦é‡ç‚¹æŒæ¡ä»¥ä¸‹å†…å®¹:</p><ol><li><code>@babel/preset-env</code> çš„ä½¿ç”¨ã€‚</li><li><code>useBuiltIns</code> ä¸ <code>transformRuntime</code> ä¸¤ç§ Polyfill æ–¹æ¡ˆçš„åŒºåˆ«ã€‚</li><li>Vite é™çº§æ’ä»¶<code>@vitejs/plugin-legacy</code> çš„ä½¿ç”¨åŠåŸç†ã€‚</li></ol><p>é¦–å…ˆæˆ‘ç»™ä½ å¤ç°äº†çº¿ä¸Šçš„ä½ç‰ˆæœ¬æµè§ˆå™¨è¯­æ³•æŠ¥é”™æƒ…æ™¯ï¼Œä¸»è¦åˆ†ä¸º <strong>è¯­æ³•æŠ¥é”™</strong> å’Œ <strong>Polyfill ç¼ºå¤±</strong> çš„é—®é¢˜ï¼Œç”±æ­¤å¼•å‡ºäº†åº•å±‚çš„è§£å†³æ–¹æ¡ˆâ€”â€”ä½¿ç”¨ <code>Babel ç¼–è¯‘å·¥å…·é“¾</code> å’Œ JS è¿è¡Œæ—¶åŸºç¡€åº“æ¥å®Œæˆã€‚æ¥ç€æˆ‘è·Ÿä½ å…·ä½“ä»‹ç»äº† <code>@babel/preset-env</code>çš„ä½¿ç”¨ï¼Œé€šè¿‡å®é™…çš„ä»£ç æ¡ˆä¾‹è®©ä½ ä½“éªŒäº†å®ƒçš„è¯­æ³•é™çº§å’Œè‡ªåŠ¨ Polyfill æ³¨å…¥çš„èƒ½åŠ›ï¼Œæ¥ç€ï¼Œæˆ‘åˆç»™ä½ ä»‹ç»äº†ä¸€ä¸ªæ›´ä¼˜çš„ Polyfill æ–¹æ¡ˆâ€”â€”<code>transform-runtime</code>æ–¹æ¡ˆï¼Œå¹¶ä¸<code>@babel/preset-env</code>çš„<code>useBuiltIns</code>æ–¹æ¡ˆè¿›è¡Œäº†å¯¹æ¯”ï¼Œåˆ†æäº†<code>transform-runtime</code>æ–¹æ¡ˆçš„ä¸¤ä¸ªä¼˜åŒ–ç‚¹: <strong>ä¸å½±å“å…¨å±€ç©ºé—´</strong>å’Œ<strong>ä¼˜åŒ–æ–‡ä»¶ä½“ç§¯</strong>ã€‚</p><p>åœ¨ä»‹ç»äº†åº•å±‚çš„è§£å†³æ–¹æ¡ˆä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹å­¦ä¹ åœ¨ Vite ä¸­çš„è§£å†³æ–¹æ¡ˆâ€”â€”<code>@vitejs/plugin-legacy</code>ï¼Œåˆ†æäº†å®ƒå¦‚ä½•è®©äº§ç‰©èƒ½å¤ŸåŒæ—¶å…¼å®¹ç°ä»£æµè§ˆå™¨å’Œä¸æ”¯æŒ <code>type=&quot;module&quot;</code>çš„ä½ç‰ˆæœ¬æµè§ˆå™¨ï¼Œæ¥ç€æ·±å…¥åœ°è®²è§£äº†è¿™ä¸ªæ’ä»¶çš„å®ç°åŸç†ï¼Œä½ å¯ä»¥å‘ç°åº•å±‚ä¹Ÿæ˜¯é€šè¿‡<code>@babel/preset-env</code>æ¥å®Œæˆå…¼å®¹æ–¹æ¡ˆçš„ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯æœ¬èŠ‚çš„å…¨éƒ¨å†…å®¹ï¼Œå¸Œæœ›å¯¹ä½ èƒ½æœ‰æ‰€å¯å‘ï¼Œä¹Ÿæ¬¢è¿å°†ä½ çš„å­¦ä¹ å¿ƒå¾—å’Œå›°æƒ‘æ‰“åœ¨è¯„è®ºåŒºï¼Œæˆ‘ä»¬ä¸‹ä¸€å°èŠ‚å†è§ğŸ‘‹ğŸ»</p><details class="details custom-block"><summary>é™„ä¸Šè¯„è®ºåŒºçš„ä¸€ä¸ªé—®ç­”</summary><p>å­¦å®Œæœ¬èŠ‚å†…å®¹ï¼Œå¯ä»¥æ€è€ƒå¦‚ä¸‹é—®é¢˜ï¼š</p><ol><li>Viteæ˜¯å¦å¯ä»¥æ„å»ºå‡ºæ”¯æŒä½ç‰ˆæœ¬æµè§ˆå™¨çš„äº§ç‰©ï¼Ÿ <ul><li>æ”¯æŒ</li></ul></li><li>æ—§ç‰ˆæœ¬æµè§ˆå™¨è¯­æ³•å…¼å®¹é—®é¢˜åˆ†ä¸ºå“ªä¸¤ç±»ï¼Ÿ <ul><li>è¯­æ³•é”™è¯¯ã€ç¼ºå°‘polyfillå®ç°</li></ul></li><li>ä¸ºè§£å†³æ—§æµè§ˆå™¨è¯­æ³•å…¼å®¹é—®é¢˜ï¼Œéœ€è¦ç”¨åˆ°ä»€ä¹ˆå·¥å…·ï¼Ÿä½œç”¨éƒ½æ˜¯ä»€ä¹ˆï¼Ÿä½¿ç”¨æ—¶éœ€æ³¨æ„ä»€ä¹ˆé—®é¢˜ï¼Ÿ <ul><li>babelå·¥å…·é“¾ï¼š@babel/cli @babel/core @babel/preset-env,å¯¹é¡¹ç›®è¿›è¡Œè¯­æ³•è½¬æ¢ï¼Œéœ€è¦æ³¨æ„é…ç½®.babelrc.jsonçš„presetsçš„targetsä¸ºç›®æ ‡æµè§ˆå™¨ç‰ˆæœ¬ç¾¤ä½“ï¼ŒåŠuseBuiltIns:&quot;usage&quot;;è¿™æ˜¯æŒ‰éœ€(targets)å¼•ç”¨polyfillä¸”æ³¨å…¥åˆ°windowå…¨å±€ï¼Œå¯¹äºåº”ç”¨é¡¹ç›®æ¥è¯´æ˜¯æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¯¹äºç±»åº“é¡¹ç›®å°±æœ‰æ±¡æŸ“windowå…¨å±€çš„é—®é¢˜ï¼Œä¸ºæ­¤ç±»åº“ç‰¹æ„é‡‡ç”¨å¦å¤–çš„æ–¹å¼ï¼š@babel/plugin-transform-runtimeé…ç½®ï¼Œä¸”è®¾ç½®useBuiltInså…³é—­ï¼Œå³presetsçš„useBuiltIns: false</li></ul></li><li>åˆ©ç”¨@babel/preset-envæ—¶æœ‰ä¸¤ä¸ªé‡è¦é…ç½®ï¼štargets ï¼ŒuseBuiltInsã€‚è°ˆä¸€ä¸‹å®ƒä»¬çš„ä½œç”¨ï¼Ÿ <ul><li><code>targets</code>å°±æ˜¯åªæœ‰@babel/preset-envé‡‡ç”¨çš„é…ç½®ï¼Œè¡¨ç¤ºæ ¹æ®å“ªäº›æµè§ˆå™¨ç‰ˆæœ¬æ¥è¿›è¡Œè¯­æ³•è½¬æ¢å’Œè¯­æ³•å«ç‰‡æ³¨å…¥ï¼›<code>useBuiltIns</code>è¡¨ç¤ºæ€ä¹ˆå»è¿›è¡Œè¯­æ³•è½¬æ¢å’Œå«ç‰‡æ³¨å…¥ï¼Œè¿™é‡ŒåŒ…æ‹¬å‡ ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°&#39;entry&#39;ï¼Œä»£è¡¨æŠŠæ‰€æœ‰çš„polyfillæ³¨å…¥åˆ°å…¨å±€windowä¸‹ï¼Œè¿™æ ·å­å°±ä¼šè®©é¡¹ç›®ä½“ç§¯å¾ˆå¤§ï¼›æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬é¡¹ç›®ä¸ç”¨è¿™ä¸ªï¼Œè€Œæ˜¯é‡‡ç”¨ç¬¬äºŒä¸ªå‚æ•°:usageï¼Œè¡¨ç¤ºä½ ç”¨åˆ°å“ªäº›éœ€è¦è½¬æ¢çš„è¯­æ³•æˆ–è€…å«ç‰‡å°±è½¬æ¢å“ªäº›è¯­æ³•ã€æ³¨å…¥å“ªäº›polyfillï¼›ç¬¬ä¸‰ä¸ªå‚æ•°: false ä¸è¿›è¡Œè¯­æ³•è½¬æ¢ã€å«ç‰‡æ³¨å…¥ã€‚</li></ul></li><li>è§£å†³æµè§ˆå™¨å…¼å®¹é—®é¢˜æ—¶ï¼Œ@babel/preset-envæ–¹æ¡ˆæœ‰ä»€ä¹ˆå±€é™ï¼Ÿ <ul><li>å±€é™å°±æ˜¯æ ¹æ®é…ç½®å¯èƒ½ä¼šåœ¨å…¨å±€æ³¨å…¥äº†polyfillï¼Œæ±¡æŸ“å…¨å±€</li></ul></li><li>è§£å†³æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨transform-runtimeæ–¹æ¡ˆï¼Œç®€è¿°å…¶ä½¿ç”¨å’Œé…ç½®ï¼Ÿ <ul><li>å‚è€ƒç¬¬3ç‚¹é‡Œé¢è¯´çš„</li></ul></li><li>è°ˆä¸€ä¸‹Viteé™çº§æ’ä»¶@vitejs/plugin-legacyçš„ä½¿ç”¨åŠåŸç†ï¼Ÿ <ul><li>å…¶å®å°±æ˜¯åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡viteçš„é’©å­å»åŸºäºesm chunké‡æ–°ç”Ÿæˆä¸€ä»½å¯¹åº”çš„legacy chunkã€‚å…·ä½“å®ç°åŸç†æ˜¯ï¼šé‡‡ç”¨preset-envæ–¹æ¡ˆï¼Œ1.åœ¨configResolvedé’©å­æ·»åŠ outputè¾“å‡ºçš„legacyæ–‡ä»¶é…ç½®ï¼Œ2.åœ¨renderChunké’©å­å¯¹polyfillè¿›è¡Œæ”¶é›† 3.åœ¨generateBundleé’©å­ä¸­è¿›è¡Œpolyfillçš„æ‰“åŒ…ï¼Œåœ¨transformIndexHtmlä¸­å°†legacyäº§ç‰©å’Œpolyfillæ–‡ä»¶æ³¨å…¥htmlä¸­</li></ul></li></ol></details><p><img src="`+u+'" alt="mindmap"></p>',123),m=[g];function f(h,E,v,q,k,j){return a(),l("div",null,m)}const P=s(b,[["render",f]]);export{_ as __pageData,P as default};
